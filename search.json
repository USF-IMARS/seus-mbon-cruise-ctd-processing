[
  {
    "objectID": "cruise_report/cruise_reports/WS23061.html",
    "href": "cruise_report/cruise_reports/WS23061.html",
    "title": "WS23061",
    "section": "",
    "text": "WS23061\n\n\nsetup\nif (!nzchar(system.file(package = \"librarian\"))) {\n  install.packages(\"librarian\")\n}\n\nlibrarian::shelf(\n  quiet = TRUE,\n  readr, here, fs, ggplot2, glue, \"jiho/castr\", dplyr, oce, patchwork, purrr, tidyr\n)\n\n\n\n\nCode\nsource(here(\"R/cruise_load.R\"))\ncruise_df &lt;- cruise_load(params$cruise_id)\n\n\n\n\nplot depth & pressure vs time elapsed\ntryCatch({\n  plots &lt;- list()\n  \n  for (station_name in unique(cruise_df$station)) {\n    subset_df &lt;- filter(cruise_df, station == station_name)\n    plots[[station_name]] &lt;- ggplot(subset_df, aes(x = time_elapsed)) +\n      geom_point(aes(y = depth), color = \"blue\") +  # Plot depth in blue\n      geom_line(aes(y = sea_water_pressure), color = \"red\") +  # Plot sea water pressure in red\n      ggtitle(glue(\"{station_name}\")) +\n      theme(\n        axis.title.x = element_blank(),\n        axis.title.y = element_blank(),\n        axis.text.x = element_blank(),\n        axis.text.y = element_blank(),\n        axis.ticks.x = element_blank(),\n        axis.ticks.y = element_blank()\n      )  # Remove individual axis titles and text\n  }\n  \n  # drop nulls\n  plots &lt;- purrr::compact(plots)\n  \n  # Combine all plots into a grid\n  combined_plot &lt;- wrap_plots(plots) + \n    plot_layout(ncol = 4) +  # Adjust ncol to set number of columns in the grid\n    plot_annotation(\n      title = \"Depth (blue) and Pressure (red)\",\n      subtitle = \"Each panel represents a different station\",\n      caption = \"Time Elapsed (x-axis) vs Depth & Pressure (y-axis)\"\n    ) +\n    theme(\n      plot.tag = element_text(size = 12, face = \"bold\"),\n      plot.tag.position = \"topleft\",\n      axis.title.x = element_text(margin = margin(t = 10)),\n      axis.title.y = element_text(margin = margin(r = 10))\n    )\n  \n  print(combined_plot)\n}, error = function(er){\n  print(er)\n});\n\n\n\n\n\n\n\n\n\n\n\nplot across all stations\np &lt;- ggplot(cruise_df, aes(x = time, y = depth, fill = station)) +\n  geom_col() +  # This creates the bars\n  # geom_text(aes(label = station), vjust = -0.3) +  # This adds labels to each bar, adjust vjust for position\n  labs(x = \"Time\", y = \"Depth\", title = \"Depth over Time by Station\") +  # Set labels and title\n  theme_minimal()  # Use a minimal theme\nprint(p)\n\n\n\n\n\n\n\n\n\n\n\ncreate oce.ctd objects from dataframes\nctd_load &lt;- function(data, other_params = NULL) {\n  \n  # create csv into ctd object\n  test_ctd &lt;-\n    as.ctd(\n      salinity    = data$sea_water_salinity,\n      temperature = data$sea_water_temperature,\n      pressure    = data$sea_water_pressure,\n      station     = data$station\n    )\n  \n  # add additional columns to ctd object\n  if (!is.null(other_params)) {\n    for (param_name in other_params) {\n      test_ctd &lt;-\n        oceSetData(\n          object = test_ctd,\n          name   = param_name,\n          value  = data[[param_name]]\n        )\n    }\n  }\n  print(glue(\"{data$station[1]}:\\t{length(test_ctd@data$scan)} scans\"))\n\n\n  return(test_ctd)\n}\n\n# Define other parameters to add\nother_params &lt;- c(\n  \"cruise_id\", \"station\", \"time\", \"time_elapsed\", \n  \"latitude\", \"longitude\", \"sea_water_electrical_conductivity\", \n  \"CDOM\", \"dissolved_oxygen\",\"oxygen_saturation\", \"chlorophyll_concentration\", \n  \"chlorophyll_fluorescence\", \"photosynthetically_available_radiation\", \n  \"beam_attenuation\",\"beam_transmission\", \"depth\", \"sea_water_sigma_t\",\n  \"descent_rate\", \"sound_velocity\",\"altimeter\"\n)\n\n# Split data by station and create data list\nctd_FK &lt;- cruise_df %&gt;%\n  split(.$station) %&gt;%\n  map(~ ctd_load(.x, other_params = other_params)) # ~ is a lambda(x)\n\n\n.007:   3010 scans\n.009:   3990 scans\n.009_5: 6867 scans\n.010:   80 scans\n.012:   4670 scans\n.016:   2674 scans\n.018:   4197 scans\n.030:   3501 scans\n.031:   4094 scans\n.033:   3067 scans\n.033UP: 162 scans\n.041:   2591 scans\n.045:   3317 scans\n.047:   3069 scans\n.049:   3 scans\n.051:   3337 scans\n.053:   504 scans\n.054:   60 scans\n.055:   265 scans\n.056:   99 scans\n.057:   2488 scans\n.057_1: 2546 scans\n.057_2: 2865 scans\n.057_3: 3214 scans\n.058:   2890 scans\n.060:   3249 scans\n.064:   591 scans\n.065:   103 scans\n.068:   130 scans\n.21LK:  4542 scans\n.AMI1:  2926 scans\n.AMI2:  3628 scans\n.AMI3:  3573 scans\n.AMI4:  3916 scans\n.AMI5:  4675 scans\n.AMI6:  4195 scans\n.AMI7:  4299 scans\n.AMI8:  4530 scans\n.AMI9:  4565 scans\n.BG1:   3015 scans\n.BG2:   2915 scans\n.BG3:   3327 scans\n.BG4:   4291 scans\n.BG6:   4496 scans\n.BG7:   4337 scans\n.CAL1:  2674 scans\n.CAL2:  2756 scans\n.CAL3:  4071 scans\n.CAL4:  3697 scans\n.CAL5:  4402 scans\n.CAL6:  4194 scans\n.CW1:   2526 scans\n.CW2:   2823 scans\n.CW3:   3216 scans\n.CW4:   4230 scans\n.CW5:   4104 scans\n.CW6:   3571 scans\n.CW7:   4577 scans\n.GP5:   4477 scans\n.KW1:   3044 scans\n.KW2:   3640 scans\n.KW4:   3576 scans\n.L1:    5066 scans\n.L3:    3216 scans\n.L5:    3718 scans\n.L7:    2330 scans\n.L9:    4529 scans\n.MR:    4246 scans\n.ROME4: 3371 scans\n.ROME5: 2778 scans\n.RP1:   2948 scans\n.RP2:   3650 scans\n.RP3:   5145 scans\n.RP4:   4078 scans\n.TB1:   2541 scans\n.TB10:  4137 scans\n.TB2:   2901 scans\n.TB3:   3521 scans\n.TB4:   4027 scans\n.TB5:   4091 scans\n.V1:    3637 scans\n.V2:    3433 scans\n.V3:    3270 scans\n.V4:    4013 scans\n.V5:    3634 scans\n.V6:    5134 scans\n.V7:    4628 scans\n.V8:    4121 scans\n.V9:    4392 scans\n.WS:    3628 scans\n002:    4282 scans\n\n\n\n\nplotting scans for each cast in the first list\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # 1 is selecting only the first sublist\n  # print(i)\n  print(glue(\"=== station: {cast@metadata$station[1]}\"))\n  print(glue(\"# scans: {length(cast@data$scan)}\"))\n  plotScan(cast)\n}\n\n\n=== station: .007\n# scans: 3010\n\n\n\n\n\n\n\n\n\n=== station: .009\n# scans: 3990\n\n\n\n\n\n\n\n\n\n=== station: .009_5\n# scans: 6867\n\n\n\n\n\n\n\n\n\n=== station: .010\n# scans: 80\n\n\n\n\n\n\n\n\n\n=== station: .012\n# scans: 4670\n\n\n\n\n\n\n\n\n\n=== station: .016\n# scans: 2674\n\n\n\n\n\n\n\n\n\n=== station: .018\n# scans: 4197\n\n\n\n\n\n\n\n\n\n=== station: .030\n# scans: 3501\n\n\n\n\n\n\n\n\n\n=== station: .031\n# scans: 4094\n\n\n\n\n\n\n\n\n\n=== station: .033\n# scans: 3067\n\n\n\n\n\n\n\n\n\n=== station: .033UP\n# scans: 162\n\n\n\n\n\n\n\n\n\n=== station: .041\n# scans: 2591\n\n\n\n\n\n\n\n\n\n=== station: .045\n# scans: 3317\n\n\n\n\n\n\n\n\n\n=== station: .047\n# scans: 3069\n\n\n\n\n\n\n\n\n\n=== station: .049\n# scans: 3\n\n\n\n\n\n\n\n\n\n=== station: .051\n# scans: 3337\n\n\n\n\n\n\n\n\n\n=== station: .053\n# scans: 504\n\n\n\n\n\n\n\n\n\n=== station: .054\n# scans: 60\n\n\n\n\n\n\n\n\n\n=== station: .055\n# scans: 265\n\n\n\n\n\n\n\n\n\n=== station: .056\n# scans: 99\n\n\n\n\n\n\n\n\n\n=== station: .057\n# scans: 2488\n\n\n\n\n\n\n\n\n\n=== station: .057_1\n# scans: 2546\n\n\n\n\n\n\n\n\n\n=== station: .057_2\n# scans: 2865\n\n\n\n\n\n\n\n\n\n=== station: .057_3\n# scans: 3214\n\n\n\n\n\n\n\n\n\n=== station: .058\n# scans: 2890\n\n\n\n\n\n\n\n\n\n=== station: .060\n# scans: 3249\n\n\n\n\n\n\n\n\n\n=== station: .064\n# scans: 591\n\n\n\n\n\n\n\n\n\n=== station: .065\n# scans: 103\n\n\n\n\n\n\n\n\n\n=== station: .068\n# scans: 130\n\n\n\n\n\n\n\n\n\n=== station: .21LK\n# scans: 4542\n\n\n\n\n\n\n\n\n\n=== station: .AMI1\n# scans: 2926\n\n\n\n\n\n\n\n\n\n=== station: .AMI2\n# scans: 3628\n\n\n\n\n\n\n\n\n\n=== station: .AMI3\n# scans: 3573\n\n\n\n\n\n\n\n\n\n=== station: .AMI4\n# scans: 3916\n\n\n\n\n\n\n\n\n\n=== station: .AMI5\n# scans: 4675\n\n\n\n\n\n\n\n\n\n=== station: .AMI6\n# scans: 4195\n\n\n\n\n\n\n\n\n\n=== station: .AMI7\n# scans: 4299\n\n\n\n\n\n\n\n\n\n=== station: .AMI8\n# scans: 4530\n\n\n\n\n\n\n\n\n\n=== station: .AMI9\n# scans: 4565\n\n\n\n\n\n\n\n\n\n=== station: .BG1\n# scans: 3015\n\n\n\n\n\n\n\n\n\n=== station: .BG2\n# scans: 2915\n\n\n\n\n\n\n\n\n\n=== station: .BG3\n# scans: 3327\n\n\n\n\n\n\n\n\n\n=== station: .BG4\n# scans: 4291\n\n\n\n\n\n\n\n\n\n=== station: .BG6\n# scans: 4496\n\n\n\n\n\n\n\n\n\n=== station: .BG7\n# scans: 4337\n\n\n\n\n\n\n\n\n\n=== station: .CAL1\n# scans: 2674\n\n\n\n\n\n\n\n\n\n=== station: .CAL2\n# scans: 2756\n\n\n\n\n\n\n\n\n\n=== station: .CAL3\n# scans: 4071\n\n\n\n\n\n\n\n\n\n=== station: .CAL4\n# scans: 3697\n\n\n\n\n\n\n\n\n\n=== station: .CAL5\n# scans: 4402\n\n\n\n\n\n\n\n\n\n=== station: .CAL6\n# scans: 4194\n\n\n\n\n\n\n\n\n\n=== station: .CW1\n# scans: 2526\n\n\n\n\n\n\n\n\n\n=== station: .CW2\n# scans: 2823\n\n\n\n\n\n\n\n\n\n=== station: .CW3\n# scans: 3216\n\n\n\n\n\n\n\n\n\n=== station: .CW4\n# scans: 4230\n\n\n\n\n\n\n\n\n\n=== station: .CW5\n# scans: 4104\n\n\n\n\n\n\n\n\n\n=== station: .CW6\n# scans: 3571\n\n\n\n\n\n\n\n\n\n=== station: .CW7\n# scans: 4577\n\n\n\n\n\n\n\n\n\n=== station: .GP5\n# scans: 4477\n\n\n\n\n\n\n\n\n\n=== station: .KW1\n# scans: 3044\n\n\n\n\n\n\n\n\n\n=== station: .KW2\n# scans: 3640\n\n\n\n\n\n\n\n\n\n=== station: .KW4\n# scans: 3576\n\n\n\n\n\n\n\n\n\n=== station: .L1\n# scans: 5066\n\n\n\n\n\n\n\n\n\n=== station: .L3\n# scans: 3216\n\n\n\n\n\n\n\n\n\n=== station: .L5\n# scans: 3718\n\n\n\n\n\n\n\n\n\n=== station: .L7\n# scans: 2330\n\n\n\n\n\n\n\n\n\n=== station: .L9\n# scans: 4529\n\n\n\n\n\n\n\n\n\n=== station: .MR\n# scans: 4246\n\n\n\n\n\n\n\n\n\n=== station: .ROME4\n# scans: 3371\n\n\n\n\n\n\n\n\n\n=== station: .ROME5\n# scans: 2778\n\n\n\n\n\n\n\n\n\n=== station: .RP1\n# scans: 2948\n\n\n\n\n\n\n\n\n\n=== station: .RP2\n# scans: 3650\n\n\n\n\n\n\n\n\n\n=== station: .RP3\n# scans: 5145\n\n\n\n\n\n\n\n\n\n=== station: .RP4\n# scans: 4078\n\n\n\n\n\n\n\n\n\n=== station: .TB1\n# scans: 2541\n\n\n\n\n\n\n\n\n\n=== station: .TB10\n# scans: 4137\n\n\n\n\n\n\n\n\n\n=== station: .TB2\n# scans: 2901\n\n\n\n\n\n\n\n\n\n=== station: .TB3\n# scans: 3521\n\n\n\n\n\n\n\n\n\n=== station: .TB4\n# scans: 4027\n\n\n\n\n\n\n\n\n\n=== station: .TB5\n# scans: 4091\n\n\n\n\n\n\n\n\n\n=== station: .V1\n# scans: 3637\n\n\n\n\n\n\n\n\n\n=== station: .V2\n# scans: 3433\n\n\n\n\n\n\n\n\n\n=== station: .V3\n# scans: 3270\n\n\n\n\n\n\n\n\n\n=== station: .V4\n# scans: 4013\n\n\n\n\n\n\n\n\n\n=== station: .V5\n# scans: 3634\n\n\n\n\n\n\n\n\n\n=== station: .V6\n# scans: 5134\n\n\n\n\n\n\n\n\n\n=== station: .V7\n# scans: 4628\n\n\n\n\n\n\n\n\n\n=== station: .V8\n# scans: 4121\n\n\n\n\n\n\n\n\n\n=== station: .V9\n# scans: 4392\n\n\n\n\n\n\n\n\n\n=== station: .WS\n# scans: 3628\n\n\n\n\n\n\n\n\n\n=== station: 002\n# scans: 4282\n\n\n\n\n\n\n\n\n\n\n\nplotting each cast in the first list\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # 1 is selecting only the first sublist\n  tryCatch({\n    plot(ctdDecimate(ctdTrim(cast)))\n  }, error = function(e){\n    print(e)\n  })\n}\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3010' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3990' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 6867' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 80' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4670' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2674' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4197' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3501' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4094' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3067' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 162' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2591' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3317' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3069' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3337' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 504' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 99' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2488' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2546' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2865' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3214' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2890' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3249' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4542' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2926' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3628' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3573' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3916' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4675' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4195' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4299' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4530' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4565' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3015' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2915' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3327' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4291' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4496' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4337' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2674' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2756' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4071' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3697' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4402' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4194' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2526' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2823' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3216' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4230' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4104' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3571' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4577' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4477' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3044' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3640' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3576' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 5066' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3216' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3718' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2330' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4529' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4246' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3371' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2778' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2948' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3650' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 5145' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4078' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2541' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4137' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2901' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3521' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4027' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4091' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3637' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3433' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3270' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4013' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3634' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 5134' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4628' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4121' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4392' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3628' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4282' in coercion to 'logical(1)'&gt;\n\n\n\n\nplotting other physical parameters for each cast\n# Loop through each CTD cast\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # Assuming each sublist contains only one relevant CTD object\n  tryCatch({\n    # Extract metadata for station name and cruise ID\n    station_name &lt;- cast@metadata$station[1]\n    cruise_id &lt;- cast@data$cruise_id[1]\n\n    # Generate a title with station name and cruise ID\n    overall_title &lt;- glue::glue(\"Station: {station_name}, Cruise ID: {cruise_id}\")\n\n    # Set margins: increase the outer margin for the title\n    par(oma = c(0, 0, 3, 0))  # Top outer margin increased for title\n\n    # Plotting function with specific parameters\n    oce::plot(\n      x = ctdDecimate(ctdTrim(cast)),\n      which = c(\n        \"sea_water_electrical_conductivity\",\n        \"descent_rate\", \"sound_velocity\",\n        \"sea_water_sigma_t\",\"altimeter\"\n      ),\n      main = \"\"  # No main title for individual subplots\n    )\n\n    # Place a single overall title at the top of the plot frame\n    mtext(overall_title, side = 3, line = 1, outer = TRUE, cex = 1.5)\n\n    # Reset outer margins to default\n    par(oma = c(0, 0, 0, 0))\n\n  }, error = function(e) {\n    print(e$message)  # Print any errors that occur during plotting\n  })\n}\n\n\n\n\n\n\n\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"unknown xtype value (\\\"5.50915\\\")\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"unknown xtype value (\\\"5.140198\\\")\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n\n\nplotting other nutrient parameters for each cast\n# Loop through each CTD cast\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # Assuming each sublist contains only one relevant CTD object\n  tryCatch({\n    # Extract metadata for station name and cruise ID\n    station_name &lt;- cast@metadata$station[1]\n    cruise_id &lt;- cast@data$cruise_id[1]\n\n    # Generate a title with station name and cruise ID\n    overall_title &lt;- glue::glue(\"Station: {station_name}, Cruise ID: {cruise_id}\")\n\n    # Set margins: increase the outer margin for the title\n    par(oma = c(0, 0, 3, 0))  # Top outer margin increased for title\n\n    # Plotting function with specific parameters\n    oce::plot(\n      x = ctdDecimate(ctdTrim(cast)),\n      which = c(\n        \"CDOM\", \"dissolved_oxygen\",\n        \"oxygen_saturation\",\n        \"chlorophyll_concentration\", \"chlorophyll_fluorescence\"\n      ),\n      main = \"\"  # No main title for individual subplots\n    )\n\n    # Place a single overall title at the top of the plot frame\n    mtext(overall_title, side = 3, line = 1, outer = TRUE, cex = 1.5)\n\n    # Reset outer margins to default\n    par(oma = c(0, 0, 0, 0))\n\n  }, error = function(e) {\n    print(e$message)  # Print any errors that occur during plotting\n  })\n}\n\n\n\n\n\n\n\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"unknown xtype value (\\\"1.123\\\")\"\n\n\n[1] \"unknown xtype value (\\\"259.9752\\\")\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n\n\nplotting other optical parameters for each cast\n# Loop through each CTD cast\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # Assuming each sublist contains only one relevant CTD object\n  tryCatch({\n    # Extract metadata for station name and cruise ID\n    station_name &lt;- cast@metadata$station[1]\n    cruise_id &lt;- cast@data$cruise_id[1]\n\n    # Generate a title with station name and cruise ID\n    overall_title &lt;- glue::glue(\"Station: {station_name}, Cruise ID: {cruise_id}\")\n\n    # Set margins: increase the outer margin for the title\n    par(oma = c(0, 0, 3, 0))  # Top outer margin increased for title\n\n    # Plotting function with specific parameters\n    oce::plot(\n      x = ctdDecimate(ctdTrim(cast)),\n      which = c(\n        \"photosynthetically_available_radiation\",\n        \"beam_attenuation\",\"beam_transmission\"\n      ),\n      main = \"\"  # No main title for individual subplots\n    )\n\n    # Place a single overall title at the top of the plot frame\n    mtext(overall_title, side = 3, line = 1, outer = TRUE, cex = 1.5)\n\n    # Reset outer margins to default\n    par(oma = c(0, 0, 0, 0))\n\n  }, error = function(e) {\n    print(e$message)  # Print any errors that occur during plotting\n  })\n}\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n[1] \"unknown xtype value (\\\"0.098973\\\")\"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n[1] \"unknown xtype value (\\\"0.099065\\\")\"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n\n\nloop through every cast, clean, & save\ncombined_df &lt;- data.frame()\nfor (i in seq(ctd_FK)){\n  tryCatch({\n    cast &lt;- ctd_FK[[i]]  # 1 is selecting only the first sublist\n    \n    # print(class(cast))\n    # clean cast \n    trimmed_cast &lt;- ctdTrim(cast)\n    decimated_cast &lt;- ctdDecimate(trimmed_cast, p = 0.5)  # binned to 0.5 m\n    \n    # convert to df\n    cast_df &lt;- as.data.frame(decimated_cast@data)\n    \n    # Add metadata\n    # assumes station ID and cruise ID the same for all & just uses 1st one\n    cast_df &lt;- mutate(\n      cast_df,\n      station = cast@data$station[1],\n      cruise_id = cast@data$cruise_id[1]\n    )\n  \n    # drop NA rows left by cleaning\n    cast_df &lt;- subset(cast_df, !is.na(scan))\n    \n    # Append the data to the combined dataframe\n    combined_df &lt;- rbind(combined_df, cast_df)\n  }, error = function(e){\n    print(glue(\"error in cast {cast@metadata$station[1]}\"))\n    print(e)\n  })\n}\n# Save to CSV\nfile_path &lt;- here(glue(\"data/cleaned/{cruise_id}.csv\"))\nwrite.csv(combined_df, file_path, row.names = FALSE)"
  },
  {
    "objectID": "cruise_report/cruise_reports/WS22337.html",
    "href": "cruise_report/cruise_reports/WS22337.html",
    "title": "WS22337",
    "section": "",
    "text": "WS22337\n\n\nsetup\nif (!nzchar(system.file(package = \"librarian\"))) {\n  install.packages(\"librarian\")\n}\n\nlibrarian::shelf(\n  quiet = TRUE,\n  readr, here, fs, ggplot2, glue, \"jiho/castr\", dplyr, oce, patchwork, purrr, tidyr\n)\n\n\n\n\nCode\nsource(here(\"R/cruise_load.R\"))\ncruise_df &lt;- cruise_load(params$cruise_id)\n\n\n\n\nplot depth & pressure vs time elapsed\ntryCatch({\n  plots &lt;- list()\n  \n  for (station_name in unique(cruise_df$station)) {\n    subset_df &lt;- filter(cruise_df, station == station_name)\n    plots[[station_name]] &lt;- ggplot(subset_df, aes(x = time_elapsed)) +\n      geom_point(aes(y = depth), color = \"blue\") +  # Plot depth in blue\n      geom_line(aes(y = sea_water_pressure), color = \"red\") +  # Plot sea water pressure in red\n      ggtitle(glue(\"{station_name}\")) +\n      theme(\n        axis.title.x = element_blank(),\n        axis.title.y = element_blank(),\n        axis.text.x = element_blank(),\n        axis.text.y = element_blank(),\n        axis.ticks.x = element_blank(),\n        axis.ticks.y = element_blank()\n      )  # Remove individual axis titles and text\n  }\n  \n  # drop nulls\n  plots &lt;- purrr::compact(plots)\n  \n  # Combine all plots into a grid\n  combined_plot &lt;- wrap_plots(plots) + \n    plot_layout(ncol = 4) +  # Adjust ncol to set number of columns in the grid\n    plot_annotation(\n      title = \"Depth (blue) and Pressure (red)\",\n      subtitle = \"Each panel represents a different station\",\n      caption = \"Time Elapsed (x-axis) vs Depth & Pressure (y-axis)\"\n    ) +\n    theme(\n      plot.tag = element_text(size = 12, face = \"bold\"),\n      plot.tag.position = \"topleft\",\n      axis.title.x = element_text(margin = margin(t = 10)),\n      axis.title.y = element_text(margin = margin(r = 10))\n    )\n  \n  print(combined_plot)\n}, error = function(er){\n  print(er)\n});\n\n\n\n\n\n\n\n\n\n\n\nplot across all stations\np &lt;- ggplot(cruise_df, aes(x = time, y = depth, fill = station)) +\n  geom_col() +  # This creates the bars\n  # geom_text(aes(label = station), vjust = -0.3) +  # This adds labels to each bar, adjust vjust for position\n  labs(x = \"Time\", y = \"Depth\", title = \"Depth over Time by Station\") +  # Set labels and title\n  theme_minimal()  # Use a minimal theme\nprint(p)\n\n\n\n\n\n\n\n\n\n\n\ncreate oce.ctd objects from dataframes\nctd_load &lt;- function(data, other_params = NULL) {\n  \n  # create csv into ctd object\n  test_ctd &lt;-\n    as.ctd(\n      salinity    = data$sea_water_salinity,\n      temperature = data$sea_water_temperature,\n      pressure    = data$sea_water_pressure,\n      station     = data$station\n    )\n  \n  # add additional columns to ctd object\n  if (!is.null(other_params)) {\n    for (param_name in other_params) {\n      test_ctd &lt;-\n        oceSetData(\n          object = test_ctd,\n          name   = param_name,\n          value  = data[[param_name]]\n        )\n    }\n  }\n  print(glue(\"{data$station[1]}:\\t{length(test_ctd@data$scan)} scans\"))\n\n\n  return(test_ctd)\n}\n\n# Define other parameters to add\nother_params &lt;- c(\n  \"cruise_id\", \"station\", \"time\", \"time_elapsed\", \n  \"latitude\", \"longitude\", \"sea_water_electrical_conductivity\", \n  \"CDOM\", \"dissolved_oxygen\",\"oxygen_saturation\", \"chlorophyll_concentration\", \n  \"chlorophyll_fluorescence\", \"photosynthetically_available_radiation\", \n  \"beam_attenuation\",\"beam_transmission\", \"depth\", \"sea_water_sigma_t\",\n  \"descent_rate\", \"sound_velocity\",\"altimeter\"\n)\n\n# Split data by station and create data list\nctd_FK &lt;- cruise_df %&gt;%\n  split(.$station) %&gt;%\n  map(~ ctd_load(.x, other_params = other_params)) # ~ is a lambda(x)\n\n\n.10:    4 scans\n.12:    4962 scans\n.16:    2698 scans\n.18:    4697 scans\n.2: 2713 scans\n.21:    6113 scans\n.30:    4387 scans\n.31:    4676 scans\n.33:    3281 scans\n.41:    2893 scans\n.45:    2880 scans\n.47:    3017 scans\n.49:    2726 scans\n.51:    2659 scans\n.53:    2406 scans\n.54:    78 scans\n.55:    211 scans\n.56:    3467 scans\n.57:    2588 scans\n.57_1:  2549 scans\n.57_2:  3849 scans\n.57_3:  3622 scans\n.58:    3810 scans\n.60:    3419 scans\n.64:    2 scans\n.65:    4961 scans\n.68:    4392 scans\n.7: 2492 scans\n.9: 4702 scans\n.9_5:   9073 scans\n.AMI1:  3392 scans\n.AMI2:  3942 scans\n.AMI3:  4782 scans\n.AMI4:  5058 scans\n.AMI5:  4625 scans\n.AMI6:  5327 scans\n.AMI7:  5106 scans\n.AMI8:  6270 scans\n.AMI9:  6002 scans\n.BG1:   3746 scans\n.BG2:   3374 scans\n.BG3:   4823 scans\n.BG4:   4014 scans\n.CAL1:  1591 scans\n.CAL2:  3132 scans\n.CAL3:  3192 scans\n.CAL4:  3959 scans\n.CAL5:  4531 scans\n.CAL6:  4384 scans\n.CW1:   3 scans\n.CW2:   2768 scans\n.CW3:   3104 scans\n.CW4:   3878 scans\n.GP5:   4680 scans\n.KW1:   3458 scans\n.KW2:   3771 scans\n.KW4:   4397 scans\n.L1:    2946 scans\n.L3:    4914 scans\n.L5:    6961 scans\n.L7:    5775 scans\n.L9:    5180 scans\n.MR:    5551 scans\n.RP1:   2990 scans\n.RP2:   3154 scans\n.RP3:   3810 scans\n.RP4:   4376 scans\n.TB1:   2848 scans\n.TB10:  5350 scans\n.TB2:   3141 scans\n.TB3:   4004 scans\n.TB4:   4058 scans\n.TB5:   5301 scans\n.V1:    3901 scans\n.V2:    3752 scans\n.V3:    3774 scans\n.V4:    3651 scans\n.V5:    5442 scans\n.V6:    4826 scans\n.V7:    4717 scans\n.V8:    5135 scans\n.V9:    5212 scans\n.WS:    5575 scans\n\n\n\n\nplotting scans for each cast in the first list\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # 1 is selecting only the first sublist\n  # print(i)\n  print(glue(\"=== station: {cast@metadata$station[1]}\"))\n  print(glue(\"# scans: {length(cast@data$scan)}\"))\n  plotScan(cast)\n}\n\n\n=== station: .10\n# scans: 4\n\n\n\n\n\n\n\n\n\n=== station: .12\n# scans: 4962\n\n\n\n\n\n\n\n\n\n=== station: .16\n# scans: 2698\n\n\n\n\n\n\n\n\n\n=== station: .18\n# scans: 4697\n\n\n\n\n\n\n\n\n\n=== station: .2\n# scans: 2713\n\n\n\n\n\n\n\n\n\n=== station: .21\n# scans: 6113\n\n\n\n\n\n\n\n\n\n=== station: .30\n# scans: 4387\n\n\n\n\n\n\n\n\n\n=== station: .31\n# scans: 4676\n\n\n\n\n\n\n\n\n\n=== station: .33\n# scans: 3281\n\n\n\n\n\n\n\n\n\n=== station: .41\n# scans: 2893\n\n\n\n\n\n\n\n\n\n=== station: .45\n# scans: 2880\n\n\n\n\n\n\n\n\n\n=== station: .47\n# scans: 3017\n\n\n\n\n\n\n\n\n\n=== station: .49\n# scans: 2726\n\n\n\n\n\n\n\n\n\n=== station: .51\n# scans: 2659\n\n\n\n\n\n\n\n\n\n=== station: .53\n# scans: 2406\n\n\n\n\n\n\n\n\n\n=== station: .54\n# scans: 78\n\n\n\n\n\n\n\n\n\n=== station: .55\n# scans: 211\n\n\n\n\n\n\n\n\n\n=== station: .56\n# scans: 3467\n\n\n\n\n\n\n\n\n\n=== station: .57\n# scans: 2588\n\n\n\n\n\n\n\n\n\n=== station: .57_1\n# scans: 2549\n\n\n\n\n\n\n\n\n\n=== station: .57_2\n# scans: 3849\n\n\n\n\n\n\n\n\n\n=== station: .57_3\n# scans: 3622\n\n\n\n\n\n\n\n\n\n=== station: .58\n# scans: 3810\n\n\n\n\n\n\n\n\n\n=== station: .60\n# scans: 3419\n\n\n\n\n\n\n\n\n\n=== station: .64\n# scans: 2\n\n\n\n\n\n\n\n\n\n=== station: .65\n# scans: 4961\n\n\n\n\n\n\n\n\n\n=== station: .68\n# scans: 4392\n\n\n\n\n\n\n\n\n\n=== station: .7\n# scans: 2492\n\n\n\n\n\n\n\n\n\n=== station: .9\n# scans: 4702\n\n\n\n\n\n\n\n\n\n=== station: .9_5\n# scans: 9073\n\n\n\n\n\n\n\n\n\n=== station: .AMI1\n# scans: 3392\n\n\n\n\n\n\n\n\n\n=== station: .AMI2\n# scans: 3942\n\n\n\n\n\n\n\n\n\n=== station: .AMI3\n# scans: 4782\n\n\n\n\n\n\n\n\n\n=== station: .AMI4\n# scans: 5058\n\n\n\n\n\n\n\n\n\n=== station: .AMI5\n# scans: 4625\n\n\n\n\n\n\n\n\n\n=== station: .AMI6\n# scans: 5327\n\n\n\n\n\n\n\n\n\n=== station: .AMI7\n# scans: 5106\n\n\n\n\n\n\n\n\n\n=== station: .AMI8\n# scans: 6270\n\n\n\n\n\n\n\n\n\n=== station: .AMI9\n# scans: 6002\n\n\n\n\n\n\n\n\n\n=== station: .BG1\n# scans: 3746\n\n\n\n\n\n\n\n\n\n=== station: .BG2\n# scans: 3374\n\n\n\n\n\n\n\n\n\n=== station: .BG3\n# scans: 4823\n\n\n\n\n\n\n\n\n\n=== station: .BG4\n# scans: 4014\n\n\n\n\n\n\n\n\n\n=== station: .CAL1\n# scans: 1591\n\n\n\n\n\n\n\n\n\n=== station: .CAL2\n# scans: 3132\n\n\n\n\n\n\n\n\n\n=== station: .CAL3\n# scans: 3192\n\n\n\n\n\n\n\n\n\n=== station: .CAL4\n# scans: 3959\n\n\n\n\n\n\n\n\n\n=== station: .CAL5\n# scans: 4531\n\n\n\n\n\n\n\n\n\n=== station: .CAL6\n# scans: 4384\n\n\n\n\n\n\n\n\n\n=== station: .CW1\n# scans: 3\n\n\n\n\n\n\n\n\n\n=== station: .CW2\n# scans: 2768\n\n\n\n\n\n\n\n\n\n=== station: .CW3\n# scans: 3104\n\n\n\n\n\n\n\n\n\n=== station: .CW4\n# scans: 3878\n\n\n\n\n\n\n\n\n\n=== station: .GP5\n# scans: 4680\n\n\n\n\n\n\n\n\n\n=== station: .KW1\n# scans: 3458\n\n\n\n\n\n\n\n\n\n=== station: .KW2\n# scans: 3771\n\n\n\n\n\n\n\n\n\n=== station: .KW4\n# scans: 4397\n\n\n\n\n\n\n\n\n\n=== station: .L1\n# scans: 2946\n\n\n\n\n\n\n\n\n\n=== station: .L3\n# scans: 4914\n\n\n\n\n\n\n\n\n\n=== station: .L5\n# scans: 6961\n\n\n\n\n\n\n\n\n\n=== station: .L7\n# scans: 5775\n\n\n\n\n\n\n\n\n\n=== station: .L9\n# scans: 5180\n\n\n\n\n\n\n\n\n\n=== station: .MR\n# scans: 5551\n\n\n\n\n\n\n\n\n\n=== station: .RP1\n# scans: 2990\n\n\n\n\n\n\n\n\n\n=== station: .RP2\n# scans: 3154\n\n\n\n\n\n\n\n\n\n=== station: .RP3\n# scans: 3810\n\n\n\n\n\n\n\n\n\n=== station: .RP4\n# scans: 4376\n\n\n\n\n\n\n\n\n\n=== station: .TB1\n# scans: 2848\n\n\n\n\n\n\n\n\n\n=== station: .TB10\n# scans: 5350\n\n\n\n\n\n\n\n\n\n=== station: .TB2\n# scans: 3141\n\n\n\n\n\n\n\n\n\n=== station: .TB3\n# scans: 4004\n\n\n\n\n\n\n\n\n\n=== station: .TB4\n# scans: 4058\n\n\n\n\n\n\n\n\n\n=== station: .TB5\n# scans: 5301\n\n\n\n\n\n\n\n\n\n=== station: .V1\n# scans: 3901\n\n\n\n\n\n\n\n\n\n=== station: .V2\n# scans: 3752\n\n\n\n\n\n\n\n\n\n=== station: .V3\n# scans: 3774\n\n\n\n\n\n\n\n\n\n=== station: .V4\n# scans: 3651\n\n\n\n\n\n\n\n\n\n=== station: .V5\n# scans: 5442\n\n\n\n\n\n\n\n\n\n=== station: .V6\n# scans: 4826\n\n\n\n\n\n\n\n\n\n=== station: .V7\n# scans: 4717\n\n\n\n\n\n\n\n\n\n=== station: .V8\n# scans: 5135\n\n\n\n\n\n\n\n\n\n=== station: .V9\n# scans: 5212\n\n\n\n\n\n\n\n\n\n=== station: .WS\n# scans: 5575\n\n\n\n\n\n\n\n\n\n\n\nplotting each cast in the first list\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # 1 is selecting only the first sublist\n  tryCatch({\n    plot(ctdDecimate(ctdTrim(cast)))\n  }, error = function(e){\n    print(e)\n  })\n}\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4962' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2698' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4697' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2713' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 6113' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4387' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4676' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3281' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2893' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2880' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3017' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2726' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2659' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2406' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3467' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2588' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2549' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3849' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3622' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3810' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3419' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4392' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2492' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4702' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 9073' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3392' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3942' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4782' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 5058' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4625' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 5327' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 5106' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 6270' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 6002' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3746' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3374' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4823' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4014' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3132' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3192' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3959' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4531' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4384' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2768' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3104' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3878' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4680' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3458' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3771' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4397' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2946' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4914' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 6961' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 5775' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 5180' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 5551' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2990' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3154' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3810' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4376' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2848' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 5350' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3141' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4004' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4058' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 5301' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3901' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3752' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3774' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3651' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 5442' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4826' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4717' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 5135' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 5212' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 5575' in coercion to 'logical(1)'&gt;\n\n\n\n\nplotting other physical parameters for each cast\n# Loop through each CTD cast\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # Assuming each sublist contains only one relevant CTD object\n  tryCatch({\n    # Extract metadata for station name and cruise ID\n    station_name &lt;- cast@metadata$station[1]\n    cruise_id &lt;- cast@data$cruise_id[1]\n\n    # Generate a title with station name and cruise ID\n    overall_title &lt;- glue::glue(\"Station: {station_name}, Cruise ID: {cruise_id}\")\n\n    # Set margins: increase the outer margin for the title\n    par(oma = c(0, 0, 3, 0))  # Top outer margin increased for title\n\n    # Plotting function with specific parameters\n    oce::plot(\n      x = ctdDecimate(ctdTrim(cast)),\n      which = c(\n        \"sea_water_electrical_conductivity\",\n        \"descent_rate\", \"sound_velocity\",\n        \"sea_water_sigma_t\",\"altimeter\"\n      ),\n      main = \"\"  # No main title for individual subplots\n    )\n\n    # Place a single overall title at the top of the plot frame\n    mtext(overall_title, side = 3, line = 1, outer = TRUE, cex = 1.5)\n\n    # Reset outer margins to default\n    par(oma = c(0, 0, 0, 0))\n\n  }, error = function(e) {\n    print(e$message)  # Print any errors that occur during plotting\n  })\n}\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"unknown xtype value (\\\"4.829499\\\")\"\n\n\n\n\nplotting other nutrient parameters for each cast\n# Loop through each CTD cast\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # Assuming each sublist contains only one relevant CTD object\n  tryCatch({\n    # Extract metadata for station name and cruise ID\n    station_name &lt;- cast@metadata$station[1]\n    cruise_id &lt;- cast@data$cruise_id[1]\n\n    # Generate a title with station name and cruise ID\n    overall_title &lt;- glue::glue(\"Station: {station_name}, Cruise ID: {cruise_id}\")\n\n    # Set margins: increase the outer margin for the title\n    par(oma = c(0, 0, 3, 0))  # Top outer margin increased for title\n\n    # Plotting function with specific parameters\n    oce::plot(\n      x = ctdDecimate(ctdTrim(cast)),\n      which = c(\n        \"CDOM\", \"dissolved_oxygen\",\n        \"oxygen_saturation\",\n        \"chlorophyll_concentration\", \"chlorophyll_fluorescence\"\n      ),\n      main = \"\"  # No main title for individual subplots\n    )\n\n    # Place a single overall title at the top of the plot frame\n    mtext(overall_title, side = 3, line = 1, outer = TRUE, cex = 1.5)\n\n    # Reset outer margins to default\n    par(oma = c(0, 0, 0, 0))\n\n  }, error = function(e) {\n    print(e$message)  # Print any errors that occur during plotting\n  })\n}\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"unknown xtype value (\\\"1.6407\\\")\"\n\n\n\n\nplotting other optical parameters for each cast\n# Loop through each CTD cast\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # Assuming each sublist contains only one relevant CTD object\n  tryCatch({\n    # Extract metadata for station name and cruise ID\n    station_name &lt;- cast@metadata$station[1]\n    cruise_id &lt;- cast@data$cruise_id[1]\n\n    # Generate a title with station name and cruise ID\n    overall_title &lt;- glue::glue(\"Station: {station_name}, Cruise ID: {cruise_id}\")\n\n    # Set margins: increase the outer margin for the title\n    par(oma = c(0, 0, 3, 0))  # Top outer margin increased for title\n\n    # Plotting function with specific parameters\n    oce::plot(\n      x = ctdDecimate(ctdTrim(cast)),\n      which = c(\n        \"photosynthetically_available_radiation\",\n        \"beam_attenuation\",\"beam_transmission\"\n      ),\n      main = \"\"  # No main title for individual subplots\n    )\n\n    # Place a single overall title at the top of the plot frame\n    mtext(overall_title, side = 3, line = 1, outer = TRUE, cex = 1.5)\n\n    # Reset outer margins to default\n    par(oma = c(0, 0, 0, 0))\n\n  }, error = function(e) {\n    print(e$message)  # Print any errors that occur during plotting\n  })\n}\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"unknown xtype value (\\\"0.098924\\\")\"\n\n\n\n\nloop through every cast, clean, & save\ncombined_df &lt;- data.frame()\nfor (i in seq(ctd_FK)){\n  tryCatch({\n    cast &lt;- ctd_FK[[i]]  # 1 is selecting only the first sublist\n    \n    # print(class(cast))\n    # clean cast \n    trimmed_cast &lt;- ctdTrim(cast)\n    decimated_cast &lt;- ctdDecimate(trimmed_cast, p = 0.5)  # binned to 0.5 m\n    \n    # convert to df\n    cast_df &lt;- as.data.frame(decimated_cast@data)\n    \n    # Add metadata\n    # assumes station ID and cruise ID the same for all & just uses 1st one\n    cast_df &lt;- mutate(\n      cast_df,\n      station = cast@data$station[1],\n      cruise_id = cast@data$cruise_id[1]\n    )\n  \n    # drop NA rows left by cleaning\n    cast_df &lt;- subset(cast_df, !is.na(scan))\n    \n    # Append the data to the combined dataframe\n    combined_df &lt;- rbind(combined_df, cast_df)\n  }, error = function(e){\n    print(glue(\"error in cast {cast@metadata$station[1]}\"))\n    print(e)\n  })\n}\n# Save to CSV\nfile_path &lt;- here(glue(\"data/cleaned/{cruise_id}.csv\"))\nwrite.csv(combined_df, file_path, row.names = FALSE)"
  },
  {
    "objectID": "cruise_report/cruise_reports/WS22215.html",
    "href": "cruise_report/cruise_reports/WS22215.html",
    "title": "WS22215",
    "section": "",
    "text": "WS22215\n\n\nsetup\nif (!nzchar(system.file(package = \"librarian\"))) {\n  install.packages(\"librarian\")\n}\n\nlibrarian::shelf(\n  quiet = TRUE,\n  readr, here, fs, ggplot2, glue, \"jiho/castr\", dplyr, oce, patchwork, purrr, tidyr\n)\n\n\n\n\nCode\nsource(here(\"R/cruise_load.R\"))\ncruise_df &lt;- cruise_load(params$cruise_id)\n\n\n\n\nplot depth & pressure vs time elapsed\ntryCatch({\n  plots &lt;- list()\n  \n  for (station_name in unique(cruise_df$station)) {\n    subset_df &lt;- filter(cruise_df, station == station_name)\n    plots[[station_name]] &lt;- ggplot(subset_df, aes(x = time_elapsed)) +\n      geom_point(aes(y = depth), color = \"blue\") +  # Plot depth in blue\n      geom_line(aes(y = sea_water_pressure), color = \"red\") +  # Plot sea water pressure in red\n      ggtitle(glue(\"{station_name}\")) +\n      theme(\n        axis.title.x = element_blank(),\n        axis.title.y = element_blank(),\n        axis.text.x = element_blank(),\n        axis.text.y = element_blank(),\n        axis.ticks.x = element_blank(),\n        axis.ticks.y = element_blank()\n      )  # Remove individual axis titles and text\n  }\n  \n  # drop nulls\n  plots &lt;- purrr::compact(plots)\n  \n  # Combine all plots into a grid\n  combined_plot &lt;- wrap_plots(plots) + \n    plot_layout(ncol = 4) +  # Adjust ncol to set number of columns in the grid\n    plot_annotation(\n      title = \"Depth (blue) and Pressure (red)\",\n      subtitle = \"Each panel represents a different station\",\n      caption = \"Time Elapsed (x-axis) vs Depth & Pressure (y-axis)\"\n    ) +\n    theme(\n      plot.tag = element_text(size = 12, face = \"bold\"),\n      plot.tag.position = \"topleft\",\n      axis.title.x = element_text(margin = margin(t = 10)),\n      axis.title.y = element_text(margin = margin(r = 10))\n    )\n  \n  print(combined_plot)\n}, error = function(er){\n  print(er)\n});\n\n\nWarning: Removed 1 row containing missing values or values outside the scale range\n(`geom_point()`).\n\n\nWarning: Removed 2 rows containing missing values or values outside the scale range\n(`geom_point()`).\n\n\nWarning: Removed 1 row containing missing values or values outside the scale range\n(`geom_point()`).\n\n\n\n\n\n\n\n\n\n\n\nplot across all stations\np &lt;- ggplot(cruise_df, aes(x = time, y = depth, fill = station)) +\n  geom_col() +  # This creates the bars\n  # geom_text(aes(label = station), vjust = -0.3) +  # This adds labels to each bar, adjust vjust for position\n  labs(x = \"Time\", y = \"Depth\", title = \"Depth over Time by Station\") +  # Set labels and title\n  theme_minimal()  # Use a minimal theme\nprint(p)\n\n\nWarning: Removed 4 rows containing missing values or values outside the scale range\n(`geom_col()`).\n\n\n\n\n\n\n\n\n\n\n\ncreate oce.ctd objects from dataframes\nctd_load &lt;- function(data, other_params = NULL) {\n  \n  # create csv into ctd object\n  test_ctd &lt;-\n    as.ctd(\n      salinity    = data$sea_water_salinity,\n      temperature = data$sea_water_temperature,\n      pressure    = data$sea_water_pressure,\n      station     = data$station\n    )\n  \n  # add additional columns to ctd object\n  if (!is.null(other_params)) {\n    for (param_name in other_params) {\n      test_ctd &lt;-\n        oceSetData(\n          object = test_ctd,\n          name   = param_name,\n          value  = data[[param_name]]\n        )\n    }\n  }\n  print(glue(\"{data$station[1]}:\\t{length(test_ctd@data$scan)} scans\"))\n\n\n  return(test_ctd)\n}\n\n# Define other parameters to add\nother_params &lt;- c(\n  \"cruise_id\", \"station\", \"time\", \"time_elapsed\", \n  \"latitude\", \"longitude\", \"sea_water_electrical_conductivity\", \n  \"CDOM\", \"dissolved_oxygen\",\"oxygen_saturation\", \"chlorophyll_concentration\", \n  \"chlorophyll_fluorescence\", \"photosynthetically_available_radiation\", \n  \"beam_attenuation\",\"beam_transmission\", \"depth\", \"sea_water_sigma_t\",\n  \"descent_rate\", \"sound_velocity\",\"altimeter\"\n)\n\n# Split data by station and create data list\nctd_FK &lt;- cruise_df %&gt;%\n  split(.$station) %&gt;%\n  map(~ ctd_load(.x, other_params = other_params)) # ~ is a lambda(x)\n\n\nWB22215.009:    903 scans\nWB22215.009_5:  2023 scans\nWB22215.012:    1642 scans\nWB22215.030:    1354 scans\nWB22215.031:    1270 scans\nWB22215.033:    1558 scans\nWB22215.041:    871 scans\nWB22215.045:    712 scans\nWB22215.047:    603 scans\nWB22215.051:    722 scans\nWB22215.056:    608 scans\nWB22215.057:    781 scans\nWB22215.057_1:  1130 scans\nWB22215.057_2:  845 scans\nWB22215.057_3:  1098 scans\nWB22215.058:    1227 scans\nWB22215.060:    945 scans\nWB22215.068:    327 scans\nWB22215.18: 1358 scans\nWB22215.2:  620 scans\nWB22215.21LK:   1203 scans\nWB22215.AMI1:   303 scans\nWB22215.AMI2:   782 scans\nWB22215.AMI3:   633 scans\nWB22215.AMI4:   645 scans\nWB22215.AMI5:   575 scans\nWB22215.AMI6:   1260 scans\nWB22215.AMI7:   646 scans\nWB22215.AMI8:   640 scans\nWB22215.AMI9:   1381 scans\nWB22215.BG1:    995 scans\nWB22215.BG2:    1176 scans\nWB22215.BG3:    1345 scans\nWB22215.BG4:    2203 scans\nWB22215.CAL1:   596 scans\nWB22215.CAL2:   760 scans\nWB22215.CAL3:   902 scans\nWB22215.CAL4:   932 scans\nWB22215.CAL5:   1281 scans\nWB22215.CAL6:   1460 scans\nWB22215.GP5:    2303 scans\nWB22215.KW1:    1022 scans\nWB22215.KW2:    897 scans\nWB22215.KW4:    885 scans\nWB22215.MR: 843 scans\nWB22215.RP1:    753 scans\nWB22215.RP2:    1140 scans\nWB22215.RP3:    1296 scans\nWB22215.RP4:    797 scans\nWB22215.TB10:   1015 scans\nWB22215.TB4:    483 scans\nWB22215.TB5:    905 scans\nWB22215.TEST2:  11 scans\nWB22215.V1: 846 scans\nWB22215.V2: 576 scans\nWB22215.V3: 975 scans\nWB22215.V4: 412 scans\nWB22215.V5: 368 scans\nWB22215.V6: 629 scans\nWB22215.V7: 532 scans\nWB22215.V8: 750 scans\nWB22215.V9: 750 scans\nWB22215.WS: 1119 scans\n\n\n\n\nplotting scans for each cast in the first list\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # 1 is selecting only the first sublist\n  # print(i)\n  print(glue(\"=== station: {cast@metadata$station[1]}\"))\n  print(glue(\"# scans: {length(cast@data$scan)}\"))\n  plotScan(cast)\n}\n\n\n=== station: WB22215.009\n# scans: 903\n\n\n\n\n\n\n\n\n\n=== station: WB22215.009_5\n# scans: 2023\n\n\n\n\n\n\n\n\n\n=== station: WB22215.012\n# scans: 1642\n\n\n\n\n\n\n\n\n\n=== station: WB22215.030\n# scans: 1354\n\n\n\n\n\n\n\n\n\n=== station: WB22215.031\n# scans: 1270\n\n\n\n\n\n\n\n\n\n=== station: WB22215.033\n# scans: 1558\n\n\n\n\n\n\n\n\n\n=== station: WB22215.041\n# scans: 871\n\n\n\n\n\n\n\n\n\n=== station: WB22215.045\n# scans: 712\n\n\n\n\n\n\n\n\n\n=== station: WB22215.047\n# scans: 603\n\n\n\n\n\n\n\n\n\n=== station: WB22215.051\n# scans: 722\n\n\n\n\n\n\n\n\n\n=== station: WB22215.056\n# scans: 608\n\n\n\n\n\n\n\n\n\n=== station: WB22215.057\n# scans: 781\n\n\n\n\n\n\n\n\n\n=== station: WB22215.057_1\n# scans: 1130\n\n\n\n\n\n\n\n\n\n=== station: WB22215.057_2\n# scans: 845\n\n\n\n\n\n\n\n\n\n=== station: WB22215.057_3\n# scans: 1098\n\n\n\n\n\n\n\n\n\n=== station: WB22215.058\n# scans: 1227\n\n\n\n\n\n\n\n\n\n=== station: WB22215.060\n# scans: 945\n\n\n\n\n\n\n\n\n\n=== station: WB22215.068\n# scans: 327\n\n\n\n\n\n\n\n\n\n=== station: WB22215.18\n# scans: 1358\n\n\n\n\n\n\n\n\n\n=== station: WB22215.2\n# scans: 620\n\n\n\n\n\n\n\n\n\n=== station: WB22215.21LK\n# scans: 1203\n\n\n\n\n\n\n\n\n\n=== station: WB22215.AMI1\n# scans: 303\n\n\n\n\n\n\n\n\n\n=== station: WB22215.AMI2\n# scans: 782\n\n\n\n\n\n\n\n\n\n=== station: WB22215.AMI3\n# scans: 633\n\n\n\n\n\n\n\n\n\n=== station: WB22215.AMI4\n# scans: 645\n\n\n\n\n\n\n\n\n\n=== station: WB22215.AMI5\n# scans: 575\n\n\n\n\n\n\n\n\n\n=== station: WB22215.AMI6\n# scans: 1260\n\n\n\n\n\n\n\n\n\n=== station: WB22215.AMI7\n# scans: 646\n\n\n\n\n\n\n\n\n\n=== station: WB22215.AMI8\n# scans: 640\n\n\n\n\n\n\n\n\n\n=== station: WB22215.AMI9\n# scans: 1381\n\n\n\n\n\n\n\n\n\n=== station: WB22215.BG1\n# scans: 995\n\n\n\n\n\n\n\n\n\n=== station: WB22215.BG2\n# scans: 1176\n\n\n\n\n\n\n\n\n\n=== station: WB22215.BG3\n# scans: 1345\n\n\n\n\n\n\n\n\n\n=== station: WB22215.BG4\n# scans: 2203\n\n\n\n\n\n\n\n\n\n=== station: WB22215.CAL1\n# scans: 596\n\n\n\n\n\n\n\n\n\n=== station: WB22215.CAL2\n# scans: 760\n\n\n\n\n\n\n\n\n\n=== station: WB22215.CAL3\n# scans: 902\n\n\n\n\n\n\n\n\n\n=== station: WB22215.CAL4\n# scans: 932\n\n\n\n\n\n\n\n\n\n=== station: WB22215.CAL5\n# scans: 1281\n\n\n\n\n\n\n\n\n\n=== station: WB22215.CAL6\n# scans: 1460\n\n\n\n\n\n\n\n\n\n=== station: WB22215.GP5\n# scans: 2303\n\n\n\n\n\n\n\n\n\n=== station: WB22215.KW1\n# scans: 1022\n\n\n\n\n\n\n\n\n\n=== station: WB22215.KW2\n# scans: 897\n\n\n\n\n\n\n\n\n\n=== station: WB22215.KW4\n# scans: 885\n\n\n\n\n\n\n\n\n\n=== station: WB22215.MR\n# scans: 843\n\n\n\n\n\n\n\n\n\n=== station: WB22215.RP1\n# scans: 753\n\n\n\n\n\n\n\n\n\n=== station: WB22215.RP2\n# scans: 1140\n\n\n\n\n\n\n\n\n\n=== station: WB22215.RP3\n# scans: 1296\n\n\n\n\n\n\n\n\n\n=== station: WB22215.RP4\n# scans: 797\n\n\n\n\n\n\n\n\n\n=== station: WB22215.TB10\n# scans: 1015\n\n\n\n\n\n\n\n\n\n=== station: WB22215.TB4\n# scans: 483\n\n\n\n\n\n\n\n\n\n=== station: WB22215.TB5\n# scans: 905\n\n\n\n\n\n\n\n\n\n=== station: WB22215.TEST2\n# scans: 11\n\n\n\n\n\n\n\n\n\n=== station: WB22215.V1\n# scans: 846\n\n\n\n\n\n\n\n\n\n=== station: WB22215.V2\n# scans: 576\n\n\n\n\n\n\n\n\n\n=== station: WB22215.V3\n# scans: 975\n\n\n\n\n\n\n\n\n\n=== station: WB22215.V4\n# scans: 412\n\n\n\n\n\n\n\n\n\n=== station: WB22215.V5\n# scans: 368\n\n\n\n\n\n\n\n\n\n=== station: WB22215.V6\n# scans: 629\n\n\n\n\n\n\n\n\n\n=== station: WB22215.V7\n# scans: 532\n\n\n\n\n\n\n\n\n\n=== station: WB22215.V8\n# scans: 750\n\n\n\n\n\n\n\n\n\n=== station: WB22215.V9\n# scans: 750\n\n\n\n\n\n\n\n\n\n=== station: WB22215.WS\n# scans: 1119\n\n\n\n\n\n\n\n\n\n\n\nplotting each cast in the first list\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # 1 is selecting only the first sublist\n  tryCatch({\n    plot(ctdDecimate(ctdTrim(cast)))\n  }, error = function(e){\n    print(e)\n  })\n}\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 903' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2023' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1642' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1354' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1270' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1558' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 871' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 712' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 603' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 722' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 608' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 781' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1130' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 845' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1098' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1227' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 945' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 327' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1358' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 620' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1203' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 303' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 782' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 633' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 645' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 575' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1260' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 646' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 640' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1381' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 995' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1176' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1345' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2203' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 596' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 760' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 902' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 932' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1281' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1460' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2303' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1022' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 897' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 885' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 843' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 753' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1140' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1296' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 797' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1015' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 483' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 905' in coercion to 'logical(1)'&gt;\n&lt;simpleError in h(simpleError(msg, call)): error in evaluating the argument 'x' in selecting a method for function 'plot': wrong sign in 'by' argument&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 846' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 576' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 975' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 412' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 368' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 629' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 532' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 750' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 750' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1119' in coercion to 'logical(1)'&gt;\n\n\n\n\nplotting other physical parameters for each cast\n# Loop through each CTD cast\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # Assuming each sublist contains only one relevant CTD object\n  tryCatch({\n    # Extract metadata for station name and cruise ID\n    station_name &lt;- cast@metadata$station[1]\n    cruise_id &lt;- cast@data$cruise_id[1]\n\n    # Generate a title with station name and cruise ID\n    overall_title &lt;- glue::glue(\"Station: {station_name}, Cruise ID: {cruise_id}\")\n\n    # Set margins: increase the outer margin for the title\n    par(oma = c(0, 0, 3, 0))  # Top outer margin increased for title\n\n    # Plotting function with specific parameters\n    oce::plot(\n      x = ctdDecimate(ctdTrim(cast)),\n      which = c(\n        \"sea_water_electrical_conductivity\",\n        \"descent_rate\", \"sound_velocity\",\n        \"sea_water_sigma_t\",\"altimeter\"\n      ),\n      main = \"\"  # No main title for individual subplots\n    )\n\n    # Place a single overall title at the top of the plot frame\n    mtext(overall_title, side = 3, line = 1, outer = TRUE, cex = 1.5)\n\n    # Reset outer margins to default\n    par(oma = c(0, 0, 0, 0))\n\n  }, error = function(e) {\n    print(e$message)  # Print any errors that occur during plotting\n  })\n}\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"error in evaluating the argument 'x' in selecting a method for function 'plot': wrong sign in 'by' argument\"\n\n\n\n\nplotting other nutrient parameters for each cast\n# Loop through each CTD cast\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # Assuming each sublist contains only one relevant CTD object\n  tryCatch({\n    # Extract metadata for station name and cruise ID\n    station_name &lt;- cast@metadata$station[1]\n    cruise_id &lt;- cast@data$cruise_id[1]\n\n    # Generate a title with station name and cruise ID\n    overall_title &lt;- glue::glue(\"Station: {station_name}, Cruise ID: {cruise_id}\")\n\n    # Set margins: increase the outer margin for the title\n    par(oma = c(0, 0, 3, 0))  # Top outer margin increased for title\n\n    # Plotting function with specific parameters\n    oce::plot(\n      x = ctdDecimate(ctdTrim(cast)),\n      which = c(\n        \"CDOM\", \"dissolved_oxygen\",\n        \"oxygen_saturation\",\n        \"chlorophyll_concentration\", \"chlorophyll_fluorescence\"\n      ),\n      main = \"\"  # No main title for individual subplots\n    )\n\n    # Place a single overall title at the top of the plot frame\n    mtext(overall_title, side = 3, line = 1, outer = TRUE, cex = 1.5)\n\n    # Reset outer margins to default\n    par(oma = c(0, 0, 0, 0))\n\n  }, error = function(e) {\n    print(e$message)  # Print any errors that occur during plotting\n  })\n}\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"error in evaluating the argument 'x' in selecting a method for function 'plot': wrong sign in 'by' argument\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n\n\n\n\nplotting other optical parameters for each cast\n# Loop through each CTD cast\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # Assuming each sublist contains only one relevant CTD object\n  tryCatch({\n    # Extract metadata for station name and cruise ID\n    station_name &lt;- cast@metadata$station[1]\n    cruise_id &lt;- cast@data$cruise_id[1]\n\n    # Generate a title with station name and cruise ID\n    overall_title &lt;- glue::glue(\"Station: {station_name}, Cruise ID: {cruise_id}\")\n\n    # Set margins: increase the outer margin for the title\n    par(oma = c(0, 0, 3, 0))  # Top outer margin increased for title\n\n    # Plotting function with specific parameters\n    oce::plot(\n      x = ctdDecimate(ctdTrim(cast)),\n      which = c(\n        \"photosynthetically_available_radiation\",\n        \"beam_attenuation\",\"beam_transmission\"\n      ),\n      main = \"\"  # No main title for individual subplots\n    )\n\n    # Place a single overall title at the top of the plot frame\n    mtext(overall_title, side = 3, line = 1, outer = TRUE, cex = 1.5)\n\n    # Reset outer margins to default\n    par(oma = c(0, 0, 0, 0))\n\n  }, error = function(e) {\n    print(e$message)  # Print any errors that occur during plotting\n  })\n}\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"error in evaluating the argument 'x' in selecting a method for function 'plot': wrong sign in 'by' argument\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n\n\nloop through every cast, clean, & save\ncombined_df &lt;- data.frame()\nfor (i in seq(ctd_FK)){\n  tryCatch({\n    cast &lt;- ctd_FK[[i]]  # 1 is selecting only the first sublist\n    \n    # print(class(cast))\n    # clean cast \n    trimmed_cast &lt;- ctdTrim(cast)\n    decimated_cast &lt;- ctdDecimate(trimmed_cast, p = 0.5)  # binned to 0.5 m\n    \n    # convert to df\n    cast_df &lt;- as.data.frame(decimated_cast@data)\n    \n    # Add metadata\n    # assumes station ID and cruise ID the same for all & just uses 1st one\n    cast_df &lt;- mutate(\n      cast_df,\n      station = cast@data$station[1],\n      cruise_id = cast@data$cruise_id[1]\n    )\n  \n    # drop NA rows left by cleaning\n    cast_df &lt;- subset(cast_df, !is.na(scan))\n    \n    # Append the data to the combined dataframe\n    combined_df &lt;- rbind(combined_df, cast_df)\n  }, error = function(e){\n    print(glue(\"error in cast {cast@metadata$station[1]}\"))\n    print(e)\n  })\n}\n\n\nerror in cast WB22215.TEST2\n&lt;simpleError in seq.default(0, p * floor(max(x[[\"pressure\"]], na.rm = TRUE)/p),     p): wrong sign in 'by' argument&gt;\n\n\nloop through every cast, clean, & save\n# Save to CSV\nfile_path &lt;- here(glue(\"data/cleaned/{cruise_id}.csv\"))\nwrite.csv(combined_df, file_path, row.names = FALSE)"
  },
  {
    "objectID": "cruise_report/cruise_reports/WS22072.html",
    "href": "cruise_report/cruise_reports/WS22072.html",
    "title": "WS22072",
    "section": "",
    "text": "WS22072\n\n\nsetup\nif (!nzchar(system.file(package = \"librarian\"))) {\n  install.packages(\"librarian\")\n}\n\nlibrarian::shelf(\n  quiet = TRUE,\n  readr, here, fs, ggplot2, glue, \"jiho/castr\", dplyr, oce, patchwork, purrr, tidyr\n)\n\n\n\n\nCode\nsource(here(\"R/cruise_load.R\"))\ncruise_df &lt;- cruise_load(params$cruise_id)\n\n\n\n\nplot depth & pressure vs time elapsed\ntryCatch({\n  plots &lt;- list()\n  \n  for (station_name in unique(cruise_df$station)) {\n    subset_df &lt;- filter(cruise_df, station == station_name)\n    plots[[station_name]] &lt;- ggplot(subset_df, aes(x = time_elapsed)) +\n      geom_point(aes(y = depth), color = \"blue\") +  # Plot depth in blue\n      geom_line(aes(y = sea_water_pressure), color = \"red\") +  # Plot sea water pressure in red\n      ggtitle(glue(\"{station_name}\")) +\n      theme(\n        axis.title.x = element_blank(),\n        axis.title.y = element_blank(),\n        axis.text.x = element_blank(),\n        axis.text.y = element_blank(),\n        axis.ticks.x = element_blank(),\n        axis.ticks.y = element_blank()\n      )  # Remove individual axis titles and text\n  }\n  \n  # drop nulls\n  plots &lt;- purrr::compact(plots)\n  \n  # Combine all plots into a grid\n  combined_plot &lt;- wrap_plots(plots) + \n    plot_layout(ncol = 4) +  # Adjust ncol to set number of columns in the grid\n    plot_annotation(\n      title = \"Depth (blue) and Pressure (red)\",\n      subtitle = \"Each panel represents a different station\",\n      caption = \"Time Elapsed (x-axis) vs Depth & Pressure (y-axis)\"\n    ) +\n    theme(\n      plot.tag = element_text(size = 12, face = \"bold\"),\n      plot.tag.position = \"topleft\",\n      axis.title.x = element_text(margin = margin(t = 10)),\n      axis.title.y = element_text(margin = margin(r = 10))\n    )\n  \n  print(combined_plot)\n}, error = function(er){\n  print(er)\n});\n\n\n\n\n\n\n\n\n\n\n\nplot across all stations\np &lt;- ggplot(cruise_df, aes(x = time, y = depth, fill = station)) +\n  geom_col() +  # This creates the bars\n  # geom_text(aes(label = station), vjust = -0.3) +  # This adds labels to each bar, adjust vjust for position\n  labs(x = \"Time\", y = \"Depth\", title = \"Depth over Time by Station\") +  # Set labels and title\n  theme_minimal()  # Use a minimal theme\nprint(p)\n\n\n\n\n\n\n\n\n\n\n\ncreate oce.ctd objects from dataframes\nctd_load &lt;- function(data, other_params = NULL) {\n  \n  # create csv into ctd object\n  test_ctd &lt;-\n    as.ctd(\n      salinity    = data$sea_water_salinity,\n      temperature = data$sea_water_temperature,\n      pressure    = data$sea_water_pressure,\n      station     = data$station\n    )\n  \n  # add additional columns to ctd object\n  if (!is.null(other_params)) {\n    for (param_name in other_params) {\n      test_ctd &lt;-\n        oceSetData(\n          object = test_ctd,\n          name   = param_name,\n          value  = data[[param_name]]\n        )\n    }\n  }\n  print(glue(\"{data$station[1]}:\\t{length(test_ctd@data$scan)} scans\"))\n\n\n  return(test_ctd)\n}\n\n# Define other parameters to add\nother_params &lt;- c(\n  \"cruise_id\", \"station\", \"time\", \"time_elapsed\", \n  \"latitude\", \"longitude\", \"sea_water_electrical_conductivity\", \n  \"CDOM\", \"dissolved_oxygen\",\"oxygen_saturation\", \"chlorophyll_concentration\", \n  \"chlorophyll_fluorescence\", \"photosynthetically_available_radiation\", \n  \"beam_attenuation\",\"beam_transmission\", \"depth\", \"sea_water_sigma_t\",\n  \"descent_rate\", \"sound_velocity\",\"altimeter\"\n)\n\n# Split data by station and create data list\nctd_FK &lt;- cruise_df %&gt;%\n  split(.$station) %&gt;%\n  map(~ ctd_load(.x, other_params = other_params)) # ~ is a lambda(x)\n\n\n.006_5: 7772 scans\n.007:   2435 scans\n.010:   89 scans\n.012:   4880 scans\n.016:   2678 scans\n.018:   4330 scans\n.02:    2592 scans\n.03:    4489 scans\n.030:   5316 scans\n.031:   3472 scans\n.033:   2922 scans\n.041:   2540 scans\n.045:   2945 scans\n.047:   2890 scans\n.049:   21 scans\n.051:   2626 scans\n.053:   1462 scans\n.054:   263 scans\n.055:   2816 scans\n.056:   3008 scans\n.057:   3061 scans\n.057_1: 2557 scans\n.057_2: 3079 scans\n.057_3: 3090 scans\n.058:   3267 scans\n.060:   3379 scans\n.064:   75 scans\n.065:   170 scans\n.068:   3054 scans\n.09:    4631 scans\n.09_5:  9529 scans\n.21LK:  5318 scans\n.AMI1:  2649 scans\n.AMI2:  3702 scans\n.AMI3:  3783 scans\n.AMI4:  4402 scans\n.AMI5:  5974 scans\n.AMI6:  4733 scans\n.AMI7:  4527 scans\n.AMI8:  4414 scans\n.AMI9:  5509 scans\n.BG1:   2905 scans\n.BG2:   3330 scans\n.BG3:   3503 scans\n.BG4:   3822 scans\n.CAL1:  2522 scans\n.CAL2:  3038 scans\n.CAL3:  3021 scans\n.CAL4:  3058 scans\n.CAL5:  3663 scans\n.CAL6:  4525 scans\n.EK_IN: 2736 scans\n.EK_MID:    2583 scans\n.EK_OFF:    4189 scans\n.GP5:   4239 scans\n.KW1:   3043 scans\n.KW2:   3222 scans\n.KW4:   3975 scans\n.MR:    5130 scans\n.RP1:   2674 scans\n.RP2:   2992 scans\n.RP3:   3006 scans\n.RP4:   3284 scans\n.TB1:   2765 scans\n.TB10:  5235 scans\n.TB2:   3147 scans\n.TB3:   3714 scans\n.TB4:   3818 scans\n.TB5:   4079 scans\n.V1:    2773 scans\n.V2:    3260 scans\n.V3:    3631 scans\n.V4:    3965 scans\n.V5:    4663 scans\n.V6:    4003 scans\n.V7:    4883 scans\n.V8:    6137 scans\n.V9:    4846 scans\n.WS:    4022 scans\n\n\n\n\nplotting scans for each cast in the first list\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # 1 is selecting only the first sublist\n  # print(i)\n  print(glue(\"=== station: {cast@metadata$station[1]}\"))\n  print(glue(\"# scans: {length(cast@data$scan)}\"))\n  plotScan(cast)\n}\n\n\n=== station: .006_5\n# scans: 7772\n\n\n\n\n\n\n\n\n\n=== station: .007\n# scans: 2435\n\n\n\n\n\n\n\n\n\n=== station: .010\n# scans: 89\n\n\n\n\n\n\n\n\n\n=== station: .012\n# scans: 4880\n\n\n\n\n\n\n\n\n\n=== station: .016\n# scans: 2678\n\n\n\n\n\n\n\n\n\n=== station: .018\n# scans: 4330\n\n\n\n\n\n\n\n\n\n=== station: .02\n# scans: 2592\n\n\n\n\n\n\n\n\n\n=== station: .03\n# scans: 4489\n\n\n\n\n\n\n\n\n\n=== station: .030\n# scans: 5316\n\n\n\n\n\n\n\n\n\n=== station: .031\n# scans: 3472\n\n\n\n\n\n\n\n\n\n=== station: .033\n# scans: 2922\n\n\n\n\n\n\n\n\n\n=== station: .041\n# scans: 2540\n\n\n\n\n\n\n\n\n\n=== station: .045\n# scans: 2945\n\n\n\n\n\n\n\n\n\n=== station: .047\n# scans: 2890\n\n\n\n\n\n\n\n\n\n=== station: .049\n# scans: 21\n\n\n\n\n\n\n\n\n\n=== station: .051\n# scans: 2626\n\n\n\n\n\n\n\n\n\n=== station: .053\n# scans: 1462\n\n\n\n\n\n\n\n\n\n=== station: .054\n# scans: 263\n\n\n\n\n\n\n\n\n\n=== station: .055\n# scans: 2816\n\n\n\n\n\n\n\n\n\n=== station: .056\n# scans: 3008\n\n\n\n\n\n\n\n\n\n=== station: .057\n# scans: 3061\n\n\n\n\n\n\n\n\n\n=== station: .057_1\n# scans: 2557\n\n\n\n\n\n\n\n\n\n=== station: .057_2\n# scans: 3079\n\n\n\n\n\n\n\n\n\n=== station: .057_3\n# scans: 3090\n\n\n\n\n\n\n\n\n\n=== station: .058\n# scans: 3267\n\n\n\n\n\n\n\n\n\n=== station: .060\n# scans: 3379\n\n\n\n\n\n\n\n\n\n=== station: .064\n# scans: 75\n\n\n\n\n\n\n\n\n\n=== station: .065\n# scans: 170\n\n\n\n\n\n\n\n\n\n=== station: .068\n# scans: 3054\n\n\n\n\n\n\n\n\n\n=== station: .09\n# scans: 4631\n\n\n\n\n\n\n\n\n\n=== station: .09_5\n# scans: 9529\n\n\n\n\n\n\n\n\n\n=== station: .21LK\n# scans: 5318\n\n\n\n\n\n\n\n\n\n=== station: .AMI1\n# scans: 2649\n\n\n\n\n\n\n\n\n\n=== station: .AMI2\n# scans: 3702\n\n\n\n\n\n\n\n\n\n=== station: .AMI3\n# scans: 3783\n\n\n\n\n\n\n\n\n\n=== station: .AMI4\n# scans: 4402\n\n\n\n\n\n\n\n\n\n=== station: .AMI5\n# scans: 5974\n\n\n\n\n\n\n\n\n\n=== station: .AMI6\n# scans: 4733\n\n\n\n\n\n\n\n\n\n=== station: .AMI7\n# scans: 4527\n\n\n\n\n\n\n\n\n\n=== station: .AMI8\n# scans: 4414\n\n\n\n\n\n\n\n\n\n=== station: .AMI9\n# scans: 5509\n\n\n\n\n\n\n\n\n\n=== station: .BG1\n# scans: 2905\n\n\n\n\n\n\n\n\n\n=== station: .BG2\n# scans: 3330\n\n\n\n\n\n\n\n\n\n=== station: .BG3\n# scans: 3503\n\n\n\n\n\n\n\n\n\n=== station: .BG4\n# scans: 3822\n\n\n\n\n\n\n\n\n\n=== station: .CAL1\n# scans: 2522\n\n\n\n\n\n\n\n\n\n=== station: .CAL2\n# scans: 3038\n\n\n\n\n\n\n\n\n\n=== station: .CAL3\n# scans: 3021\n\n\n\n\n\n\n\n\n\n=== station: .CAL4\n# scans: 3058\n\n\n\n\n\n\n\n\n\n=== station: .CAL5\n# scans: 3663\n\n\n\n\n\n\n\n\n\n=== station: .CAL6\n# scans: 4525\n\n\n\n\n\n\n\n\n\n=== station: .EK_IN\n# scans: 2736\n\n\n\n\n\n\n\n\n\n=== station: .EK_MID\n# scans: 2583\n\n\n\n\n\n\n\n\n\n=== station: .EK_OFF\n# scans: 4189\n\n\n\n\n\n\n\n\n\n=== station: .GP5\n# scans: 4239\n\n\n\n\n\n\n\n\n\n=== station: .KW1\n# scans: 3043\n\n\n\n\n\n\n\n\n\n=== station: .KW2\n# scans: 3222\n\n\n\n\n\n\n\n\n\n=== station: .KW4\n# scans: 3975\n\n\n\n\n\n\n\n\n\n=== station: .MR\n# scans: 5130\n\n\n\n\n\n\n\n\n\n=== station: .RP1\n# scans: 2674\n\n\n\n\n\n\n\n\n\n=== station: .RP2\n# scans: 2992\n\n\n\n\n\n\n\n\n\n=== station: .RP3\n# scans: 3006\n\n\n\n\n\n\n\n\n\n=== station: .RP4\n# scans: 3284\n\n\n\n\n\n\n\n\n\n=== station: .TB1\n# scans: 2765\n\n\n\n\n\n\n\n\n\n=== station: .TB10\n# scans: 5235\n\n\n\n\n\n\n\n\n\n=== station: .TB2\n# scans: 3147\n\n\n\n\n\n\n\n\n\n=== station: .TB3\n# scans: 3714\n\n\n\n\n\n\n\n\n\n=== station: .TB4\n# scans: 3818\n\n\n\n\n\n\n\n\n\n=== station: .TB5\n# scans: 4079\n\n\n\n\n\n\n\n\n\n=== station: .V1\n# scans: 2773\n\n\n\n\n\n\n\n\n\n=== station: .V2\n# scans: 3260\n\n\n\n\n\n\n\n\n\n=== station: .V3\n# scans: 3631\n\n\n\n\n\n\n\n\n\n=== station: .V4\n# scans: 3965\n\n\n\n\n\n\n\n\n\n=== station: .V5\n# scans: 4663\n\n\n\n\n\n\n\n\n\n=== station: .V6\n# scans: 4003\n\n\n\n\n\n\n\n\n\n=== station: .V7\n# scans: 4883\n\n\n\n\n\n\n\n\n\n=== station: .V8\n# scans: 6137\n\n\n\n\n\n\n\n\n\n=== station: .V9\n# scans: 4846\n\n\n\n\n\n\n\n\n\n=== station: .WS\n# scans: 4022\n\n\n\n\n\n\n\n\n\n\n\nplotting each cast in the first list\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # 1 is selecting only the first sublist\n  tryCatch({\n    plot(ctdDecimate(ctdTrim(cast)))\n  }, error = function(e){\n    print(e)\n  })\n}\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 7772' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2435' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 89' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4880' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2678' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4330' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2592' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4489' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 5316' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3472' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2922' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2540' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2945' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2890' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2626' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1462' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2816' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3008' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3061' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2557' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3079' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3090' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3267' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3379' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3054' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4631' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 9529' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 5318' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2649' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3702' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3783' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4402' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 5974' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4733' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4527' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4414' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 5509' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2905' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3330' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3503' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3822' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2522' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3038' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3021' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3058' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3663' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4525' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2736' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2583' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4189' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4239' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3043' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3222' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3975' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 5130' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2674' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2992' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3006' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3284' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2765' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 5235' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3147' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3714' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3818' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4079' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2773' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3260' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3631' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3965' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4663' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4003' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4883' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 6137' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4846' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4022' in coercion to 'logical(1)'&gt;\n\n\n\n\nplotting other physical parameters for each cast\n# Loop through each CTD cast\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # Assuming each sublist contains only one relevant CTD object\n  tryCatch({\n    # Extract metadata for station name and cruise ID\n    station_name &lt;- cast@metadata$station[1]\n    cruise_id &lt;- cast@data$cruise_id[1]\n\n    # Generate a title with station name and cruise ID\n    overall_title &lt;- glue::glue(\"Station: {station_name}, Cruise ID: {cruise_id}\")\n\n    # Set margins: increase the outer margin for the title\n    par(oma = c(0, 0, 3, 0))  # Top outer margin increased for title\n\n    # Plotting function with specific parameters\n    oce::plot(\n      x = ctdDecimate(ctdTrim(cast)),\n      which = c(\n        \"sea_water_electrical_conductivity\",\n        \"descent_rate\", \"sound_velocity\",\n        \"sea_water_sigma_t\",\"altimeter\"\n      ),\n      main = \"\"  # No main title for individual subplots\n    )\n\n    # Place a single overall title at the top of the plot frame\n    mtext(overall_title, side = 3, line = 1, outer = TRUE, cex = 1.5)\n\n    # Reset outer margins to default\n    par(oma = c(0, 0, 0, 0))\n\n  }, error = function(e) {\n    print(e$message)  # Print any errors that occur during plotting\n  })\n}\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n\n\nplotting other nutrient parameters for each cast\n# Loop through each CTD cast\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # Assuming each sublist contains only one relevant CTD object\n  tryCatch({\n    # Extract metadata for station name and cruise ID\n    station_name &lt;- cast@metadata$station[1]\n    cruise_id &lt;- cast@data$cruise_id[1]\n\n    # Generate a title with station name and cruise ID\n    overall_title &lt;- glue::glue(\"Station: {station_name}, Cruise ID: {cruise_id}\")\n\n    # Set margins: increase the outer margin for the title\n    par(oma = c(0, 0, 3, 0))  # Top outer margin increased for title\n\n    # Plotting function with specific parameters\n    oce::plot(\n      x = ctdDecimate(ctdTrim(cast)),\n      which = c(\n        \"CDOM\", \"dissolved_oxygen\",\n        \"oxygen_saturation\",\n        \"chlorophyll_concentration\", \"chlorophyll_fluorescence\"\n      ),\n      main = \"\"  # No main title for individual subplots\n    )\n\n    # Place a single overall title at the top of the plot frame\n    mtext(overall_title, side = 3, line = 1, outer = TRUE, cex = 1.5)\n\n    # Reset outer margins to default\n    par(oma = c(0, 0, 0, 0))\n\n  }, error = function(e) {\n    print(e$message)  # Print any errors that occur during plotting\n  })\n}\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n\n\nplotting other optical parameters for each cast\n# Loop through each CTD cast\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # Assuming each sublist contains only one relevant CTD object\n  tryCatch({\n    # Extract metadata for station name and cruise ID\n    station_name &lt;- cast@metadata$station[1]\n    cruise_id &lt;- cast@data$cruise_id[1]\n\n    # Generate a title with station name and cruise ID\n    overall_title &lt;- glue::glue(\"Station: {station_name}, Cruise ID: {cruise_id}\")\n\n    # Set margins: increase the outer margin for the title\n    par(oma = c(0, 0, 3, 0))  # Top outer margin increased for title\n\n    # Plotting function with specific parameters\n    oce::plot(\n      x = ctdDecimate(ctdTrim(cast)),\n      which = c(\n        \"photosynthetically_available_radiation\",\n        \"beam_attenuation\",\"beam_transmission\"\n      ),\n      main = \"\"  # No main title for individual subplots\n    )\n\n    # Place a single overall title at the top of the plot frame\n    mtext(overall_title, side = 3, line = 1, outer = TRUE, cex = 1.5)\n\n    # Reset outer margins to default\n    par(oma = c(0, 0, 0, 0))\n\n  }, error = function(e) {\n    print(e$message)  # Print any errors that occur during plotting\n  })\n}\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n\n\nloop through every cast, clean, & save\ncombined_df &lt;- data.frame()\nfor (i in seq(ctd_FK)){\n  tryCatch({\n    cast &lt;- ctd_FK[[i]]  # 1 is selecting only the first sublist\n    \n    # print(class(cast))\n    # clean cast \n    trimmed_cast &lt;- ctdTrim(cast)\n    decimated_cast &lt;- ctdDecimate(trimmed_cast, p = 0.5)  # binned to 0.5 m\n    \n    # convert to df\n    cast_df &lt;- as.data.frame(decimated_cast@data)\n    \n    # Add metadata\n    # assumes station ID and cruise ID the same for all & just uses 1st one\n    cast_df &lt;- mutate(\n      cast_df,\n      station = cast@data$station[1],\n      cruise_id = cast@data$cruise_id[1]\n    )\n  \n    # drop NA rows left by cleaning\n    cast_df &lt;- subset(cast_df, !is.na(scan))\n    \n    # Append the data to the combined dataframe\n    combined_df &lt;- rbind(combined_df, cast_df)\n  }, error = function(e){\n    print(glue(\"error in cast {cast@metadata$station[1]}\"))\n    print(e)\n  })\n}\n# Save to CSV\nfile_path &lt;- here(glue(\"data/cleaned/{cruise_id}.csv\"))\nwrite.csv(combined_df, file_path, row.names = FALSE)"
  },
  {
    "objectID": "cruise_report/cruise_reports/WS21338.html",
    "href": "cruise_report/cruise_reports/WS21338.html",
    "title": "WS21338",
    "section": "",
    "text": "WS21338\n\n\nsetup\nif (!nzchar(system.file(package = \"librarian\"))) {\n  install.packages(\"librarian\")\n}\n\nlibrarian::shelf(\n  quiet = TRUE,\n  readr, here, fs, ggplot2, glue, \"jiho/castr\", dplyr, oce, patchwork, purrr, tidyr\n)\n\n\n\n\nCode\nsource(here(\"R/cruise_load.R\"))\ncruise_df &lt;- cruise_load(params$cruise_id)\n\n\n\n\nplot depth & pressure vs time elapsed\ntryCatch({\n  plots &lt;- list()\n  \n  for (station_name in unique(cruise_df$station)) {\n    subset_df &lt;- filter(cruise_df, station == station_name)\n    plots[[station_name]] &lt;- ggplot(subset_df, aes(x = time_elapsed)) +\n      geom_point(aes(y = depth), color = \"blue\") +  # Plot depth in blue\n      geom_line(aes(y = sea_water_pressure), color = \"red\") +  # Plot sea water pressure in red\n      ggtitle(glue(\"{station_name}\")) +\n      theme(\n        axis.title.x = element_blank(),\n        axis.title.y = element_blank(),\n        axis.text.x = element_blank(),\n        axis.text.y = element_blank(),\n        axis.ticks.x = element_blank(),\n        axis.ticks.y = element_blank()\n      )  # Remove individual axis titles and text\n  }\n  \n  # drop nulls\n  plots &lt;- purrr::compact(plots)\n  \n  # Combine all plots into a grid\n  combined_plot &lt;- wrap_plots(plots) + \n    plot_layout(ncol = 4) +  # Adjust ncol to set number of columns in the grid\n    plot_annotation(\n      title = \"Depth (blue) and Pressure (red)\",\n      subtitle = \"Each panel represents a different station\",\n      caption = \"Time Elapsed (x-axis) vs Depth & Pressure (y-axis)\"\n    ) +\n    theme(\n      plot.tag = element_text(size = 12, face = \"bold\"),\n      plot.tag.position = \"topleft\",\n      axis.title.x = element_text(margin = margin(t = 10)),\n      axis.title.y = element_text(margin = margin(r = 10))\n    )\n  \n  print(combined_plot)\n}, error = function(er){\n  print(er)\n});\n\n\n\n\n\n\n\n\n\n\n\nplot across all stations\np &lt;- ggplot(cruise_df, aes(x = time, y = depth, fill = station)) +\n  geom_col() +  # This creates the bars\n  # geom_text(aes(label = station), vjust = -0.3) +  # This adds labels to each bar, adjust vjust for position\n  labs(x = \"Time\", y = \"Depth\", title = \"Depth over Time by Station\") +  # Set labels and title\n  theme_minimal()  # Use a minimal theme\nprint(p)\n\n\n\n\n\n\n\n\n\n\n\ncreate oce.ctd objects from dataframes\nctd_load &lt;- function(data, other_params = NULL) {\n  \n  # create csv into ctd object\n  test_ctd &lt;-\n    as.ctd(\n      salinity    = data$sea_water_salinity,\n      temperature = data$sea_water_temperature,\n      pressure    = data$sea_water_pressure,\n      station     = data$station\n    )\n  \n  # add additional columns to ctd object\n  if (!is.null(other_params)) {\n    for (param_name in other_params) {\n      test_ctd &lt;-\n        oceSetData(\n          object = test_ctd,\n          name   = param_name,\n          value  = data[[param_name]]\n        )\n    }\n  }\n  print(glue(\"{data$station[1]}:\\t{length(test_ctd@data$scan)} scans\"))\n\n\n  return(test_ctd)\n}\n\n# Define other parameters to add\nother_params &lt;- c(\n  \"cruise_id\", \"station\", \"time\", \"time_elapsed\", \n  \"latitude\", \"longitude\", \"sea_water_electrical_conductivity\", \n  \"CDOM\", \"dissolved_oxygen\",\"oxygen_saturation\", \"chlorophyll_concentration\", \n  \"chlorophyll_fluorescence\", \"photosynthetically_available_radiation\", \n  \"beam_attenuation\",\"beam_transmission\", \"depth\", \"sea_water_sigma_t\",\n  \"descent_rate\", \"sound_velocity\",\"altimeter\"\n)\n\n# Split data by station and create data list\nctd_FK &lt;- cruise_df %&gt;%\n  split(.$station) %&gt;%\n  map(~ ctd_load(.x, other_params = other_params)) # ~ is a lambda(x)\n\n\n.002:   2746 scans\n.10:    1701 scans\n.12:    5459 scans\n.16:    2734 scans\n.18:    5483 scans\n.21LK:  5188 scans\n.30:    3802 scans\n.31:    3396 scans\n.33:    2947 scans\n.41:    205 scans\n.45:    3613 scans\n.51:    2850 scans\n.54:    4 scans\n.55:    2197 scans\n.56:    61 scans\n.57:    2558 scans\n.57_1:  3368 scans\n.57_2:  2546 scans\n.57_3:  4941 scans\n.58:    4611 scans\n.60:    2499 scans\n.64:    498 scans\n.65:    222 scans\n.68:    481 scans\n.7: 5964 scans\n.9: 4059 scans\n.9_5:   13009 scans\n.AMI1:  1464 scans\n.AMI1_2:    250 scans\n.AMI2:  4218 scans\n.AMI3:  2182 scans\n.AMI4:  4155 scans\n.AMI5:  5819 scans\n.AMI6:  6263 scans\n.AMI7:  6498 scans\n.AMI8:  6595 scans\n.AMI9:  4959 scans\n.CAL1:  2496 scans\n.CAL2:  3241 scans\n.CAL3:  3351 scans\n.CAL4:  3537 scans\n.CAL5:  2791 scans\n.CAL6:  3151 scans\n.EH07:  5436 scans\n.EH08:  5988 scans\n.GP1:   2532 scans\n.GP2:   3417 scans\n.GP3:   2493 scans\n.GP4:   3563 scans\n.GP5:   2099 scans\n.GP5_2: 27 scans\n.KW1:   2428 scans\n.KW2:   3465 scans\n.KW4:   4075 scans\n.MR:    4367 scans\n.RP1:   4059 scans\n.RP2:   3732 scans\n.RP3:   3329 scans\n.RP4:   4106 scans\n.TB1:   4378 scans\n.TB10:  5529 scans\n.TB2:   4317 scans\n.TB3:   3872 scans\n.TB4:   3733 scans\n.TB5:   5570 scans\n.V1:    349 scans\n.V2:    3743 scans\n.V3:    3448 scans\n.V4:    2560 scans\n.V5:    4125 scans\n.V6:    4104 scans\n.V7:    4075 scans\n.V8:    4789 scans\n.V9:    4364 scans\n.WS:    3000 scans\n\n\n\n\nplotting scans for each cast in the first list\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # 1 is selecting only the first sublist\n  # print(i)\n  print(glue(\"=== station: {cast@metadata$station[1]}\"))\n  print(glue(\"# scans: {length(cast@data$scan)}\"))\n  plotScan(cast)\n}\n\n\n=== station: .002\n# scans: 2746\n\n\n\n\n\n\n\n\n\n=== station: .10\n# scans: 1701\n\n\n\n\n\n\n\n\n\n=== station: .12\n# scans: 5459\n\n\n\n\n\n\n\n\n\n=== station: .16\n# scans: 2734\n\n\n\n\n\n\n\n\n\n=== station: .18\n# scans: 5483\n\n\n\n\n\n\n\n\n\n=== station: .21LK\n# scans: 5188\n\n\n\n\n\n\n\n\n\n=== station: .30\n# scans: 3802\n\n\n\n\n\n\n\n\n\n=== station: .31\n# scans: 3396\n\n\n\n\n\n\n\n\n\n=== station: .33\n# scans: 2947\n\n\n\n\n\n\n\n\n\n=== station: .41\n# scans: 205\n\n\n\n\n\n\n\n\n\n=== station: .45\n# scans: 3613\n\n\n\n\n\n\n\n\n\n=== station: .51\n# scans: 2850\n\n\n\n\n\n\n\n\n\n=== station: .54\n# scans: 4\n\n\n\n\n\n\n\n\n\n=== station: .55\n# scans: 2197\n\n\n\n\n\n\n\n\n\n=== station: .56\n# scans: 61\n\n\n\n\n\n\n\n\n\n=== station: .57\n# scans: 2558\n\n\n\n\n\n\n\n\n\n=== station: .57_1\n# scans: 3368\n\n\n\n\n\n\n\n\n\n=== station: .57_2\n# scans: 2546\n\n\n\n\n\n\n\n\n\n=== station: .57_3\n# scans: 4941\n\n\n\n\n\n\n\n\n\n=== station: .58\n# scans: 4611\n\n\n\n\n\n\n\n\n\n=== station: .60\n# scans: 2499\n\n\n\n\n\n\n\n\n\n=== station: .64\n# scans: 498\n\n\n\n\n\n\n\n\n\n=== station: .65\n# scans: 222\n\n\n\n\n\n\n\n\n\n=== station: .68\n# scans: 481\n\n\n\n\n\n\n\n\n\n=== station: .7\n# scans: 5964\n\n\n\n\n\n\n\n\n\n=== station: .9\n# scans: 4059\n\n\n\n\n\n\n\n\n\n=== station: .9_5\n# scans: 13009\n\n\n\n\n\n\n\n\n\n=== station: .AMI1\n# scans: 1464\n\n\n\n\n\n\n\n\n\n=== station: .AMI1_2\n# scans: 250\n\n\n\n\n\n\n\n\n\n=== station: .AMI2\n# scans: 4218\n\n\n\n\n\n\n\n\n\n=== station: .AMI3\n# scans: 2182\n\n\n\n\n\n\n\n\n\n=== station: .AMI4\n# scans: 4155\n\n\n\n\n\n\n\n\n\n=== station: .AMI5\n# scans: 5819\n\n\n\n\n\n\n\n\n\n=== station: .AMI6\n# scans: 6263\n\n\n\n\n\n\n\n\n\n=== station: .AMI7\n# scans: 6498\n\n\n\n\n\n\n\n\n\n=== station: .AMI8\n# scans: 6595\n\n\n\n\n\n\n\n\n\n=== station: .AMI9\n# scans: 4959\n\n\n\n\n\n\n\n\n\n=== station: .CAL1\n# scans: 2496\n\n\n\n\n\n\n\n\n\n=== station: .CAL2\n# scans: 3241\n\n\n\n\n\n\n\n\n\n=== station: .CAL3\n# scans: 3351\n\n\n\n\n\n\n\n\n\n=== station: .CAL4\n# scans: 3537\n\n\n\n\n\n\n\n\n\n=== station: .CAL5\n# scans: 2791\n\n\n\n\n\n\n\n\n\n=== station: .CAL6\n# scans: 3151\n\n\n\n\n\n\n\n\n\n=== station: .EH07\n# scans: 5436\n\n\n\n\n\n\n\n\n\n=== station: .EH08\n# scans: 5988\n\n\n\n\n\n\n\n\n\n=== station: .GP1\n# scans: 2532\n\n\n\n\n\n\n\n\n\n=== station: .GP2\n# scans: 3417\n\n\n\n\n\n\n\n\n\n=== station: .GP3\n# scans: 2493\n\n\n\n\n\n\n\n\n\n=== station: .GP4\n# scans: 3563\n\n\n\n\n\n\n\n\n\n=== station: .GP5\n# scans: 2099\n\n\n\n\n\n\n\n\n\n=== station: .GP5_2\n# scans: 27\n\n\n\n\n\n\n\n\n\n=== station: .KW1\n# scans: 2428\n\n\n\n\n\n\n\n\n\n=== station: .KW2\n# scans: 3465\n\n\n\n\n\n\n\n\n\n=== station: .KW4\n# scans: 4075\n\n\n\n\n\n\n\n\n\n=== station: .MR\n# scans: 4367\n\n\n\n\n\n\n\n\n\n=== station: .RP1\n# scans: 4059\n\n\n\n\n\n\n\n\n\n=== station: .RP2\n# scans: 3732\n\n\n\n\n\n\n\n\n\n=== station: .RP3\n# scans: 3329\n\n\n\n\n\n\n\n\n\n=== station: .RP4\n# scans: 4106\n\n\n\n\n\n\n\n\n\n=== station: .TB1\n# scans: 4378\n\n\n\n\n\n\n\n\n\n=== station: .TB10\n# scans: 5529\n\n\n\n\n\n\n\n\n\n=== station: .TB2\n# scans: 4317\n\n\n\n\n\n\n\n\n\n=== station: .TB3\n# scans: 3872\n\n\n\n\n\n\n\n\n\n=== station: .TB4\n# scans: 3733\n\n\n\n\n\n\n\n\n\n=== station: .TB5\n# scans: 5570\n\n\n\n\n\n\n\n\n\n=== station: .V1\n# scans: 349\n\n\n\n\n\n\n\n\n\n=== station: .V2\n# scans: 3743\n\n\n\n\n\n\n\n\n\n=== station: .V3\n# scans: 3448\n\n\n\n\n\n\n\n\n\n=== station: .V4\n# scans: 2560\n\n\n\n\n\n\n\n\n\n=== station: .V5\n# scans: 4125\n\n\n\n\n\n\n\n\n\n=== station: .V6\n# scans: 4104\n\n\n\n\n\n\n\n\n\n=== station: .V7\n# scans: 4075\n\n\n\n\n\n\n\n\n\n=== station: .V8\n# scans: 4789\n\n\n\n\n\n\n\n\n\n=== station: .V9\n# scans: 4364\n\n\n\n\n\n\n\n\n\n=== station: .WS\n# scans: 3000\n\n\n\n\n\n\n\n\n\n\n\nplotting each cast in the first list\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # 1 is selecting only the first sublist\n  tryCatch({\n    plot(ctdDecimate(ctdTrim(cast)))\n  }, error = function(e){\n    print(e)\n  })\n}\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2746' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1701' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 5459' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2734' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 5483' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 5188' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3802' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3396' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2947' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 205' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3613' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2850' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2558' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3368' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2546' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4941' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4611' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2499' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 498' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 222' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 481' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 5964' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4059' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 13009' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1464' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 250' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4218' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2182' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4155' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 5819' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 6263' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 6498' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 6595' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4959' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2496' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3241' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3351' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3537' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2791' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3151' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 5436' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 5988' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2532' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3417' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2493' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3563' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2099' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 27' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2428' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3465' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4075' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4367' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4059' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3732' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3329' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4106' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4378' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 5529' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4317' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3872' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3733' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 5570' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3743' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3448' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2560' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4125' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4104' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4075' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4789' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4364' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3000' in coercion to 'logical(1)'&gt;\n\n\n\n\nplotting other physical parameters for each cast\n# Loop through each CTD cast\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # Assuming each sublist contains only one relevant CTD object\n  tryCatch({\n    # Extract metadata for station name and cruise ID\n    station_name &lt;- cast@metadata$station[1]\n    cruise_id &lt;- cast@data$cruise_id[1]\n\n    # Generate a title with station name and cruise ID\n    overall_title &lt;- glue::glue(\"Station: {station_name}, Cruise ID: {cruise_id}\")\n\n    # Set margins: increase the outer margin for the title\n    par(oma = c(0, 0, 3, 0))  # Top outer margin increased for title\n\n    # Plotting function with specific parameters\n    oce::plot(\n      x = ctdDecimate(ctdTrim(cast)),\n      which = c(\n        \"sea_water_electrical_conductivity\",\n        \"descent_rate\", \"sound_velocity\",\n        \"sea_water_sigma_t\",\"altimeter\"\n      ),\n      main = \"\"  # No main title for individual subplots\n    )\n\n    # Place a single overall title at the top of the plot frame\n    mtext(overall_title, side = 3, line = 1, outer = TRUE, cex = 1.5)\n\n    # Reset outer margins to default\n    par(oma = c(0, 0, 0, 0))\n\n  }, error = function(e) {\n    print(e$message)  # Print any errors that occur during plotting\n  })\n}\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n\n\nplotting other nutrient parameters for each cast\n# Loop through each CTD cast\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # Assuming each sublist contains only one relevant CTD object\n  tryCatch({\n    # Extract metadata for station name and cruise ID\n    station_name &lt;- cast@metadata$station[1]\n    cruise_id &lt;- cast@data$cruise_id[1]\n\n    # Generate a title with station name and cruise ID\n    overall_title &lt;- glue::glue(\"Station: {station_name}, Cruise ID: {cruise_id}\")\n\n    # Set margins: increase the outer margin for the title\n    par(oma = c(0, 0, 3, 0))  # Top outer margin increased for title\n\n    # Plotting function with specific parameters\n    oce::plot(\n      x = ctdDecimate(ctdTrim(cast)),\n      which = c(\n        \"CDOM\", \"dissolved_oxygen\",\n        \"oxygen_saturation\",\n        \"chlorophyll_concentration\", \"chlorophyll_fluorescence\"\n      ),\n      main = \"\"  # No main title for individual subplots\n    )\n\n    # Place a single overall title at the top of the plot frame\n    mtext(overall_title, side = 3, line = 1, outer = TRUE, cex = 1.5)\n\n    # Reset outer margins to default\n    par(oma = c(0, 0, 0, 0))\n\n  }, error = function(e) {\n    print(e$message)  # Print any errors that occur during plotting\n  })\n}\n\n\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"plot.new has not been called yet\"\n[1] \"plot.new has not been called yet\"\n[1] \"plot.new has not been called yet\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"plot.new has not been called yet\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n\n\n\n\nplotting other optical parameters for each cast\n# Loop through each CTD cast\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # Assuming each sublist contains only one relevant CTD object\n  tryCatch({\n    # Extract metadata for station name and cruise ID\n    station_name &lt;- cast@metadata$station[1]\n    cruise_id &lt;- cast@data$cruise_id[1]\n\n    # Generate a title with station name and cruise ID\n    overall_title &lt;- glue::glue(\"Station: {station_name}, Cruise ID: {cruise_id}\")\n\n    # Set margins: increase the outer margin for the title\n    par(oma = c(0, 0, 3, 0))  # Top outer margin increased for title\n\n    # Plotting function with specific parameters\n    oce::plot(\n      x = ctdDecimate(ctdTrim(cast)),\n      which = c(\n        \"photosynthetically_available_radiation\",\n        \"beam_attenuation\",\"beam_transmission\"\n      ),\n      main = \"\"  # No main title for individual subplots\n    )\n\n    # Place a single overall title at the top of the plot frame\n    mtext(overall_title, side = 3, line = 1, outer = TRUE, cex = 1.5)\n\n    # Reset outer margins to default\n    par(oma = c(0, 0, 0, 0))\n\n  }, error = function(e) {\n    print(e$message)  # Print any errors that occur during plotting\n  })\n}\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nloop through every cast, clean, & save\ncombined_df &lt;- data.frame()\nfor (i in seq(ctd_FK)){\n  tryCatch({\n    cast &lt;- ctd_FK[[i]]  # 1 is selecting only the first sublist\n    \n    # print(class(cast))\n    # clean cast \n    trimmed_cast &lt;- ctdTrim(cast)\n    decimated_cast &lt;- ctdDecimate(trimmed_cast, p = 0.5)  # binned to 0.5 m\n    \n    # convert to df\n    cast_df &lt;- as.data.frame(decimated_cast@data)\n    \n    # Add metadata\n    # assumes station ID and cruise ID the same for all & just uses 1st one\n    cast_df &lt;- mutate(\n      cast_df,\n      station = cast@data$station[1],\n      cruise_id = cast@data$cruise_id[1]\n    )\n  \n    # drop NA rows left by cleaning\n    cast_df &lt;- subset(cast_df, !is.na(scan))\n    \n    # Append the data to the combined dataframe\n    combined_df &lt;- rbind(combined_df, cast_df)\n  }, error = function(e){\n    print(glue(\"error in cast {cast@metadata$station[1]}\"))\n    print(e)\n  })\n}\n# Save to CSV\nfile_path &lt;- here(glue(\"data/cleaned/{cruise_id}.csv\"))\nwrite.csv(combined_df, file_path, row.names = FALSE)"
  },
  {
    "objectID": "cruise_report/cruise_reports/WS21151.html",
    "href": "cruise_report/cruise_reports/WS21151.html",
    "title": "WS21151",
    "section": "",
    "text": "WS21151\n\n\nsetup\nif (!nzchar(system.file(package = \"librarian\"))) {\n  install.packages(\"librarian\")\n}\n\nlibrarian::shelf(\n  quiet = TRUE,\n  readr, here, fs, ggplot2, glue, \"jiho/castr\", dplyr, oce, patchwork, purrr, tidyr\n)\n\n\n\n\nCode\nsource(here(\"R/cruise_load.R\"))\ncruise_df &lt;- cruise_load(params$cruise_id)\n\n\n\n\nplot depth & pressure vs time elapsed\ntryCatch({\n  plots &lt;- list()\n  \n  for (station_name in unique(cruise_df$station)) {\n    subset_df &lt;- filter(cruise_df, station == station_name)\n    plots[[station_name]] &lt;- ggplot(subset_df, aes(x = time_elapsed)) +\n      geom_point(aes(y = depth), color = \"blue\") +  # Plot depth in blue\n      geom_line(aes(y = sea_water_pressure), color = \"red\") +  # Plot sea water pressure in red\n      ggtitle(glue(\"{station_name}\")) +\n      theme(\n        axis.title.x = element_blank(),\n        axis.title.y = element_blank(),\n        axis.text.x = element_blank(),\n        axis.text.y = element_blank(),\n        axis.ticks.x = element_blank(),\n        axis.ticks.y = element_blank()\n      )  # Remove individual axis titles and text\n  }\n  \n  # drop nulls\n  plots &lt;- purrr::compact(plots)\n  \n  # Combine all plots into a grid\n  combined_plot &lt;- wrap_plots(plots) + \n    plot_layout(ncol = 4) +  # Adjust ncol to set number of columns in the grid\n    plot_annotation(\n      title = \"Depth (blue) and Pressure (red)\",\n      subtitle = \"Each panel represents a different station\",\n      caption = \"Time Elapsed (x-axis) vs Depth & Pressure (y-axis)\"\n    ) +\n    theme(\n      plot.tag = element_text(size = 12, face = \"bold\"),\n      plot.tag.position = \"topleft\",\n      axis.title.x = element_text(margin = margin(t = 10)),\n      axis.title.y = element_text(margin = margin(r = 10))\n    )\n  \n  print(combined_plot)\n}, error = function(er){\n  print(er)\n});\n\n\n`geom_line()`: Each group consists of only one observation.\n Do you need to adjust the group aesthetic?\n\n\n\n\n\n\n\n\n\n\n\nplot across all stations\np &lt;- ggplot(cruise_df, aes(x = time, y = depth, fill = station)) +\n  geom_col() +  # This creates the bars\n  # geom_text(aes(label = station), vjust = -0.3) +  # This adds labels to each bar, adjust vjust for position\n  labs(x = \"Time\", y = \"Depth\", title = \"Depth over Time by Station\") +  # Set labels and title\n  theme_minimal()  # Use a minimal theme\nprint(p)\n\n\n\n\n\n\n\n\n\n\n\ncreate oce.ctd objects from dataframes\nctd_load &lt;- function(data, other_params = NULL) {\n  \n  # create csv into ctd object\n  test_ctd &lt;-\n    as.ctd(\n      salinity    = data$sea_water_salinity,\n      temperature = data$sea_water_temperature,\n      pressure    = data$sea_water_pressure,\n      station     = data$station\n    )\n  \n  # add additional columns to ctd object\n  if (!is.null(other_params)) {\n    for (param_name in other_params) {\n      test_ctd &lt;-\n        oceSetData(\n          object = test_ctd,\n          name   = param_name,\n          value  = data[[param_name]]\n        )\n    }\n  }\n  print(glue(\"{data$station[1]}:\\t{length(test_ctd@data$scan)} scans\"))\n\n\n  return(test_ctd)\n}\n\n# Define other parameters to add\nother_params &lt;- c(\n  \"cruise_id\", \"station\", \"time\", \"time_elapsed\", \n  \"latitude\", \"longitude\", \"sea_water_electrical_conductivity\", \n  \"CDOM\", \"dissolved_oxygen\",\"oxygen_saturation\", \"chlorophyll_concentration\", \n  \"chlorophyll_fluorescence\", \"photosynthetically_available_radiation\", \n  \"beam_attenuation\",\"beam_transmission\", \"depth\", \"sea_water_sigma_t\",\n  \"descent_rate\", \"sound_velocity\",\"altimeter\"\n)\n\n# Split data by station and create data list\nctd_FK &lt;- cruise_df %&gt;%\n  split(.$station) %&gt;%\n  map(~ ctd_load(.x, other_params = other_params)) # ~ is a lambda(x)\n\n\n001:    4083 scans\n007:    2401 scans\n009:    8790 scans\n009.5:  11589 scans\n010:    3495 scans\n012:    4989 scans\n016:    2068 scans\n018:    4476 scans\n21LK:   3836 scans\n30: 4127 scans\n31: 3503 scans\n33: 1939 scans\n41: 2144 scans\n45: 1496 scans\n47: 1433 scans\n49: 21 scans\n51: 1786 scans\n53: 1 scans\n54: 713 scans\n55: 786 scans\n56: 2059 scans\n57: 3803 scans\n57.1:   3842 scans\n57.2:   4276 scans\n57.3:   3700 scans\n58: 4020 scans\n60: 2082 scans\n64: 189 scans\n65: 50 scans\n68: 26 scans\nAMI1:   3305 scans\nAMI2:   3517 scans\nAMI3:   3773 scans\nAMI4:   3907 scans\nAMI5:   4860 scans\nAMI6:   5757 scans\nAMI7:   5406 scans\nAMI8:   5667 scans\nAMI9:   6452 scans\nBG1:    1990 scans\nBG2:    3919 scans\nBG3:    3476 scans\nBG4:    4101 scans\nCAL.A:  4275 scans\nCAL1:   1562 scans\nCAL2:   1635 scans\nCAL3:   2805 scans\nCAL4:   2245 scans\nCAL5:   4217 scans\nCAL6:   4214 scans\nGP5:    3928 scans\nGS: 7392 scans\nKW1:    3121 scans\nKW2:    4303 scans\nKW4:    4700 scans\nMR: 3370 scans\nRP1:    2651 scans\nRP2:    2801 scans\nRP3:    3874 scans\nRP4:    3963 scans\nTB1:    2323 scans\nTB10:   4822 scans\nTB2:    3170 scans\nTB3:    4540 scans\nTB4:    4601 scans\nTB5:    3469 scans\nTBA:    2930 scans\nTBB:    1884 scans\nTBC:    2402 scans\nV1: 3724 scans\nV2: 3053 scans\nV3: 3052 scans\nV4: 3528 scans\nV5: 3960 scans\nV6: 3316 scans\nV7: 3725 scans\nV8: 3542 scans\nV9: 3899 scans\nWS: 3363 scans\n\n\n\n\nplotting scans for each cast in the first list\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # 1 is selecting only the first sublist\n  # print(i)\n  print(glue(\"=== station: {cast@metadata$station[1]}\"))\n  print(glue(\"# scans: {length(cast@data$scan)}\"))\n  plotScan(cast)\n}\n\n\n=== station: 001\n# scans: 4083\n\n\n\n\n\n\n\n\n\n=== station: 007\n# scans: 2401\n\n\n\n\n\n\n\n\n\n=== station: 009\n# scans: 8790\n\n\n\n\n\n\n\n\n\n=== station: 009.5\n# scans: 11589\n\n\n\n\n\n\n\n\n\n=== station: 010\n# scans: 3495\n\n\n\n\n\n\n\n\n\n=== station: 012\n# scans: 4989\n\n\n\n\n\n\n\n\n\n=== station: 016\n# scans: 2068\n\n\n\n\n\n\n\n\n\n=== station: 018\n# scans: 4476\n\n\n\n\n\n\n\n\n\n=== station: 21LK\n# scans: 3836\n\n\n\n\n\n\n\n\n\n=== station: 30\n# scans: 4127\n\n\n\n\n\n\n\n\n\n=== station: 31\n# scans: 3503\n\n\n\n\n\n\n\n\n\n=== station: 33\n# scans: 1939\n\n\n\n\n\n\n\n\n\n=== station: 41\n# scans: 2144\n\n\n\n\n\n\n\n\n\n=== station: 45\n# scans: 1496\n\n\n\n\n\n\n\n\n\n=== station: 47\n# scans: 1433\n\n\n\n\n\n\n\n\n\n=== station: 49\n# scans: 21\n\n\n\n\n\n\n\n\n\n=== station: 51\n# scans: 1786\n\n\n\n\n\n\n\n\n\n=== station: 53\n# scans: 1\n\n\n\n\n\n\n\n\n\n=== station: 54\n# scans: 713\n\n\n\n\n\n\n\n\n\n=== station: 55\n# scans: 786\n\n\n\n\n\n\n\n\n\n=== station: 56\n# scans: 2059\n\n\n\n\n\n\n\n\n\n=== station: 57\n# scans: 3803\n\n\n\n\n\n\n\n\n\n=== station: 57.1\n# scans: 3842\n\n\n\n\n\n\n\n\n\n=== station: 57.2\n# scans: 4276\n\n\n\n\n\n\n\n\n\n=== station: 57.3\n# scans: 3700\n\n\n\n\n\n\n\n\n\n=== station: 58\n# scans: 4020\n\n\n\n\n\n\n\n\n\n=== station: 60\n# scans: 2082\n\n\n\n\n\n\n\n\n\n=== station: 64\n# scans: 189\n\n\n\n\n\n\n\n\n\n=== station: 65\n# scans: 50\n\n\n\n\n\n\n\n\n\n=== station: 68\n# scans: 26\n\n\n\n\n\n\n\n\n\n=== station: AMI1\n# scans: 3305\n\n\n\n\n\n\n\n\n\n=== station: AMI2\n# scans: 3517\n\n\n\n\n\n\n\n\n\n=== station: AMI3\n# scans: 3773\n\n\n\n\n\n\n\n\n\n=== station: AMI4\n# scans: 3907\n\n\n\n\n\n\n\n\n\n=== station: AMI5\n# scans: 4860\n\n\n\n\n\n\n\n\n\n=== station: AMI6\n# scans: 5757\n\n\n\n\n\n\n\n\n\n=== station: AMI7\n# scans: 5406\n\n\n\n\n\n\n\n\n\n=== station: AMI8\n# scans: 5667\n\n\n\n\n\n\n\n\n\n=== station: AMI9\n# scans: 6452\n\n\n\n\n\n\n\n\n\n=== station: BG1\n# scans: 1990\n\n\n\n\n\n\n\n\n\n=== station: BG2\n# scans: 3919\n\n\n\n\n\n\n\n\n\n=== station: BG3\n# scans: 3476\n\n\n\n\n\n\n\n\n\n=== station: BG4\n# scans: 4101\n\n\n\n\n\n\n\n\n\n=== station: CAL.A\n# scans: 4275\n\n\n\n\n\n\n\n\n\n=== station: CAL1\n# scans: 1562\n\n\n\n\n\n\n\n\n\n=== station: CAL2\n# scans: 1635\n\n\n\n\n\n\n\n\n\n=== station: CAL3\n# scans: 2805\n\n\n\n\n\n\n\n\n\n=== station: CAL4\n# scans: 2245\n\n\n\n\n\n\n\n\n\n=== station: CAL5\n# scans: 4217\n\n\n\n\n\n\n\n\n\n=== station: CAL6\n# scans: 4214\n\n\n\n\n\n\n\n\n\n=== station: GP5\n# scans: 3928\n\n\n\n\n\n\n\n\n\n=== station: GS\n# scans: 7392\n\n\n\n\n\n\n\n\n\n=== station: KW1\n# scans: 3121\n\n\n\n\n\n\n\n\n\n=== station: KW2\n# scans: 4303\n\n\n\n\n\n\n\n\n\n=== station: KW4\n# scans: 4700\n\n\n\n\n\n\n\n\n\n=== station: MR\n# scans: 3370\n\n\n\n\n\n\n\n\n\n=== station: RP1\n# scans: 2651\n\n\n\n\n\n\n\n\n\n=== station: RP2\n# scans: 2801\n\n\n\n\n\n\n\n\n\n=== station: RP3\n# scans: 3874\n\n\n\n\n\n\n\n\n\n=== station: RP4\n# scans: 3963\n\n\n\n\n\n\n\n\n\n=== station: TB1\n# scans: 2323\n\n\n\n\n\n\n\n\n\n=== station: TB10\n# scans: 4822\n\n\n\n\n\n\n\n\n\n=== station: TB2\n# scans: 3170\n\n\n\n\n\n\n\n\n\n=== station: TB3\n# scans: 4540\n\n\n\n\n\n\n\n\n\n=== station: TB4\n# scans: 4601\n\n\n\n\n\n\n\n\n\n=== station: TB5\n# scans: 3469\n\n\n\n\n\n\n\n\n\n=== station: TBA\n# scans: 2930\n\n\n\n\n\n\n\n\n\n=== station: TBB\n# scans: 1884\n\n\n\n\n\n\n\n\n\n=== station: TBC\n# scans: 2402\n\n\n\n\n\n\n\n\n\n=== station: V1\n# scans: 3724\n\n\n\n\n\n\n\n\n\n=== station: V2\n# scans: 3053\n\n\n\n\n\n\n\n\n\n=== station: V3\n# scans: 3052\n\n\n\n\n\n\n\n\n\n=== station: V4\n# scans: 3528\n\n\n\n\n\n\n\n\n\n=== station: V5\n# scans: 3960\n\n\n\n\n\n\n\n\n\n=== station: V6\n# scans: 3316\n\n\n\n\n\n\n\n\n\n=== station: V7\n# scans: 3725\n\n\n\n\n\n\n\n\n\n=== station: V8\n# scans: 3542\n\n\n\n\n\n\n\n\n\n=== station: V9\n# scans: 3899\n\n\n\n\n\n\n\n\n\n=== station: WS\n# scans: 3363\n\n\n\n\n\n\n\n\n\n\n\nplotting each cast in the first list\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # 1 is selecting only the first sublist\n  tryCatch({\n    plot(ctdDecimate(ctdTrim(cast)))\n  }, error = function(e){\n    print(e)\n  })\n}\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4083' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2401' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 8790' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 11589' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3495' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4989' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2068' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4476' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3836' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4127' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3503' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1939' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2144' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1496' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1433' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1786' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 786' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2059' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3803' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3842' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4276' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3700' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4020' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2082' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 189' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 50' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 26' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3305' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3517' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3773' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3907' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4860' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 5757' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 5406' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 5667' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 6452' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1990' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3919' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3476' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4101' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4275' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1562' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1635' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2805' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2245' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4217' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4214' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3928' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 7392' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3121' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4303' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4700' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3370' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2651' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2801' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3874' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3963' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2323' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4822' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3170' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4540' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4601' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3469' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2930' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1884' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2402' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3724' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3053' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3052' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3528' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3960' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3316' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3725' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3542' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3899' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3363' in coercion to 'logical(1)'&gt;\n\n\n\n\nplotting other physical parameters for each cast\n# Loop through each CTD cast\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # Assuming each sublist contains only one relevant CTD object\n  tryCatch({\n    # Extract metadata for station name and cruise ID\n    station_name &lt;- cast@metadata$station[1]\n    cruise_id &lt;- cast@data$cruise_id[1]\n\n    # Generate a title with station name and cruise ID\n    overall_title &lt;- glue::glue(\"Station: {station_name}, Cruise ID: {cruise_id}\")\n\n    # Set margins: increase the outer margin for the title\n    par(oma = c(0, 0, 3, 0))  # Top outer margin increased for title\n\n    # Plotting function with specific parameters\n    oce::plot(\n      x = ctdDecimate(ctdTrim(cast)),\n      which = c(\n        \"sea_water_electrical_conductivity\",\n        \"descent_rate\", \"sound_velocity\",\n        \"sea_water_sigma_t\",\"altimeter\"\n      ),\n      main = \"\"  # No main title for individual subplots\n    )\n\n    # Place a single overall title at the top of the plot frame\n    mtext(overall_title, side = 3, line = 1, outer = TRUE, cex = 1.5)\n\n    # Reset outer margins to default\n    par(oma = c(0, 0, 0, 0))\n\n  }, error = function(e) {\n    print(e$message)  # Print any errors that occur during plotting\n  })\n}\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"unknown xtype value (\\\"5.461893\\\")\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n\n\nplotting other nutrient parameters for each cast\n# Loop through each CTD cast\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # Assuming each sublist contains only one relevant CTD object\n  tryCatch({\n    # Extract metadata for station name and cruise ID\n    station_name &lt;- cast@metadata$station[1]\n    cruise_id &lt;- cast@data$cruise_id[1]\n\n    # Generate a title with station name and cruise ID\n    overall_title &lt;- glue::glue(\"Station: {station_name}, Cruise ID: {cruise_id}\")\n\n    # Set margins: increase the outer margin for the title\n    par(oma = c(0, 0, 3, 0))  # Top outer margin increased for title\n\n    # Plotting function with specific parameters\n    oce::plot(\n      x = ctdDecimate(ctdTrim(cast)),\n      which = c(\n        \"CDOM\", \"dissolved_oxygen\",\n        \"oxygen_saturation\",\n        \"chlorophyll_concentration\", \"chlorophyll_fluorescence\"\n      ),\n      main = \"\"  # No main title for individual subplots\n    )\n\n    # Place a single overall title at the top of the plot frame\n    mtext(overall_title, side = 3, line = 1, outer = TRUE, cex = 1.5)\n\n    # Reset outer margins to default\n    par(oma = c(0, 0, 0, 0))\n\n  }, error = function(e) {\n    print(e$message)  # Print any errors that occur during plotting\n  })\n}\n\n\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"plot.new has not been called yet\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"plot.new has not been called yet\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n\n\n\n\nplotting other optical parameters for each cast\n# Loop through each CTD cast\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # Assuming each sublist contains only one relevant CTD object\n  tryCatch({\n    # Extract metadata for station name and cruise ID\n    station_name &lt;- cast@metadata$station[1]\n    cruise_id &lt;- cast@data$cruise_id[1]\n\n    # Generate a title with station name and cruise ID\n    overall_title &lt;- glue::glue(\"Station: {station_name}, Cruise ID: {cruise_id}\")\n\n    # Set margins: increase the outer margin for the title\n    par(oma = c(0, 0, 3, 0))  # Top outer margin increased for title\n\n    # Plotting function with specific parameters\n    oce::plot(\n      x = ctdDecimate(ctdTrim(cast)),\n      which = c(\n        \"photosynthetically_available_radiation\",\n        \"beam_attenuation\",\"beam_transmission\"\n      ),\n      main = \"\"  # No main title for individual subplots\n    )\n\n    # Place a single overall title at the top of the plot frame\n    mtext(overall_title, side = 3, line = 1, outer = TRUE, cex = 1.5)\n\n    # Reset outer margins to default\n    par(oma = c(0, 0, 0, 0))\n\n  }, error = function(e) {\n    print(e$message)  # Print any errors that occur during plotting\n  })\n}\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n[1] \"unknown xtype value (\\\"12.588\\\")\"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nloop through every cast, clean, & save\ncombined_df &lt;- data.frame()\nfor (i in seq(ctd_FK)){\n  tryCatch({\n    cast &lt;- ctd_FK[[i]]  # 1 is selecting only the first sublist\n    \n    # print(class(cast))\n    # clean cast \n    trimmed_cast &lt;- ctdTrim(cast)\n    decimated_cast &lt;- ctdDecimate(trimmed_cast, p = 0.5)  # binned to 0.5 m\n    \n    # convert to df\n    cast_df &lt;- as.data.frame(decimated_cast@data)\n    \n    # Add metadata\n    # assumes station ID and cruise ID the same for all & just uses 1st one\n    cast_df &lt;- mutate(\n      cast_df,\n      station = cast@data$station[1],\n      cruise_id = cast@data$cruise_id[1]\n    )\n  \n    # drop NA rows left by cleaning\n    cast_df &lt;- subset(cast_df, !is.na(scan))\n    \n    # Append the data to the combined dataframe\n    combined_df &lt;- rbind(combined_df, cast_df)\n  }, error = function(e){\n    print(glue(\"error in cast {cast@metadata$station[1]}\"))\n    print(e)\n  })\n}\n# Save to CSV\nfile_path &lt;- here(glue(\"data/cleaned/{cruise_id}.csv\"))\nwrite.csv(combined_df, file_path, row.names = FALSE)"
  },
  {
    "objectID": "cruise_report/cruise_reports/WS21032.html",
    "href": "cruise_report/cruise_reports/WS21032.html",
    "title": "WS21032",
    "section": "",
    "text": "WS21032\n\n\nsetup\nif (!nzchar(system.file(package = \"librarian\"))) {\n  install.packages(\"librarian\")\n}\n\nlibrarian::shelf(\n  quiet = TRUE,\n  readr, here, fs, ggplot2, glue, \"jiho/castr\", dplyr, oce, patchwork, purrr, tidyr\n)\n\n\n\n\nCode\nsource(here(\"R/cruise_load.R\"))\ncruise_df &lt;- cruise_load(params$cruise_id)\n\n\n\n\nplot depth & pressure vs time elapsed\ntryCatch({\n  plots &lt;- list()\n  \n  for (station_name in unique(cruise_df$station)) {\n    subset_df &lt;- filter(cruise_df, station == station_name)\n    plots[[station_name]] &lt;- ggplot(subset_df, aes(x = time_elapsed)) +\n      geom_point(aes(y = depth), color = \"blue\") +  # Plot depth in blue\n      geom_line(aes(y = sea_water_pressure), color = \"red\") +  # Plot sea water pressure in red\n      ggtitle(glue(\"{station_name}\")) +\n      theme(\n        axis.title.x = element_blank(),\n        axis.title.y = element_blank(),\n        axis.text.x = element_blank(),\n        axis.text.y = element_blank(),\n        axis.ticks.x = element_blank(),\n        axis.ticks.y = element_blank()\n      )  # Remove individual axis titles and text\n  }\n  \n  # drop nulls\n  plots &lt;- purrr::compact(plots)\n  \n  # Combine all plots into a grid\n  combined_plot &lt;- wrap_plots(plots) + \n    plot_layout(ncol = 4) +  # Adjust ncol to set number of columns in the grid\n    plot_annotation(\n      title = \"Depth (blue) and Pressure (red)\",\n      subtitle = \"Each panel represents a different station\",\n      caption = \"Time Elapsed (x-axis) vs Depth & Pressure (y-axis)\"\n    ) +\n    theme(\n      plot.tag = element_text(size = 12, face = \"bold\"),\n      plot.tag.position = \"topleft\",\n      axis.title.x = element_text(margin = margin(t = 10)),\n      axis.title.y = element_text(margin = margin(r = 10))\n    )\n  \n  print(combined_plot)\n}, error = function(er){\n  print(er)\n});\n\n\n\n\n\n\n\n\n\n\n\nplot across all stations\np &lt;- ggplot(cruise_df, aes(x = time, y = depth, fill = station)) +\n  geom_col() +  # This creates the bars\n  # geom_text(aes(label = station), vjust = -0.3) +  # This adds labels to each bar, adjust vjust for position\n  labs(x = \"Time\", y = \"Depth\", title = \"Depth over Time by Station\") +  # Set labels and title\n  theme_minimal()  # Use a minimal theme\nprint(p)\n\n\n\n\n\n\n\n\n\n\n\ncreate oce.ctd objects from dataframes\nctd_load &lt;- function(data, other_params = NULL) {\n  \n  # create csv into ctd object\n  test_ctd &lt;-\n    as.ctd(\n      salinity    = data$sea_water_salinity,\n      temperature = data$sea_water_temperature,\n      pressure    = data$sea_water_pressure,\n      station     = data$station\n    )\n  \n  # add additional columns to ctd object\n  if (!is.null(other_params)) {\n    for (param_name in other_params) {\n      test_ctd &lt;-\n        oceSetData(\n          object = test_ctd,\n          name   = param_name,\n          value  = data[[param_name]]\n        )\n    }\n  }\n  print(glue(\"{data$station[1]}:\\t{length(test_ctd@data$scan)} scans\"))\n\n\n  return(test_ctd)\n}\n\n# Define other parameters to add\nother_params &lt;- c(\n  \"cruise_id\", \"station\", \"time\", \"time_elapsed\", \n  \"latitude\", \"longitude\", \"sea_water_electrical_conductivity\", \n  \"CDOM\", \"dissolved_oxygen\",\"oxygen_saturation\", \"chlorophyll_concentration\", \n  \"chlorophyll_fluorescence\", \"photosynthetically_available_radiation\", \n  \"beam_attenuation\",\"beam_transmission\", \"depth\", \"sea_water_sigma_t\",\n  \"descent_rate\", \"sound_velocity\",\"altimeter\"\n)\n\n# Split data by station and create data list\nctd_FK &lt;- cruise_df %&gt;%\n  split(.$station) %&gt;%\n  map(~ ctd_load(.x, other_params = other_params)) # ~ is a lambda(x)\n\n\n.12:    4193 scans\n.15:    10055 scans\n.18:    3423 scans\n.21-LK: 3445 scans\n.30:    3314 scans\n.31:    3535 scans\n.33:    2070 scans\n.41:    1968 scans\n.45:    2927 scans\n.47:    3754 scans\n.49:    758 scans\n.51:    1902 scans\n.53:    71 scans\n.54:    4 scans\n.55:    480 scans\n.56:    35 scans\n.57:    2094 scans\n.57_1:  1702 scans\n.57_2:  2182 scans\n.57_3:  1908 scans\n.58:    3583 scans\n.60:    1622 scans\n.64:    63 scans\n.65:    629 scans\n.68:    1047 scans\n.9: 5675 scans\n.9_5:   10321 scans\n.AMI1:  3187 scans\n.AMI2:  4677 scans\n.AMI3:  4650 scans\n.AMI4:  3116 scans\n.AMI5:  3763 scans\n.AMI6:  4178 scans\n.AMI7:  5025 scans\n.AMI8:  4605 scans\n.AMI9:  4828 scans\n.BG2:   3269 scans\n.BG3:   3279 scans\n.BG4:   6306 scans\n.CAL1:  1792 scans\n.CAL2:  1759 scans\n.CAL3:  2257 scans\n.CAL4:  3137 scans\n.CAL5:  4418 scans\n.CAL6:  4644 scans\n.GP5:   4308 scans\n.KW1:   2190 scans\n.KW2:   2324 scans\n.KW4:   2374 scans\n.MR:    6794 scans\n.RP1:   1822 scans\n.RP2:   2081 scans\n.RP3:   2456 scans\n.RP4:   3914 scans\n.TB1:   1926 scans\n.TB10:  4131 scans\n.TB2:   4965 scans\n.TB3:   4668 scans\n.TB4:   4415 scans\n.TB5:   3772 scans\n.V1:    2881 scans\n.V2:    2559 scans\n.V3:    2876 scans\n.V4:    3603 scans\n.V5:    3647 scans\n.V6:    4430 scans\n.V7:    3987 scans\n.V8:    3309 scans\n.V9:    5403 scans\n.WS:    1557 scans\n\n\n\n\nplotting scans for each cast in the first list\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # 1 is selecting only the first sublist\n  # print(i)\n  print(glue(\"=== station: {cast@metadata$station[1]}\"))\n  print(glue(\"# scans: {length(cast@data$scan)}\"))\n  plotScan(cast)\n}\n\n\n=== station: .12\n# scans: 4193\n\n\n\n\n\n\n\n\n\n=== station: .15\n# scans: 10055\n\n\n\n\n\n\n\n\n\n=== station: .18\n# scans: 3423\n\n\n\n\n\n\n\n\n\n=== station: .21-LK\n# scans: 3445\n\n\n\n\n\n\n\n\n\n=== station: .30\n# scans: 3314\n\n\n\n\n\n\n\n\n\n=== station: .31\n# scans: 3535\n\n\n\n\n\n\n\n\n\n=== station: .33\n# scans: 2070\n\n\n\n\n\n\n\n\n\n=== station: .41\n# scans: 1968\n\n\n\n\n\n\n\n\n\n=== station: .45\n# scans: 2927\n\n\n\n\n\n\n\n\n\n=== station: .47\n# scans: 3754\n\n\n\n\n\n\n\n\n\n=== station: .49\n# scans: 758\n\n\n\n\n\n\n\n\n\n=== station: .51\n# scans: 1902\n\n\n\n\n\n\n\n\n\n=== station: .53\n# scans: 71\n\n\n\n\n\n\n\n\n\n=== station: .54\n# scans: 4\n\n\n\n\n\n\n\n\n\n=== station: .55\n# scans: 480\n\n\n\n\n\n\n\n\n\n=== station: .56\n# scans: 35\n\n\n\n\n\n\n\n\n\n=== station: .57\n# scans: 2094\n\n\n\n\n\n\n\n\n\n=== station: .57_1\n# scans: 1702\n\n\n\n\n\n\n\n\n\n=== station: .57_2\n# scans: 2182\n\n\n\n\n\n\n\n\n\n=== station: .57_3\n# scans: 1908\n\n\n\n\n\n\n\n\n\n=== station: .58\n# scans: 3583\n\n\n\n\n\n\n\n\n\n=== station: .60\n# scans: 1622\n\n\n\n\n\n\n\n\n\n=== station: .64\n# scans: 63\n\n\n\n\n\n\n\n\n\n=== station: .65\n# scans: 629\n\n\n\n\n\n\n\n\n\n=== station: .68\n# scans: 1047\n\n\n\n\n\n\n\n\n\n=== station: .9\n# scans: 5675\n\n\n\n\n\n\n\n\n\n=== station: .9_5\n# scans: 10321\n\n\n\n\n\n\n\n\n\n=== station: .AMI1\n# scans: 3187\n\n\n\n\n\n\n\n\n\n=== station: .AMI2\n# scans: 4677\n\n\n\n\n\n\n\n\n\n=== station: .AMI3\n# scans: 4650\n\n\n\n\n\n\n\n\n\n=== station: .AMI4\n# scans: 3116\n\n\n\n\n\n\n\n\n\n=== station: .AMI5\n# scans: 3763\n\n\n\n\n\n\n\n\n\n=== station: .AMI6\n# scans: 4178\n\n\n\n\n\n\n\n\n\n=== station: .AMI7\n# scans: 5025\n\n\n\n\n\n\n\n\n\n=== station: .AMI8\n# scans: 4605\n\n\n\n\n\n\n\n\n\n=== station: .AMI9\n# scans: 4828\n\n\n\n\n\n\n\n\n\n=== station: .BG2\n# scans: 3269\n\n\n\n\n\n\n\n\n\n=== station: .BG3\n# scans: 3279\n\n\n\n\n\n\n\n\n\n=== station: .BG4\n# scans: 6306\n\n\n\n\n\n\n\n\n\n=== station: .CAL1\n# scans: 1792\n\n\n\n\n\n\n\n\n\n=== station: .CAL2\n# scans: 1759\n\n\n\n\n\n\n\n\n\n=== station: .CAL3\n# scans: 2257\n\n\n\n\n\n\n\n\n\n=== station: .CAL4\n# scans: 3137\n\n\n\n\n\n\n\n\n\n=== station: .CAL5\n# scans: 4418\n\n\n\n\n\n\n\n\n\n=== station: .CAL6\n# scans: 4644\n\n\n\n\n\n\n\n\n\n=== station: .GP5\n# scans: 4308\n\n\n\n\n\n\n\n\n\n=== station: .KW1\n# scans: 2190\n\n\n\n\n\n\n\n\n\n=== station: .KW2\n# scans: 2324\n\n\n\n\n\n\n\n\n\n=== station: .KW4\n# scans: 2374\n\n\n\n\n\n\n\n\n\n=== station: .MR\n# scans: 6794\n\n\n\n\n\n\n\n\n\n=== station: .RP1\n# scans: 1822\n\n\n\n\n\n\n\n\n\n=== station: .RP2\n# scans: 2081\n\n\n\n\n\n\n\n\n\n=== station: .RP3\n# scans: 2456\n\n\n\n\n\n\n\n\n\n=== station: .RP4\n# scans: 3914\n\n\n\n\n\n\n\n\n\n=== station: .TB1\n# scans: 1926\n\n\n\n\n\n\n\n\n\n=== station: .TB10\n# scans: 4131\n\n\n\n\n\n\n\n\n\n=== station: .TB2\n# scans: 4965\n\n\n\n\n\n\n\n\n\n=== station: .TB3\n# scans: 4668\n\n\n\n\n\n\n\n\n\n=== station: .TB4\n# scans: 4415\n\n\n\n\n\n\n\n\n\n=== station: .TB5\n# scans: 3772\n\n\n\n\n\n\n\n\n\n=== station: .V1\n# scans: 2881\n\n\n\n\n\n\n\n\n\n=== station: .V2\n# scans: 2559\n\n\n\n\n\n\n\n\n\n=== station: .V3\n# scans: 2876\n\n\n\n\n\n\n\n\n\n=== station: .V4\n# scans: 3603\n\n\n\n\n\n\n\n\n\n=== station: .V5\n# scans: 3647\n\n\n\n\n\n\n\n\n\n=== station: .V6\n# scans: 4430\n\n\n\n\n\n\n\n\n\n=== station: .V7\n# scans: 3987\n\n\n\n\n\n\n\n\n\n=== station: .V8\n# scans: 3309\n\n\n\n\n\n\n\n\n\n=== station: .V9\n# scans: 5403\n\n\n\n\n\n\n\n\n\n=== station: .WS\n# scans: 1557\n\n\n\n\n\n\n\n\n\n\n\nplotting each cast in the first list\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # 1 is selecting only the first sublist\n  tryCatch({\n    plot(ctdDecimate(ctdTrim(cast)))\n  }, error = function(e){\n    print(e)\n  })\n}\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4193' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 10055' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3423' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3445' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3314' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3535' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2070' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1968' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2927' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3754' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1902' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 480' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 35' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2094' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1702' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2182' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1908' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3583' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1622' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 63' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 629' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1047' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 5675' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 10321' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3187' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4677' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4650' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3116' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3763' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4178' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 5025' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4605' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4828' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3269' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3279' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 6306' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1792' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1759' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2257' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3137' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4418' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4644' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4308' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2190' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2324' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2374' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 6794' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1822' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2081' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2456' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3914' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1926' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4131' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4965' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4668' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4415' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3772' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2881' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2559' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2876' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3603' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3647' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4430' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3987' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3309' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 5403' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1557' in coercion to 'logical(1)'&gt;\n\n\n\n\nplotting other physical parameters for each cast\n# Loop through each CTD cast\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # Assuming each sublist contains only one relevant CTD object\n  tryCatch({\n    # Extract metadata for station name and cruise ID\n    station_name &lt;- cast@metadata$station[1]\n    cruise_id &lt;- cast@data$cruise_id[1]\n\n    # Generate a title with station name and cruise ID\n    overall_title &lt;- glue::glue(\"Station: {station_name}, Cruise ID: {cruise_id}\")\n\n    # Set margins: increase the outer margin for the title\n    par(oma = c(0, 0, 3, 0))  # Top outer margin increased for title\n\n    # Plotting function with specific parameters\n    oce::plot(\n      x = ctdDecimate(ctdTrim(cast)),\n      which = c(\n        \"sea_water_electrical_conductivity\",\n        \"descent_rate\", \"sound_velocity\",\n        \"sea_water_sigma_t\",\"altimeter\"\n      ),\n      main = \"\"  # No main title for individual subplots\n    )\n\n    # Place a single overall title at the top of the plot frame\n    mtext(overall_title, side = 3, line = 1, outer = TRUE, cex = 1.5)\n\n    # Reset outer margins to default\n    par(oma = c(0, 0, 0, 0))\n\n  }, error = function(e) {\n    print(e$message)  # Print any errors that occur during plotting\n  })\n}\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n[1] \"unknown xtype value (\\\"3.745881\\\")\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n\n\nplotting other nutrient parameters for each cast\n# Loop through each CTD cast\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # Assuming each sublist contains only one relevant CTD object\n  tryCatch({\n    # Extract metadata for station name and cruise ID\n    station_name &lt;- cast@metadata$station[1]\n    cruise_id &lt;- cast@data$cruise_id[1]\n\n    # Generate a title with station name and cruise ID\n    overall_title &lt;- glue::glue(\"Station: {station_name}, Cruise ID: {cruise_id}\")\n\n    # Set margins: increase the outer margin for the title\n    par(oma = c(0, 0, 3, 0))  # Top outer margin increased for title\n\n    # Plotting function with specific parameters\n    oce::plot(\n      x = ctdDecimate(ctdTrim(cast)),\n      which = c(\n        \"CDOM\", \"dissolved_oxygen\",\n        \"oxygen_saturation\",\n        \"chlorophyll_concentration\", \"chlorophyll_fluorescence\"\n      ),\n      main = \"\"  # No main title for individual subplots\n    )\n\n    # Place a single overall title at the top of the plot frame\n    mtext(overall_title, side = 3, line = 1, outer = TRUE, cex = 1.5)\n\n    # Reset outer margins to default\n    par(oma = c(0, 0, 0, 0))\n\n  }, error = function(e) {\n    print(e$message)  # Print any errors that occur during plotting\n  })\n}\n\n\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n\n\n\n\nplotting other optical parameters for each cast\n# Loop through each CTD cast\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # Assuming each sublist contains only one relevant CTD object\n  tryCatch({\n    # Extract metadata for station name and cruise ID\n    station_name &lt;- cast@metadata$station[1]\n    cruise_id &lt;- cast@data$cruise_id[1]\n\n    # Generate a title with station name and cruise ID\n    overall_title &lt;- glue::glue(\"Station: {station_name}, Cruise ID: {cruise_id}\")\n\n    # Set margins: increase the outer margin for the title\n    par(oma = c(0, 0, 3, 0))  # Top outer margin increased for title\n\n    # Plotting function with specific parameters\n    oce::plot(\n      x = ctdDecimate(ctdTrim(cast)),\n      which = c(\n        \"photosynthetically_available_radiation\",\n        \"beam_attenuation\",\"beam_transmission\"\n      ),\n      main = \"\"  # No main title for individual subplots\n    )\n\n    # Place a single overall title at the top of the plot frame\n    mtext(overall_title, side = 3, line = 1, outer = TRUE, cex = 1.5)\n\n    # Reset outer margins to default\n    par(oma = c(0, 0, 0, 0))\n\n  }, error = function(e) {\n    print(e$message)  # Print any errors that occur during plotting\n  })\n}\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n[1] \"unknown xtype value (\\\"1e-12\\\")\"\n\n\n\n\nloop through every cast, clean, & save\ncombined_df &lt;- data.frame()\nfor (i in seq(ctd_FK)){\n  tryCatch({\n    cast &lt;- ctd_FK[[i]]  # 1 is selecting only the first sublist\n    \n    # print(class(cast))\n    # clean cast \n    trimmed_cast &lt;- ctdTrim(cast)\n    decimated_cast &lt;- ctdDecimate(trimmed_cast, p = 0.5)  # binned to 0.5 m\n    \n    # convert to df\n    cast_df &lt;- as.data.frame(decimated_cast@data)\n    \n    # Add metadata\n    # assumes station ID and cruise ID the same for all & just uses 1st one\n    cast_df &lt;- mutate(\n      cast_df,\n      station = cast@data$station[1],\n      cruise_id = cast@data$cruise_id[1]\n    )\n  \n    # drop NA rows left by cleaning\n    cast_df &lt;- subset(cast_df, !is.na(scan))\n    \n    # Append the data to the combined dataframe\n    combined_df &lt;- rbind(combined_df, cast_df)\n  }, error = function(e){\n    print(glue(\"error in cast {cast@metadata$station[1]}\"))\n    print(e)\n  })\n}\n# Save to CSV\nfile_path &lt;- here(glue(\"data/cleaned/{cruise_id}.csv\"))\nwrite.csv(combined_df, file_path, row.names = FALSE)"
  },
  {
    "objectID": "cruise_report/cruise_reports/WS20279.html",
    "href": "cruise_report/cruise_reports/WS20279.html",
    "title": "WS20279",
    "section": "",
    "text": "WS20279\n\n\nsetup\nif (!nzchar(system.file(package = \"librarian\"))) {\n  install.packages(\"librarian\")\n}\n\nlibrarian::shelf(\n  quiet = TRUE,\n  readr, here, fs, ggplot2, glue, \"jiho/castr\", dplyr, oce, patchwork, purrr, tidyr\n)\n\n\n\n\nCode\nsource(here(\"R/cruise_load.R\"))\ncruise_df &lt;- cruise_load(params$cruise_id)\n\n\n\n\nplot depth & pressure vs time elapsed\ntryCatch({\n  plots &lt;- list()\n  \n  for (station_name in unique(cruise_df$station)) {\n    subset_df &lt;- filter(cruise_df, station == station_name)\n    plots[[station_name]] &lt;- ggplot(subset_df, aes(x = time_elapsed)) +\n      geom_point(aes(y = depth), color = \"blue\") +  # Plot depth in blue\n      geom_line(aes(y = sea_water_pressure), color = \"red\") +  # Plot sea water pressure in red\n      ggtitle(glue(\"{station_name}\")) +\n      theme(\n        axis.title.x = element_blank(),\n        axis.title.y = element_blank(),\n        axis.text.x = element_blank(),\n        axis.text.y = element_blank(),\n        axis.ticks.x = element_blank(),\n        axis.ticks.y = element_blank()\n      )  # Remove individual axis titles and text\n  }\n  \n  # drop nulls\n  plots &lt;- purrr::compact(plots)\n  \n  # Combine all plots into a grid\n  combined_plot &lt;- wrap_plots(plots) + \n    plot_layout(ncol = 4) +  # Adjust ncol to set number of columns in the grid\n    plot_annotation(\n      title = \"Depth (blue) and Pressure (red)\",\n      subtitle = \"Each panel represents a different station\",\n      caption = \"Time Elapsed (x-axis) vs Depth & Pressure (y-axis)\"\n    ) +\n    theme(\n      plot.tag = element_text(size = 12, face = \"bold\"),\n      plot.tag.position = \"topleft\",\n      axis.title.x = element_text(margin = margin(t = 10)),\n      axis.title.y = element_text(margin = margin(r = 10))\n    )\n  \n  print(combined_plot)\n}, error = function(er){\n  print(er)\n});\n\n\n\n\n\n\n\n\n\n\n\nplot across all stations\np &lt;- ggplot(cruise_df, aes(x = time, y = depth, fill = station)) +\n  geom_col() +  # This creates the bars\n  # geom_text(aes(label = station), vjust = -0.3) +  # This adds labels to each bar, adjust vjust for position\n  labs(x = \"Time\", y = \"Depth\", title = \"Depth over Time by Station\") +  # Set labels and title\n  theme_minimal()  # Use a minimal theme\nprint(p)\n\n\n\n\n\n\n\n\n\n\n\ncreate oce.ctd objects from dataframes\nctd_load &lt;- function(data, other_params = NULL) {\n  \n  # create csv into ctd object\n  test_ctd &lt;-\n    as.ctd(\n      salinity    = data$sea_water_salinity,\n      temperature = data$sea_water_temperature,\n      pressure    = data$sea_water_pressure,\n      station     = data$station\n    )\n  \n  # add additional columns to ctd object\n  if (!is.null(other_params)) {\n    for (param_name in other_params) {\n      test_ctd &lt;-\n        oceSetData(\n          object = test_ctd,\n          name   = param_name,\n          value  = data[[param_name]]\n        )\n    }\n  }\n  print(glue(\"{data$station[1]}:\\t{length(test_ctd@data$scan)} scans\"))\n\n\n  return(test_ctd)\n}\n\n# Define other parameters to add\nother_params &lt;- c(\n  \"cruise_id\", \"station\", \"time\", \"time_elapsed\", \n  \"latitude\", \"longitude\", \"sea_water_electrical_conductivity\", \n  \"CDOM\", \"dissolved_oxygen\",\"oxygen_saturation\", \"chlorophyll_concentration\", \n  \"chlorophyll_fluorescence\", \"photosynthetically_available_radiation\", \n  \"beam_attenuation\",\"beam_transmission\", \"depth\", \"sea_water_sigma_t\",\n  \"descent_rate\", \"sound_velocity\",\"altimeter\"\n)\n\n# Split data by station and create data list\nctd_FK &lt;- cruise_df %&gt;%\n  split(.$station) %&gt;%\n  map(~ ctd_load(.x, other_params = other_params)) # ~ is a lambda(x)\n\n\n.002:   3305 scans\n.10:    21 scans\n.12:    4250 scans\n.16:    1746 scans\n.18:    3310 scans\n.21LK:  2868 scans\n.30:    2817 scans\n.31:    3438 scans\n.41:    3795 scans\n.45:    2649 scans\n.51:    1791 scans\n.53:    50 scans\n.54:    1877 scans\n.55:    482 scans\n.56:    13 scans\n.57:    1698 scans\n.571:   2016 scans\n.572:   1716 scans\n.573:   1827 scans\n.58:    2267 scans\n.60:    2355 scans\n.64:    98 scans\n.65:    13 scans\n.68:    1308 scans\n.7: 1171 scans\n.9: 5223 scans\n.9_5:   8506 scans\n.AMI1:  3171 scans\n.AMI2:  2920 scans\n.AMI3:  2788 scans\n.AMI4:  2791 scans\n.AMI5:  3554 scans\n.AMI6:  3624 scans\n.AMI7:  4102 scans\n.AMI8:  3921 scans\n.AMI9:  5171 scans\n.BG2:   4426 scans\n.BG3:   3685 scans\n.BG4:   2899 scans\n.CAL1:  1869 scans\n.CAL2:  1862 scans\n.CAL3:  1995 scans\n.CAL4:  2718 scans\n.CAL5:  2982 scans\n.CAL6:  3367 scans\n.GP5:   4234 scans\n.KW1:   4272 scans\n.KW2:   5143 scans\n.KW4:   3587 scans\n.MR:    5404 scans\n.RP1:   2468 scans\n.RP2:   3005 scans\n.RP3:   3297 scans\n.RP4:   2624 scans\n.TB1:   2776 scans\n.TB10:  5213 scans\n.TB11:  5119 scans\n.TB2:   2618 scans\n.TB3:   2983 scans\n.TB4:   3000 scans\n.TB5:   3259 scans\n.V1:    2204 scans\n.V2:    2711 scans\n.V3:    1907 scans\n.V4:    2302 scans\n.V5:    3210 scans\n.V6:    5486 scans\n.V7:    4894 scans\n.V8:    6053 scans\n.V9:    5730 scans\n.WS:    2741 scans\n\n\n\n\nplotting scans for each cast in the first list\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # 1 is selecting only the first sublist\n  # print(i)\n  print(glue(\"=== station: {cast@metadata$station[1]}\"))\n  print(glue(\"# scans: {length(cast@data$scan)}\"))\n  plotScan(cast)\n}\n\n\n=== station: .002\n# scans: 3305\n\n\n\n\n\n\n\n\n\n=== station: .10\n# scans: 21\n\n\n\n\n\n\n\n\n\n=== station: .12\n# scans: 4250\n\n\n\n\n\n\n\n\n\n=== station: .16\n# scans: 1746\n\n\n\n\n\n\n\n\n\n=== station: .18\n# scans: 3310\n\n\n\n\n\n\n\n\n\n=== station: .21LK\n# scans: 2868\n\n\n\n\n\n\n\n\n\n=== station: .30\n# scans: 2817\n\n\n\n\n\n\n\n\n\n=== station: .31\n# scans: 3438\n\n\n\n\n\n\n\n\n\n=== station: .41\n# scans: 3795\n\n\n\n\n\n\n\n\n\n=== station: .45\n# scans: 2649\n\n\n\n\n\n\n\n\n\n=== station: .51\n# scans: 1791\n\n\n\n\n\n\n\n\n\n=== station: .53\n# scans: 50\n\n\n\n\n\n\n\n\n\n=== station: .54\n# scans: 1877\n\n\n\n\n\n\n\n\n\n=== station: .55\n# scans: 482\n\n\n\n\n\n\n\n\n\n=== station: .56\n# scans: 13\n\n\n\n\n\n\n\n\n\n=== station: .57\n# scans: 1698\n\n\n\n\n\n\n\n\n\n=== station: .571\n# scans: 2016\n\n\n\n\n\n\n\n\n\n=== station: .572\n# scans: 1716\n\n\n\n\n\n\n\n\n\n=== station: .573\n# scans: 1827\n\n\n\n\n\n\n\n\n\n=== station: .58\n# scans: 2267\n\n\n\n\n\n\n\n\n\n=== station: .60\n# scans: 2355\n\n\n\n\n\n\n\n\n\n=== station: .64\n# scans: 98\n\n\n\n\n\n\n\n\n\n=== station: .65\n# scans: 13\n\n\n\n\n\n\n\n\n\n=== station: .68\n# scans: 1308\n\n\n\n\n\n\n\n\n\n=== station: .7\n# scans: 1171\n\n\n\n\n\n\n\n\n\n=== station: .9\n# scans: 5223\n\n\n\n\n\n\n\n\n\n=== station: .9_5\n# scans: 8506\n\n\n\n\n\n\n\n\n\n=== station: .AMI1\n# scans: 3171\n\n\n\n\n\n\n\n\n\n=== station: .AMI2\n# scans: 2920\n\n\n\n\n\n\n\n\n\n=== station: .AMI3\n# scans: 2788\n\n\n\n\n\n\n\n\n\n=== station: .AMI4\n# scans: 2791\n\n\n\n\n\n\n\n\n\n=== station: .AMI5\n# scans: 3554\n\n\n\n\n\n\n\n\n\n=== station: .AMI6\n# scans: 3624\n\n\n\n\n\n\n\n\n\n=== station: .AMI7\n# scans: 4102\n\n\n\n\n\n\n\n\n\n=== station: .AMI8\n# scans: 3921\n\n\n\n\n\n\n\n\n\n=== station: .AMI9\n# scans: 5171\n\n\n\n\n\n\n\n\n\n=== station: .BG2\n# scans: 4426\n\n\n\n\n\n\n\n\n\n=== station: .BG3\n# scans: 3685\n\n\n\n\n\n\n\n\n\n=== station: .BG4\n# scans: 2899\n\n\n\n\n\n\n\n\n\n=== station: .CAL1\n# scans: 1869\n\n\n\n\n\n\n\n\n\n=== station: .CAL2\n# scans: 1862\n\n\n\n\n\n\n\n\n\n=== station: .CAL3\n# scans: 1995\n\n\n\n\n\n\n\n\n\n=== station: .CAL4\n# scans: 2718\n\n\n\n\n\n\n\n\n\n=== station: .CAL5\n# scans: 2982\n\n\n\n\n\n\n\n\n\n=== station: .CAL6\n# scans: 3367\n\n\n\n\n\n\n\n\n\n=== station: .GP5\n# scans: 4234\n\n\n\n\n\n\n\n\n\n=== station: .KW1\n# scans: 4272\n\n\n\n\n\n\n\n\n\n=== station: .KW2\n# scans: 5143\n\n\n\n\n\n\n\n\n\n=== station: .KW4\n# scans: 3587\n\n\n\n\n\n\n\n\n\n=== station: .MR\n# scans: 5404\n\n\n\n\n\n\n\n\n\n=== station: .RP1\n# scans: 2468\n\n\n\n\n\n\n\n\n\n=== station: .RP2\n# scans: 3005\n\n\n\n\n\n\n\n\n\n=== station: .RP3\n# scans: 3297\n\n\n\n\n\n\n\n\n\n=== station: .RP4\n# scans: 2624\n\n\n\n\n\n\n\n\n\n=== station: .TB1\n# scans: 2776\n\n\n\n\n\n\n\n\n\n=== station: .TB10\n# scans: 5213\n\n\n\n\n\n\n\n\n\n=== station: .TB11\n# scans: 5119\n\n\n\n\n\n\n\n\n\n=== station: .TB2\n# scans: 2618\n\n\n\n\n\n\n\n\n\n=== station: .TB3\n# scans: 2983\n\n\n\n\n\n\n\n\n\n=== station: .TB4\n# scans: 3000\n\n\n\n\n\n\n\n\n\n=== station: .TB5\n# scans: 3259\n\n\n\n\n\n\n\n\n\n=== station: .V1\n# scans: 2204\n\n\n\n\n\n\n\n\n\n=== station: .V2\n# scans: 2711\n\n\n\n\n\n\n\n\n\n=== station: .V3\n# scans: 1907\n\n\n\n\n\n\n\n\n\n=== station: .V4\n# scans: 2302\n\n\n\n\n\n\n\n\n\n=== station: .V5\n# scans: 3210\n\n\n\n\n\n\n\n\n\n=== station: .V6\n# scans: 5486\n\n\n\n\n\n\n\n\n\n=== station: .V7\n# scans: 4894\n\n\n\n\n\n\n\n\n\n=== station: .V8\n# scans: 6053\n\n\n\n\n\n\n\n\n\n=== station: .V9\n# scans: 5730\n\n\n\n\n\n\n\n\n\n=== station: .WS\n# scans: 2741\n\n\n\n\n\n\n\n\n\n\n\nplotting each cast in the first list\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # 1 is selecting only the first sublist\n  tryCatch({\n    plot(ctdDecimate(ctdTrim(cast)))\n  }, error = function(e){\n    print(e)\n  })\n}\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3305' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4250' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1746' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3310' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2868' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2817' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3438' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3795' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2649' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1791' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1877' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1698' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2016' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1716' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1827' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2267' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2355' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 98' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1308' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1171' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 5223' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 8506' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3171' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2920' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2788' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2791' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3554' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3624' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4102' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3921' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 5171' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4426' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3685' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2899' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1869' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1862' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1995' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2718' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2982' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3367' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4234' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4272' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 5143' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3587' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 5404' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2468' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3005' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3297' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2624' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2776' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 5213' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 5119' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2618' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2983' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3000' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3259' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2204' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2711' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1907' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2302' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3210' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 5486' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4894' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 6053' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 5730' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2741' in coercion to 'logical(1)'&gt;\n\n\n\n\nplotting other physical parameters for each cast\n# Loop through each CTD cast\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # Assuming each sublist contains only one relevant CTD object\n  tryCatch({\n    # Extract metadata for station name and cruise ID\n    station_name &lt;- cast@metadata$station[1]\n    cruise_id &lt;- cast@data$cruise_id[1]\n\n    # Generate a title with station name and cruise ID\n    overall_title &lt;- glue::glue(\"Station: {station_name}, Cruise ID: {cruise_id}\")\n\n    # Set margins: increase the outer margin for the title\n    par(oma = c(0, 0, 3, 0))  # Top outer margin increased for title\n\n    # Plotting function with specific parameters\n    oce::plot(\n      x = ctdDecimate(ctdTrim(cast)),\n      which = c(\n        \"sea_water_electrical_conductivity\",\n        \"descent_rate\", \"sound_velocity\",\n        \"sea_water_sigma_t\",\"altimeter\"\n      ),\n      main = \"\"  # No main title for individual subplots\n    )\n\n    # Place a single overall title at the top of the plot frame\n    mtext(overall_title, side = 3, line = 1, outer = TRUE, cex = 1.5)\n\n    # Reset outer margins to default\n    par(oma = c(0, 0, 0, 0))\n\n  }, error = function(e) {\n    print(e$message)  # Print any errors that occur during plotting\n  })\n}\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n\n\nplotting other nutrient parameters for each cast\n# Loop through each CTD cast\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # Assuming each sublist contains only one relevant CTD object\n  tryCatch({\n    # Extract metadata for station name and cruise ID\n    station_name &lt;- cast@metadata$station[1]\n    cruise_id &lt;- cast@data$cruise_id[1]\n\n    # Generate a title with station name and cruise ID\n    overall_title &lt;- glue::glue(\"Station: {station_name}, Cruise ID: {cruise_id}\")\n\n    # Set margins: increase the outer margin for the title\n    par(oma = c(0, 0, 3, 0))  # Top outer margin increased for title\n\n    # Plotting function with specific parameters\n    oce::plot(\n      x = ctdDecimate(ctdTrim(cast)),\n      which = c(\n        \"CDOM\", \"dissolved_oxygen\",\n        \"oxygen_saturation\",\n        \"chlorophyll_concentration\", \"chlorophyll_fluorescence\"\n      ),\n      main = \"\"  # No main title for individual subplots\n    )\n\n    # Place a single overall title at the top of the plot frame\n    mtext(overall_title, side = 3, line = 1, outer = TRUE, cex = 1.5)\n\n    # Reset outer margins to default\n    par(oma = c(0, 0, 0, 0))\n\n  }, error = function(e) {\n    print(e$message)  # Print any errors that occur during plotting\n  })\n}\n\n\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"plot.new has not been called yet\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n\n\n\n\nplotting other optical parameters for each cast\n# Loop through each CTD cast\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # Assuming each sublist contains only one relevant CTD object\n  tryCatch({\n    # Extract metadata for station name and cruise ID\n    station_name &lt;- cast@metadata$station[1]\n    cruise_id &lt;- cast@data$cruise_id[1]\n\n    # Generate a title with station name and cruise ID\n    overall_title &lt;- glue::glue(\"Station: {station_name}, Cruise ID: {cruise_id}\")\n\n    # Set margins: increase the outer margin for the title\n    par(oma = c(0, 0, 3, 0))  # Top outer margin increased for title\n\n    # Plotting function with specific parameters\n    oce::plot(\n      x = ctdDecimate(ctdTrim(cast)),\n      which = c(\n        \"photosynthetically_available_radiation\",\n        \"beam_attenuation\",\"beam_transmission\"\n      ),\n      main = \"\"  # No main title for individual subplots\n    )\n\n    # Place a single overall title at the top of the plot frame\n    mtext(overall_title, side = 3, line = 1, outer = TRUE, cex = 1.5)\n\n    # Reset outer margins to default\n    par(oma = c(0, 0, 0, 0))\n\n  }, error = function(e) {\n    print(e$message)  # Print any errors that occur during plotting\n  })\n}\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n\n\nloop through every cast, clean, & save\ncombined_df &lt;- data.frame()\nfor (i in seq(ctd_FK)){\n  tryCatch({\n    cast &lt;- ctd_FK[[i]]  # 1 is selecting only the first sublist\n    \n    # print(class(cast))\n    # clean cast \n    trimmed_cast &lt;- ctdTrim(cast)\n    decimated_cast &lt;- ctdDecimate(trimmed_cast, p = 0.5)  # binned to 0.5 m\n    \n    # convert to df\n    cast_df &lt;- as.data.frame(decimated_cast@data)\n    \n    # Add metadata\n    # assumes station ID and cruise ID the same for all & just uses 1st one\n    cast_df &lt;- mutate(\n      cast_df,\n      station = cast@data$station[1],\n      cruise_id = cast@data$cruise_id[1]\n    )\n  \n    # drop NA rows left by cleaning\n    cast_df &lt;- subset(cast_df, !is.na(scan))\n    \n    # Append the data to the combined dataframe\n    combined_df &lt;- rbind(combined_df, cast_df)\n  }, error = function(e){\n    print(glue(\"error in cast {cast@metadata$station[1]}\"))\n    print(e)\n  })\n}\n# Save to CSV\nfile_path &lt;- here(glue(\"data/cleaned/{cruise_id}.csv\"))\nwrite.csv(combined_df, file_path, row.names = FALSE)"
  },
  {
    "objectID": "cruise_report/cruise_reports/WS20006.html",
    "href": "cruise_report/cruise_reports/WS20006.html",
    "title": "WS20006",
    "section": "",
    "text": "WS20006\n\n\nsetup\nif (!nzchar(system.file(package = \"librarian\"))) {\n  install.packages(\"librarian\")\n}\n\nlibrarian::shelf(\n  quiet = TRUE,\n  readr, here, fs, ggplot2, glue, \"jiho/castr\", dplyr, oce, patchwork, purrr, tidyr\n)\n\n\n\n\nCode\nsource(here(\"R/cruise_load.R\"))\ncruise_df &lt;- cruise_load(params$cruise_id)\n\n\n\n\nplot depth & pressure vs time elapsed\ntryCatch({\n  plots &lt;- list()\n  \n  for (station_name in unique(cruise_df$station)) {\n    subset_df &lt;- filter(cruise_df, station == station_name)\n    plots[[station_name]] &lt;- ggplot(subset_df, aes(x = time_elapsed)) +\n      geom_point(aes(y = depth), color = \"blue\") +  # Plot depth in blue\n      geom_line(aes(y = sea_water_pressure), color = \"red\") +  # Plot sea water pressure in red\n      ggtitle(glue(\"{station_name}\")) +\n      theme(\n        axis.title.x = element_blank(),\n        axis.title.y = element_blank(),\n        axis.text.x = element_blank(),\n        axis.text.y = element_blank(),\n        axis.ticks.x = element_blank(),\n        axis.ticks.y = element_blank()\n      )  # Remove individual axis titles and text\n  }\n  \n  # drop nulls\n  plots &lt;- purrr::compact(plots)\n  \n  # Combine all plots into a grid\n  combined_plot &lt;- wrap_plots(plots) + \n    plot_layout(ncol = 4) +  # Adjust ncol to set number of columns in the grid\n    plot_annotation(\n      title = \"Depth (blue) and Pressure (red)\",\n      subtitle = \"Each panel represents a different station\",\n      caption = \"Time Elapsed (x-axis) vs Depth & Pressure (y-axis)\"\n    ) +\n    theme(\n      plot.tag = element_text(size = 12, face = \"bold\"),\n      plot.tag.position = \"topleft\",\n      axis.title.x = element_text(margin = margin(t = 10)),\n      axis.title.y = element_text(margin = margin(r = 10))\n    )\n  \n  print(combined_plot)\n}, error = function(er){\n  print(er)\n});\n\n\n&lt;error/rlang_error&gt;\nError in `geom_point()`:\n! Problem while computing aesthetics.\n Error occurred in the 1st layer.\nCaused by error:\n! object 'time_elapsed' not found\n---\nBacktrace:\n     \n  1. base::tryCatch(...)\n  2.  base (local) tryCatchList(expr, classes, parentenv, handlers)\n  3.    base (local) tryCatchOne(expr, names, parentenv, handlers[[1L]])\n  4.      base (local) doTryCatch(return(expr), name, parentenv, handler)\n  5. base::print(combined_plot)\n  6. patchwork:::print.patchwork(combined_plot)\n  7.   patchwork:::build_patchwork(plot, plot$layout$guides %||% \"auto\")\n  8.     base::lapply(x$plots, plot_table, guides = guides)\n  9.       patchwork (local) FUN(X[[i]], ...)\n 10.       patchwork:::plot_table.ggplot(X[[i]], ...)\n 11.         ggplot2::ggplotGrob(x)\n 12.           ggplot2::ggplot_gtable(ggplot_build(x))\n 13.            ggplot2:::attach_plot_env(data$plot$plot_env)\n 14.              base::options(ggplot2_plot_env = env)\n 15.           ggplot2::ggplot_build(x)\n 16.           ggplot2:::ggplot_build.ggplot(x)\n 17.             ggplot2:::by_layer(...)\n 18.               rlang::try_fetch(...)\n 19.                base::tryCatch(...)\n 20.                 base (local) tryCatchList(expr, classes, parentenv, handlers)\n 21.                   base (local) tryCatchOne(expr, names, parentenv, handlers[[1L]])\n 22.                     base (local) doTryCatch(return(expr), name, parentenv, handler)\n 23.                base::withCallingHandlers(...)\n 24.               ggplot2 (local) f(l = layers[[i]], d = data[[i]])\n 25.                 l$compute_aesthetics(d, plot)\n 26.                   ggplot2 (local) compute_aesthetics(..., self = self)\n 27.                     base::lapply(aesthetics, eval_tidy, data = data, env = env)\n 28.                       rlang (local) FUN(X[[i]], ...)\n\n\n\n\nplot across all stations\np &lt;- ggplot(cruise_df, aes(x = time, y = depth, fill = station)) +\n  geom_col() +  # This creates the bars\n  # geom_text(aes(label = station), vjust = -0.3) +  # This adds labels to each bar, adjust vjust for position\n  labs(x = \"Time\", y = \"Depth\", title = \"Depth over Time by Station\") +  # Set labels and title\n  theme_minimal()  # Use a minimal theme\nprint(p)\n\n\n\n\n\n\n\n\n\n\n\ncreate oce.ctd objects from dataframes\nctd_load &lt;- function(data, other_params = NULL) {\n  \n  # create csv into ctd object\n  test_ctd &lt;-\n    as.ctd(\n      salinity    = data$sea_water_salinity,\n      temperature = data$sea_water_temperature,\n      pressure    = data$sea_water_pressure,\n      station     = data$station\n    )\n  \n  # add additional columns to ctd object\n  if (!is.null(other_params)) {\n    for (param_name in other_params) {\n      test_ctd &lt;-\n        oceSetData(\n          object = test_ctd,\n          name   = param_name,\n          value  = data[[param_name]]\n        )\n    }\n  }\n  print(glue(\"{data$station[1]}:\\t{length(test_ctd@data$scan)} scans\"))\n\n\n  return(test_ctd)\n}\n\n# Define other parameters to add\nother_params &lt;- c(\n  \"cruise_id\", \"station\", \"time\", \"time_elapsed\", \n  \"latitude\", \"longitude\", \"sea_water_electrical_conductivity\", \n  \"CDOM\", \"dissolved_oxygen\",\"oxygen_saturation\", \"chlorophyll_concentration\", \n  \"chlorophyll_fluorescence\", \"photosynthetically_available_radiation\", \n  \"beam_attenuation\",\"beam_transmission\", \"depth\", \"sea_water_sigma_t\",\n  \"descent_rate\", \"sound_velocity\",\"altimeter\"\n)\n\n# Split data by station and create data list\nctd_FK &lt;- cruise_df %&gt;%\n  split(.$station) %&gt;%\n  map(~ ctd_load(.x, other_params = other_params)) # ~ is a lambda(x)\n\n\n10: 1353 scans\n12: 6615 scans\n16: 1697 scans\n18: 4576 scans\n2:  1879 scans\n21.5:   11304 scans\n21.5B:  10569 scans\n21/LK:  3971 scans\n30: 3364 scans\n31: 2038 scans\n33: 3272 scans\n41: 2161 scans\n45: 1891 scans\n51: 1649 scans\n54: 2209 scans\n55: 73 scans\n56: 2041 scans\n57: 3287 scans\n57.1:   2417 scans\n57.2:   2558 scans\n57.3:   2454 scans\n58: 3393 scans\n60: 3105 scans\n64: 1913 scans\n65: 2042 scans\n68: 174 scans\n7:  2 scans\n9:  5276 scans\n9.5:    9876 scans\nBG2:    2510 scans\nBG5:    3110 scans\nCAL1:   2309 scans\nCAL2:   2037 scans\nCAL3:   2182 scans\nCAL4:   2878 scans\nCAL5:   4305 scans\nCAL6:   4691 scans\nGP5:    4902 scans\nKW1:    3494 scans\nKW2:    3259 scans\nKW4:    3209 scans\nMR: 5898 scans\nRP1:    1718 scans\nRP2:    2127 scans\nRP3:    2598 scans\nRP4:    3435 scans\nV1: 1499 scans\nV2: 3541 scans\nV3: 2784 scans\nV4: 3221 scans\nV5: 3528 scans\nV6: 3498 scans\nV7: 3801 scans\nV8: 5586 scans\nV9: 4433 scans\nWS: 3919 scans\n\n\n\n\nplotting scans for each cast in the first list\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # 1 is selecting only the first sublist\n  # print(i)\n  print(glue(\"=== station: {cast@metadata$station[1]}\"))\n  print(glue(\"# scans: {length(cast@data$scan)}\"))\n  plotScan(cast)\n}\n\n\n=== station: 10\n# scans: 1353\n\n\n\n\n\n\n\n\n\n=== station: 12\n# scans: 6615\n\n\n\n\n\n\n\n\n\n=== station: 16\n# scans: 1697\n\n\n\n\n\n\n\n\n\n=== station: 18\n# scans: 4576\n\n\n\n\n\n\n\n\n\n=== station: 2\n# scans: 1879\n\n\n\n\n\n\n\n\n\n=== station: 21.5\n# scans: 11304\n\n\n\n\n\n\n\n\n\n=== station: 21.5B\n# scans: 10569\n\n\n\n\n\n\n\n\n\n=== station: 21/LK\n# scans: 3971\n\n\n\n\n\n\n\n\n\n=== station: 30\n# scans: 3364\n\n\n\n\n\n\n\n\n\n=== station: 31\n# scans: 2038\n\n\n\n\n\n\n\n\n\n=== station: 33\n# scans: 3272\n\n\n\n\n\n\n\n\n\n=== station: 41\n# scans: 2161\n\n\n\n\n\n\n\n\n\n=== station: 45\n# scans: 1891\n\n\n\n\n\n\n\n\n\n=== station: 51\n# scans: 1649\n\n\n\n\n\n\n\n\n\n=== station: 54\n# scans: 2209\n\n\n\n\n\n\n\n\n\n=== station: 55\n# scans: 73\n\n\n\n\n\n\n\n\n\n=== station: 56\n# scans: 2041\n\n\n\n\n\n\n\n\n\n=== station: 57\n# scans: 3287\n\n\n\n\n\n\n\n\n\n=== station: 57.1\n# scans: 2417\n\n\n\n\n\n\n\n\n\n=== station: 57.2\n# scans: 2558\n\n\n\n\n\n\n\n\n\n=== station: 57.3\n# scans: 2454\n\n\n\n\n\n\n\n\n\n=== station: 58\n# scans: 3393\n\n\n\n\n\n\n\n\n\n=== station: 60\n# scans: 3105\n\n\n\n\n\n\n\n\n\n=== station: 64\n# scans: 1913\n\n\n\n\n\n\n\n\n\n=== station: 65\n# scans: 2042\n\n\n\n\n\n\n\n\n\n=== station: 68\n# scans: 174\n\n\n\n\n\n\n\n\n\n=== station: 7\n# scans: 2\n\n\n\n\n\n\n\n\n\n=== station: 9\n# scans: 5276\n\n\n\n\n\n\n\n\n\n=== station: 9.5\n# scans: 9876\n\n\n\n\n\n\n\n\n\n=== station: BG2\n# scans: 2510\n\n\n\n\n\n\n\n\n\n=== station: BG5\n# scans: 3110\n\n\n\n\n\n\n\n\n\n=== station: CAL1\n# scans: 2309\n\n\n\n\n\n\n\n\n\n=== station: CAL2\n# scans: 2037\n\n\n\n\n\n\n\n\n\n=== station: CAL3\n# scans: 2182\n\n\n\n\n\n\n\n\n\n=== station: CAL4\n# scans: 2878\n\n\n\n\n\n\n\n\n\n=== station: CAL5\n# scans: 4305\n\n\n\n\n\n\n\n\n\n=== station: CAL6\n# scans: 4691\n\n\n\n\n\n\n\n\n\n=== station: GP5\n# scans: 4902\n\n\n\n\n\n\n\n\n\n=== station: KW1\n# scans: 3494\n\n\n\n\n\n\n\n\n\n=== station: KW2\n# scans: 3259\n\n\n\n\n\n\n\n\n\n=== station: KW4\n# scans: 3209\n\n\n\n\n\n\n\n\n\n=== station: MR\n# scans: 5898\n\n\n\n\n\n\n\n\n\n=== station: RP1\n# scans: 1718\n\n\n\n\n\n\n\n\n\n=== station: RP2\n# scans: 2127\n\n\n\n\n\n\n\n\n\n=== station: RP3\n# scans: 2598\n\n\n\n\n\n\n\n\n\n=== station: RP4\n# scans: 3435\n\n\n\n\n\n\n\n\n\n=== station: V1\n# scans: 1499\n\n\n\n\n\n\n\n\n\n=== station: V2\n# scans: 3541\n\n\n\n\n\n\n\n\n\n=== station: V3\n# scans: 2784\n\n\n\n\n\n\n\n\n\n=== station: V4\n# scans: 3221\n\n\n\n\n\n\n\n\n\n=== station: V5\n# scans: 3528\n\n\n\n\n\n\n\n\n\n=== station: V6\n# scans: 3498\n\n\n\n\n\n\n\n\n\n=== station: V7\n# scans: 3801\n\n\n\n\n\n\n\n\n\n=== station: V8\n# scans: 5586\n\n\n\n\n\n\n\n\n\n=== station: V9\n# scans: 4433\n\n\n\n\n\n\n\n\n\n=== station: WS\n# scans: 3919\n\n\n\n\n\n\n\n\n\n\n\nplotting each cast in the first list\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # 1 is selecting only the first sublist\n  tryCatch({\n    plot(ctdDecimate(ctdTrim(cast)))\n  }, error = function(e){\n    print(e)\n  })\n}\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1353' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 6615' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1697' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4576' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1879' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 11304' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 10569' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3971' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3364' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2038' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3272' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2161' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1891' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1649' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2209' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3287' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2417' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2558' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2454' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3393' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3105' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1913' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2042' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 174' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 5276' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 9876' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2510' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3110' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2309' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2037' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2182' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2878' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4305' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4691' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4902' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3494' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3259' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3209' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 5898' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1718' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2127' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2598' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3435' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1499' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3541' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2784' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3221' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3528' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3498' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3801' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 5586' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4433' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3919' in coercion to 'logical(1)'&gt;\n\n\n\n\nplotting other physical parameters for each cast\n# Loop through each CTD cast\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # Assuming each sublist contains only one relevant CTD object\n  tryCatch({\n    # Extract metadata for station name and cruise ID\n    station_name &lt;- cast@metadata$station[1]\n    cruise_id &lt;- cast@data$cruise_id[1]\n\n    # Generate a title with station name and cruise ID\n    overall_title &lt;- glue::glue(\"Station: {station_name}, Cruise ID: {cruise_id}\")\n\n    # Set margins: increase the outer margin for the title\n    par(oma = c(0, 0, 3, 0))  # Top outer margin increased for title\n\n    # Plotting function with specific parameters\n    oce::plot(\n      x = ctdDecimate(ctdTrim(cast)),\n      which = c(\n        \"sea_water_electrical_conductivity\",\n        \"descent_rate\", \"sound_velocity\",\n        \"sea_water_sigma_t\",\"altimeter\"\n      ),\n      main = \"\"  # No main title for individual subplots\n    )\n\n    # Place a single overall title at the top of the plot frame\n    mtext(overall_title, side = 3, line = 1, outer = TRUE, cex = 1.5)\n\n    # Reset outer margins to default\n    par(oma = c(0, 0, 0, 0))\n\n  }, error = function(e) {\n    print(e$message)  # Print any errors that occur during plotting\n  })\n}\n\n\n\n\n\n\n\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n\n\nplotting other nutrient parameters for each cast\n# Loop through each CTD cast\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # Assuming each sublist contains only one relevant CTD object\n  tryCatch({\n    # Extract metadata for station name and cruise ID\n    station_name &lt;- cast@metadata$station[1]\n    cruise_id &lt;- cast@data$cruise_id[1]\n\n    # Generate a title with station name and cruise ID\n    overall_title &lt;- glue::glue(\"Station: {station_name}, Cruise ID: {cruise_id}\")\n\n    # Set margins: increase the outer margin for the title\n    par(oma = c(0, 0, 3, 0))  # Top outer margin increased for title\n\n    # Plotting function with specific parameters\n    oce::plot(\n      x = ctdDecimate(ctdTrim(cast)),\n      which = c(\n        \"CDOM\", \"dissolved_oxygen\",\n        \"oxygen_saturation\",\n        \"chlorophyll_concentration\", \"chlorophyll_fluorescence\"\n      ),\n      main = \"\"  # No main title for individual subplots\n    )\n\n    # Place a single overall title at the top of the plot frame\n    mtext(overall_title, side = 3, line = 1, outer = TRUE, cex = 1.5)\n\n    # Reset outer margins to default\n    par(oma = c(0, 0, 0, 0))\n\n  }, error = function(e) {\n    print(e$message)  # Print any errors that occur during plotting\n  })\n}\n\n\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n\n\n\n\nplotting other optical parameters for each cast\n# Loop through each CTD cast\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # Assuming each sublist contains only one relevant CTD object\n  tryCatch({\n    # Extract metadata for station name and cruise ID\n    station_name &lt;- cast@metadata$station[1]\n    cruise_id &lt;- cast@data$cruise_id[1]\n\n    # Generate a title with station name and cruise ID\n    overall_title &lt;- glue::glue(\"Station: {station_name}, Cruise ID: {cruise_id}\")\n\n    # Set margins: increase the outer margin for the title\n    par(oma = c(0, 0, 3, 0))  # Top outer margin increased for title\n\n    # Plotting function with specific parameters\n    oce::plot(\n      x = ctdDecimate(ctdTrim(cast)),\n      which = c(\n        \"photosynthetically_available_radiation\",\n        \"beam_attenuation\",\"beam_transmission\"\n      ),\n      main = \"\"  # No main title for individual subplots\n    )\n\n    # Place a single overall title at the top of the plot frame\n    mtext(overall_title, side = 3, line = 1, outer = TRUE, cex = 1.5)\n\n    # Reset outer margins to default\n    par(oma = c(0, 0, 0, 0))\n\n  }, error = function(e) {\n    print(e$message)  # Print any errors that occur during plotting\n  })\n}\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n\n\nloop through every cast, clean, & save\ncombined_df &lt;- data.frame()\nfor (i in seq(ctd_FK)){\n  tryCatch({\n    cast &lt;- ctd_FK[[i]]  # 1 is selecting only the first sublist\n    \n    # print(class(cast))\n    # clean cast \n    trimmed_cast &lt;- ctdTrim(cast)\n    decimated_cast &lt;- ctdDecimate(trimmed_cast, p = 0.5)  # binned to 0.5 m\n    \n    # convert to df\n    cast_df &lt;- as.data.frame(decimated_cast@data)\n    \n    # Add metadata\n    # assumes station ID and cruise ID the same for all & just uses 1st one\n    cast_df &lt;- mutate(\n      cast_df,\n      station = cast@data$station[1],\n      cruise_id = cast@data$cruise_id[1]\n    )\n  \n    # drop NA rows left by cleaning\n    cast_df &lt;- subset(cast_df, !is.na(scan))\n    \n    # Append the data to the combined dataframe\n    combined_df &lt;- rbind(combined_df, cast_df)\n  }, error = function(e){\n    print(glue(\"error in cast {cast@metadata$station[1]}\"))\n    print(e)\n  })\n}\n# Save to CSV\nfile_path &lt;- here(glue(\"data/cleaned/{cruise_id}.csv\"))\nwrite.csv(combined_df, file_path, row.names = FALSE)"
  },
  {
    "objectID": "cruise_report/cruise_reports/WS19266.html",
    "href": "cruise_report/cruise_reports/WS19266.html",
    "title": "WS19266",
    "section": "",
    "text": "WS19266\n\n\nsetup\nif (!nzchar(system.file(package = \"librarian\"))) {\n  install.packages(\"librarian\")\n}\n\nlibrarian::shelf(\n  quiet = TRUE,\n  readr, here, fs, ggplot2, glue, \"jiho/castr\", dplyr, oce, patchwork, purrr, tidyr\n)\n\n\n\n\nCode\nsource(here(\"R/cruise_load.R\"))\ncruise_df &lt;- cruise_load(params$cruise_id)\n\n\n\n\nplot depth & pressure vs time elapsed\ntryCatch({\n  plots &lt;- list()\n  \n  for (station_name in unique(cruise_df$station)) {\n    subset_df &lt;- filter(cruise_df, station == station_name)\n    plots[[station_name]] &lt;- ggplot(subset_df, aes(x = time_elapsed)) +\n      geom_point(aes(y = depth), color = \"blue\") +  # Plot depth in blue\n      geom_line(aes(y = sea_water_pressure), color = \"red\") +  # Plot sea water pressure in red\n      ggtitle(glue(\"{station_name}\")) +\n      theme(\n        axis.title.x = element_blank(),\n        axis.title.y = element_blank(),\n        axis.text.x = element_blank(),\n        axis.text.y = element_blank(),\n        axis.ticks.x = element_blank(),\n        axis.ticks.y = element_blank()\n      )  # Remove individual axis titles and text\n  }\n  \n  # drop nulls\n  plots &lt;- purrr::compact(plots)\n  \n  # Combine all plots into a grid\n  combined_plot &lt;- wrap_plots(plots) + \n    plot_layout(ncol = 4) +  # Adjust ncol to set number of columns in the grid\n    plot_annotation(\n      title = \"Depth (blue) and Pressure (red)\",\n      subtitle = \"Each panel represents a different station\",\n      caption = \"Time Elapsed (x-axis) vs Depth & Pressure (y-axis)\"\n    ) +\n    theme(\n      plot.tag = element_text(size = 12, face = \"bold\"),\n      plot.tag.position = \"topleft\",\n      axis.title.x = element_text(margin = margin(t = 10)),\n      axis.title.y = element_text(margin = margin(r = 10))\n    )\n  \n  print(combined_plot)\n}, error = function(er){\n  print(er)\n});\n\n\n&lt;error/rlang_error&gt;\nError in `geom_point()`:\n! Problem while computing aesthetics.\n Error occurred in the 1st layer.\nCaused by error:\n! object 'time_elapsed' not found\n---\nBacktrace:\n     \n  1. base::tryCatch(...)\n  2.  base (local) tryCatchList(expr, classes, parentenv, handlers)\n  3.    base (local) tryCatchOne(expr, names, parentenv, handlers[[1L]])\n  4.      base (local) doTryCatch(return(expr), name, parentenv, handler)\n  5. base::print(combined_plot)\n  6. patchwork:::print.patchwork(combined_plot)\n  7.   patchwork:::build_patchwork(plot, plot$layout$guides %||% \"auto\")\n  8.     base::lapply(x$plots, plot_table, guides = guides)\n  9.       patchwork (local) FUN(X[[i]], ...)\n 10.       patchwork:::plot_table.ggplot(X[[i]], ...)\n 11.         ggplot2::ggplotGrob(x)\n 12.           ggplot2::ggplot_gtable(ggplot_build(x))\n 13.            ggplot2:::attach_plot_env(data$plot$plot_env)\n 14.              base::options(ggplot2_plot_env = env)\n 15.           ggplot2::ggplot_build(x)\n 16.           ggplot2:::ggplot_build.ggplot(x)\n 17.             ggplot2:::by_layer(...)\n 18.               rlang::try_fetch(...)\n 19.                base::tryCatch(...)\n 20.                 base (local) tryCatchList(expr, classes, parentenv, handlers)\n 21.                   base (local) tryCatchOne(expr, names, parentenv, handlers[[1L]])\n 22.                     base (local) doTryCatch(return(expr), name, parentenv, handler)\n 23.                base::withCallingHandlers(...)\n 24.               ggplot2 (local) f(l = layers[[i]], d = data[[i]])\n 25.                 l$compute_aesthetics(d, plot)\n 26.                   ggplot2 (local) compute_aesthetics(..., self = self)\n 27.                     base::lapply(aesthetics, eval_tidy, data = data, env = env)\n 28.                       rlang (local) FUN(X[[i]], ...)\n\n\n\n\nplot across all stations\np &lt;- ggplot(cruise_df, aes(x = time, y = depth, fill = station)) +\n  geom_col() +  # This creates the bars\n  # geom_text(aes(label = station), vjust = -0.3) +  # This adds labels to each bar, adjust vjust for position\n  labs(x = \"Time\", y = \"Depth\", title = \"Depth over Time by Station\") +  # Set labels and title\n  theme_minimal()  # Use a minimal theme\nprint(p)\n\n\n\n\n\n\n\n\n\n\n\ncreate oce.ctd objects from dataframes\nctd_load &lt;- function(data, other_params = NULL) {\n  \n  # create csv into ctd object\n  test_ctd &lt;-\n    as.ctd(\n      salinity    = data$sea_water_salinity,\n      temperature = data$sea_water_temperature,\n      pressure    = data$sea_water_pressure,\n      station     = data$station\n    )\n  \n  # add additional columns to ctd object\n  if (!is.null(other_params)) {\n    for (param_name in other_params) {\n      test_ctd &lt;-\n        oceSetData(\n          object = test_ctd,\n          name   = param_name,\n          value  = data[[param_name]]\n        )\n    }\n  }\n  print(glue(\"{data$station[1]}:\\t{length(test_ctd@data$scan)} scans\"))\n\n\n  return(test_ctd)\n}\n\n# Define other parameters to add\nother_params &lt;- c(\n  \"cruise_id\", \"station\", \"time\", \"time_elapsed\", \n  \"latitude\", \"longitude\", \"sea_water_electrical_conductivity\", \n  \"CDOM\", \"dissolved_oxygen\",\"oxygen_saturation\", \"chlorophyll_concentration\", \n  \"chlorophyll_fluorescence\", \"photosynthetically_available_radiation\", \n  \"beam_attenuation\",\"beam_transmission\", \"depth\", \"sea_water_sigma_t\",\n  \"descent_rate\", \"sound_velocity\",\"altimeter\"\n)\n\n# Split data by station and create data list\nctd_FK &lt;- cruise_df %&gt;%\n  split(.$station) %&gt;%\n  map(~ ctd_load(.x, other_params = other_params)) # ~ is a lambda(x)\n\n\n10: 1509 scans\n12: 3203 scans\n16: 2062 scans\n18: 4859 scans\n2:  1884 scans\n21/LK:  4812 scans\n30: 3867 scans\n31: 2724 scans\n33: 2053 scans\n42: 2293 scans\n45: 1700 scans\n51: 1792 scans\n53: 1521 scans\n54: 1550 scans\n55: 7 scans\n56: 1553 scans\n57: 2356 scans\n57.1:   1568 scans\n57.2:   1865 scans\n57.3:   2540 scans\n58: 2173 scans\n60: 1775 scans\n68: 826 scans\n7:  1661 scans\n9:  3371 scans\n9.5:    9102 scans\nBG2:    2327 scans\nBG3:    2677 scans\nBG4:    3076 scans\nCAL1:   2024 scans\nCAL2:   2825 scans\nCAL3:   2657 scans\nCAL4:   2601 scans\nCAL5:   3585 scans\nCAL6:   4540 scans\nGP5:    3195 scans\nKW1:    2405 scans\nKW2:    3194 scans\nKW4:    2377 scans\nMR: 5673 scans\nRP1:    2422 scans\nRP2:    2046 scans\nRP3:    1700 scans\nRP4:    3120 scans\nTB1:    3408 scans\nTB10:   3955 scans\nTB11:   4202 scans\nTB12:   4584 scans\nTB13:   5821 scans\nTB2:    2246 scans\nTB3:    2282 scans\nTB4:    3752 scans\nTB5:    5542 scans\nV1: 1570 scans\nV10:    4817 scans\nV11:    5011 scans\nV2: 1693 scans\nV3: 2710 scans\nV4: 2502 scans\nV5: 4516 scans\nV6: 3455 scans\nV7: 5107 scans\nV8: 3637 scans\nV9: 3869 scans\nWS: 3570 scans\n\n\n\n\nplotting scans for each cast in the first list\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # 1 is selecting only the first sublist\n  # print(i)\n  print(glue(\"=== station: {cast@metadata$station[1]}\"))\n  print(glue(\"# scans: {length(cast@data$scan)}\"))\n  plotScan(cast)\n}\n\n\n=== station: 10\n# scans: 1509\n\n\n\n\n\n\n\n\n\n=== station: 12\n# scans: 3203\n\n\n\n\n\n\n\n\n\n=== station: 16\n# scans: 2062\n\n\n\n\n\n\n\n\n\n=== station: 18\n# scans: 4859\n\n\n\n\n\n\n\n\n\n=== station: 2\n# scans: 1884\n\n\n\n\n\n\n\n\n\n=== station: 21/LK\n# scans: 4812\n\n\n\n\n\n\n\n\n\n=== station: 30\n# scans: 3867\n\n\n\n\n\n\n\n\n\n=== station: 31\n# scans: 2724\n\n\n\n\n\n\n\n\n\n=== station: 33\n# scans: 2053\n\n\n\n\n\n\n\n\n\n=== station: 42\n# scans: 2293\n\n\n\n\n\n\n\n\n\n=== station: 45\n# scans: 1700\n\n\n\n\n\n\n\n\n\n=== station: 51\n# scans: 1792\n\n\n\n\n\n\n\n\n\n=== station: 53\n# scans: 1521\n\n\n\n\n\n\n\n\n\n=== station: 54\n# scans: 1550\n\n\n\n\n\n\n\n\n\n=== station: 55\n# scans: 7\n\n\n\n\n\n\n\n\n\n=== station: 56\n# scans: 1553\n\n\n\n\n\n\n\n\n\n=== station: 57\n# scans: 2356\n\n\n\n\n\n\n\n\n\n=== station: 57.1\n# scans: 1568\n\n\n\n\n\n\n\n\n\n=== station: 57.2\n# scans: 1865\n\n\n\n\n\n\n\n\n\n=== station: 57.3\n# scans: 2540\n\n\n\n\n\n\n\n\n\n=== station: 58\n# scans: 2173\n\n\n\n\n\n\n\n\n\n=== station: 60\n# scans: 1775\n\n\n\n\n\n\n\n\n\n=== station: 68\n# scans: 826\n\n\n\n\n\n\n\n\n\n=== station: 7\n# scans: 1661\n\n\n\n\n\n\n\n\n\n=== station: 9\n# scans: 3371\n\n\n\n\n\n\n\n\n\n=== station: 9.5\n# scans: 9102\n\n\n\n\n\n\n\n\n\n=== station: BG2\n# scans: 2327\n\n\n\n\n\n\n\n\n\n=== station: BG3\n# scans: 2677\n\n\n\n\n\n\n\n\n\n=== station: BG4\n# scans: 3076\n\n\n\n\n\n\n\n\n\n=== station: CAL1\n# scans: 2024\n\n\n\n\n\n\n\n\n\n=== station: CAL2\n# scans: 2825\n\n\n\n\n\n\n\n\n\n=== station: CAL3\n# scans: 2657\n\n\n\n\n\n\n\n\n\n=== station: CAL4\n# scans: 2601\n\n\n\n\n\n\n\n\n\n=== station: CAL5\n# scans: 3585\n\n\n\n\n\n\n\n\n\n=== station: CAL6\n# scans: 4540\n\n\n\n\n\n\n\n\n\n=== station: GP5\n# scans: 3195\n\n\n\n\n\n\n\n\n\n=== station: KW1\n# scans: 2405\n\n\n\n\n\n\n\n\n\n=== station: KW2\n# scans: 3194\n\n\n\n\n\n\n\n\n\n=== station: KW4\n# scans: 2377\n\n\n\n\n\n\n\n\n\n=== station: MR\n# scans: 5673\n\n\n\n\n\n\n\n\n\n=== station: RP1\n# scans: 2422\n\n\n\n\n\n\n\n\n\n=== station: RP2\n# scans: 2046\n\n\n\n\n\n\n\n\n\n=== station: RP3\n# scans: 1700\n\n\n\n\n\n\n\n\n\n=== station: RP4\n# scans: 3120\n\n\n\n\n\n\n\n\n\n=== station: TB1\n# scans: 3408\n\n\n\n\n\n\n\n\n\n=== station: TB10\n# scans: 3955\n\n\n\n\n\n\n\n\n\n=== station: TB11\n# scans: 4202\n\n\n\n\n\n\n\n\n\n=== station: TB12\n# scans: 4584\n\n\n\n\n\n\n\n\n\n=== station: TB13\n# scans: 5821\n\n\n\n\n\n\n\n\n\n=== station: TB2\n# scans: 2246\n\n\n\n\n\n\n\n\n\n=== station: TB3\n# scans: 2282\n\n\n\n\n\n\n\n\n\n=== station: TB4\n# scans: 3752\n\n\n\n\n\n\n\n\n\n=== station: TB5\n# scans: 5542\n\n\n\n\n\n\n\n\n\n=== station: V1\n# scans: 1570\n\n\n\n\n\n\n\n\n\n=== station: V10\n# scans: 4817\n\n\n\n\n\n\n\n\n\n=== station: V11\n# scans: 5011\n\n\n\n\n\n\n\n\n\n=== station: V2\n# scans: 1693\n\n\n\n\n\n\n\n\n\n=== station: V3\n# scans: 2710\n\n\n\n\n\n\n\n\n\n=== station: V4\n# scans: 2502\n\n\n\n\n\n\n\n\n\n=== station: V5\n# scans: 4516\n\n\n\n\n\n\n\n\n\n=== station: V6\n# scans: 3455\n\n\n\n\n\n\n\n\n\n=== station: V7\n# scans: 5107\n\n\n\n\n\n\n\n\n\n=== station: V8\n# scans: 3637\n\n\n\n\n\n\n\n\n\n=== station: V9\n# scans: 3869\n\n\n\n\n\n\n\n\n\n=== station: WS\n# scans: 3570\n\n\n\n\n\n\n\n\n\n\n\nplotting each cast in the first list\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # 1 is selecting only the first sublist\n  tryCatch({\n    plot(ctdDecimate(ctdTrim(cast)))\n  }, error = function(e){\n    print(e)\n  })\n}\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1509' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3203' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2062' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4859' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1884' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4812' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3867' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2724' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2053' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2293' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1700' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1792' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1521' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1550' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1553' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2356' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1568' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1865' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2540' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2173' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1775' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 826' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1661' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3371' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 9102' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2327' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2677' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3076' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2024' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2825' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2657' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2601' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3585' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4540' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3195' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2405' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3194' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2377' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 5673' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2422' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2046' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1700' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3120' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3408' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3955' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4202' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4584' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 5821' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2246' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2282' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3752' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 5542' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1570' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4817' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 5011' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1693' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2710' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2502' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4516' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3455' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 5107' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3637' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3869' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3570' in coercion to 'logical(1)'&gt;\n\n\n\n\nplotting other physical parameters for each cast\n# Loop through each CTD cast\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # Assuming each sublist contains only one relevant CTD object\n  tryCatch({\n    # Extract metadata for station name and cruise ID\n    station_name &lt;- cast@metadata$station[1]\n    cruise_id &lt;- cast@data$cruise_id[1]\n\n    # Generate a title with station name and cruise ID\n    overall_title &lt;- glue::glue(\"Station: {station_name}, Cruise ID: {cruise_id}\")\n\n    # Set margins: increase the outer margin for the title\n    par(oma = c(0, 0, 3, 0))  # Top outer margin increased for title\n\n    # Plotting function with specific parameters\n    oce::plot(\n      x = ctdDecimate(ctdTrim(cast)),\n      which = c(\n        \"sea_water_electrical_conductivity\",\n        \"descent_rate\", \"sound_velocity\",\n        \"sea_water_sigma_t\",\"altimeter\"\n      ),\n      main = \"\"  # No main title for individual subplots\n    )\n\n    # Place a single overall title at the top of the plot frame\n    mtext(overall_title, side = 3, line = 1, outer = TRUE, cex = 1.5)\n\n    # Reset outer margins to default\n    par(oma = c(0, 0, 0, 0))\n\n  }, error = function(e) {\n    print(e$message)  # Print any errors that occur during plotting\n  })\n}\n\n\n\n\n\n\n\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n\n\nplotting other nutrient parameters for each cast\n# Loop through each CTD cast\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # Assuming each sublist contains only one relevant CTD object\n  tryCatch({\n    # Extract metadata for station name and cruise ID\n    station_name &lt;- cast@metadata$station[1]\n    cruise_id &lt;- cast@data$cruise_id[1]\n\n    # Generate a title with station name and cruise ID\n    overall_title &lt;- glue::glue(\"Station: {station_name}, Cruise ID: {cruise_id}\")\n\n    # Set margins: increase the outer margin for the title\n    par(oma = c(0, 0, 3, 0))  # Top outer margin increased for title\n\n    # Plotting function with specific parameters\n    oce::plot(\n      x = ctdDecimate(ctdTrim(cast)),\n      which = c(\n        \"CDOM\", \"dissolved_oxygen\",\n        \"oxygen_saturation\",\n        \"chlorophyll_concentration\", \"chlorophyll_fluorescence\"\n      ),\n      main = \"\"  # No main title for individual subplots\n    )\n\n    # Place a single overall title at the top of the plot frame\n    mtext(overall_title, side = 3, line = 1, outer = TRUE, cex = 1.5)\n\n    # Reset outer margins to default\n    par(oma = c(0, 0, 0, 0))\n\n  }, error = function(e) {\n    print(e$message)  # Print any errors that occur during plotting\n  })\n}\n\n\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"plot.new has not been called yet\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n\n\n\n\nplotting other optical parameters for each cast\n# Loop through each CTD cast\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # Assuming each sublist contains only one relevant CTD object\n  tryCatch({\n    # Extract metadata for station name and cruise ID\n    station_name &lt;- cast@metadata$station[1]\n    cruise_id &lt;- cast@data$cruise_id[1]\n\n    # Generate a title with station name and cruise ID\n    overall_title &lt;- glue::glue(\"Station: {station_name}, Cruise ID: {cruise_id}\")\n\n    # Set margins: increase the outer margin for the title\n    par(oma = c(0, 0, 3, 0))  # Top outer margin increased for title\n\n    # Plotting function with specific parameters\n    oce::plot(\n      x = ctdDecimate(ctdTrim(cast)),\n      which = c(\n        \"photosynthetically_available_radiation\",\n        \"beam_attenuation\",\"beam_transmission\"\n      ),\n      main = \"\"  # No main title for individual subplots\n    )\n\n    # Place a single overall title at the top of the plot frame\n    mtext(overall_title, side = 3, line = 1, outer = TRUE, cex = 1.5)\n\n    # Reset outer margins to default\n    par(oma = c(0, 0, 0, 0))\n\n  }, error = function(e) {\n    print(e$message)  # Print any errors that occur during plotting\n  })\n}\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nloop through every cast, clean, & save\ncombined_df &lt;- data.frame()\nfor (i in seq(ctd_FK)){\n  tryCatch({\n    cast &lt;- ctd_FK[[i]]  # 1 is selecting only the first sublist\n    \n    # print(class(cast))\n    # clean cast \n    trimmed_cast &lt;- ctdTrim(cast)\n    decimated_cast &lt;- ctdDecimate(trimmed_cast, p = 0.5)  # binned to 0.5 m\n    \n    # convert to df\n    cast_df &lt;- as.data.frame(decimated_cast@data)\n    \n    # Add metadata\n    # assumes station ID and cruise ID the same for all & just uses 1st one\n    cast_df &lt;- mutate(\n      cast_df,\n      station = cast@data$station[1],\n      cruise_id = cast@data$cruise_id[1]\n    )\n  \n    # drop NA rows left by cleaning\n    cast_df &lt;- subset(cast_df, !is.na(scan))\n    \n    # Append the data to the combined dataframe\n    combined_df &lt;- rbind(combined_df, cast_df)\n  }, error = function(e){\n    print(glue(\"error in cast {cast@metadata$station[1]}\"))\n    print(e)\n  })\n}\n# Save to CSV\nfile_path &lt;- here(glue(\"data/cleaned/{cruise_id}.csv\"))\nwrite.csv(combined_df, file_path, row.names = FALSE)"
  },
  {
    "objectID": "cruise_report/cruise_reports/WS19119.html",
    "href": "cruise_report/cruise_reports/WS19119.html",
    "title": "WS19119",
    "section": "",
    "text": "WS19119\n\n\nsetup\nif (!nzchar(system.file(package = \"librarian\"))) {\n  install.packages(\"librarian\")\n}\n\nlibrarian::shelf(\n  quiet = TRUE,\n  readr, here, fs, ggplot2, glue, \"jiho/castr\", dplyr, oce, patchwork, purrr, tidyr\n)\n\n\n\n\nCode\nsource(here(\"R/cruise_load.R\"))\ncruise_df &lt;- cruise_load(params$cruise_id)\n\n\n\n\nplot depth & pressure vs time elapsed\ntryCatch({\n  plots &lt;- list()\n  \n  for (station_name in unique(cruise_df$station)) {\n    subset_df &lt;- filter(cruise_df, station == station_name)\n    plots[[station_name]] &lt;- ggplot(subset_df, aes(x = time_elapsed)) +\n      geom_point(aes(y = depth), color = \"blue\") +  # Plot depth in blue\n      geom_line(aes(y = sea_water_pressure), color = \"red\") +  # Plot sea water pressure in red\n      ggtitle(glue(\"{station_name}\")) +\n      theme(\n        axis.title.x = element_blank(),\n        axis.title.y = element_blank(),\n        axis.text.x = element_blank(),\n        axis.text.y = element_blank(),\n        axis.ticks.x = element_blank(),\n        axis.ticks.y = element_blank()\n      )  # Remove individual axis titles and text\n  }\n  \n  # drop nulls\n  plots &lt;- purrr::compact(plots)\n  \n  # Combine all plots into a grid\n  combined_plot &lt;- wrap_plots(plots) + \n    plot_layout(ncol = 4) +  # Adjust ncol to set number of columns in the grid\n    plot_annotation(\n      title = \"Depth (blue) and Pressure (red)\",\n      subtitle = \"Each panel represents a different station\",\n      caption = \"Time Elapsed (x-axis) vs Depth & Pressure (y-axis)\"\n    ) +\n    theme(\n      plot.tag = element_text(size = 12, face = \"bold\"),\n      plot.tag.position = \"topleft\",\n      axis.title.x = element_text(margin = margin(t = 10)),\n      axis.title.y = element_text(margin = margin(r = 10))\n    )\n  \n  print(combined_plot)\n}, error = function(er){\n  print(er)\n});\n\n\n&lt;error/rlang_error&gt;\nError in `geom_point()`:\n! Problem while computing aesthetics.\n Error occurred in the 1st layer.\nCaused by error:\n! object 'time_elapsed' not found\n---\nBacktrace:\n     \n  1. base::tryCatch(...)\n  2.  base (local) tryCatchList(expr, classes, parentenv, handlers)\n  3.    base (local) tryCatchOne(expr, names, parentenv, handlers[[1L]])\n  4.      base (local) doTryCatch(return(expr), name, parentenv, handler)\n  5. base::print(combined_plot)\n  6. patchwork:::print.patchwork(combined_plot)\n  7.   patchwork:::build_patchwork(plot, plot$layout$guides %||% \"auto\")\n  8.     base::lapply(x$plots, plot_table, guides = guides)\n  9.       patchwork (local) FUN(X[[i]], ...)\n 10.       patchwork:::plot_table.ggplot(X[[i]], ...)\n 11.         ggplot2::ggplotGrob(x)\n 12.           ggplot2::ggplot_gtable(ggplot_build(x))\n 13.            ggplot2:::attach_plot_env(data$plot$plot_env)\n 14.              base::options(ggplot2_plot_env = env)\n 15.           ggplot2::ggplot_build(x)\n 16.           ggplot2:::ggplot_build.ggplot(x)\n 17.             ggplot2:::by_layer(...)\n 18.               rlang::try_fetch(...)\n 19.                base::tryCatch(...)\n 20.                 base (local) tryCatchList(expr, classes, parentenv, handlers)\n 21.                   base (local) tryCatchOne(expr, names, parentenv, handlers[[1L]])\n 22.                     base (local) doTryCatch(return(expr), name, parentenv, handler)\n 23.                base::withCallingHandlers(...)\n 24.               ggplot2 (local) f(l = layers[[i]], d = data[[i]])\n 25.                 l$compute_aesthetics(d, plot)\n 26.                   ggplot2 (local) compute_aesthetics(..., self = self)\n 27.                     base::lapply(aesthetics, eval_tidy, data = data, env = env)\n 28.                       rlang (local) FUN(X[[i]], ...)\n\n\n\n\nplot across all stations\np &lt;- ggplot(cruise_df, aes(x = time, y = depth, fill = station)) +\n  geom_col() +  # This creates the bars\n  # geom_text(aes(label = station), vjust = -0.3) +  # This adds labels to each bar, adjust vjust for position\n  labs(x = \"Time\", y = \"Depth\", title = \"Depth over Time by Station\") +  # Set labels and title\n  theme_minimal()  # Use a minimal theme\nprint(p)\n\n\n\n\n\n\n\n\n\n\n\ncreate oce.ctd objects from dataframes\nctd_load &lt;- function(data, other_params = NULL) {\n  \n  # create csv into ctd object\n  test_ctd &lt;-\n    as.ctd(\n      salinity    = data$sea_water_salinity,\n      temperature = data$sea_water_temperature,\n      pressure    = data$sea_water_pressure,\n      station     = data$station\n    )\n  \n  # add additional columns to ctd object\n  if (!is.null(other_params)) {\n    for (param_name in other_params) {\n      test_ctd &lt;-\n        oceSetData(\n          object = test_ctd,\n          name   = param_name,\n          value  = data[[param_name]]\n        )\n    }\n  }\n  print(glue(\"{data$station[1]}:\\t{length(test_ctd@data$scan)} scans\"))\n\n\n  return(test_ctd)\n}\n\n# Define other parameters to add\nother_params &lt;- c(\n  \"cruise_id\", \"station\", \"time\", \"time_elapsed\", \n  \"latitude\", \"longitude\", \"sea_water_electrical_conductivity\", \n  \"CDOM\", \"dissolved_oxygen\",\"oxygen_saturation\", \"chlorophyll_concentration\", \n  \"chlorophyll_fluorescence\", \"photosynthetically_available_radiation\", \n  \"beam_attenuation\",\"beam_transmission\", \"depth\", \"sea_water_sigma_t\",\n  \"descent_rate\", \"sound_velocity\",\"altimeter\"\n)\n\n# Split data by station and create data list\nctd_FK &lt;- cruise_df %&gt;%\n  split(.$station) %&gt;%\n  map(~ ctd_load(.x, other_params = other_params)) # ~ is a lambda(x)\n\n\n10: 1512 scans\n12: 4194 scans\n16: 2317 scans\n18: 2538 scans\n2:  2686 scans\n21/LK:  3983 scans\n30: 3800 scans\n31: 2599 scans\n33: 2553 scans\n41: 3405 scans\n45: 1989 scans\n49: 2233 scans\n54: 767 scans\n55: 856 scans\n56: 17 scans\n57: 1732 scans\n57.1:   1447 scans\n57.2:   1656 scans\n57.3:   1951 scans\n58: 2948 scans\n60: 935 scans\n65: 58 scans\n68: 1394 scans\n7:  1520 scans\n9:  4293 scans\n9.5:    9887 scans\nCAL1:   1567 scans\nCAL3:   2014 scans\nCAL5:   3350 scans\nCAPTIVA_BLUEHOLE:   15362 scans\nGP1:    1872 scans\nGP2:    2130 scans\nGP3:    2005 scans\nGP4:    2799 scans\nGP5:    3234 scans\nKW1:    3308 scans\nKW2:    3984 scans\nKW4:    3152 scans\nMR: 2833 scans\nMUDHOLE:    2119 scans\nNAPLESBLUEHOLE: 3202 scans\nRP1:    3049 scans\nRP2:    3574 scans\nRP3:    2084 scans\nRP4:    2697 scans\nWS: 2179 scans\n\n\n\n\nplotting scans for each cast in the first list\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # 1 is selecting only the first sublist\n  # print(i)\n  print(glue(\"=== station: {cast@metadata$station[1]}\"))\n  print(glue(\"# scans: {length(cast@data$scan)}\"))\n  plotScan(cast)\n}\n\n\n=== station: 10\n# scans: 1512\n\n\n\n\n\n\n\n\n\n=== station: 12\n# scans: 4194\n\n\n\n\n\n\n\n\n\n=== station: 16\n# scans: 2317\n\n\n\n\n\n\n\n\n\n=== station: 18\n# scans: 2538\n\n\n\n\n\n\n\n\n\n=== station: 2\n# scans: 2686\n\n\n\n\n\n\n\n\n\n=== station: 21/LK\n# scans: 3983\n\n\n\n\n\n\n\n\n\n=== station: 30\n# scans: 3800\n\n\n\n\n\n\n\n\n\n=== station: 31\n# scans: 2599\n\n\n\n\n\n\n\n\n\n=== station: 33\n# scans: 2553\n\n\n\n\n\n\n\n\n\n=== station: 41\n# scans: 3405\n\n\n\n\n\n\n\n\n\n=== station: 45\n# scans: 1989\n\n\n\n\n\n\n\n\n\n=== station: 49\n# scans: 2233\n\n\n\n\n\n\n\n\n\n=== station: 54\n# scans: 767\n\n\n\n\n\n\n\n\n\n=== station: 55\n# scans: 856\n\n\n\n\n\n\n\n\n\n=== station: 56\n# scans: 17\n\n\n\n\n\n\n\n\n\n=== station: 57\n# scans: 1732\n\n\n\n\n\n\n\n\n\n=== station: 57.1\n# scans: 1447\n\n\n\n\n\n\n\n\n\n=== station: 57.2\n# scans: 1656\n\n\n\n\n\n\n\n\n\n=== station: 57.3\n# scans: 1951\n\n\n\n\n\n\n\n\n\n=== station: 58\n# scans: 2948\n\n\n\n\n\n\n\n\n\n=== station: 60\n# scans: 935\n\n\n\n\n\n\n\n\n\n=== station: 65\n# scans: 58\n\n\n\n\n\n\n\n\n\n=== station: 68\n# scans: 1394\n\n\n\n\n\n\n\n\n\n=== station: 7\n# scans: 1520\n\n\n\n\n\n\n\n\n\n=== station: 9\n# scans: 4293\n\n\n\n\n\n\n\n\n\n=== station: 9.5\n# scans: 9887\n\n\n\n\n\n\n\n\n\n=== station: CAL1\n# scans: 1567\n\n\n\n\n\n\n\n\n\n=== station: CAL3\n# scans: 2014\n\n\n\n\n\n\n\n\n\n=== station: CAL5\n# scans: 3350\n\n\n\n\n\n\n\n\n\n=== station: CAPTIVA_BLUEHOLE\n# scans: 15362\n\n\n\n\n\n\n\n\n\n=== station: GP1\n# scans: 1872\n\n\n\n\n\n\n\n\n\n=== station: GP2\n# scans: 2130\n\n\n\n\n\n\n\n\n\n=== station: GP3\n# scans: 2005\n\n\n\n\n\n\n\n\n\n=== station: GP4\n# scans: 2799\n\n\n\n\n\n\n\n\n\n=== station: GP5\n# scans: 3234\n\n\n\n\n\n\n\n\n\n=== station: KW1\n# scans: 3308\n\n\n\n\n\n\n\n\n\n=== station: KW2\n# scans: 3984\n\n\n\n\n\n\n\n\n\n=== station: KW4\n# scans: 3152\n\n\n\n\n\n\n\n\n\n=== station: MR\n# scans: 2833\n\n\n\n\n\n\n\n\n\n=== station: MUDHOLE\n# scans: 2119\n\n\n\n\n\n\n\n\n\n=== station: NAPLESBLUEHOLE\n# scans: 3202\n\n\n\n\n\n\n\n\n\n=== station: RP1\n# scans: 3049\n\n\n\n\n\n\n\n\n\n=== station: RP2\n# scans: 3574\n\n\n\n\n\n\n\n\n\n=== station: RP3\n# scans: 2084\n\n\n\n\n\n\n\n\n\n=== station: RP4\n# scans: 2697\n\n\n\n\n\n\n\n\n\n=== station: WS\n# scans: 2179\n\n\n\n\n\n\n\n\n\n\n\nplotting each cast in the first list\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # 1 is selecting only the first sublist\n  tryCatch({\n    plot(ctdDecimate(ctdTrim(cast)))\n  }, error = function(e){\n    print(e)\n  })\n}\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1512' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4194' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2317' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2538' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2686' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3983' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3800' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2599' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2553' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3405' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1989' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2233' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 767' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 856' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 17' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1732' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1447' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1656' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1951' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2948' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 935' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1394' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1520' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4293' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 9887' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1567' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2014' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3350' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 15362' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1872' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2130' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2005' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2799' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3234' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3308' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3984' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3152' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2833' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2119' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3202' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3049' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3574' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2084' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2697' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2179' in coercion to 'logical(1)'&gt;\n\n\n\n\nplotting other physical parameters for each cast\n# Loop through each CTD cast\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # Assuming each sublist contains only one relevant CTD object\n  tryCatch({\n    # Extract metadata for station name and cruise ID\n    station_name &lt;- cast@metadata$station[1]\n    cruise_id &lt;- cast@data$cruise_id[1]\n\n    # Generate a title with station name and cruise ID\n    overall_title &lt;- glue::glue(\"Station: {station_name}, Cruise ID: {cruise_id}\")\n\n    # Set margins: increase the outer margin for the title\n    par(oma = c(0, 0, 3, 0))  # Top outer margin increased for title\n\n    # Plotting function with specific parameters\n    oce::plot(\n      x = ctdDecimate(ctdTrim(cast)),\n      which = c(\n        \"sea_water_electrical_conductivity\",\n        \"descent_rate\", \"sound_velocity\",\n        \"sea_water_sigma_t\",\"altimeter\"\n      ),\n      main = \"\"  # No main title for individual subplots\n    )\n\n    # Place a single overall title at the top of the plot frame\n    mtext(overall_title, side = 3, line = 1, outer = TRUE, cex = 1.5)\n\n    # Reset outer margins to default\n    par(oma = c(0, 0, 0, 0))\n\n  }, error = function(e) {\n    print(e$message)  # Print any errors that occur during plotting\n  })\n}\n\n\n\n\n\n\n\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n\n\nplotting other nutrient parameters for each cast\n# Loop through each CTD cast\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # Assuming each sublist contains only one relevant CTD object\n  tryCatch({\n    # Extract metadata for station name and cruise ID\n    station_name &lt;- cast@metadata$station[1]\n    cruise_id &lt;- cast@data$cruise_id[1]\n\n    # Generate a title with station name and cruise ID\n    overall_title &lt;- glue::glue(\"Station: {station_name}, Cruise ID: {cruise_id}\")\n\n    # Set margins: increase the outer margin for the title\n    par(oma = c(0, 0, 3, 0))  # Top outer margin increased for title\n\n    # Plotting function with specific parameters\n    oce::plot(\n      x = ctdDecimate(ctdTrim(cast)),\n      which = c(\n        \"CDOM\", \"dissolved_oxygen\",\n        \"oxygen_saturation\",\n        \"chlorophyll_concentration\", \"chlorophyll_fluorescence\"\n      ),\n      main = \"\"  # No main title for individual subplots\n    )\n\n    # Place a single overall title at the top of the plot frame\n    mtext(overall_title, side = 3, line = 1, outer = TRUE, cex = 1.5)\n\n    # Reset outer margins to default\n    par(oma = c(0, 0, 0, 0))\n\n  }, error = function(e) {\n    print(e$message)  # Print any errors that occur during plotting\n  })\n}\n\n\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"plot.new has not been called yet\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n\n\n\n\nplotting other optical parameters for each cast\n# Loop through each CTD cast\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # Assuming each sublist contains only one relevant CTD object\n  tryCatch({\n    # Extract metadata for station name and cruise ID\n    station_name &lt;- cast@metadata$station[1]\n    cruise_id &lt;- cast@data$cruise_id[1]\n\n    # Generate a title with station name and cruise ID\n    overall_title &lt;- glue::glue(\"Station: {station_name}, Cruise ID: {cruise_id}\")\n\n    # Set margins: increase the outer margin for the title\n    par(oma = c(0, 0, 3, 0))  # Top outer margin increased for title\n\n    # Plotting function with specific parameters\n    oce::plot(\n      x = ctdDecimate(ctdTrim(cast)),\n      which = c(\n        \"photosynthetically_available_radiation\",\n        \"beam_attenuation\",\"beam_transmission\"\n      ),\n      main = \"\"  # No main title for individual subplots\n    )\n\n    # Place a single overall title at the top of the plot frame\n    mtext(overall_title, side = 3, line = 1, outer = TRUE, cex = 1.5)\n\n    # Reset outer margins to default\n    par(oma = c(0, 0, 0, 0))\n\n  }, error = function(e) {\n    print(e$message)  # Print any errors that occur during plotting\n  })\n}\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nloop through every cast, clean, & save\ncombined_df &lt;- data.frame()\nfor (i in seq(ctd_FK)){\n  tryCatch({\n    cast &lt;- ctd_FK[[i]]  # 1 is selecting only the first sublist\n    \n    # print(class(cast))\n    # clean cast \n    trimmed_cast &lt;- ctdTrim(cast)\n    decimated_cast &lt;- ctdDecimate(trimmed_cast, p = 0.5)  # binned to 0.5 m\n    \n    # convert to df\n    cast_df &lt;- as.data.frame(decimated_cast@data)\n    \n    # Add metadata\n    # assumes station ID and cruise ID the same for all & just uses 1st one\n    cast_df &lt;- mutate(\n      cast_df,\n      station = cast@data$station[1],\n      cruise_id = cast@data$cruise_id[1]\n    )\n  \n    # drop NA rows left by cleaning\n    cast_df &lt;- subset(cast_df, !is.na(scan))\n    \n    # Append the data to the combined dataframe\n    combined_df &lt;- rbind(combined_df, cast_df)\n  }, error = function(e){\n    print(glue(\"error in cast {cast@metadata$station[1]}\"))\n    print(e)\n  })\n}\n# Save to CSV\nfile_path &lt;- here(glue(\"data/cleaned/{cruise_id}.csv\"))\nwrite.csv(combined_df, file_path, row.names = FALSE)"
  },
  {
    "objectID": "cruise_report/cruise_reports/WS18351.html",
    "href": "cruise_report/cruise_reports/WS18351.html",
    "title": "WS18351",
    "section": "",
    "text": "WS18351\n\n\nsetup\nif (!nzchar(system.file(package = \"librarian\"))) {\n  install.packages(\"librarian\")\n}\n\nlibrarian::shelf(\n  quiet = TRUE,\n  readr, here, fs, ggplot2, glue, \"jiho/castr\", dplyr, oce, patchwork, purrr, tidyr\n)\n\n\n\n\nCode\nsource(here(\"R/cruise_load.R\"))\ncruise_df &lt;- cruise_load(params$cruise_id)\n\n\n\n\nplot depth & pressure vs time elapsed\ntryCatch({\n  plots &lt;- list()\n  \n  for (station_name in unique(cruise_df$station)) {\n    subset_df &lt;- filter(cruise_df, station == station_name)\n    plots[[station_name]] &lt;- ggplot(subset_df, aes(x = time_elapsed)) +\n      geom_point(aes(y = depth), color = \"blue\") +  # Plot depth in blue\n      geom_line(aes(y = sea_water_pressure), color = \"red\") +  # Plot sea water pressure in red\n      ggtitle(glue(\"{station_name}\")) +\n      theme(\n        axis.title.x = element_blank(),\n        axis.title.y = element_blank(),\n        axis.text.x = element_blank(),\n        axis.text.y = element_blank(),\n        axis.ticks.x = element_blank(),\n        axis.ticks.y = element_blank()\n      )  # Remove individual axis titles and text\n  }\n  \n  # drop nulls\n  plots &lt;- purrr::compact(plots)\n  \n  # Combine all plots into a grid\n  combined_plot &lt;- wrap_plots(plots) + \n    plot_layout(ncol = 4) +  # Adjust ncol to set number of columns in the grid\n    plot_annotation(\n      title = \"Depth (blue) and Pressure (red)\",\n      subtitle = \"Each panel represents a different station\",\n      caption = \"Time Elapsed (x-axis) vs Depth & Pressure (y-axis)\"\n    ) +\n    theme(\n      plot.tag = element_text(size = 12, face = \"bold\"),\n      plot.tag.position = \"topleft\",\n      axis.title.x = element_text(margin = margin(t = 10)),\n      axis.title.y = element_text(margin = margin(r = 10))\n    )\n  \n  print(combined_plot)\n}, error = function(er){\n  print(er)\n});\n\n\n&lt;error/rlang_error&gt;\nError in `geom_point()`:\n! Problem while computing aesthetics.\n Error occurred in the 1st layer.\nCaused by error:\n! object 'time_elapsed' not found\n---\nBacktrace:\n     \n  1. base::tryCatch(...)\n  2.  base (local) tryCatchList(expr, classes, parentenv, handlers)\n  3.    base (local) tryCatchOne(expr, names, parentenv, handlers[[1L]])\n  4.      base (local) doTryCatch(return(expr), name, parentenv, handler)\n  5. base::print(combined_plot)\n  6. patchwork:::print.patchwork(combined_plot)\n  7.   patchwork:::build_patchwork(plot, plot$layout$guides %||% \"auto\")\n  8.     base::lapply(x$plots, plot_table, guides = guides)\n  9.       patchwork (local) FUN(X[[i]], ...)\n 10.       patchwork:::plot_table.ggplot(X[[i]], ...)\n 11.         ggplot2::ggplotGrob(x)\n 12.           ggplot2::ggplot_gtable(ggplot_build(x))\n 13.            ggplot2:::attach_plot_env(data$plot$plot_env)\n 14.              base::options(ggplot2_plot_env = env)\n 15.           ggplot2::ggplot_build(x)\n 16.           ggplot2:::ggplot_build.ggplot(x)\n 17.             ggplot2:::by_layer(...)\n 18.               rlang::try_fetch(...)\n 19.                base::tryCatch(...)\n 20.                 base (local) tryCatchList(expr, classes, parentenv, handlers)\n 21.                   base (local) tryCatchOne(expr, names, parentenv, handlers[[1L]])\n 22.                     base (local) doTryCatch(return(expr), name, parentenv, handler)\n 23.                base::withCallingHandlers(...)\n 24.               ggplot2 (local) f(l = layers[[i]], d = data[[i]])\n 25.                 l$compute_aesthetics(d, plot)\n 26.                   ggplot2 (local) compute_aesthetics(..., self = self)\n 27.                     base::lapply(aesthetics, eval_tidy, data = data, env = env)\n 28.                       rlang (local) FUN(X[[i]], ...)\n\n\n\n\nplot across all stations\np &lt;- ggplot(cruise_df, aes(x = time, y = depth, fill = station)) +\n  geom_col() +  # This creates the bars\n  # geom_text(aes(label = station), vjust = -0.3) +  # This adds labels to each bar, adjust vjust for position\n  labs(x = \"Time\", y = \"Depth\", title = \"Depth over Time by Station\") +  # Set labels and title\n  theme_minimal()  # Use a minimal theme\nprint(p)\n\n\n\n\n\n\n\n\n\n\n\ncreate oce.ctd objects from dataframes\nctd_load &lt;- function(data, other_params = NULL) {\n  \n  # create csv into ctd object\n  test_ctd &lt;-\n    as.ctd(\n      salinity    = data$sea_water_salinity,\n      temperature = data$sea_water_temperature,\n      pressure    = data$sea_water_pressure,\n      station     = data$station\n    )\n  \n  # add additional columns to ctd object\n  if (!is.null(other_params)) {\n    for (param_name in other_params) {\n      test_ctd &lt;-\n        oceSetData(\n          object = test_ctd,\n          name   = param_name,\n          value  = data[[param_name]]\n        )\n    }\n  }\n  print(glue(\"{data$station[1]}:\\t{length(test_ctd@data$scan)} scans\"))\n\n\n  return(test_ctd)\n}\n\n# Define other parameters to add\nother_params &lt;- c(\n  \"cruise_id\", \"station\", \"time\", \"time_elapsed\", \n  \"latitude\", \"longitude\", \"sea_water_electrical_conductivity\", \n  \"CDOM\", \"dissolved_oxygen\",\"oxygen_saturation\", \"chlorophyll_concentration\", \n  \"chlorophyll_fluorescence\", \"photosynthetically_available_radiation\", \n  \"beam_attenuation\",\"beam_transmission\", \"depth\", \"sea_water_sigma_t\",\n  \"descent_rate\", \"sound_velocity\",\"altimeter\"\n)\n\n# Split data by station and create data list\nctd_FK &lt;- cruise_df %&gt;%\n  split(.$station) %&gt;%\n  map(~ ctd_load(.x, other_params = other_params)) # ~ is a lambda(x)\n\n\n10: 1403 scans\n12: 5118 scans\n16: 1790 scans\n18: 3868 scans\n2:  1658 scans\n21/LK:  4213 scans\n7:  1294 scans\n9:  4060 scans\n9.5:    18319 scans\n9B: 2890 scans\nMR: 3900 scans\nWS: 3350 scans\n\n\n\n\nplotting scans for each cast in the first list\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # 1 is selecting only the first sublist\n  # print(i)\n  print(glue(\"=== station: {cast@metadata$station[1]}\"))\n  print(glue(\"# scans: {length(cast@data$scan)}\"))\n  plotScan(cast)\n}\n\n\n=== station: 10\n# scans: 1403\n\n\n\n\n\n\n\n\n\n=== station: 12\n# scans: 5118\n\n\n\n\n\n\n\n\n\n=== station: 16\n# scans: 1790\n\n\n\n\n\n\n\n\n\n=== station: 18\n# scans: 3868\n\n\n\n\n\n\n\n\n\n=== station: 2\n# scans: 1658\n\n\n\n\n\n\n\n\n\n=== station: 21/LK\n# scans: 4213\n\n\n\n\n\n\n\n\n\n=== station: 7\n# scans: 1294\n\n\n\n\n\n\n\n\n\n=== station: 9\n# scans: 4060\n\n\n\n\n\n\n\n\n\n=== station: 9.5\n# scans: 18319\n\n\n\n\n\n\n\n\n\n=== station: 9B\n# scans: 2890\n\n\n\n\n\n\n\n\n\n=== station: MR\n# scans: 3900\n\n\n\n\n\n\n\n\n\n=== station: WS\n# scans: 3350\n\n\n\n\n\n\n\n\n\n\n\nplotting each cast in the first list\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # 1 is selecting only the first sublist\n  tryCatch({\n    plot(ctdDecimate(ctdTrim(cast)))\n  }, error = function(e){\n    print(e)\n  })\n}\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1403' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 5118' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1790' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3868' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1658' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4213' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1294' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4060' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 18319' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2890' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3900' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3350' in coercion to 'logical(1)'&gt;\n\n\n\n\nplotting other physical parameters for each cast\n# Loop through each CTD cast\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # Assuming each sublist contains only one relevant CTD object\n  tryCatch({\n    # Extract metadata for station name and cruise ID\n    station_name &lt;- cast@metadata$station[1]\n    cruise_id &lt;- cast@data$cruise_id[1]\n\n    # Generate a title with station name and cruise ID\n    overall_title &lt;- glue::glue(\"Station: {station_name}, Cruise ID: {cruise_id}\")\n\n    # Set margins: increase the outer margin for the title\n    par(oma = c(0, 0, 3, 0))  # Top outer margin increased for title\n\n    # Plotting function with specific parameters\n    oce::plot(\n      x = ctdDecimate(ctdTrim(cast)),\n      which = c(\n        \"sea_water_electrical_conductivity\",\n        \"descent_rate\", \"sound_velocity\",\n        \"sea_water_sigma_t\",\"altimeter\"\n      ),\n      main = \"\"  # No main title for individual subplots\n    )\n\n    # Place a single overall title at the top of the plot frame\n    mtext(overall_title, side = 3, line = 1, outer = TRUE, cex = 1.5)\n\n    # Reset outer margins to default\n    par(oma = c(0, 0, 0, 0))\n\n  }, error = function(e) {\n    print(e$message)  # Print any errors that occur during plotting\n  })\n}\n\n\n\n\n\n\n\n\n\n[1] \"need finite 'xlim' values\"\n\n\n\n\nplotting other nutrient parameters for each cast\n# Loop through each CTD cast\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # Assuming each sublist contains only one relevant CTD object\n  tryCatch({\n    # Extract metadata for station name and cruise ID\n    station_name &lt;- cast@metadata$station[1]\n    cruise_id &lt;- cast@data$cruise_id[1]\n\n    # Generate a title with station name and cruise ID\n    overall_title &lt;- glue::glue(\"Station: {station_name}, Cruise ID: {cruise_id}\")\n\n    # Set margins: increase the outer margin for the title\n    par(oma = c(0, 0, 3, 0))  # Top outer margin increased for title\n\n    # Plotting function with specific parameters\n    oce::plot(\n      x = ctdDecimate(ctdTrim(cast)),\n      which = c(\n        \"CDOM\", \"dissolved_oxygen\",\n        \"oxygen_saturation\",\n        \"chlorophyll_concentration\", \"chlorophyll_fluorescence\"\n      ),\n      main = \"\"  # No main title for individual subplots\n    )\n\n    # Place a single overall title at the top of the plot frame\n    mtext(overall_title, side = 3, line = 1, outer = TRUE, cex = 1.5)\n\n    # Reset outer margins to default\n    par(oma = c(0, 0, 0, 0))\n\n  }, error = function(e) {\n    print(e$message)  # Print any errors that occur during plotting\n  })\n}\n\n\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n\n\n\n\nplotting other optical parameters for each cast\n# Loop through each CTD cast\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # Assuming each sublist contains only one relevant CTD object\n  tryCatch({\n    # Extract metadata for station name and cruise ID\n    station_name &lt;- cast@metadata$station[1]\n    cruise_id &lt;- cast@data$cruise_id[1]\n\n    # Generate a title with station name and cruise ID\n    overall_title &lt;- glue::glue(\"Station: {station_name}, Cruise ID: {cruise_id}\")\n\n    # Set margins: increase the outer margin for the title\n    par(oma = c(0, 0, 3, 0))  # Top outer margin increased for title\n\n    # Plotting function with specific parameters\n    oce::plot(\n      x = ctdDecimate(ctdTrim(cast)),\n      which = c(\n        \"photosynthetically_available_radiation\",\n        \"beam_attenuation\",\"beam_transmission\"\n      ),\n      main = \"\"  # No main title for individual subplots\n    )\n\n    # Place a single overall title at the top of the plot frame\n    mtext(overall_title, side = 3, line = 1, outer = TRUE, cex = 1.5)\n\n    # Reset outer margins to default\n    par(oma = c(0, 0, 0, 0))\n\n  }, error = function(e) {\n    print(e$message)  # Print any errors that occur during plotting\n  })\n}\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nloop through every cast, clean, & save\ncombined_df &lt;- data.frame()\nfor (i in seq(ctd_FK)){\n  tryCatch({\n    cast &lt;- ctd_FK[[i]]  # 1 is selecting only the first sublist\n    \n    # print(class(cast))\n    # clean cast \n    trimmed_cast &lt;- ctdTrim(cast)\n    decimated_cast &lt;- ctdDecimate(trimmed_cast, p = 0.5)  # binned to 0.5 m\n    \n    # convert to df\n    cast_df &lt;- as.data.frame(decimated_cast@data)\n    \n    # Add metadata\n    # assumes station ID and cruise ID the same for all & just uses 1st one\n    cast_df &lt;- mutate(\n      cast_df,\n      station = cast@data$station[1],\n      cruise_id = cast@data$cruise_id[1]\n    )\n  \n    # drop NA rows left by cleaning\n    cast_df &lt;- subset(cast_df, !is.na(scan))\n    \n    # Append the data to the combined dataframe\n    combined_df &lt;- rbind(combined_df, cast_df)\n  }, error = function(e){\n    print(glue(\"error in cast {cast@metadata$station[1]}\"))\n    print(e)\n  })\n}\n# Save to CSV\nfile_path &lt;- here(glue(\"data/cleaned/{cruise_id}.csv\"))\nwrite.csv(combined_df, file_path, row.names = FALSE)"
  },
  {
    "objectID": "cruise_report/cruise_reports/WS18218.html",
    "href": "cruise_report/cruise_reports/WS18218.html",
    "title": "WS18218",
    "section": "",
    "text": "WS18218\n\n\nsetup\nif (!nzchar(system.file(package = \"librarian\"))) {\n  install.packages(\"librarian\")\n}\n\nlibrarian::shelf(\n  quiet = TRUE,\n  readr, here, fs, ggplot2, glue, \"jiho/castr\", dplyr, oce, patchwork, purrr, tidyr\n)\n\n\n\n\nCode\nsource(here(\"R/cruise_load.R\"))\ncruise_df &lt;- cruise_load(params$cruise_id)\n\n\n\n\nplot depth & pressure vs time elapsed\ntryCatch({\n  plots &lt;- list()\n  \n  for (station_name in unique(cruise_df$station)) {\n    subset_df &lt;- filter(cruise_df, station == station_name)\n    plots[[station_name]] &lt;- ggplot(subset_df, aes(x = time_elapsed)) +\n      geom_point(aes(y = depth), color = \"blue\") +  # Plot depth in blue\n      geom_line(aes(y = sea_water_pressure), color = \"red\") +  # Plot sea water pressure in red\n      ggtitle(glue(\"{station_name}\")) +\n      theme(\n        axis.title.x = element_blank(),\n        axis.title.y = element_blank(),\n        axis.text.x = element_blank(),\n        axis.text.y = element_blank(),\n        axis.ticks.x = element_blank(),\n        axis.ticks.y = element_blank()\n      )  # Remove individual axis titles and text\n  }\n  \n  # drop nulls\n  plots &lt;- purrr::compact(plots)\n  \n  # Combine all plots into a grid\n  combined_plot &lt;- wrap_plots(plots) + \n    plot_layout(ncol = 4) +  # Adjust ncol to set number of columns in the grid\n    plot_annotation(\n      title = \"Depth (blue) and Pressure (red)\",\n      subtitle = \"Each panel represents a different station\",\n      caption = \"Time Elapsed (x-axis) vs Depth & Pressure (y-axis)\"\n    ) +\n    theme(\n      plot.tag = element_text(size = 12, face = \"bold\"),\n      plot.tag.position = \"topleft\",\n      axis.title.x = element_text(margin = margin(t = 10)),\n      axis.title.y = element_text(margin = margin(r = 10))\n    )\n  \n  print(combined_plot)\n}, error = function(er){\n  print(er)\n});\n\n\n&lt;error/rlang_error&gt;\nError in `geom_point()`:\n! Problem while computing aesthetics.\n Error occurred in the 1st layer.\nCaused by error:\n! object 'time_elapsed' not found\n---\nBacktrace:\n     \n  1. base::tryCatch(...)\n  2.  base (local) tryCatchList(expr, classes, parentenv, handlers)\n  3.    base (local) tryCatchOne(expr, names, parentenv, handlers[[1L]])\n  4.      base (local) doTryCatch(return(expr), name, parentenv, handler)\n  5. base::print(combined_plot)\n  6. patchwork:::print.patchwork(combined_plot)\n  7.   patchwork:::build_patchwork(plot, plot$layout$guides %||% \"auto\")\n  8.     base::lapply(x$plots, plot_table, guides = guides)\n  9.       patchwork (local) FUN(X[[i]], ...)\n 10.       patchwork:::plot_table.ggplot(X[[i]], ...)\n 11.         ggplot2::ggplotGrob(x)\n 12.           ggplot2::ggplot_gtable(ggplot_build(x))\n 13.            ggplot2:::attach_plot_env(data$plot$plot_env)\n 14.              base::options(ggplot2_plot_env = env)\n 15.           ggplot2::ggplot_build(x)\n 16.           ggplot2:::ggplot_build.ggplot(x)\n 17.             ggplot2:::by_layer(...)\n 18.               rlang::try_fetch(...)\n 19.                base::tryCatch(...)\n 20.                 base (local) tryCatchList(expr, classes, parentenv, handlers)\n 21.                   base (local) tryCatchOne(expr, names, parentenv, handlers[[1L]])\n 22.                     base (local) doTryCatch(return(expr), name, parentenv, handler)\n 23.                base::withCallingHandlers(...)\n 24.               ggplot2 (local) f(l = layers[[i]], d = data[[i]])\n 25.                 l$compute_aesthetics(d, plot)\n 26.                   ggplot2 (local) compute_aesthetics(..., self = self)\n 27.                     base::lapply(aesthetics, eval_tidy, data = data, env = env)\n 28.                       rlang (local) FUN(X[[i]], ...)\n\n\n\n\nplot across all stations\np &lt;- ggplot(cruise_df, aes(x = time, y = depth, fill = station)) +\n  geom_col() +  # This creates the bars\n  # geom_text(aes(label = station), vjust = -0.3) +  # This adds labels to each bar, adjust vjust for position\n  labs(x = \"Time\", y = \"Depth\", title = \"Depth over Time by Station\") +  # Set labels and title\n  theme_minimal()  # Use a minimal theme\nprint(p)\n\n\n\n\n\n\n\n\n\n\n\ncreate oce.ctd objects from dataframes\nctd_load &lt;- function(data, other_params = NULL) {\n  \n  # create csv into ctd object\n  test_ctd &lt;-\n    as.ctd(\n      salinity    = data$sea_water_salinity,\n      temperature = data$sea_water_temperature,\n      pressure    = data$sea_water_pressure,\n      station     = data$station\n    )\n  \n  # add additional columns to ctd object\n  if (!is.null(other_params)) {\n    for (param_name in other_params) {\n      test_ctd &lt;-\n        oceSetData(\n          object = test_ctd,\n          name   = param_name,\n          value  = data[[param_name]]\n        )\n    }\n  }\n  print(glue(\"{data$station[1]}:\\t{length(test_ctd@data$scan)} scans\"))\n\n\n  return(test_ctd)\n}\n\n# Define other parameters to add\nother_params &lt;- c(\n  \"cruise_id\", \"station\", \"time\", \"time_elapsed\", \n  \"latitude\", \"longitude\", \"sea_water_electrical_conductivity\", \n  \"CDOM\", \"dissolved_oxygen\",\"oxygen_saturation\", \"chlorophyll_concentration\", \n  \"chlorophyll_fluorescence\", \"photosynthetically_available_radiation\", \n  \"beam_attenuation\",\"beam_transmission\", \"depth\", \"sea_water_sigma_t\",\n  \"descent_rate\", \"sound_velocity\",\"altimeter\"\n)\n\n# Split data by station and create data list\nctd_FK &lt;- cruise_df %&gt;%\n  split(.$station) %&gt;%\n  map(~ ctd_load(.x, other_params = other_params)) # ~ is a lambda(x)\n\n\n10: 22 scans\n12: 3655 scans\n16: 1505 scans\n18: 3417 scans\n2:  4168 scans\n21/LK:  3511 scans\n30: 3525 scans\n31: 3267 scans\n33: 4721 scans\n41: 2351 scans\n45: 1857 scans\n49: 775 scans\n51: 2606 scans\n53: 1745 scans\n54: 1752 scans\n55: 1924 scans\n56: 39 scans\n57: 1 scans\n57.1:   20 scans\n57.2:   1964 scans\n57.3:   2043 scans\n58: 2614 scans\n59: 2560 scans\n60: 1652 scans\n62: 1661 scans\n64: 632 scans\n65: 40 scans\n68: 15 scans\n7:  2496 scans\n9:  3963 scans\n9.5:    9735 scans\nDECK_TST:   406 scans\nMR: 4172 scans\nWS: 2968 scans\n\n\n\n\nplotting scans for each cast in the first list\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # 1 is selecting only the first sublist\n  # print(i)\n  print(glue(\"=== station: {cast@metadata$station[1]}\"))\n  print(glue(\"# scans: {length(cast@data$scan)}\"))\n  plotScan(cast)\n}\n\n\n=== station: 10\n# scans: 22\n\n\n\n\n\n\n\n\n\n=== station: 12\n# scans: 3655\n\n\n\n\n\n\n\n\n\n=== station: 16\n# scans: 1505\n\n\n\n\n\n\n\n\n\n=== station: 18\n# scans: 3417\n\n\n\n\n\n\n\n\n\n=== station: 2\n# scans: 4168\n\n\n\n\n\n\n\n\n\n=== station: 21/LK\n# scans: 3511\n\n\n\n\n\n\n\n\n\n=== station: 30\n# scans: 3525\n\n\n\n\n\n\n\n\n\n=== station: 31\n# scans: 3267\n\n\n\n\n\n\n\n\n\n=== station: 33\n# scans: 4721\n\n\n\n\n\n\n\n\n\n=== station: 41\n# scans: 2351\n\n\n\n\n\n\n\n\n\n=== station: 45\n# scans: 1857\n\n\n\n\n\n\n\n\n\n=== station: 49\n# scans: 775\n\n\n\n\n\n\n\n\n\n=== station: 51\n# scans: 2606\n\n\n\n\n\n\n\n\n\n=== station: 53\n# scans: 1745\n\n\n\n\n\n\n\n\n\n=== station: 54\n# scans: 1752\n\n\n\n\n\n\n\n\n\n=== station: 55\n# scans: 1924\n\n\n\n\n\n\n\n\n\n=== station: 56\n# scans: 39\n\n\n\n\n\n\n\n\n\n=== station: 57\n# scans: 1\n\n\n\n\n\n\n\n\n\n=== station: 57.1\n# scans: 20\n\n\n\n\n\n\n\n\n\n=== station: 57.2\n# scans: 1964\n\n\n\n\n\n\n\n\n\n=== station: 57.3\n# scans: 2043\n\n\n\n\n\n\n\n\n\n=== station: 58\n# scans: 2614\n\n\n\n\n\n\n\n\n\n=== station: 59\n# scans: 2560\n\n\n\n\n\n\n\n\n\n=== station: 60\n# scans: 1652\n\n\n\n\n\n\n\n\n\n=== station: 62\n# scans: 1661\n\n\n\n\n\n\n\n\n\n=== station: 64\n# scans: 632\n\n\n\n\n\n\n\n\n\n=== station: 65\n# scans: 40\n\n\n\n\n\n\n\n\n\n=== station: 68\n# scans: 15\n\n\n\n\n\n\n\n\n\n=== station: 7\n# scans: 2496\n\n\n\n\n\n\n\n\n\n=== station: 9\n# scans: 3963\n\n\n\n\n\n\n\n\n\n=== station: 9.5\n# scans: 9735\n\n\n\n\n\n\n\n\n\n=== station: DECK_TST\n# scans: 406\n\n\n\n\n\n\n\n\n\n=== station: MR\n# scans: 4172\n\n\n\n\n\n\n\n\n\n=== station: WS\n# scans: 2968\n\n\n\n\n\n\n\n\n\n\n\nplotting each cast in the first list\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # 1 is selecting only the first sublist\n  tryCatch({\n    plot(ctdDecimate(ctdTrim(cast)))\n  }, error = function(e){\n    print(e)\n  })\n}\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3655' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1505' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3417' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4168' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3511' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3525' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3267' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4721' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2351' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1857' in coercion to 'logical(1)'&gt;\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 775' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2606' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1745' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1752' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1924' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 39' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 20' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1964' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2043' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2614' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2560' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1652' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1661' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 40' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 15' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2496' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3963' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 9735' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4172' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2968' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n\n\nplotting other physical parameters for each cast\n# Loop through each CTD cast\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # Assuming each sublist contains only one relevant CTD object\n  tryCatch({\n    # Extract metadata for station name and cruise ID\n    station_name &lt;- cast@metadata$station[1]\n    cruise_id &lt;- cast@data$cruise_id[1]\n\n    # Generate a title with station name and cruise ID\n    overall_title &lt;- glue::glue(\"Station: {station_name}, Cruise ID: {cruise_id}\")\n\n    # Set margins: increase the outer margin for the title\n    par(oma = c(0, 0, 3, 0))  # Top outer margin increased for title\n\n    # Plotting function with specific parameters\n    oce::plot(\n      x = ctdDecimate(ctdTrim(cast)),\n      which = c(\n        \"sea_water_electrical_conductivity\",\n        \"descent_rate\", \"sound_velocity\",\n        \"sea_water_sigma_t\",\"altimeter\"\n      ),\n      main = \"\"  # No main title for individual subplots\n    )\n\n    # Place a single overall title at the top of the plot frame\n    mtext(overall_title, side = 3, line = 1, outer = TRUE, cex = 1.5)\n\n    # Reset outer margins to default\n    par(oma = c(0, 0, 0, 0))\n\n  }, error = function(e) {\n    print(e$message)  # Print any errors that occur during plotting\n  })\n}\n\n\n\n\n\n\n\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"unknown xtype value (\\\"6.020655\\\")\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n\n\nplotting other nutrient parameters for each cast\n# Loop through each CTD cast\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # Assuming each sublist contains only one relevant CTD object\n  tryCatch({\n    # Extract metadata for station name and cruise ID\n    station_name &lt;- cast@metadata$station[1]\n    cruise_id &lt;- cast@data$cruise_id[1]\n\n    # Generate a title with station name and cruise ID\n    overall_title &lt;- glue::glue(\"Station: {station_name}, Cruise ID: {cruise_id}\")\n\n    # Set margins: increase the outer margin for the title\n    par(oma = c(0, 0, 3, 0))  # Top outer margin increased for title\n\n    # Plotting function with specific parameters\n    oce::plot(\n      x = ctdDecimate(ctdTrim(cast)),\n      which = c(\n        \"CDOM\", \"dissolved_oxygen\",\n        \"oxygen_saturation\",\n        \"chlorophyll_concentration\", \"chlorophyll_fluorescence\"\n      ),\n      main = \"\"  # No main title for individual subplots\n    )\n\n    # Place a single overall title at the top of the plot frame\n    mtext(overall_title, side = 3, line = 1, outer = TRUE, cex = 1.5)\n\n    # Reset outer margins to default\n    par(oma = c(0, 0, 0, 0))\n\n  }, error = function(e) {\n    print(e$message)  # Print any errors that occur during plotting\n  })\n}\n\n\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"plot.new has not been called yet\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"plot.new has not been called yet\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n\n\n\n\nplotting other optical parameters for each cast\n# Loop through each CTD cast\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # Assuming each sublist contains only one relevant CTD object\n  tryCatch({\n    # Extract metadata for station name and cruise ID\n    station_name &lt;- cast@metadata$station[1]\n    cruise_id &lt;- cast@data$cruise_id[1]\n\n    # Generate a title with station name and cruise ID\n    overall_title &lt;- glue::glue(\"Station: {station_name}, Cruise ID: {cruise_id}\")\n\n    # Set margins: increase the outer margin for the title\n    par(oma = c(0, 0, 3, 0))  # Top outer margin increased for title\n\n    # Plotting function with specific parameters\n    oce::plot(\n      x = ctdDecimate(ctdTrim(cast)),\n      which = c(\n        \"photosynthetically_available_radiation\",\n        \"beam_attenuation\",\"beam_transmission\"\n      ),\n      main = \"\"  # No main title for individual subplots\n    )\n\n    # Place a single overall title at the top of the plot frame\n    mtext(overall_title, side = 3, line = 1, outer = TRUE, cex = 1.5)\n\n    # Reset outer margins to default\n    par(oma = c(0, 0, 0, 0))\n\n  }, error = function(e) {\n    print(e$message)  # Print any errors that occur during plotting\n  })\n}\n\n\n\n\n\n\n\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"unknown xtype value (\\\"1878.1\\\")\"\n\n\n\n\nloop through every cast, clean, & save\ncombined_df &lt;- data.frame()\nfor (i in seq(ctd_FK)){\n  tryCatch({\n    cast &lt;- ctd_FK[[i]]  # 1 is selecting only the first sublist\n    \n    # print(class(cast))\n    # clean cast \n    trimmed_cast &lt;- ctdTrim(cast)\n    decimated_cast &lt;- ctdDecimate(trimmed_cast, p = 0.5)  # binned to 0.5 m\n    \n    # convert to df\n    cast_df &lt;- as.data.frame(decimated_cast@data)\n    \n    # Add metadata\n    # assumes station ID and cruise ID the same for all & just uses 1st one\n    cast_df &lt;- mutate(\n      cast_df,\n      station = cast@data$station[1],\n      cruise_id = cast@data$cruise_id[1]\n    )\n  \n    # drop NA rows left by cleaning\n    cast_df &lt;- subset(cast_df, !is.na(scan))\n    \n    # Append the data to the combined dataframe\n    combined_df &lt;- rbind(combined_df, cast_df)\n  }, error = function(e){\n    print(glue(\"error in cast {cast@metadata$station[1]}\"))\n    print(e)\n  })\n}\n# Save to CSV\nfile_path &lt;- here(glue(\"data/cleaned/{cruise_id}.csv\"))\nwrite.csv(combined_df, file_path, row.names = FALSE)"
  },
  {
    "objectID": "cruise_report/cruise_reports/WS18008.html",
    "href": "cruise_report/cruise_reports/WS18008.html",
    "title": "WS18008",
    "section": "",
    "text": "WS18008\n\n\nsetup\nif (!nzchar(system.file(package = \"librarian\"))) {\n  install.packages(\"librarian\")\n}\n\nlibrarian::shelf(\n  quiet = TRUE,\n  readr, here, fs, ggplot2, glue, \"jiho/castr\", dplyr, oce, patchwork, purrr, tidyr\n)\n\n\n\n\nCode\nsource(here(\"R/cruise_load.R\"))\ncruise_df &lt;- cruise_load(params$cruise_id)\n\n\n\n\nplot depth & pressure vs time elapsed\ntryCatch({\n  plots &lt;- list()\n  \n  for (station_name in unique(cruise_df$station)) {\n    subset_df &lt;- filter(cruise_df, station == station_name)\n    plots[[station_name]] &lt;- ggplot(subset_df, aes(x = time_elapsed)) +\n      geom_point(aes(y = depth), color = \"blue\") +  # Plot depth in blue\n      geom_line(aes(y = sea_water_pressure), color = \"red\") +  # Plot sea water pressure in red\n      ggtitle(glue(\"{station_name}\")) +\n      theme(\n        axis.title.x = element_blank(),\n        axis.title.y = element_blank(),\n        axis.text.x = element_blank(),\n        axis.text.y = element_blank(),\n        axis.ticks.x = element_blank(),\n        axis.ticks.y = element_blank()\n      )  # Remove individual axis titles and text\n  }\n  \n  # drop nulls\n  plots &lt;- purrr::compact(plots)\n  \n  # Combine all plots into a grid\n  combined_plot &lt;- wrap_plots(plots) + \n    plot_layout(ncol = 4) +  # Adjust ncol to set number of columns in the grid\n    plot_annotation(\n      title = \"Depth (blue) and Pressure (red)\",\n      subtitle = \"Each panel represents a different station\",\n      caption = \"Time Elapsed (x-axis) vs Depth & Pressure (y-axis)\"\n    ) +\n    theme(\n      plot.tag = element_text(size = 12, face = \"bold\"),\n      plot.tag.position = \"topleft\",\n      axis.title.x = element_text(margin = margin(t = 10)),\n      axis.title.y = element_text(margin = margin(r = 10))\n    )\n  \n  print(combined_plot)\n}, error = function(er){\n  print(er)\n});\n\n\n&lt;error/rlang_error&gt;\nError in `geom_point()`:\n! Problem while computing aesthetics.\n Error occurred in the 1st layer.\nCaused by error:\n! object 'time_elapsed' not found\n---\nBacktrace:\n     \n  1. base::tryCatch(...)\n  2.  base (local) tryCatchList(expr, classes, parentenv, handlers)\n  3.    base (local) tryCatchOne(expr, names, parentenv, handlers[[1L]])\n  4.      base (local) doTryCatch(return(expr), name, parentenv, handler)\n  5. base::print(combined_plot)\n  6. patchwork:::print.patchwork(combined_plot)\n  7.   patchwork:::build_patchwork(plot, plot$layout$guides %||% \"auto\")\n  8.     base::lapply(x$plots, plot_table, guides = guides)\n  9.       patchwork (local) FUN(X[[i]], ...)\n 10.       patchwork:::plot_table.ggplot(X[[i]], ...)\n 11.         ggplot2::ggplotGrob(x)\n 12.           ggplot2::ggplot_gtable(ggplot_build(x))\n 13.            ggplot2:::attach_plot_env(data$plot$plot_env)\n 14.              base::options(ggplot2_plot_env = env)\n 15.           ggplot2::ggplot_build(x)\n 16.           ggplot2:::ggplot_build.ggplot(x)\n 17.             ggplot2:::by_layer(...)\n 18.               rlang::try_fetch(...)\n 19.                base::tryCatch(...)\n 20.                 base (local) tryCatchList(expr, classes, parentenv, handlers)\n 21.                   base (local) tryCatchOne(expr, names, parentenv, handlers[[1L]])\n 22.                     base (local) doTryCatch(return(expr), name, parentenv, handler)\n 23.                base::withCallingHandlers(...)\n 24.               ggplot2 (local) f(l = layers[[i]], d = data[[i]])\n 25.                 l$compute_aesthetics(d, plot)\n 26.                   ggplot2 (local) compute_aesthetics(..., self = self)\n 27.                     base::lapply(aesthetics, eval_tidy, data = data, env = env)\n 28.                       rlang (local) FUN(X[[i]], ...)\n\n\n\n\nplot across all stations\np &lt;- ggplot(cruise_df, aes(x = time, y = depth, fill = station)) +\n  geom_col() +  # This creates the bars\n  # geom_text(aes(label = station), vjust = -0.3) +  # This adds labels to each bar, adjust vjust for position\n  labs(x = \"Time\", y = \"Depth\", title = \"Depth over Time by Station\") +  # Set labels and title\n  theme_minimal()  # Use a minimal theme\nprint(p)\n\n\n\n\n\n\n\n\n\n\n\ncreate oce.ctd objects from dataframes\nctd_load &lt;- function(data, other_params = NULL) {\n  \n  # create csv into ctd object\n  test_ctd &lt;-\n    as.ctd(\n      salinity    = data$sea_water_salinity,\n      temperature = data$sea_water_temperature,\n      pressure    = data$sea_water_pressure,\n      station     = data$station\n    )\n  \n  # add additional columns to ctd object\n  if (!is.null(other_params)) {\n    for (param_name in other_params) {\n      test_ctd &lt;-\n        oceSetData(\n          object = test_ctd,\n          name   = param_name,\n          value  = data[[param_name]]\n        )\n    }\n  }\n  print(glue(\"{data$station[1]}:\\t{length(test_ctd@data$scan)} scans\"))\n\n\n  return(test_ctd)\n}\n\n# Define other parameters to add\nother_params &lt;- c(\n  \"cruise_id\", \"station\", \"time\", \"time_elapsed\", \n  \"latitude\", \"longitude\", \"sea_water_electrical_conductivity\", \n  \"CDOM\", \"dissolved_oxygen\",\"oxygen_saturation\", \"chlorophyll_concentration\", \n  \"chlorophyll_fluorescence\", \"photosynthetically_available_radiation\", \n  \"beam_attenuation\",\"beam_transmission\", \"depth\", \"sea_water_sigma_t\",\n  \"descent_rate\", \"sound_velocity\",\"altimeter\"\n)\n\n# Split data by station and create data list\nctd_FK &lt;- cruise_df %&gt;%\n  split(.$station) %&gt;%\n  map(~ ctd_load(.x, other_params = other_params)) # ~ is a lambda(x)\n\n\n10: 2865 scans\n12: 2494 scans\n16: 1062 scans\n18: 3144 scans\n21/LK:  2104 scans\n30: 2988 scans\n31: 2649 scans\n33: 1919 scans\n41: 1216 scans\n45: 1249 scans\n49: 3449 scans\n49A:    17027 scans\n51: 1501 scans\n53: 1493 scans\n54: 2250 scans\n55: 3308 scans\n56: 3478 scans\n57: 1057 scans\n57.1:   1960 scans\n57.2:   3990 scans\n57.3:   1349 scans\n58: 1231 scans\n59: 1478 scans\n60: 1421 scans\n62: 1459 scans\n64: 1453 scans\n65: 1339 scans\n68: 6921 scans\n7:  2228 scans\n9:  3379 scans\n9.5:    8463 scans\nDECK_TST:   22 scans\nMR: 2575 scans\nWS: 1735 scans\n\n\n\n\nplotting scans for each cast in the first list\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # 1 is selecting only the first sublist\n  # print(i)\n  print(glue(\"=== station: {cast@metadata$station[1]}\"))\n  print(glue(\"# scans: {length(cast@data$scan)}\"))\n  plotScan(cast)\n}\n\n\n=== station: 10\n# scans: 2865\n\n\n\n\n\n\n\n\n\n=== station: 12\n# scans: 2494\n\n\n\n\n\n\n\n\n\n=== station: 16\n# scans: 1062\n\n\n\n\n\n\n\n\n\n=== station: 18\n# scans: 3144\n\n\n\n\n\n\n\n\n\n=== station: 21/LK\n# scans: 2104\n\n\n\n\n\n\n\n\n\n=== station: 30\n# scans: 2988\n\n\n\n\n\n\n\n\n\n=== station: 31\n# scans: 2649\n\n\n\n\n\n\n\n\n\n=== station: 33\n# scans: 1919\n\n\n\n\n\n\n\n\n\n=== station: 41\n# scans: 1216\n\n\n\n\n\n\n\n\n\n=== station: 45\n# scans: 1249\n\n\n\n\n\n\n\n\n\n=== station: 49\n# scans: 3449\n\n\n\n\n\n\n\n\n\n=== station: 49A\n# scans: 17027\n\n\n\n\n\n\n\n\n\n=== station: 51\n# scans: 1501\n\n\n\n\n\n\n\n\n\n=== station: 53\n# scans: 1493\n\n\n\n\n\n\n\n\n\n=== station: 54\n# scans: 2250\n\n\n\n\n\n\n\n\n\n=== station: 55\n# scans: 3308\n\n\n\n\n\n\n\n\n\n=== station: 56\n# scans: 3478\n\n\n\n\n\n\n\n\n\n=== station: 57\n# scans: 1057\n\n\n\n\n\n\n\n\n\n=== station: 57.1\n# scans: 1960\n\n\n\n\n\n\n\n\n\n=== station: 57.2\n# scans: 3990\n\n\n\n\n\n\n\n\n\n=== station: 57.3\n# scans: 1349\n\n\n\n\n\n\n\n\n\n=== station: 58\n# scans: 1231\n\n\n\n\n\n\n\n\n\n=== station: 59\n# scans: 1478\n\n\n\n\n\n\n\n\n\n=== station: 60\n# scans: 1421\n\n\n\n\n\n\n\n\n\n=== station: 62\n# scans: 1459\n\n\n\n\n\n\n\n\n\n=== station: 64\n# scans: 1453\n\n\n\n\n\n\n\n\n\n=== station: 65\n# scans: 1339\n\n\n\n\n\n\n\n\n\n=== station: 68\n# scans: 6921\n\n\n\n\n\n\n\n\n\n=== station: 7\n# scans: 2228\n\n\n\n\n\n\n\n\n\n=== station: 9\n# scans: 3379\n\n\n\n\n\n\n\n\n\n=== station: 9.5\n# scans: 8463\n\n\n\n\n\n\n\n\n\n=== station: DECK_TST\n# scans: 22\n\n\n\n\n\n\n\n\n\n=== station: MR\n# scans: 2575\n\n\n\n\n\n\n\n\n\n=== station: WS\n# scans: 1735\n\n\n\n\n\n\n\n\n\n\n\nplotting each cast in the first list\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # 1 is selecting only the first sublist\n  tryCatch({\n    plot(ctdDecimate(ctdTrim(cast)))\n  }, error = function(e){\n    print(e)\n  })\n}\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2865' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2494' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1062' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3144' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2104' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2988' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2649' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1919' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1216' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1249' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3449' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 17027' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1501' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1493' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2250' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3308' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3478' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1057' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1960' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3990' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1349' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1231' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1478' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1421' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1459' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1453' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 6921' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2228' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3379' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 8463' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2575' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1735' in coercion to 'logical(1)'&gt;\n\n\n\n\nplotting other physical parameters for each cast\n# Loop through each CTD cast\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # Assuming each sublist contains only one relevant CTD object\n  tryCatch({\n    # Extract metadata for station name and cruise ID\n    station_name &lt;- cast@metadata$station[1]\n    cruise_id &lt;- cast@data$cruise_id[1]\n\n    # Generate a title with station name and cruise ID\n    overall_title &lt;- glue::glue(\"Station: {station_name}, Cruise ID: {cruise_id}\")\n\n    # Set margins: increase the outer margin for the title\n    par(oma = c(0, 0, 3, 0))  # Top outer margin increased for title\n\n    # Plotting function with specific parameters\n    oce::plot(\n      x = ctdDecimate(ctdTrim(cast)),\n      which = c(\n        \"sea_water_electrical_conductivity\",\n        \"descent_rate\", \"sound_velocity\",\n        \"sea_water_sigma_t\",\"altimeter\"\n      ),\n      main = \"\"  # No main title for individual subplots\n    )\n\n    # Place a single overall title at the top of the plot frame\n    mtext(overall_title, side = 3, line = 1, outer = TRUE, cex = 1.5)\n\n    # Reset outer margins to default\n    par(oma = c(0, 0, 0, 0))\n\n  }, error = function(e) {\n    print(e$message)  # Print any errors that occur during plotting\n  })\n}\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n\n\nplotting other nutrient parameters for each cast\n# Loop through each CTD cast\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # Assuming each sublist contains only one relevant CTD object\n  tryCatch({\n    # Extract metadata for station name and cruise ID\n    station_name &lt;- cast@metadata$station[1]\n    cruise_id &lt;- cast@data$cruise_id[1]\n\n    # Generate a title with station name and cruise ID\n    overall_title &lt;- glue::glue(\"Station: {station_name}, Cruise ID: {cruise_id}\")\n\n    # Set margins: increase the outer margin for the title\n    par(oma = c(0, 0, 3, 0))  # Top outer margin increased for title\n\n    # Plotting function with specific parameters\n    oce::plot(\n      x = ctdDecimate(ctdTrim(cast)),\n      which = c(\n        \"CDOM\", \"dissolved_oxygen\",\n        \"oxygen_saturation\",\n        \"chlorophyll_concentration\", \"chlorophyll_fluorescence\"\n      ),\n      main = \"\"  # No main title for individual subplots\n    )\n\n    # Place a single overall title at the top of the plot frame\n    mtext(overall_title, side = 3, line = 1, outer = TRUE, cex = 1.5)\n\n    # Reset outer margins to default\n    par(oma = c(0, 0, 0, 0))\n\n  }, error = function(e) {\n    print(e$message)  # Print any errors that occur during plotting\n  })\n}\n\n\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"plot.new has not been called yet\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n\n\n\n\nplotting other optical parameters for each cast\n# Loop through each CTD cast\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # Assuming each sublist contains only one relevant CTD object\n  tryCatch({\n    # Extract metadata for station name and cruise ID\n    station_name &lt;- cast@metadata$station[1]\n    cruise_id &lt;- cast@data$cruise_id[1]\n\n    # Generate a title with station name and cruise ID\n    overall_title &lt;- glue::glue(\"Station: {station_name}, Cruise ID: {cruise_id}\")\n\n    # Set margins: increase the outer margin for the title\n    par(oma = c(0, 0, 3, 0))  # Top outer margin increased for title\n\n    # Plotting function with specific parameters\n    oce::plot(\n      x = ctdDecimate(ctdTrim(cast)),\n      which = c(\n        \"photosynthetically_available_radiation\",\n        \"beam_attenuation\",\"beam_transmission\"\n      ),\n      main = \"\"  # No main title for individual subplots\n    )\n\n    # Place a single overall title at the top of the plot frame\n    mtext(overall_title, side = 3, line = 1, outer = TRUE, cex = 1.5)\n\n    # Reset outer margins to default\n    par(oma = c(0, 0, 0, 0))\n\n  }, error = function(e) {\n    print(e$message)  # Print any errors that occur during plotting\n  })\n}\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n[1] \"need finite 'xlim' values\"\n\n\n\n\nloop through every cast, clean, & save\ncombined_df &lt;- data.frame()\nfor (i in seq(ctd_FK)){\n  tryCatch({\n    cast &lt;- ctd_FK[[i]]  # 1 is selecting only the first sublist\n    \n    # print(class(cast))\n    # clean cast \n    trimmed_cast &lt;- ctdTrim(cast)\n    decimated_cast &lt;- ctdDecimate(trimmed_cast, p = 0.5)  # binned to 0.5 m\n    \n    # convert to df\n    cast_df &lt;- as.data.frame(decimated_cast@data)\n    \n    # Add metadata\n    # assumes station ID and cruise ID the same for all & just uses 1st one\n    cast_df &lt;- mutate(\n      cast_df,\n      station = cast@data$station[1],\n      cruise_id = cast@data$cruise_id[1]\n    )\n  \n    # drop NA rows left by cleaning\n    cast_df &lt;- subset(cast_df, !is.na(scan))\n    \n    # Append the data to the combined dataframe\n    combined_df &lt;- rbind(combined_df, cast_df)\n  }, error = function(e){\n    print(glue(\"error in cast {cast@metadata$station[1]}\"))\n    print(e)\n  })\n}\n# Save to CSV\nfile_path &lt;- here(glue(\"data/cleaned/{cruise_id}.csv\"))\nwrite.csv(combined_df, file_path, row.names = FALSE)"
  },
  {
    "objectID": "cruise_report/cruise_reports/WS17212.html",
    "href": "cruise_report/cruise_reports/WS17212.html",
    "title": "WS17212",
    "section": "",
    "text": "WS17212\n\n\nsetup\nif (!nzchar(system.file(package = \"librarian\"))) {\n  install.packages(\"librarian\")\n}\n\nlibrarian::shelf(\n  quiet = TRUE,\n  readr, here, fs, ggplot2, glue, \"jiho/castr\", dplyr, oce, patchwork, purrr, tidyr\n)\n\n\n\n\nCode\nsource(here(\"R/cruise_load.R\"))\ncruise_df &lt;- cruise_load(params$cruise_id)\n\n\n\n\nplot depth & pressure vs time elapsed\ntryCatch({\n  plots &lt;- list()\n  \n  for (station_name in unique(cruise_df$station)) {\n    subset_df &lt;- filter(cruise_df, station == station_name)\n    plots[[station_name]] &lt;- ggplot(subset_df, aes(x = time_elapsed)) +\n      geom_point(aes(y = depth), color = \"blue\") +  # Plot depth in blue\n      geom_line(aes(y = sea_water_pressure), color = \"red\") +  # Plot sea water pressure in red\n      ggtitle(glue(\"{station_name}\")) +\n      theme(\n        axis.title.x = element_blank(),\n        axis.title.y = element_blank(),\n        axis.text.x = element_blank(),\n        axis.text.y = element_blank(),\n        axis.ticks.x = element_blank(),\n        axis.ticks.y = element_blank()\n      )  # Remove individual axis titles and text\n  }\n  \n  # drop nulls\n  plots &lt;- purrr::compact(plots)\n  \n  # Combine all plots into a grid\n  combined_plot &lt;- wrap_plots(plots) + \n    plot_layout(ncol = 4) +  # Adjust ncol to set number of columns in the grid\n    plot_annotation(\n      title = \"Depth (blue) and Pressure (red)\",\n      subtitle = \"Each panel represents a different station\",\n      caption = \"Time Elapsed (x-axis) vs Depth & Pressure (y-axis)\"\n    ) +\n    theme(\n      plot.tag = element_text(size = 12, face = \"bold\"),\n      plot.tag.position = \"topleft\",\n      axis.title.x = element_text(margin = margin(t = 10)),\n      axis.title.y = element_text(margin = margin(r = 10))\n    )\n  \n  print(combined_plot)\n}, error = function(er){\n  print(er)\n});\n\n\n&lt;error/rlang_error&gt;\nError in `geom_point()`:\n! Problem while computing aesthetics.\n Error occurred in the 1st layer.\nCaused by error:\n! object 'time_elapsed' not found\n---\nBacktrace:\n     \n  1. base::tryCatch(...)\n  2.  base (local) tryCatchList(expr, classes, parentenv, handlers)\n  3.    base (local) tryCatchOne(expr, names, parentenv, handlers[[1L]])\n  4.      base (local) doTryCatch(return(expr), name, parentenv, handler)\n  5. base::print(combined_plot)\n  6. patchwork:::print.patchwork(combined_plot)\n  7.   patchwork:::build_patchwork(plot, plot$layout$guides %||% \"auto\")\n  8.     base::lapply(x$plots, plot_table, guides = guides)\n  9.       patchwork (local) FUN(X[[i]], ...)\n 10.       patchwork:::plot_table.ggplot(X[[i]], ...)\n 11.         ggplot2::ggplotGrob(x)\n 12.           ggplot2::ggplot_gtable(ggplot_build(x))\n 13.            ggplot2:::attach_plot_env(data$plot$plot_env)\n 14.              base::options(ggplot2_plot_env = env)\n 15.           ggplot2::ggplot_build(x)\n 16.           ggplot2:::ggplot_build.ggplot(x)\n 17.             ggplot2:::by_layer(...)\n 18.               rlang::try_fetch(...)\n 19.                base::tryCatch(...)\n 20.                 base (local) tryCatchList(expr, classes, parentenv, handlers)\n 21.                   base (local) tryCatchOne(expr, names, parentenv, handlers[[1L]])\n 22.                     base (local) doTryCatch(return(expr), name, parentenv, handler)\n 23.                base::withCallingHandlers(...)\n 24.               ggplot2 (local) f(l = layers[[i]], d = data[[i]])\n 25.                 l$compute_aesthetics(d, plot)\n 26.                   ggplot2 (local) compute_aesthetics(..., self = self)\n 27.                     base::lapply(aesthetics, eval_tidy, data = data, env = env)\n 28.                       rlang (local) FUN(X[[i]], ...)\n\n\n\n\nplot across all stations\np &lt;- ggplot(cruise_df, aes(x = time, y = depth, fill = station)) +\n  geom_col() +  # This creates the bars\n  # geom_text(aes(label = station), vjust = -0.3) +  # This adds labels to each bar, adjust vjust for position\n  labs(x = \"Time\", y = \"Depth\", title = \"Depth over Time by Station\") +  # Set labels and title\n  theme_minimal()  # Use a minimal theme\nprint(p)\n\n\nWarning: Removed 10 rows containing missing values or values outside the scale range\n(`geom_col()`).\n\n\n\n\n\n\n\n\n\n\n\ncreate oce.ctd objects from dataframes\nctd_load &lt;- function(data, other_params = NULL) {\n  \n  # create csv into ctd object\n  test_ctd &lt;-\n    as.ctd(\n      salinity    = data$sea_water_salinity,\n      temperature = data$sea_water_temperature,\n      pressure    = data$sea_water_pressure,\n      station     = data$station\n    )\n  \n  # add additional columns to ctd object\n  if (!is.null(other_params)) {\n    for (param_name in other_params) {\n      test_ctd &lt;-\n        oceSetData(\n          object = test_ctd,\n          name   = param_name,\n          value  = data[[param_name]]\n        )\n    }\n  }\n  print(glue(\"{data$station[1]}:\\t{length(test_ctd@data$scan)} scans\"))\n\n\n  return(test_ctd)\n}\n\n# Define other parameters to add\nother_params &lt;- c(\n  \"cruise_id\", \"station\", \"time\", \"time_elapsed\", \n  \"latitude\", \"longitude\", \"sea_water_electrical_conductivity\", \n  \"CDOM\", \"dissolved_oxygen\",\"oxygen_saturation\", \"chlorophyll_concentration\", \n  \"chlorophyll_fluorescence\", \"photosynthetically_available_radiation\", \n  \"beam_attenuation\",\"beam_transmission\", \"depth\", \"sea_water_sigma_t\",\n  \"descent_rate\", \"sound_velocity\",\"altimeter\"\n)\n\n# Split data by station and create data list\nctd_FK &lt;- cruise_df %&gt;%\n  split(.$station) %&gt;%\n  map(~ ctd_load(.x, other_params = other_params)) # ~ is a lambda(x)\n\n\n10: 1527 scans\n12: 3222 scans\n16: 457 scans\n18: 3459 scans\n2:  2107 scans\n21/LK:  1674 scans\n30: 3395 scans\n31: 1934 scans\n33: 1617 scans\n41: 1294 scans\n45: 1309 scans\n54: 823 scans\n55: 130 scans\n56: 981 scans\n57: 1250 scans\n57.1:   719 scans\n57.1B:  1489 scans\n57.2:   1632 scans\n57.2B:  2294 scans\n57.3:   1618 scans\n57.3_2: 1038 scans\n57B:    1701 scans\n60: 1331 scans\n62: 1072 scans\n64: 79 scans\n65: 95 scans\n68: 51 scans\n7:  2341 scans\n9:  3433 scans\n9.5:    7575 scans\nDECK_TST:   999 scans\nDECK_TST2:  4 scans\nMR: 3933 scans\nWS: 2379 scans\n\n\n\n\nplotting scans for each cast in the first list\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # 1 is selecting only the first sublist\n  # print(i)\n  print(glue(\"=== station: {cast@metadata$station[1]}\"))\n  print(glue(\"# scans: {length(cast@data$scan)}\"))\n  plotScan(cast)\n}\n\n\n=== station: 10\n# scans: 1527\n\n\n\n\n\n\n\n\n\n=== station: 12\n# scans: 3222\n\n\n\n\n\n\n\n\n\n=== station: 16\n# scans: 457\n\n\n\n\n\n\n\n\n\n=== station: 18\n# scans: 3459\n\n\n\n\n\n\n\n\n\n=== station: 2\n# scans: 2107\n\n\n\n\n\n\n\n\n\n=== station: 21/LK\n# scans: 1674\n\n\n\n\n\n\n\n\n\n=== station: 30\n# scans: 3395\n\n\n\n\n\n\n\n\n\n=== station: 31\n# scans: 1934\n\n\n\n\n\n\n\n\n\n=== station: 33\n# scans: 1617\n\n\n\n\n\n\n\n\n\n=== station: 41\n# scans: 1294\n\n\n\n\n\n\n\n\n\n=== station: 45\n# scans: 1309\n\n\n\n\n\n\n\n\n\n=== station: 54\n# scans: 823\n\n\n\n\n\n\n\n\n\n=== station: 55\n# scans: 130\n\n\n\n\n\n\n\n\n\n=== station: 56\n# scans: 981\n\n\n\n\n\n\n\n\n\n=== station: 57\n# scans: 1250\n\n\n\n\n\n\n\n\n\n=== station: 57.1\n# scans: 719\n\n\n\n\n\n\n\n\n\n=== station: 57.1B\n# scans: 1489\n\n\n\n\n\n\n\n\n\n=== station: 57.2\n# scans: 1632\n\n\n\n\n\n\n\n\n\n=== station: 57.2B\n# scans: 2294\n\n\n\n\n\n\n\n\n\n=== station: 57.3\n# scans: 1618\n\n\n\n\n\n\n\n\n\n=== station: 57.3_2\n# scans: 1038\n\n\n\n\n\n\n\n\n\n=== station: 57B\n# scans: 1701\n\n\n\n\n\n\n\n\n\n=== station: 60\n# scans: 1331\n\n\n\n\n\n\n\n\n\n=== station: 62\n# scans: 1072\n\n\n\n\n\n\n\n\n\n=== station: 64\n# scans: 79\n\n\n\n\n\n\n\n\n\n=== station: 65\n# scans: 95\n\n\n\n\n\n\n\n\n\n=== station: 68\n# scans: 51\n\n\n\n\n\n\n\n\n\n=== station: 7\n# scans: 2341\n\n\n\n\n\n\n\n\n\n=== station: 9\n# scans: 3433\n\n\n\n\n\n\n\n\n\n=== station: 9.5\n# scans: 7575\n\n\n\n\n\n\n\n\n\n=== station: DECK_TST\n# scans: 999\n\n\n\n\n\n\n\n\n\n=== station: DECK_TST2\n# scans: 4\n\n\n\n\n\n\n\n\n\n=== station: MR\n# scans: 3933\n\n\n\n\n\n\n\n\n\n=== station: WS\n# scans: 2379\n\n\n\n\n\n\n\n\n\n\n\nplotting each cast in the first list\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # 1 is selecting only the first sublist\n  tryCatch({\n    plot(ctdDecimate(ctdTrim(cast)))\n  }, error = function(e){\n    print(e)\n  })\n}\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1527' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3222' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3459' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2107' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1674' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3395' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1934' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1617' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1294' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1309' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 823' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 981' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1250' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 719' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1489' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1632' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2294' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1618' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1038' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1701' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1331' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1072' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 95' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2341' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3433' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 7575' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3933' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2379' in coercion to 'logical(1)'&gt;\n\n\n\n\nplotting other physical parameters for each cast\n# Loop through each CTD cast\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # Assuming each sublist contains only one relevant CTD object\n  tryCatch({\n    # Extract metadata for station name and cruise ID\n    station_name &lt;- cast@metadata$station[1]\n    cruise_id &lt;- cast@data$cruise_id[1]\n\n    # Generate a title with station name and cruise ID\n    overall_title &lt;- glue::glue(\"Station: {station_name}, Cruise ID: {cruise_id}\")\n\n    # Set margins: increase the outer margin for the title\n    par(oma = c(0, 0, 3, 0))  # Top outer margin increased for title\n\n    # Plotting function with specific parameters\n    oce::plot(\n      x = ctdDecimate(ctdTrim(cast)),\n      which = c(\n        \"sea_water_electrical_conductivity\",\n        \"descent_rate\", \"sound_velocity\",\n        \"sea_water_sigma_t\",\"altimeter\"\n      ),\n      main = \"\"  # No main title for individual subplots\n    )\n\n    # Place a single overall title at the top of the plot frame\n    mtext(overall_title, side = 3, line = 1, outer = TRUE, cex = 1.5)\n\n    # Reset outer margins to default\n    par(oma = c(0, 0, 0, 0))\n\n  }, error = function(e) {\n    print(e$message)  # Print any errors that occur during plotting\n  })\n}\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"missing value where TRUE/FALSE needed\"\n\n\n\n\nplotting other nutrient parameters for each cast\n# Loop through each CTD cast\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # Assuming each sublist contains only one relevant CTD object\n  tryCatch({\n    # Extract metadata for station name and cruise ID\n    station_name &lt;- cast@metadata$station[1]\n    cruise_id &lt;- cast@data$cruise_id[1]\n\n    # Generate a title with station name and cruise ID\n    overall_title &lt;- glue::glue(\"Station: {station_name}, Cruise ID: {cruise_id}\")\n\n    # Set margins: increase the outer margin for the title\n    par(oma = c(0, 0, 3, 0))  # Top outer margin increased for title\n\n    # Plotting function with specific parameters\n    oce::plot(\n      x = ctdDecimate(ctdTrim(cast)),\n      which = c(\n        \"CDOM\", \"dissolved_oxygen\",\n        \"oxygen_saturation\",\n        \"chlorophyll_concentration\", \"chlorophyll_fluorescence\"\n      ),\n      main = \"\"  # No main title for individual subplots\n    )\n\n    # Place a single overall title at the top of the plot frame\n    mtext(overall_title, side = 3, line = 1, outer = TRUE, cex = 1.5)\n\n    # Reset outer margins to default\n    par(oma = c(0, 0, 0, 0))\n\n  }, error = function(e) {\n    print(e$message)  # Print any errors that occur during plotting\n  })\n}\n\n\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"plot.new has not been called yet\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"plot.new has not been called yet\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"plot.new has not been called yet\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n\n\n\n\nplotting other optical parameters for each cast\n# Loop through each CTD cast\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # Assuming each sublist contains only one relevant CTD object\n  tryCatch({\n    # Extract metadata for station name and cruise ID\n    station_name &lt;- cast@metadata$station[1]\n    cruise_id &lt;- cast@data$cruise_id[1]\n\n    # Generate a title with station name and cruise ID\n    overall_title &lt;- glue::glue(\"Station: {station_name}, Cruise ID: {cruise_id}\")\n\n    # Set margins: increase the outer margin for the title\n    par(oma = c(0, 0, 3, 0))  # Top outer margin increased for title\n\n    # Plotting function with specific parameters\n    oce::plot(\n      x = ctdDecimate(ctdTrim(cast)),\n      which = c(\n        \"photosynthetically_available_radiation\",\n        \"beam_attenuation\",\"beam_transmission\"\n      ),\n      main = \"\"  # No main title for individual subplots\n    )\n\n    # Place a single overall title at the top of the plot frame\n    mtext(overall_title, side = 3, line = 1, outer = TRUE, cex = 1.5)\n\n    # Reset outer margins to default\n    par(oma = c(0, 0, 0, 0))\n\n  }, error = function(e) {\n    print(e$message)  # Print any errors that occur during plotting\n  })\n}\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"missing value where TRUE/FALSE needed\"\n\n\n\n\nloop through every cast, clean, & save\ncombined_df &lt;- data.frame()\nfor (i in seq(ctd_FK)){\n  tryCatch({\n    cast &lt;- ctd_FK[[i]]  # 1 is selecting only the first sublist\n    \n    # print(class(cast))\n    # clean cast \n    trimmed_cast &lt;- ctdTrim(cast)\n    decimated_cast &lt;- ctdDecimate(trimmed_cast, p = 0.5)  # binned to 0.5 m\n    \n    # convert to df\n    cast_df &lt;- as.data.frame(decimated_cast@data)\n    \n    # Add metadata\n    # assumes station ID and cruise ID the same for all & just uses 1st one\n    cast_df &lt;- mutate(\n      cast_df,\n      station = cast@data$station[1],\n      cruise_id = cast@data$cruise_id[1]\n    )\n  \n    # drop NA rows left by cleaning\n    cast_df &lt;- subset(cast_df, !is.na(scan))\n    \n    # Append the data to the combined dataframe\n    combined_df &lt;- rbind(combined_df, cast_df)\n  }, error = function(e){\n    print(glue(\"error in cast {cast@metadata$station[1]}\"))\n    print(e)\n  })\n}\n# Save to CSV\nfile_path &lt;- here(glue(\"data/cleaned/{cruise_id}.csv\"))\nwrite.csv(combined_df, file_path, row.names = FALSE)"
  },
  {
    "objectID": "cruise_report/cruise_reports/WS17086.html",
    "href": "cruise_report/cruise_reports/WS17086.html",
    "title": "WS17086",
    "section": "",
    "text": "WS17086\n\n\nsetup\nif (!nzchar(system.file(package = \"librarian\"))) {\n  install.packages(\"librarian\")\n}\n\nlibrarian::shelf(\n  quiet = TRUE,\n  readr, here, fs, ggplot2, glue, \"jiho/castr\", dplyr, oce, patchwork, purrr, tidyr\n)\n\n\n\n\nCode\nsource(here(\"R/cruise_load.R\"))\ncruise_df &lt;- cruise_load(params$cruise_id)\n\n\n\n\nplot depth & pressure vs time elapsed\ntryCatch({\n  plots &lt;- list()\n  \n  for (station_name in unique(cruise_df$station)) {\n    subset_df &lt;- filter(cruise_df, station == station_name)\n    plots[[station_name]] &lt;- ggplot(subset_df, aes(x = time_elapsed)) +\n      geom_point(aes(y = depth), color = \"blue\") +  # Plot depth in blue\n      geom_line(aes(y = sea_water_pressure), color = \"red\") +  # Plot sea water pressure in red\n      ggtitle(glue(\"{station_name}\")) +\n      theme(\n        axis.title.x = element_blank(),\n        axis.title.y = element_blank(),\n        axis.text.x = element_blank(),\n        axis.text.y = element_blank(),\n        axis.ticks.x = element_blank(),\n        axis.ticks.y = element_blank()\n      )  # Remove individual axis titles and text\n  }\n  \n  # drop nulls\n  plots &lt;- purrr::compact(plots)\n  \n  # Combine all plots into a grid\n  combined_plot &lt;- wrap_plots(plots) + \n    plot_layout(ncol = 4) +  # Adjust ncol to set number of columns in the grid\n    plot_annotation(\n      title = \"Depth (blue) and Pressure (red)\",\n      subtitle = \"Each panel represents a different station\",\n      caption = \"Time Elapsed (x-axis) vs Depth & Pressure (y-axis)\"\n    ) +\n    theme(\n      plot.tag = element_text(size = 12, face = \"bold\"),\n      plot.tag.position = \"topleft\",\n      axis.title.x = element_text(margin = margin(t = 10)),\n      axis.title.y = element_text(margin = margin(r = 10))\n    )\n  \n  print(combined_plot)\n}, error = function(er){\n  print(er)\n});\n\n\n&lt;error/rlang_error&gt;\nError in `geom_point()`:\n! Problem while computing aesthetics.\n Error occurred in the 1st layer.\nCaused by error:\n! object 'time_elapsed' not found\n---\nBacktrace:\n     \n  1. base::tryCatch(...)\n  2.  base (local) tryCatchList(expr, classes, parentenv, handlers)\n  3.    base (local) tryCatchOne(expr, names, parentenv, handlers[[1L]])\n  4.      base (local) doTryCatch(return(expr), name, parentenv, handler)\n  5. base::print(combined_plot)\n  6. patchwork:::print.patchwork(combined_plot)\n  7.   patchwork:::build_patchwork(plot, plot$layout$guides %||% \"auto\")\n  8.     base::lapply(x$plots, plot_table, guides = guides)\n  9.       patchwork (local) FUN(X[[i]], ...)\n 10.       patchwork:::plot_table.ggplot(X[[i]], ...)\n 11.         ggplot2::ggplotGrob(x)\n 12.           ggplot2::ggplot_gtable(ggplot_build(x))\n 13.            ggplot2:::attach_plot_env(data$plot$plot_env)\n 14.              base::options(ggplot2_plot_env = env)\n 15.           ggplot2::ggplot_build(x)\n 16.           ggplot2:::ggplot_build.ggplot(x)\n 17.             ggplot2:::by_layer(...)\n 18.               rlang::try_fetch(...)\n 19.                base::tryCatch(...)\n 20.                 base (local) tryCatchList(expr, classes, parentenv, handlers)\n 21.                   base (local) tryCatchOne(expr, names, parentenv, handlers[[1L]])\n 22.                     base (local) doTryCatch(return(expr), name, parentenv, handler)\n 23.                base::withCallingHandlers(...)\n 24.               ggplot2 (local) f(l = layers[[i]], d = data[[i]])\n 25.                 l$compute_aesthetics(d, plot)\n 26.                   ggplot2 (local) compute_aesthetics(..., self = self)\n 27.                     base::lapply(aesthetics, eval_tidy, data = data, env = env)\n 28.                       rlang (local) FUN(X[[i]], ...)\n\n\n\n\nplot across all stations\np &lt;- ggplot(cruise_df, aes(x = time, y = depth, fill = station)) +\n  geom_col() +  # This creates the bars\n  # geom_text(aes(label = station), vjust = -0.3) +  # This adds labels to each bar, adjust vjust for position\n  labs(x = \"Time\", y = \"Depth\", title = \"Depth over Time by Station\") +  # Set labels and title\n  theme_minimal()  # Use a minimal theme\nprint(p)\n\n\n\n\n\n\n\n\n\n\n\ncreate oce.ctd objects from dataframes\nctd_load &lt;- function(data, other_params = NULL) {\n  \n  # create csv into ctd object\n  test_ctd &lt;-\n    as.ctd(\n      salinity    = data$sea_water_salinity,\n      temperature = data$sea_water_temperature,\n      pressure    = data$sea_water_pressure,\n      station     = data$station\n    )\n  \n  # add additional columns to ctd object\n  if (!is.null(other_params)) {\n    for (param_name in other_params) {\n      test_ctd &lt;-\n        oceSetData(\n          object = test_ctd,\n          name   = param_name,\n          value  = data[[param_name]]\n        )\n    }\n  }\n  print(glue(\"{data$station[1]}:\\t{length(test_ctd@data$scan)} scans\"))\n\n\n  return(test_ctd)\n}\n\n# Define other parameters to add\nother_params &lt;- c(\n  \"cruise_id\", \"station\", \"time\", \"time_elapsed\", \n  \"latitude\", \"longitude\", \"sea_water_electrical_conductivity\", \n  \"CDOM\", \"dissolved_oxygen\",\"oxygen_saturation\", \"chlorophyll_concentration\", \n  \"chlorophyll_fluorescence\", \"photosynthetically_available_radiation\", \n  \"beam_attenuation\",\"beam_transmission\", \"depth\", \"sea_water_sigma_t\",\n  \"descent_rate\", \"sound_velocity\",\"altimeter\"\n)\n\n# Split data by station and create data list\nctd_FK &lt;- cruise_df %&gt;%\n  split(.$station) %&gt;%\n  map(~ ctd_load(.x, other_params = other_params)) # ~ is a lambda(x)\n\n\n10: 1866 scans\n12: 5284 scans\n16: 1726 scans\n18: 6000 scans\n2:  2027 scans\n21/LK:  3474 scans\n3:  4949 scans\n30: 3602 scans\n31: 3717 scans\n33: 1578 scans\n3B: 1053 scans\n41: 1336 scans\n45: 1531 scans\n49: 1824 scans\n51: 1527 scans\n53: 1462 scans\n54: 67 scans\n54B:    531 scans\n55: 1019 scans\n55B:    279 scans\n56: 688 scans\n56B:    176 scans\n57: 1393 scans\n57.1:   880 scans\n57.2:   1671 scans\n57.2B:  1460 scans\n57.3:   1515 scans\n57.3B:  1951 scans\n57.3SURF:   294 scans\n57B:    259 scans\n58: 2960 scans\n59: 2034 scans\n60: 1994 scans\n62: 3 scans\n64: 25 scans\n65: 200 scans\n68: 58 scans\n7:  1273 scans\n9:  5242 scans\n9.5:    15069 scans\nMR: 4462 scans\nMRA:    1380 scans\nWS: 2304 scans\n\n\n\n\nplotting scans for each cast in the first list\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # 1 is selecting only the first sublist\n  # print(i)\n  print(glue(\"=== station: {cast@metadata$station[1]}\"))\n  print(glue(\"# scans: {length(cast@data$scan)}\"))\n  plotScan(cast)\n}\n\n\n=== station: 10\n# scans: 1866\n\n\n\n\n\n\n\n\n\n=== station: 12\n# scans: 5284\n\n\n\n\n\n\n\n\n\n=== station: 16\n# scans: 1726\n\n\n\n\n\n\n\n\n\n=== station: 18\n# scans: 6000\n\n\n\n\n\n\n\n\n\n=== station: 2\n# scans: 2027\n\n\n\n\n\n\n\n\n\n=== station: 21/LK\n# scans: 3474\n\n\n\n\n\n\n\n\n\n=== station: 3\n# scans: 4949\n\n\n\n\n\n\n\n\n\n=== station: 30\n# scans: 3602\n\n\n\n\n\n\n\n\n\n=== station: 31\n# scans: 3717\n\n\n\n\n\n\n\n\n\n=== station: 33\n# scans: 1578\n\n\n\n\n\n\n\n\n\n=== station: 3B\n# scans: 1053\n\n\n\n\n\n\n\n\n\n=== station: 41\n# scans: 1336\n\n\n\n\n\n\n\n\n\n=== station: 45\n# scans: 1531\n\n\n\n\n\n\n\n\n\n=== station: 49\n# scans: 1824\n\n\n\n\n\n\n\n\n\n=== station: 51\n# scans: 1527\n\n\n\n\n\n\n\n\n\n=== station: 53\n# scans: 1462\n\n\n\n\n\n\n\n\n\n=== station: 54\n# scans: 67\n\n\n\n\n\n\n\n\n\n=== station: 54B\n# scans: 531\n\n\n\n\n\n\n\n\n\n=== station: 55\n# scans: 1019\n\n\n\n\n\n\n\n\n\n=== station: 55B\n# scans: 279\n\n\n\n\n\n\n\n\n\n=== station: 56\n# scans: 688\n\n\n\n\n\n\n\n\n\n=== station: 56B\n# scans: 176\n\n\n\n\n\n\n\n\n\n=== station: 57\n# scans: 1393\n\n\n\n\n\n\n\n\n\n=== station: 57.1\n# scans: 880\n\n\n\n\n\n\n\n\n\n=== station: 57.2\n# scans: 1671\n\n\n\n\n\n\n\n\n\n=== station: 57.2B\n# scans: 1460\n\n\n\n\n\n\n\n\n\n=== station: 57.3\n# scans: 1515\n\n\n\n\n\n\n\n\n\n=== station: 57.3B\n# scans: 1951\n\n\n\n\n\n\n\n\n\n=== station: 57.3SURF\n# scans: 294\n\n\n\n\n\n\n\n\n\n=== station: 57B\n# scans: 259\n\n\n\n\n\n\n\n\n\n=== station: 58\n# scans: 2960\n\n\n\n\n\n\n\n\n\n=== station: 59\n# scans: 2034\n\n\n\n\n\n\n\n\n\n=== station: 60\n# scans: 1994\n\n\n\n\n\n\n\n\n\n=== station: 62\n# scans: 3\n\n\n\n\n\n\n\n\n\n=== station: 64\n# scans: 25\n\n\n\n\n\n\n\n\n\n=== station: 65\n# scans: 200\n\n\n\n\n\n\n\n\n\n=== station: 68\n# scans: 58\n\n\n\n\n\n\n\n\n\n=== station: 7\n# scans: 1273\n\n\n\n\n\n\n\n\n\n=== station: 9\n# scans: 5242\n\n\n\n\n\n\n\n\n\n=== station: 9.5\n# scans: 15069\n\n\n\n\n\n\n\n\n\n=== station: MR\n# scans: 4462\n\n\n\n\n\n\n\n\n\n=== station: MRA\n# scans: 1380\n\n\n\n\n\n\n\n\n\n=== station: WS\n# scans: 2304\n\n\n\n\n\n\n\n\n\n\n\nplotting each cast in the first list\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # 1 is selecting only the first sublist\n  tryCatch({\n    plot(ctdDecimate(ctdTrim(cast)))\n  }, error = function(e){\n    print(e)\n  })\n}\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1866' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 5284' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1726' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 6000' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2027' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3474' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4949' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3602' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3717' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1578' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1053' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1336' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1531' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1824' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1527' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1462' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 67' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 531' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1019' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 279' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 688' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 176' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1393' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 880' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1671' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1460' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1515' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1951' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 259' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2960' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2034' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1994' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 25' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1273' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 5242' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 15069' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4462' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1380' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2304' in coercion to 'logical(1)'&gt;\n\n\n\n\nplotting other physical parameters for each cast\n# Loop through each CTD cast\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # Assuming each sublist contains only one relevant CTD object\n  tryCatch({\n    # Extract metadata for station name and cruise ID\n    station_name &lt;- cast@metadata$station[1]\n    cruise_id &lt;- cast@data$cruise_id[1]\n\n    # Generate a title with station name and cruise ID\n    overall_title &lt;- glue::glue(\"Station: {station_name}, Cruise ID: {cruise_id}\")\n\n    # Set margins: increase the outer margin for the title\n    par(oma = c(0, 0, 3, 0))  # Top outer margin increased for title\n\n    # Plotting function with specific parameters\n    oce::plot(\n      x = ctdDecimate(ctdTrim(cast)),\n      which = c(\n        \"sea_water_electrical_conductivity\",\n        \"descent_rate\", \"sound_velocity\",\n        \"sea_water_sigma_t\",\"altimeter\"\n      ),\n      main = \"\"  # No main title for individual subplots\n    )\n\n    # Place a single overall title at the top of the plot frame\n    mtext(overall_title, side = 3, line = 1, outer = TRUE, cex = 1.5)\n\n    # Reset outer margins to default\n    par(oma = c(0, 0, 0, 0))\n\n  }, error = function(e) {\n    print(e$message)  # Print any errors that occur during plotting\n  })\n}\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"unknown xtype value (\\\"2.27342\\\")\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n\n\nplotting other nutrient parameters for each cast\n# Loop through each CTD cast\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # Assuming each sublist contains only one relevant CTD object\n  tryCatch({\n    # Extract metadata for station name and cruise ID\n    station_name &lt;- cast@metadata$station[1]\n    cruise_id &lt;- cast@data$cruise_id[1]\n\n    # Generate a title with station name and cruise ID\n    overall_title &lt;- glue::glue(\"Station: {station_name}, Cruise ID: {cruise_id}\")\n\n    # Set margins: increase the outer margin for the title\n    par(oma = c(0, 0, 3, 0))  # Top outer margin increased for title\n\n    # Plotting function with specific parameters\n    oce::plot(\n      x = ctdDecimate(ctdTrim(cast)),\n      which = c(\n        \"CDOM\", \"dissolved_oxygen\",\n        \"oxygen_saturation\",\n        \"chlorophyll_concentration\", \"chlorophyll_fluorescence\"\n      ),\n      main = \"\"  # No main title for individual subplots\n    )\n\n    # Place a single overall title at the top of the plot frame\n    mtext(overall_title, side = 3, line = 1, outer = TRUE, cex = 1.5)\n\n    # Reset outer margins to default\n    par(oma = c(0, 0, 0, 0))\n\n  }, error = function(e) {\n    print(e$message)  # Print any errors that occur during plotting\n  })\n}\n\n\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"plot.new has not been called yet\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"plot.new has not been called yet\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n\n\n\n\nplotting other optical parameters for each cast\n# Loop through each CTD cast\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # Assuming each sublist contains only one relevant CTD object\n  tryCatch({\n    # Extract metadata for station name and cruise ID\n    station_name &lt;- cast@metadata$station[1]\n    cruise_id &lt;- cast@data$cruise_id[1]\n\n    # Generate a title with station name and cruise ID\n    overall_title &lt;- glue::glue(\"Station: {station_name}, Cruise ID: {cruise_id}\")\n\n    # Set margins: increase the outer margin for the title\n    par(oma = c(0, 0, 3, 0))  # Top outer margin increased for title\n\n    # Plotting function with specific parameters\n    oce::plot(\n      x = ctdDecimate(ctdTrim(cast)),\n      which = c(\n        \"photosynthetically_available_radiation\",\n        \"beam_attenuation\",\"beam_transmission\"\n      ),\n      main = \"\"  # No main title for individual subplots\n    )\n\n    # Place a single overall title at the top of the plot frame\n    mtext(overall_title, side = 3, line = 1, outer = TRUE, cex = 1.5)\n\n    # Reset outer margins to default\n    par(oma = c(0, 0, 0, 0))\n\n  }, error = function(e) {\n    print(e$message)  # Print any errors that occur during plotting\n  })\n}\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"unknown xtype value (\\\"0.40281\\\")\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n\n\nloop through every cast, clean, & save\ncombined_df &lt;- data.frame()\nfor (i in seq(ctd_FK)){\n  tryCatch({\n    cast &lt;- ctd_FK[[i]]  # 1 is selecting only the first sublist\n    \n    # print(class(cast))\n    # clean cast \n    trimmed_cast &lt;- ctdTrim(cast)\n    decimated_cast &lt;- ctdDecimate(trimmed_cast, p = 0.5)  # binned to 0.5 m\n    \n    # convert to df\n    cast_df &lt;- as.data.frame(decimated_cast@data)\n    \n    # Add metadata\n    # assumes station ID and cruise ID the same for all & just uses 1st one\n    cast_df &lt;- mutate(\n      cast_df,\n      station = cast@data$station[1],\n      cruise_id = cast@data$cruise_id[1]\n    )\n  \n    # drop NA rows left by cleaning\n    cast_df &lt;- subset(cast_df, !is.na(scan))\n    \n    # Append the data to the combined dataframe\n    combined_df &lt;- rbind(combined_df, cast_df)\n  }, error = function(e){\n    print(glue(\"error in cast {cast@metadata$station[1]}\"))\n    print(e)\n  })\n}\n# Save to CSV\nfile_path &lt;- here(glue(\"data/cleaned/{cruise_id}.csv\"))\nwrite.csv(combined_df, file_path, row.names = FALSE)"
  },
  {
    "objectID": "cruise_report/cruise_reports/WS16319.html",
    "href": "cruise_report/cruise_reports/WS16319.html",
    "title": "WS16319",
    "section": "",
    "text": "WS16319\n\n\nsetup\nif (!nzchar(system.file(package = \"librarian\"))) {\n  install.packages(\"librarian\")\n}\n\nlibrarian::shelf(\n  quiet = TRUE,\n  readr, here, fs, ggplot2, glue, \"jiho/castr\", dplyr, oce, patchwork, purrr, tidyr\n)\n\n\n\n\nCode\nsource(here(\"R/cruise_load.R\"))\ncruise_df &lt;- cruise_load(params$cruise_id)\n\n\n\n\nplot depth & pressure vs time elapsed\ntryCatch({\n  plots &lt;- list()\n  \n  for (station_name in unique(cruise_df$station)) {\n    subset_df &lt;- filter(cruise_df, station == station_name)\n    plots[[station_name]] &lt;- ggplot(subset_df, aes(x = time_elapsed)) +\n      geom_point(aes(y = depth), color = \"blue\") +  # Plot depth in blue\n      geom_line(aes(y = sea_water_pressure), color = \"red\") +  # Plot sea water pressure in red\n      ggtitle(glue(\"{station_name}\")) +\n      theme(\n        axis.title.x = element_blank(),\n        axis.title.y = element_blank(),\n        axis.text.x = element_blank(),\n        axis.text.y = element_blank(),\n        axis.ticks.x = element_blank(),\n        axis.ticks.y = element_blank()\n      )  # Remove individual axis titles and text\n  }\n  \n  # drop nulls\n  plots &lt;- purrr::compact(plots)\n  \n  # Combine all plots into a grid\n  combined_plot &lt;- wrap_plots(plots) + \n    plot_layout(ncol = 4) +  # Adjust ncol to set number of columns in the grid\n    plot_annotation(\n      title = \"Depth (blue) and Pressure (red)\",\n      subtitle = \"Each panel represents a different station\",\n      caption = \"Time Elapsed (x-axis) vs Depth & Pressure (y-axis)\"\n    ) +\n    theme(\n      plot.tag = element_text(size = 12, face = \"bold\"),\n      plot.tag.position = \"topleft\",\n      axis.title.x = element_text(margin = margin(t = 10)),\n      axis.title.y = element_text(margin = margin(r = 10))\n    )\n  \n  print(combined_plot)\n}, error = function(er){\n  print(er)\n});\n\n\n&lt;error/rlang_error&gt;\nError in `geom_point()`:\n! Problem while computing aesthetics.\n Error occurred in the 1st layer.\nCaused by error:\n! object 'time_elapsed' not found\n---\nBacktrace:\n     \n  1. base::tryCatch(...)\n  2.  base (local) tryCatchList(expr, classes, parentenv, handlers)\n  3.    base (local) tryCatchOne(expr, names, parentenv, handlers[[1L]])\n  4.      base (local) doTryCatch(return(expr), name, parentenv, handler)\n  5. base::print(combined_plot)\n  6. patchwork:::print.patchwork(combined_plot)\n  7.   patchwork:::build_patchwork(plot, plot$layout$guides %||% \"auto\")\n  8.     base::lapply(x$plots, plot_table, guides = guides)\n  9.       patchwork (local) FUN(X[[i]], ...)\n 10.       patchwork:::plot_table.ggplot(X[[i]], ...)\n 11.         ggplot2::ggplotGrob(x)\n 12.           ggplot2::ggplot_gtable(ggplot_build(x))\n 13.            ggplot2:::attach_plot_env(data$plot$plot_env)\n 14.              base::options(ggplot2_plot_env = env)\n 15.           ggplot2::ggplot_build(x)\n 16.           ggplot2:::ggplot_build.ggplot(x)\n 17.             ggplot2:::by_layer(...)\n 18.               rlang::try_fetch(...)\n 19.                base::tryCatch(...)\n 20.                 base (local) tryCatchList(expr, classes, parentenv, handlers)\n 21.                   base (local) tryCatchOne(expr, names, parentenv, handlers[[1L]])\n 22.                     base (local) doTryCatch(return(expr), name, parentenv, handler)\n 23.                base::withCallingHandlers(...)\n 24.               ggplot2 (local) f(l = layers[[i]], d = data[[i]])\n 25.                 l$compute_aesthetics(d, plot)\n 26.                   ggplot2 (local) compute_aesthetics(..., self = self)\n 27.                     base::lapply(aesthetics, eval_tidy, data = data, env = env)\n 28.                       rlang (local) FUN(X[[i]], ...)\n\n\n\n\nplot across all stations\np &lt;- ggplot(cruise_df, aes(x = time, y = depth, fill = station)) +\n  geom_col() +  # This creates the bars\n  # geom_text(aes(label = station), vjust = -0.3) +  # This adds labels to each bar, adjust vjust for position\n  labs(x = \"Time\", y = \"Depth\", title = \"Depth over Time by Station\") +  # Set labels and title\n  theme_minimal()  # Use a minimal theme\nprint(p)\n\n\n\n\n\n\n\n\n\n\n\ncreate oce.ctd objects from dataframes\nctd_load &lt;- function(data, other_params = NULL) {\n  \n  # create csv into ctd object\n  test_ctd &lt;-\n    as.ctd(\n      salinity    = data$sea_water_salinity,\n      temperature = data$sea_water_temperature,\n      pressure    = data$sea_water_pressure,\n      station     = data$station\n    )\n  \n  # add additional columns to ctd object\n  if (!is.null(other_params)) {\n    for (param_name in other_params) {\n      test_ctd &lt;-\n        oceSetData(\n          object = test_ctd,\n          name   = param_name,\n          value  = data[[param_name]]\n        )\n    }\n  }\n  print(glue(\"{data$station[1]}:\\t{length(test_ctd@data$scan)} scans\"))\n\n\n  return(test_ctd)\n}\n\n# Define other parameters to add\nother_params &lt;- c(\n  \"cruise_id\", \"station\", \"time\", \"time_elapsed\", \n  \"latitude\", \"longitude\", \"sea_water_electrical_conductivity\", \n  \"CDOM\", \"dissolved_oxygen\",\"oxygen_saturation\", \"chlorophyll_concentration\", \n  \"chlorophyll_fluorescence\", \"photosynthetically_available_radiation\", \n  \"beam_attenuation\",\"beam_transmission\", \"depth\", \"sea_water_sigma_t\",\n  \"descent_rate\", \"sound_velocity\",\"altimeter\"\n)\n\n# Split data by station and create data list\nctd_FK &lt;- cruise_df %&gt;%\n  split(.$station) %&gt;%\n  map(~ ctd_load(.x, other_params = other_params)) # ~ is a lambda(x)\n\n\n10: 1562 scans\n12: 3689 scans\n16: 964 scans\n18: 3693 scans\n2:  2488 scans\n21/LK:  3614 scans\n30: 2500 scans\n31: 2812 scans\n33: 1368 scans\n41: 991 scans\n45: 1099 scans\n49: 2 scans\n51: 24 scans\n53: 42 scans\n54: 388 scans\n54B:    300 scans\n55: 749 scans\n55B:    270 scans\n56: 61 scans\n56B:    414 scans\n57: 437 scans\n57.1:   588 scans\n57.1B:  1432 scans\n57.2:   1468 scans\n57.2B:  1990 scans\n57.3:   1677 scans\n57.3B:  1799 scans\n57B:    1228 scans\n58: 2227 scans\n59: 1436 scans\n60: 1103 scans\n62: 1032 scans\n64: 1019 scans\n65: 262 scans\n68: 134 scans\n7:  1112 scans\n9:  3246 scans\n9.5:    8296 scans\nMR: 3202 scans\nWS: 2444 scans\n\n\n\n\nplotting scans for each cast in the first list\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # 1 is selecting only the first sublist\n  # print(i)\n  print(glue(\"=== station: {cast@metadata$station[1]}\"))\n  print(glue(\"# scans: {length(cast@data$scan)}\"))\n  plotScan(cast)\n}\n\n\n=== station: 10\n# scans: 1562\n\n\n\n\n\n\n\n\n\n=== station: 12\n# scans: 3689\n\n\n\n\n\n\n\n\n\n=== station: 16\n# scans: 964\n\n\n\n\n\n\n\n\n\n=== station: 18\n# scans: 3693\n\n\n\n\n\n\n\n\n\n=== station: 2\n# scans: 2488\n\n\n\n\n\n\n\n\n\n=== station: 21/LK\n# scans: 3614\n\n\n\n\n\n\n\n\n\n=== station: 30\n# scans: 2500\n\n\n\n\n\n\n\n\n\n=== station: 31\n# scans: 2812\n\n\n\n\n\n\n\n\n\n=== station: 33\n# scans: 1368\n\n\n\n\n\n\n\n\n\n=== station: 41\n# scans: 991\n\n\n\n\n\n\n\n\n\n=== station: 45\n# scans: 1099\n\n\n\n\n\n\n\n\n\n=== station: 49\n# scans: 2\n\n\n\n\n\n\n\n\n\n=== station: 51\n# scans: 24\n\n\n\n\n\n\n\n\n\n=== station: 53\n# scans: 42\n\n\n\n\n\n\n\n\n\n=== station: 54\n# scans: 388\n\n\n\n\n\n\n\n\n\n=== station: 54B\n# scans: 300\n\n\n\n\n\n\n\n\n\n=== station: 55\n# scans: 749\n\n\n\n\n\n\n\n\n\n=== station: 55B\n# scans: 270\n\n\n\n\n\n\n\n\n\n=== station: 56\n# scans: 61\n\n\n\n\n\n\n\n\n\n=== station: 56B\n# scans: 414\n\n\n\n\n\n\n\n\n\n=== station: 57\n# scans: 437\n\n\n\n\n\n\n\n\n\n=== station: 57.1\n# scans: 588\n\n\n\n\n\n\n\n\n\n=== station: 57.1B\n# scans: 1432\n\n\n\n\n\n\n\n\n\n=== station: 57.2\n# scans: 1468\n\n\n\n\n\n\n\n\n\n=== station: 57.2B\n# scans: 1990\n\n\n\n\n\n\n\n\n\n=== station: 57.3\n# scans: 1677\n\n\n\n\n\n\n\n\n\n=== station: 57.3B\n# scans: 1799\n\n\n\n\n\n\n\n\n\n=== station: 57B\n# scans: 1228\n\n\n\n\n\n\n\n\n\n=== station: 58\n# scans: 2227\n\n\n\n\n\n\n\n\n\n=== station: 59\n# scans: 1436\n\n\n\n\n\n\n\n\n\n=== station: 60\n# scans: 1103\n\n\n\n\n\n\n\n\n\n=== station: 62\n# scans: 1032\n\n\n\n\n\n\n\n\n\n=== station: 64\n# scans: 1019\n\n\n\n\n\n\n\n\n\n=== station: 65\n# scans: 262\n\n\n\n\n\n\n\n\n\n=== station: 68\n# scans: 134\n\n\n\n\n\n\n\n\n\n=== station: 7\n# scans: 1112\n\n\n\n\n\n\n\n\n\n=== station: 9\n# scans: 3246\n\n\n\n\n\n\n\n\n\n=== station: 9.5\n# scans: 8296\n\n\n\n\n\n\n\n\n\n=== station: MR\n# scans: 3202\n\n\n\n\n\n\n\n\n\n=== station: WS\n# scans: 2444\n\n\n\n\n\n\n\n\n\n\n\nplotting each cast in the first list\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # 1 is selecting only the first sublist\n  tryCatch({\n    plot(ctdDecimate(ctdTrim(cast)))\n  }, error = function(e){\n    print(e)\n  })\n}\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1562' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3689' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 964' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3693' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2488' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3614' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2500' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2812' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1368' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 991' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1099' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 24' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 42' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 388' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 300' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 749' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 61' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 437' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 588' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1432' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1468' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1990' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1677' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1799' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1228' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2227' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1436' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1103' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1032' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 134' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1112' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3246' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 8296' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3202' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2444' in coercion to 'logical(1)'&gt;\n\n\n\n\nplotting other physical parameters for each cast\n# Loop through each CTD cast\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # Assuming each sublist contains only one relevant CTD object\n  tryCatch({\n    # Extract metadata for station name and cruise ID\n    station_name &lt;- cast@metadata$station[1]\n    cruise_id &lt;- cast@data$cruise_id[1]\n\n    # Generate a title with station name and cruise ID\n    overall_title &lt;- glue::glue(\"Station: {station_name}, Cruise ID: {cruise_id}\")\n\n    # Set margins: increase the outer margin for the title\n    par(oma = c(0, 0, 3, 0))  # Top outer margin increased for title\n\n    # Plotting function with specific parameters\n    oce::plot(\n      x = ctdDecimate(ctdTrim(cast)),\n      which = c(\n        \"sea_water_electrical_conductivity\",\n        \"descent_rate\", \"sound_velocity\",\n        \"sea_water_sigma_t\",\"altimeter\"\n      ),\n      main = \"\"  # No main title for individual subplots\n    )\n\n    # Place a single overall title at the top of the plot frame\n    mtext(overall_title, side = 3, line = 1, outer = TRUE, cex = 1.5)\n\n    # Reset outer margins to default\n    par(oma = c(0, 0, 0, 0))\n\n  }, error = function(e) {\n    print(e$message)  # Print any errors that occur during plotting\n  })\n}\n\n\n\n\n\n\n\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n\n\nplotting other nutrient parameters for each cast\n# Loop through each CTD cast\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # Assuming each sublist contains only one relevant CTD object\n  tryCatch({\n    # Extract metadata for station name and cruise ID\n    station_name &lt;- cast@metadata$station[1]\n    cruise_id &lt;- cast@data$cruise_id[1]\n\n    # Generate a title with station name and cruise ID\n    overall_title &lt;- glue::glue(\"Station: {station_name}, Cruise ID: {cruise_id}\")\n\n    # Set margins: increase the outer margin for the title\n    par(oma = c(0, 0, 3, 0))  # Top outer margin increased for title\n\n    # Plotting function with specific parameters\n    oce::plot(\n      x = ctdDecimate(ctdTrim(cast)),\n      which = c(\n        \"CDOM\", \"dissolved_oxygen\",\n        \"oxygen_saturation\",\n        \"chlorophyll_concentration\", \"chlorophyll_fluorescence\"\n      ),\n      main = \"\"  # No main title for individual subplots\n    )\n\n    # Place a single overall title at the top of the plot frame\n    mtext(overall_title, side = 3, line = 1, outer = TRUE, cex = 1.5)\n\n    # Reset outer margins to default\n    par(oma = c(0, 0, 0, 0))\n\n  }, error = function(e) {\n    print(e$message)  # Print any errors that occur during plotting\n  })\n}\n\n\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"plot.new has not been called yet\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n\n\n\n\nplotting other optical parameters for each cast\n# Loop through each CTD cast\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # Assuming each sublist contains only one relevant CTD object\n  tryCatch({\n    # Extract metadata for station name and cruise ID\n    station_name &lt;- cast@metadata$station[1]\n    cruise_id &lt;- cast@data$cruise_id[1]\n\n    # Generate a title with station name and cruise ID\n    overall_title &lt;- glue::glue(\"Station: {station_name}, Cruise ID: {cruise_id}\")\n\n    # Set margins: increase the outer margin for the title\n    par(oma = c(0, 0, 3, 0))  # Top outer margin increased for title\n\n    # Plotting function with specific parameters\n    oce::plot(\n      x = ctdDecimate(ctdTrim(cast)),\n      which = c(\n        \"photosynthetically_available_radiation\",\n        \"beam_attenuation\",\"beam_transmission\"\n      ),\n      main = \"\"  # No main title for individual subplots\n    )\n\n    # Place a single overall title at the top of the plot frame\n    mtext(overall_title, side = 3, line = 1, outer = TRUE, cex = 1.5)\n\n    # Reset outer margins to default\n    par(oma = c(0, 0, 0, 0))\n\n  }, error = function(e) {\n    print(e$message)  # Print any errors that occur during plotting\n  })\n}\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n\n\nloop through every cast, clean, & save\ncombined_df &lt;- data.frame()\nfor (i in seq(ctd_FK)){\n  tryCatch({\n    cast &lt;- ctd_FK[[i]]  # 1 is selecting only the first sublist\n    \n    # print(class(cast))\n    # clean cast \n    trimmed_cast &lt;- ctdTrim(cast)\n    decimated_cast &lt;- ctdDecimate(trimmed_cast, p = 0.5)  # binned to 0.5 m\n    \n    # convert to df\n    cast_df &lt;- as.data.frame(decimated_cast@data)\n    \n    # Add metadata\n    # assumes station ID and cruise ID the same for all & just uses 1st one\n    cast_df &lt;- mutate(\n      cast_df,\n      station = cast@data$station[1],\n      cruise_id = cast@data$cruise_id[1]\n    )\n  \n    # drop NA rows left by cleaning\n    cast_df &lt;- subset(cast_df, !is.na(scan))\n    \n    # Append the data to the combined dataframe\n    combined_df &lt;- rbind(combined_df, cast_df)\n  }, error = function(e){\n    print(glue(\"error in cast {cast@metadata$station[1]}\"))\n    print(e)\n  })\n}\n# Save to CSV\nfile_path &lt;- here(glue(\"data/cleaned/{cruise_id}.csv\"))\nwrite.csv(combined_df, file_path, row.names = FALSE)"
  },
  {
    "objectID": "cruise_report/cruise_reports/WS16207.html",
    "href": "cruise_report/cruise_reports/WS16207.html",
    "title": "WS16207",
    "section": "",
    "text": "WS16207\n\n\nsetup\nif (!nzchar(system.file(package = \"librarian\"))) {\n  install.packages(\"librarian\")\n}\n\nlibrarian::shelf(\n  quiet = TRUE,\n  readr, here, fs, ggplot2, glue, \"jiho/castr\", dplyr, oce, patchwork, purrr, tidyr\n)\n\n\n\n\nCode\nsource(here(\"R/cruise_load.R\"))\ncruise_df &lt;- cruise_load(params$cruise_id)\n\n\n\n\nplot depth & pressure vs time elapsed\ntryCatch({\n  plots &lt;- list()\n  \n  for (station_name in unique(cruise_df$station)) {\n    subset_df &lt;- filter(cruise_df, station == station_name)\n    plots[[station_name]] &lt;- ggplot(subset_df, aes(x = time_elapsed)) +\n      geom_point(aes(y = depth), color = \"blue\") +  # Plot depth in blue\n      geom_line(aes(y = sea_water_pressure), color = \"red\") +  # Plot sea water pressure in red\n      ggtitle(glue(\"{station_name}\")) +\n      theme(\n        axis.title.x = element_blank(),\n        axis.title.y = element_blank(),\n        axis.text.x = element_blank(),\n        axis.text.y = element_blank(),\n        axis.ticks.x = element_blank(),\n        axis.ticks.y = element_blank()\n      )  # Remove individual axis titles and text\n  }\n  \n  # drop nulls\n  plots &lt;- purrr::compact(plots)\n  \n  # Combine all plots into a grid\n  combined_plot &lt;- wrap_plots(plots) + \n    plot_layout(ncol = 4) +  # Adjust ncol to set number of columns in the grid\n    plot_annotation(\n      title = \"Depth (blue) and Pressure (red)\",\n      subtitle = \"Each panel represents a different station\",\n      caption = \"Time Elapsed (x-axis) vs Depth & Pressure (y-axis)\"\n    ) +\n    theme(\n      plot.tag = element_text(size = 12, face = \"bold\"),\n      plot.tag.position = \"topleft\",\n      axis.title.x = element_text(margin = margin(t = 10)),\n      axis.title.y = element_text(margin = margin(r = 10))\n    )\n  \n  print(combined_plot)\n}, error = function(er){\n  print(er)\n});\n\n\n&lt;error/rlang_error&gt;\nError in `geom_point()`:\n! Problem while computing aesthetics.\n Error occurred in the 1st layer.\nCaused by error:\n! object 'time_elapsed' not found\n---\nBacktrace:\n     \n  1. base::tryCatch(...)\n  2.  base (local) tryCatchList(expr, classes, parentenv, handlers)\n  3.    base (local) tryCatchOne(expr, names, parentenv, handlers[[1L]])\n  4.      base (local) doTryCatch(return(expr), name, parentenv, handler)\n  5. base::print(combined_plot)\n  6. patchwork:::print.patchwork(combined_plot)\n  7.   patchwork:::build_patchwork(plot, plot$layout$guides %||% \"auto\")\n  8.     base::lapply(x$plots, plot_table, guides = guides)\n  9.       patchwork (local) FUN(X[[i]], ...)\n 10.       patchwork:::plot_table.ggplot(X[[i]], ...)\n 11.         ggplot2::ggplotGrob(x)\n 12.           ggplot2::ggplot_gtable(ggplot_build(x))\n 13.            ggplot2:::attach_plot_env(data$plot$plot_env)\n 14.              base::options(ggplot2_plot_env = env)\n 15.           ggplot2::ggplot_build(x)\n 16.           ggplot2:::ggplot_build.ggplot(x)\n 17.             ggplot2:::by_layer(...)\n 18.               rlang::try_fetch(...)\n 19.                base::tryCatch(...)\n 20.                 base (local) tryCatchList(expr, classes, parentenv, handlers)\n 21.                   base (local) tryCatchOne(expr, names, parentenv, handlers[[1L]])\n 22.                     base (local) doTryCatch(return(expr), name, parentenv, handler)\n 23.                base::withCallingHandlers(...)\n 24.               ggplot2 (local) f(l = layers[[i]], d = data[[i]])\n 25.                 l$compute_aesthetics(d, plot)\n 26.                   ggplot2 (local) compute_aesthetics(..., self = self)\n 27.                     base::lapply(aesthetics, eval_tidy, data = data, env = env)\n 28.                       rlang (local) FUN(X[[i]], ...)\n\n\n\n\nplot across all stations\np &lt;- ggplot(cruise_df, aes(x = time, y = depth, fill = station)) +\n  geom_col() +  # This creates the bars\n  # geom_text(aes(label = station), vjust = -0.3) +  # This adds labels to each bar, adjust vjust for position\n  labs(x = \"Time\", y = \"Depth\", title = \"Depth over Time by Station\") +  # Set labels and title\n  theme_minimal()  # Use a minimal theme\nprint(p)\n\n\nWarning: Removed 1 row containing missing values or values outside the scale range\n(`geom_col()`).\n\n\n\n\n\n\n\n\n\n\n\ncreate oce.ctd objects from dataframes\nctd_load &lt;- function(data, other_params = NULL) {\n  \n  # create csv into ctd object\n  test_ctd &lt;-\n    as.ctd(\n      salinity    = data$sea_water_salinity,\n      temperature = data$sea_water_temperature,\n      pressure    = data$sea_water_pressure,\n      station     = data$station\n    )\n  \n  # add additional columns to ctd object\n  if (!is.null(other_params)) {\n    for (param_name in other_params) {\n      test_ctd &lt;-\n        oceSetData(\n          object = test_ctd,\n          name   = param_name,\n          value  = data[[param_name]]\n        )\n    }\n  }\n  print(glue(\"{data$station[1]}:\\t{length(test_ctd@data$scan)} scans\"))\n\n\n  return(test_ctd)\n}\n\n# Define other parameters to add\nother_params &lt;- c(\n  \"cruise_id\", \"station\", \"time\", \"time_elapsed\", \n  \"latitude\", \"longitude\", \"sea_water_electrical_conductivity\", \n  \"CDOM\", \"dissolved_oxygen\",\"oxygen_saturation\", \"chlorophyll_concentration\", \n  \"chlorophyll_fluorescence\", \"photosynthetically_available_radiation\", \n  \"beam_attenuation\",\"beam_transmission\", \"depth\", \"sea_water_sigma_t\",\n  \"descent_rate\", \"sound_velocity\",\"altimeter\"\n)\n\n# Split data by station and create data list\nctd_FK &lt;- cruise_df %&gt;%\n  split(.$station) %&gt;%\n  map(~ ctd_load(.x, other_params = other_params)) # ~ is a lambda(x)\n\n\n10: 3018 scans\n12: 4474 scans\n16: 1247 scans\n18: 3637 scans\n2:  2135 scans\n21/LK:  5047 scans\n30: 4028 scans\n31: 2338 scans\n33: 1850 scans\n41: 741 scans\n45: 1094 scans\n49: 52 scans\n51: 1225 scans\n53: 1269 scans\n54: 327 scans\n54B:    35 scans\n55: 121 scans\n55B:    150 scans\n56: 840 scans\n56B:    175 scans\n57: 569 scans\n57.1:   1086 scans\n57.1B:  777 scans\n57.2:   1906 scans\n57.2B:  1828 scans\n57.3:   2213 scans\n57.3B:  2307 scans\n57B:    919 scans\n58: 2981 scans\n59: 1327 scans\n60: 1470 scans\n62: 615 scans\n64: 485 scans\n65: 497 scans\n68: 1243 scans\n7:  596 scans\n9:  3443 scans\n9.5:    9901 scans\nDECK_TST1:  1006 scans\nDECK_TST2:  77 scans\nDECK_TST24JUL2016:  44 scans\nDECK_TST24JUL2016.2:    62 scans\nMR: 926 scans\nWS: 4162 scans\n\n\n\n\nplotting scans for each cast in the first list\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # 1 is selecting only the first sublist\n  # print(i)\n  print(glue(\"=== station: {cast@metadata$station[1]}\"))\n  print(glue(\"# scans: {length(cast@data$scan)}\"))\n  plotScan(cast)\n}\n\n\n=== station: 10\n# scans: 3018\n\n\n\n\n\n\n\n\n\n=== station: 12\n# scans: 4474\n\n\n\n\n\n\n\n\n\n=== station: 16\n# scans: 1247\n\n\n\n\n\n\n\n\n\n=== station: 18\n# scans: 3637\n\n\n\n\n\n\n\n\n\n=== station: 2\n# scans: 2135\n\n\n\n\n\n\n\n\n\n=== station: 21/LK\n# scans: 5047\n\n\n\n\n\n\n\n\n\n=== station: 30\n# scans: 4028\n\n\n\n\n\n\n\n\n\n=== station: 31\n# scans: 2338\n\n\n\n\n\n\n\n\n\n=== station: 33\n# scans: 1850\n\n\n\n\n\n\n\n\n\n=== station: 41\n# scans: 741\n\n\n\n\n\n\n\n\n\n=== station: 45\n# scans: 1094\n\n\n\n\n\n\n\n\n\n=== station: 49\n# scans: 52\n\n\n\n\n\n\n\n\n\n=== station: 51\n# scans: 1225\n\n\n\n\n\n\n\n\n\n=== station: 53\n# scans: 1269\n\n\n\n\n\n\n\n\n\n=== station: 54\n# scans: 327\n\n\n\n\n\n\n\n\n\n=== station: 54B\n# scans: 35\n\n\n\n\n\n\n\n\n\n=== station: 55\n# scans: 121\n\n\n\n\n\n\n\n\n\n=== station: 55B\n# scans: 150\n\n\n\n\n\n\n\n\n\n=== station: 56\n# scans: 840\n\n\n\n\n\n\n\n\n\n=== station: 56B\n# scans: 175\n\n\n\n\n\n\n\n\n\n=== station: 57\n# scans: 569\n\n\n\n\n\n\n\n\n\n=== station: 57.1\n# scans: 1086\n\n\n\n\n\n\n\n\n\n=== station: 57.1B\n# scans: 777\n\n\n\n\n\n\n\n\n\n=== station: 57.2\n# scans: 1906\n\n\n\n\n\n\n\n\n\n=== station: 57.2B\n# scans: 1828\n\n\n\n\n\n\n\n\n\n=== station: 57.3\n# scans: 2213\n\n\n\n\n\n\n\n\n\n=== station: 57.3B\n# scans: 2307\n\n\n\n\n\n\n\n\n\n=== station: 57B\n# scans: 919\n\n\n\n\n\n\n\n\n\n=== station: 58\n# scans: 2981\n\n\n\n\n\n\n\n\n\n=== station: 59\n# scans: 1327\n\n\n\n\n\n\n\n\n\n=== station: 60\n# scans: 1470\n\n\n\n\n\n\n\n\n\n=== station: 62\n# scans: 615\n\n\n\n\n\n\n\n\n\n=== station: 64\n# scans: 485\n\n\n\n\n\n\n\n\n\n=== station: 65\n# scans: 497\n\n\n\n\n\n\n\n\n\n=== station: 68\n# scans: 1243\n\n\n\n\n\n\n\n\n\n=== station: 7\n# scans: 596\n\n\n\n\n\n\n\n\n\n=== station: 9\n# scans: 3443\n\n\n\n\n\n\n\n\n\n=== station: 9.5\n# scans: 9901\n\n\n\n\n\n\n\n\n\n=== station: DECK_TST1\n# scans: 1006\n\n\n\n\n\n\n\n\n\n=== station: DECK_TST2\n# scans: 77\n\n\n\n\n\n\n\n\n\n=== station: DECK_TST24JUL2016\n# scans: 44\n\n\n\n\n\n\n\n\n\n=== station: DECK_TST24JUL2016.2\n# scans: 62\n\n\n\n\n\n\n\n\n\n=== station: MR\n# scans: 926\n\n\n\n\n\n\n\n\n\n=== station: WS\n# scans: 4162\n\n\n\n\n\n\n\n\n\n\n\nplotting each cast in the first list\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # 1 is selecting only the first sublist\n  tryCatch({\n    plot(ctdDecimate(ctdTrim(cast)))\n  }, error = function(e){\n    print(e)\n  })\n}\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3018' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4474' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1247' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3637' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2135' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 5047' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4028' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2338' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1850' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 741' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1094' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 52' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1225' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1269' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 327' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 35' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 121' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 150' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 840' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 175' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 569' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1086' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 777' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1906' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1828' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2213' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2307' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 919' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2981' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1327' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1470' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 615' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 485' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1243' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 596' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3443' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 9901' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 926' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4162' in coercion to 'logical(1)'&gt;\n\n\n\n\nplotting other physical parameters for each cast\n# Loop through each CTD cast\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # Assuming each sublist contains only one relevant CTD object\n  tryCatch({\n    # Extract metadata for station name and cruise ID\n    station_name &lt;- cast@metadata$station[1]\n    cruise_id &lt;- cast@data$cruise_id[1]\n\n    # Generate a title with station name and cruise ID\n    overall_title &lt;- glue::glue(\"Station: {station_name}, Cruise ID: {cruise_id}\")\n\n    # Set margins: increase the outer margin for the title\n    par(oma = c(0, 0, 3, 0))  # Top outer margin increased for title\n\n    # Plotting function with specific parameters\n    oce::plot(\n      x = ctdDecimate(ctdTrim(cast)),\n      which = c(\n        \"sea_water_electrical_conductivity\",\n        \"descent_rate\", \"sound_velocity\",\n        \"sea_water_sigma_t\",\"altimeter\"\n      ),\n      main = \"\"  # No main title for individual subplots\n    )\n\n    # Place a single overall title at the top of the plot frame\n    mtext(overall_title, side = 3, line = 1, outer = TRUE, cex = 1.5)\n\n    # Reset outer margins to default\n    par(oma = c(0, 0, 0, 0))\n\n  }, error = function(e) {\n    print(e$message)  # Print any errors that occur during plotting\n  })\n}\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"missing value where TRUE/FALSE needed\"\n\n\n\n\nplotting other nutrient parameters for each cast\n# Loop through each CTD cast\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # Assuming each sublist contains only one relevant CTD object\n  tryCatch({\n    # Extract metadata for station name and cruise ID\n    station_name &lt;- cast@metadata$station[1]\n    cruise_id &lt;- cast@data$cruise_id[1]\n\n    # Generate a title with station name and cruise ID\n    overall_title &lt;- glue::glue(\"Station: {station_name}, Cruise ID: {cruise_id}\")\n\n    # Set margins: increase the outer margin for the title\n    par(oma = c(0, 0, 3, 0))  # Top outer margin increased for title\n\n    # Plotting function with specific parameters\n    oce::plot(\n      x = ctdDecimate(ctdTrim(cast)),\n      which = c(\n        \"CDOM\", \"dissolved_oxygen\",\n        \"oxygen_saturation\",\n        \"chlorophyll_concentration\", \"chlorophyll_fluorescence\"\n      ),\n      main = \"\"  # No main title for individual subplots\n    )\n\n    # Place a single overall title at the top of the plot frame\n    mtext(overall_title, side = 3, line = 1, outer = TRUE, cex = 1.5)\n\n    # Reset outer margins to default\n    par(oma = c(0, 0, 0, 0))\n\n  }, error = function(e) {\n    print(e$message)  # Print any errors that occur during plotting\n  })\n}\n\n\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"plot.new has not been called yet\"\n[1] \"plot.new has not been called yet\"\n[1] \"plot.new has not been called yet\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n\n\n\n\nplotting other optical parameters for each cast\n# Loop through each CTD cast\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # Assuming each sublist contains only one relevant CTD object\n  tryCatch({\n    # Extract metadata for station name and cruise ID\n    station_name &lt;- cast@metadata$station[1]\n    cruise_id &lt;- cast@data$cruise_id[1]\n\n    # Generate a title with station name and cruise ID\n    overall_title &lt;- glue::glue(\"Station: {station_name}, Cruise ID: {cruise_id}\")\n\n    # Set margins: increase the outer margin for the title\n    par(oma = c(0, 0, 3, 0))  # Top outer margin increased for title\n\n    # Plotting function with specific parameters\n    oce::plot(\n      x = ctdDecimate(ctdTrim(cast)),\n      which = c(\n        \"photosynthetically_available_radiation\",\n        \"beam_attenuation\",\"beam_transmission\"\n      ),\n      main = \"\"  # No main title for individual subplots\n    )\n\n    # Place a single overall title at the top of the plot frame\n    mtext(overall_title, side = 3, line = 1, outer = TRUE, cex = 1.5)\n\n    # Reset outer margins to default\n    par(oma = c(0, 0, 0, 0))\n\n  }, error = function(e) {\n    print(e$message)  # Print any errors that occur during plotting\n  })\n}\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"missing value where TRUE/FALSE needed\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n\n\nloop through every cast, clean, & save\ncombined_df &lt;- data.frame()\nfor (i in seq(ctd_FK)){\n  tryCatch({\n    cast &lt;- ctd_FK[[i]]  # 1 is selecting only the first sublist\n    \n    # print(class(cast))\n    # clean cast \n    trimmed_cast &lt;- ctdTrim(cast)\n    decimated_cast &lt;- ctdDecimate(trimmed_cast, p = 0.5)  # binned to 0.5 m\n    \n    # convert to df\n    cast_df &lt;- as.data.frame(decimated_cast@data)\n    \n    # Add metadata\n    # assumes station ID and cruise ID the same for all & just uses 1st one\n    cast_df &lt;- mutate(\n      cast_df,\n      station = cast@data$station[1],\n      cruise_id = cast@data$cruise_id[1]\n    )\n  \n    # drop NA rows left by cleaning\n    cast_df &lt;- subset(cast_df, !is.na(scan))\n    \n    # Append the data to the combined dataframe\n    combined_df &lt;- rbind(combined_df, cast_df)\n  }, error = function(e){\n    print(glue(\"error in cast {cast@metadata$station[1]}\"))\n    print(e)\n  })\n}\n# Save to CSV\nfile_path &lt;- here(glue(\"data/cleaned/{cruise_id}.csv\"))\nwrite.csv(combined_df, file_path, row.names = FALSE)"
  },
  {
    "objectID": "cruise_report/cruise_reports/WS16004.html",
    "href": "cruise_report/cruise_reports/WS16004.html",
    "title": "WS16004",
    "section": "",
    "text": "WS16004\n\n\nsetup\nif (!nzchar(system.file(package = \"librarian\"))) {\n  install.packages(\"librarian\")\n}\n\nlibrarian::shelf(\n  quiet = TRUE,\n  readr, here, fs, ggplot2, glue, \"jiho/castr\", dplyr, oce, patchwork, purrr, tidyr\n)\n\n\n\n\nCode\nsource(here(\"R/cruise_load.R\"))\ncruise_df &lt;- cruise_load(params$cruise_id)\n\n\n\n\nplot depth & pressure vs time elapsed\ntryCatch({\n  plots &lt;- list()\n  \n  for (station_name in unique(cruise_df$station)) {\n    subset_df &lt;- filter(cruise_df, station == station_name)\n    plots[[station_name]] &lt;- ggplot(subset_df, aes(x = time_elapsed)) +\n      geom_point(aes(y = depth), color = \"blue\") +  # Plot depth in blue\n      geom_line(aes(y = sea_water_pressure), color = \"red\") +  # Plot sea water pressure in red\n      ggtitle(glue(\"{station_name}\")) +\n      theme(\n        axis.title.x = element_blank(),\n        axis.title.y = element_blank(),\n        axis.text.x = element_blank(),\n        axis.text.y = element_blank(),\n        axis.ticks.x = element_blank(),\n        axis.ticks.y = element_blank()\n      )  # Remove individual axis titles and text\n  }\n  \n  # drop nulls\n  plots &lt;- purrr::compact(plots)\n  \n  # Combine all plots into a grid\n  combined_plot &lt;- wrap_plots(plots) + \n    plot_layout(ncol = 4) +  # Adjust ncol to set number of columns in the grid\n    plot_annotation(\n      title = \"Depth (blue) and Pressure (red)\",\n      subtitle = \"Each panel represents a different station\",\n      caption = \"Time Elapsed (x-axis) vs Depth & Pressure (y-axis)\"\n    ) +\n    theme(\n      plot.tag = element_text(size = 12, face = \"bold\"),\n      plot.tag.position = \"topleft\",\n      axis.title.x = element_text(margin = margin(t = 10)),\n      axis.title.y = element_text(margin = margin(r = 10))\n    )\n  \n  print(combined_plot)\n}, error = function(er){\n  print(er)\n});\n\n\n&lt;error/rlang_error&gt;\nError in `geom_point()`:\n! Problem while computing aesthetics.\n Error occurred in the 1st layer.\nCaused by error:\n! object 'time_elapsed' not found\n---\nBacktrace:\n     \n  1. base::tryCatch(...)\n  2.  base (local) tryCatchList(expr, classes, parentenv, handlers)\n  3.    base (local) tryCatchOne(expr, names, parentenv, handlers[[1L]])\n  4.      base (local) doTryCatch(return(expr), name, parentenv, handler)\n  5. base::print(combined_plot)\n  6. patchwork:::print.patchwork(combined_plot)\n  7.   patchwork:::build_patchwork(plot, plot$layout$guides %||% \"auto\")\n  8.     base::lapply(x$plots, plot_table, guides = guides)\n  9.       patchwork (local) FUN(X[[i]], ...)\n 10.       patchwork:::plot_table.ggplot(X[[i]], ...)\n 11.         ggplot2::ggplotGrob(x)\n 12.           ggplot2::ggplot_gtable(ggplot_build(x))\n 13.            ggplot2:::attach_plot_env(data$plot$plot_env)\n 14.              base::options(ggplot2_plot_env = env)\n 15.           ggplot2::ggplot_build(x)\n 16.           ggplot2:::ggplot_build.ggplot(x)\n 17.             ggplot2:::by_layer(...)\n 18.               rlang::try_fetch(...)\n 19.                base::tryCatch(...)\n 20.                 base (local) tryCatchList(expr, classes, parentenv, handlers)\n 21.                   base (local) tryCatchOne(expr, names, parentenv, handlers[[1L]])\n 22.                     base (local) doTryCatch(return(expr), name, parentenv, handler)\n 23.                base::withCallingHandlers(...)\n 24.               ggplot2 (local) f(l = layers[[i]], d = data[[i]])\n 25.                 l$compute_aesthetics(d, plot)\n 26.                   ggplot2 (local) compute_aesthetics(..., self = self)\n 27.                     base::lapply(aesthetics, eval_tidy, data = data, env = env)\n 28.                       rlang (local) FUN(X[[i]], ...)\n\n\n\n\nplot across all stations\np &lt;- ggplot(cruise_df, aes(x = time, y = depth, fill = station)) +\n  geom_col() +  # This creates the bars\n  # geom_text(aes(label = station), vjust = -0.3) +  # This adds labels to each bar, adjust vjust for position\n  labs(x = \"Time\", y = \"Depth\", title = \"Depth over Time by Station\") +  # Set labels and title\n  theme_minimal()  # Use a minimal theme\nprint(p)\n\n\n\n\n\n\n\n\n\n\n\ncreate oce.ctd objects from dataframes\nctd_load &lt;- function(data, other_params = NULL) {\n  \n  # create csv into ctd object\n  test_ctd &lt;-\n    as.ctd(\n      salinity    = data$sea_water_salinity,\n      temperature = data$sea_water_temperature,\n      pressure    = data$sea_water_pressure,\n      station     = data$station\n    )\n  \n  # add additional columns to ctd object\n  if (!is.null(other_params)) {\n    for (param_name in other_params) {\n      test_ctd &lt;-\n        oceSetData(\n          object = test_ctd,\n          name   = param_name,\n          value  = data[[param_name]]\n        )\n    }\n  }\n  print(glue(\"{data$station[1]}:\\t{length(test_ctd@data$scan)} scans\"))\n\n\n  return(test_ctd)\n}\n\n# Define other parameters to add\nother_params &lt;- c(\n  \"cruise_id\", \"station\", \"time\", \"time_elapsed\", \n  \"latitude\", \"longitude\", \"sea_water_electrical_conductivity\", \n  \"CDOM\", \"dissolved_oxygen\",\"oxygen_saturation\", \"chlorophyll_concentration\", \n  \"chlorophyll_fluorescence\", \"photosynthetically_available_radiation\", \n  \"beam_attenuation\",\"beam_transmission\", \"depth\", \"sea_water_sigma_t\",\n  \"descent_rate\", \"sound_velocity\",\"altimeter\"\n)\n\n# Split data by station and create data list\nctd_FK &lt;- cruise_df %&gt;%\n  split(.$station) %&gt;%\n  map(~ ctd_load(.x, other_params = other_params)) # ~ is a lambda(x)\n\n\n1:  3866 scans\n10: 1586 scans\n12: 7040 scans\n16: 2386 scans\n18: 4662 scans\n21/LK:  4838 scans\n30: 4622 scans\n31: 2900 scans\n33: 2998 scans\n41: 1976 scans\n45: 3576 scans\n49: 714 scans\n51: 1472 scans\n53: 196 scans\n54: 52 scans\n55: 2170 scans\n56: 368 scans\n57: 2564 scans\n57.1:   3208 scans\n57.2:   5706 scans\n57.3:   3100 scans\n58: 2216 scans\n59: 2452 scans\n60: 2044 scans\n64: 1168 scans\n65: 444 scans\n68: 5078 scans\n7:  1992 scans\n9:  12252 scans\n9.5:    19212 scans\nMR: 7898 scans\nWS: 5660 scans\n\n\n\n\nplotting scans for each cast in the first list\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # 1 is selecting only the first sublist\n  # print(i)\n  print(glue(\"=== station: {cast@metadata$station[1]}\"))\n  print(glue(\"# scans: {length(cast@data$scan)}\"))\n  plotScan(cast)\n}\n\n\n=== station: 1\n# scans: 3866\n\n\n\n\n\n\n\n\n\n=== station: 10\n# scans: 1586\n\n\n\n\n\n\n\n\n\n=== station: 12\n# scans: 7040\n\n\n\n\n\n\n\n\n\n=== station: 16\n# scans: 2386\n\n\n\n\n\n\n\n\n\n=== station: 18\n# scans: 4662\n\n\n\n\n\n\n\n\n\n=== station: 21/LK\n# scans: 4838\n\n\n\n\n\n\n\n\n\n=== station: 30\n# scans: 4622\n\n\n\n\n\n\n\n\n\n=== station: 31\n# scans: 2900\n\n\n\n\n\n\n\n\n\n=== station: 33\n# scans: 2998\n\n\n\n\n\n\n\n\n\n=== station: 41\n# scans: 1976\n\n\n\n\n\n\n\n\n\n=== station: 45\n# scans: 3576\n\n\n\n\n\n\n\n\n\n=== station: 49\n# scans: 714\n\n\n\n\n\n\n\n\n\n=== station: 51\n# scans: 1472\n\n\n\n\n\n\n\n\n\n=== station: 53\n# scans: 196\n\n\n\n\n\n\n\n\n\n=== station: 54\n# scans: 52\n\n\n\n\n\n\n\n\n\n=== station: 55\n# scans: 2170\n\n\n\n\n\n\n\n\n\n=== station: 56\n# scans: 368\n\n\n\n\n\n\n\n\n\n=== station: 57\n# scans: 2564\n\n\n\n\n\n\n\n\n\n=== station: 57.1\n# scans: 3208\n\n\n\n\n\n\n\n\n\n=== station: 57.2\n# scans: 5706\n\n\n\n\n\n\n\n\n\n=== station: 57.3\n# scans: 3100\n\n\n\n\n\n\n\n\n\n=== station: 58\n# scans: 2216\n\n\n\n\n\n\n\n\n\n=== station: 59\n# scans: 2452\n\n\n\n\n\n\n\n\n\n=== station: 60\n# scans: 2044\n\n\n\n\n\n\n\n\n\n=== station: 64\n# scans: 1168\n\n\n\n\n\n\n\n\n\n=== station: 65\n# scans: 444\n\n\n\n\n\n\n\n\n\n=== station: 68\n# scans: 5078\n\n\n\n\n\n\n\n\n\n=== station: 7\n# scans: 1992\n\n\n\n\n\n\n\n\n\n=== station: 9\n# scans: 12252\n\n\n\n\n\n\n\n\n\n=== station: 9.5\n# scans: 19212\n\n\n\n\n\n\n\n\n\n=== station: MR\n# scans: 7898\n\n\n\n\n\n\n\n\n\n=== station: WS\n# scans: 5660\n\n\n\n\n\n\n\n\n\n\n\nplotting each cast in the first list\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # 1 is selecting only the first sublist\n  tryCatch({\n    plot(ctdDecimate(ctdTrim(cast)))\n  }, error = function(e){\n    print(e)\n  })\n}\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3866' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1586' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 7040' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2386' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4662' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4838' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4622' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2900' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2998' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1976' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3576' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2170' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2564' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3208' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 5706' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3100' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2216' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2452' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2044' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1168' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 444' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 5078' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1992' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 12252' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 19212' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 7898' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 5660' in coercion to 'logical(1)'&gt;\n\n\n\n\nplotting other physical parameters for each cast\n# Loop through each CTD cast\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # Assuming each sublist contains only one relevant CTD object\n  tryCatch({\n    # Extract metadata for station name and cruise ID\n    station_name &lt;- cast@metadata$station[1]\n    cruise_id &lt;- cast@data$cruise_id[1]\n\n    # Generate a title with station name and cruise ID\n    overall_title &lt;- glue::glue(\"Station: {station_name}, Cruise ID: {cruise_id}\")\n\n    # Set margins: increase the outer margin for the title\n    par(oma = c(0, 0, 3, 0))  # Top outer margin increased for title\n\n    # Plotting function with specific parameters\n    oce::plot(\n      x = ctdDecimate(ctdTrim(cast)),\n      which = c(\n        \"sea_water_electrical_conductivity\",\n        \"descent_rate\", \"sound_velocity\",\n        \"sea_water_sigma_t\",\"altimeter\"\n      ),\n      main = \"\"  # No main title for individual subplots\n    )\n\n    # Place a single overall title at the top of the plot frame\n    mtext(overall_title, side = 3, line = 1, outer = TRUE, cex = 1.5)\n\n    # Reset outer margins to default\n    par(oma = c(0, 0, 0, 0))\n\n  }, error = function(e) {\n    print(e$message)  # Print any errors that occur during plotting\n  })\n}\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n\n\nplotting other nutrient parameters for each cast\n# Loop through each CTD cast\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # Assuming each sublist contains only one relevant CTD object\n  tryCatch({\n    # Extract metadata for station name and cruise ID\n    station_name &lt;- cast@metadata$station[1]\n    cruise_id &lt;- cast@data$cruise_id[1]\n\n    # Generate a title with station name and cruise ID\n    overall_title &lt;- glue::glue(\"Station: {station_name}, Cruise ID: {cruise_id}\")\n\n    # Set margins: increase the outer margin for the title\n    par(oma = c(0, 0, 3, 0))  # Top outer margin increased for title\n\n    # Plotting function with specific parameters\n    oce::plot(\n      x = ctdDecimate(ctdTrim(cast)),\n      which = c(\n        \"CDOM\", \"dissolved_oxygen\",\n        \"oxygen_saturation\",\n        \"chlorophyll_concentration\", \"chlorophyll_fluorescence\"\n      ),\n      main = \"\"  # No main title for individual subplots\n    )\n\n    # Place a single overall title at the top of the plot frame\n    mtext(overall_title, side = 3, line = 1, outer = TRUE, cex = 1.5)\n\n    # Reset outer margins to default\n    par(oma = c(0, 0, 0, 0))\n\n  }, error = function(e) {\n    print(e$message)  # Print any errors that occur during plotting\n  })\n}\n\n\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n\n\n\n\nplotting other optical parameters for each cast\n# Loop through each CTD cast\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # Assuming each sublist contains only one relevant CTD object\n  tryCatch({\n    # Extract metadata for station name and cruise ID\n    station_name &lt;- cast@metadata$station[1]\n    cruise_id &lt;- cast@data$cruise_id[1]\n\n    # Generate a title with station name and cruise ID\n    overall_title &lt;- glue::glue(\"Station: {station_name}, Cruise ID: {cruise_id}\")\n\n    # Set margins: increase the outer margin for the title\n    par(oma = c(0, 0, 3, 0))  # Top outer margin increased for title\n\n    # Plotting function with specific parameters\n    oce::plot(\n      x = ctdDecimate(ctdTrim(cast)),\n      which = c(\n        \"photosynthetically_available_radiation\",\n        \"beam_attenuation\",\"beam_transmission\"\n      ),\n      main = \"\"  # No main title for individual subplots\n    )\n\n    # Place a single overall title at the top of the plot frame\n    mtext(overall_title, side = 3, line = 1, outer = TRUE, cex = 1.5)\n\n    # Reset outer margins to default\n    par(oma = c(0, 0, 0, 0))\n\n  }, error = function(e) {\n    print(e$message)  # Print any errors that occur during plotting\n  })\n}\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n\n\nloop through every cast, clean, & save\ncombined_df &lt;- data.frame()\nfor (i in seq(ctd_FK)){\n  tryCatch({\n    cast &lt;- ctd_FK[[i]]  # 1 is selecting only the first sublist\n    \n    # print(class(cast))\n    # clean cast \n    trimmed_cast &lt;- ctdTrim(cast)\n    decimated_cast &lt;- ctdDecimate(trimmed_cast, p = 0.5)  # binned to 0.5 m\n    \n    # convert to df\n    cast_df &lt;- as.data.frame(decimated_cast@data)\n    \n    # Add metadata\n    # assumes station ID and cruise ID the same for all & just uses 1st one\n    cast_df &lt;- mutate(\n      cast_df,\n      station = cast@data$station[1],\n      cruise_id = cast@data$cruise_id[1]\n    )\n  \n    # drop NA rows left by cleaning\n    cast_df &lt;- subset(cast_df, !is.na(scan))\n    \n    # Append the data to the combined dataframe\n    combined_df &lt;- rbind(combined_df, cast_df)\n  }, error = function(e){\n    print(glue(\"error in cast {cast@metadata$station[1]}\"))\n    print(e)\n  })\n}\n# Save to CSV\nfile_path &lt;- here(glue(\"data/cleaned/{cruise_id}.csv\"))\nwrite.csv(combined_df, file_path, row.names = FALSE)"
  },
  {
    "objectID": "cruise_report/cruise_reports/WS15264.html",
    "href": "cruise_report/cruise_reports/WS15264.html",
    "title": "WS15264",
    "section": "",
    "text": "WS15264\n\n\nsetup\nif (!nzchar(system.file(package = \"librarian\"))) {\n  install.packages(\"librarian\")\n}\n\nlibrarian::shelf(\n  quiet = TRUE,\n  readr, here, fs, ggplot2, glue, \"jiho/castr\", dplyr, oce, patchwork, purrr, tidyr\n)\n\n\n\n\nCode\nsource(here(\"R/cruise_load.R\"))\ncruise_df &lt;- cruise_load(params$cruise_id)\n\n\n\n\nplot depth & pressure vs time elapsed\ntryCatch({\n  plots &lt;- list()\n  \n  for (station_name in unique(cruise_df$station)) {\n    subset_df &lt;- filter(cruise_df, station == station_name)\n    plots[[station_name]] &lt;- ggplot(subset_df, aes(x = time_elapsed)) +\n      geom_point(aes(y = depth), color = \"blue\") +  # Plot depth in blue\n      geom_line(aes(y = sea_water_pressure), color = \"red\") +  # Plot sea water pressure in red\n      ggtitle(glue(\"{station_name}\")) +\n      theme(\n        axis.title.x = element_blank(),\n        axis.title.y = element_blank(),\n        axis.text.x = element_blank(),\n        axis.text.y = element_blank(),\n        axis.ticks.x = element_blank(),\n        axis.ticks.y = element_blank()\n      )  # Remove individual axis titles and text\n  }\n  \n  # drop nulls\n  plots &lt;- purrr::compact(plots)\n  \n  # Combine all plots into a grid\n  combined_plot &lt;- wrap_plots(plots) + \n    plot_layout(ncol = 4) +  # Adjust ncol to set number of columns in the grid\n    plot_annotation(\n      title = \"Depth (blue) and Pressure (red)\",\n      subtitle = \"Each panel represents a different station\",\n      caption = \"Time Elapsed (x-axis) vs Depth & Pressure (y-axis)\"\n    ) +\n    theme(\n      plot.tag = element_text(size = 12, face = \"bold\"),\n      plot.tag.position = \"topleft\",\n      axis.title.x = element_text(margin = margin(t = 10)),\n      axis.title.y = element_text(margin = margin(r = 10))\n    )\n  \n  print(combined_plot)\n}, error = function(er){\n  print(er)\n});\n\n\n&lt;error/rlang_error&gt;\nError in `geom_point()`:\n! Problem while computing aesthetics.\n Error occurred in the 1st layer.\nCaused by error:\n! object 'time_elapsed' not found\n---\nBacktrace:\n     \n  1. base::tryCatch(...)\n  2.  base (local) tryCatchList(expr, classes, parentenv, handlers)\n  3.    base (local) tryCatchOne(expr, names, parentenv, handlers[[1L]])\n  4.      base (local) doTryCatch(return(expr), name, parentenv, handler)\n  5. base::print(combined_plot)\n  6. patchwork:::print.patchwork(combined_plot)\n  7.   patchwork:::build_patchwork(plot, plot$layout$guides %||% \"auto\")\n  8.     base::lapply(x$plots, plot_table, guides = guides)\n  9.       patchwork (local) FUN(X[[i]], ...)\n 10.       patchwork:::plot_table.ggplot(X[[i]], ...)\n 11.         ggplot2::ggplotGrob(x)\n 12.           ggplot2::ggplot_gtable(ggplot_build(x))\n 13.            ggplot2:::attach_plot_env(data$plot$plot_env)\n 14.              base::options(ggplot2_plot_env = env)\n 15.           ggplot2::ggplot_build(x)\n 16.           ggplot2:::ggplot_build.ggplot(x)\n 17.             ggplot2:::by_layer(...)\n 18.               rlang::try_fetch(...)\n 19.                base::tryCatch(...)\n 20.                 base (local) tryCatchList(expr, classes, parentenv, handlers)\n 21.                   base (local) tryCatchOne(expr, names, parentenv, handlers[[1L]])\n 22.                     base (local) doTryCatch(return(expr), name, parentenv, handler)\n 23.                base::withCallingHandlers(...)\n 24.               ggplot2 (local) f(l = layers[[i]], d = data[[i]])\n 25.                 l$compute_aesthetics(d, plot)\n 26.                   ggplot2 (local) compute_aesthetics(..., self = self)\n 27.                     base::lapply(aesthetics, eval_tidy, data = data, env = env)\n 28.                       rlang (local) FUN(X[[i]], ...)\n\n\n\n\nplot across all stations\np &lt;- ggplot(cruise_df, aes(x = time, y = depth, fill = station)) +\n  geom_col() +  # This creates the bars\n  # geom_text(aes(label = station), vjust = -0.3) +  # This adds labels to each bar, adjust vjust for position\n  labs(x = \"Time\", y = \"Depth\", title = \"Depth over Time by Station\") +  # Set labels and title\n  theme_minimal()  # Use a minimal theme\nprint(p)\n\n\n\n\n\n\n\n\n\n\n\ncreate oce.ctd objects from dataframes\nctd_load &lt;- function(data, other_params = NULL) {\n  \n  # create csv into ctd object\n  test_ctd &lt;-\n    as.ctd(\n      salinity    = data$sea_water_salinity,\n      temperature = data$sea_water_temperature,\n      pressure    = data$sea_water_pressure,\n      station     = data$station\n    )\n  \n  # add additional columns to ctd object\n  if (!is.null(other_params)) {\n    for (param_name in other_params) {\n      test_ctd &lt;-\n        oceSetData(\n          object = test_ctd,\n          name   = param_name,\n          value  = data[[param_name]]\n        )\n    }\n  }\n  print(glue(\"{data$station[1]}:\\t{length(test_ctd@data$scan)} scans\"))\n\n\n  return(test_ctd)\n}\n\n# Define other parameters to add\nother_params &lt;- c(\n  \"cruise_id\", \"station\", \"time\", \"time_elapsed\", \n  \"latitude\", \"longitude\", \"sea_water_electrical_conductivity\", \n  \"CDOM\", \"dissolved_oxygen\",\"oxygen_saturation\", \"chlorophyll_concentration\", \n  \"chlorophyll_fluorescence\", \"photosynthetically_available_radiation\", \n  \"beam_attenuation\",\"beam_transmission\", \"depth\", \"sea_water_sigma_t\",\n  \"descent_rate\", \"sound_velocity\",\"altimeter\"\n)\n\n# Split data by station and create data list\nctd_FK &lt;- cruise_df %&gt;%\n  split(.$station) %&gt;%\n  map(~ ctd_load(.x, other_params = other_params)) # ~ is a lambda(x)\n\n\n10: 1074 scans\n12: 2620 scans\n16: 598 scans\n18: 3180 scans\n2:  2386 scans\n21/LK:  4809 scans\n30: 3434 scans\n31: 2659 scans\n33: 2636 scans\n41: 1188 scans\n45: 2385 scans\n49: 3117 scans\n51: 1390 scans\n53: 71 scans\n54: 184 scans\n54B:    3753 scans\n55: 73 scans\n55B:    1530 scans\n56: 134 scans\n56B:    2199 scans\n57: 1285 scans\n57.1:   1930 scans\n57.1B:  2363 scans\n57.2:   1168 scans\n57.2B:  2413 scans\n57.3:   2282 scans\n57.3B:  2407 scans\n57B:    1732 scans\n58: 2767 scans\n60: 2082 scans\n64: 1983 scans\n65: 1963 scans\n68: 1462 scans\n7:  1866 scans\n8:  520 scans\n9:  5189 scans\n9.5:    7040 scans\nBK1:    3955 scans\nMR: 1805 scans\nMRA:    1514 scans\nWS: 3999 scans\n\n\n\n\nplotting scans for each cast in the first list\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # 1 is selecting only the first sublist\n  # print(i)\n  print(glue(\"=== station: {cast@metadata$station[1]}\"))\n  print(glue(\"# scans: {length(cast@data$scan)}\"))\n  plotScan(cast)\n}\n\n\n=== station: 10\n# scans: 1074\n\n\n\n\n\n\n\n\n\n=== station: 12\n# scans: 2620\n\n\n\n\n\n\n\n\n\n=== station: 16\n# scans: 598\n\n\n\n\n\n\n\n\n\n=== station: 18\n# scans: 3180\n\n\n\n\n\n\n\n\n\n=== station: 2\n# scans: 2386\n\n\n\n\n\n\n\n\n\n=== station: 21/LK\n# scans: 4809\n\n\n\n\n\n\n\n\n\n=== station: 30\n# scans: 3434\n\n\n\n\n\n\n\n\n\n=== station: 31\n# scans: 2659\n\n\n\n\n\n\n\n\n\n=== station: 33\n# scans: 2636\n\n\n\n\n\n\n\n\n\n=== station: 41\n# scans: 1188\n\n\n\n\n\n\n\n\n\n=== station: 45\n# scans: 2385\n\n\n\n\n\n\n\n\n\n=== station: 49\n# scans: 3117\n\n\n\n\n\n\n\n\n\n=== station: 51\n# scans: 1390\n\n\n\n\n\n\n\n\n\n=== station: 53\n# scans: 71\n\n\n\n\n\n\n\n\n\n=== station: 54\n# scans: 184\n\n\n\n\n\n\n\n\n\n=== station: 54B\n# scans: 3753\n\n\n\n\n\n\n\n\n\n=== station: 55\n# scans: 73\n\n\n\n\n\n\n\n\n\n=== station: 55B\n# scans: 1530\n\n\n\n\n\n\n\n\n\n=== station: 56\n# scans: 134\n\n\n\n\n\n\n\n\n\n=== station: 56B\n# scans: 2199\n\n\n\n\n\n\n\n\n\n=== station: 57\n# scans: 1285\n\n\n\n\n\n\n\n\n\n=== station: 57.1\n# scans: 1930\n\n\n\n\n\n\n\n\n\n=== station: 57.1B\n# scans: 2363\n\n\n\n\n\n\n\n\n\n=== station: 57.2\n# scans: 1168\n\n\n\n\n\n\n\n\n\n=== station: 57.2B\n# scans: 2413\n\n\n\n\n\n\n\n\n\n=== station: 57.3\n# scans: 2282\n\n\n\n\n\n\n\n\n\n=== station: 57.3B\n# scans: 2407\n\n\n\n\n\n\n\n\n\n=== station: 57B\n# scans: 1732\n\n\n\n\n\n\n\n\n\n=== station: 58\n# scans: 2767\n\n\n\n\n\n\n\n\n\n=== station: 60\n# scans: 2082\n\n\n\n\n\n\n\n\n\n=== station: 64\n# scans: 1983\n\n\n\n\n\n\n\n\n\n=== station: 65\n# scans: 1963\n\n\n\n\n\n\n\n\n\n=== station: 68\n# scans: 1462\n\n\n\n\n\n\n\n\n\n=== station: 7\n# scans: 1866\n\n\n\n\n\n\n\n\n\n=== station: 8\n# scans: 520\n\n\n\n\n\n\n\n\n\n=== station: 9\n# scans: 5189\n\n\n\n\n\n\n\n\n\n=== station: 9.5\n# scans: 7040\n\n\n\n\n\n\n\n\n\n=== station: BK1\n# scans: 3955\n\n\n\n\n\n\n\n\n\n=== station: MR\n# scans: 1805\n\n\n\n\n\n\n\n\n\n=== station: MRA\n# scans: 1514\n\n\n\n\n\n\n\n\n\n=== station: WS\n# scans: 3999\n\n\n\n\n\n\n\n\n\n\n\nplotting each cast in the first list\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # 1 is selecting only the first sublist\n  tryCatch({\n    plot(ctdDecimate(ctdTrim(cast)))\n  }, error = function(e){\n    print(e)\n  })\n}\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1074' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2620' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 598' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3180' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2386' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4809' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3434' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2659' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2636' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1188' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2385' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3117' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1390' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3753' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1530' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2199' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1285' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1930' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2363' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1168' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2413' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2282' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2407' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1732' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2767' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2082' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1983' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1963' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1462' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1866' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 5189' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 7040' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3955' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1805' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1514' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3999' in coercion to 'logical(1)'&gt;\n\n\n\n\nplotting other physical parameters for each cast\n# Loop through each CTD cast\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # Assuming each sublist contains only one relevant CTD object\n  tryCatch({\n    # Extract metadata for station name and cruise ID\n    station_name &lt;- cast@metadata$station[1]\n    cruise_id &lt;- cast@data$cruise_id[1]\n\n    # Generate a title with station name and cruise ID\n    overall_title &lt;- glue::glue(\"Station: {station_name}, Cruise ID: {cruise_id}\")\n\n    # Set margins: increase the outer margin for the title\n    par(oma = c(0, 0, 3, 0))  # Top outer margin increased for title\n\n    # Plotting function with specific parameters\n    oce::plot(\n      x = ctdDecimate(ctdTrim(cast)),\n      which = c(\n        \"sea_water_electrical_conductivity\",\n        \"descent_rate\", \"sound_velocity\",\n        \"sea_water_sigma_t\",\"altimeter\"\n      ),\n      main = \"\"  # No main title for individual subplots\n    )\n\n    # Place a single overall title at the top of the plot frame\n    mtext(overall_title, side = 3, line = 1, outer = TRUE, cex = 1.5)\n\n    # Reset outer margins to default\n    par(oma = c(0, 0, 0, 0))\n\n  }, error = function(e) {\n    print(e$message)  # Print any errors that occur during plotting\n  })\n}\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n\n\nplotting other nutrient parameters for each cast\n# Loop through each CTD cast\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # Assuming each sublist contains only one relevant CTD object\n  tryCatch({\n    # Extract metadata for station name and cruise ID\n    station_name &lt;- cast@metadata$station[1]\n    cruise_id &lt;- cast@data$cruise_id[1]\n\n    # Generate a title with station name and cruise ID\n    overall_title &lt;- glue::glue(\"Station: {station_name}, Cruise ID: {cruise_id}\")\n\n    # Set margins: increase the outer margin for the title\n    par(oma = c(0, 0, 3, 0))  # Top outer margin increased for title\n\n    # Plotting function with specific parameters\n    oce::plot(\n      x = ctdDecimate(ctdTrim(cast)),\n      which = c(\n        \"CDOM\", \"dissolved_oxygen\",\n        \"oxygen_saturation\",\n        \"chlorophyll_concentration\", \"chlorophyll_fluorescence\"\n      ),\n      main = \"\"  # No main title for individual subplots\n    )\n\n    # Place a single overall title at the top of the plot frame\n    mtext(overall_title, side = 3, line = 1, outer = TRUE, cex = 1.5)\n\n    # Reset outer margins to default\n    par(oma = c(0, 0, 0, 0))\n\n  }, error = function(e) {\n    print(e$message)  # Print any errors that occur during plotting\n  })\n}\n\n\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"plot.new has not been called yet\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n\n\n\n\nplotting other optical parameters for each cast\n# Loop through each CTD cast\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # Assuming each sublist contains only one relevant CTD object\n  tryCatch({\n    # Extract metadata for station name and cruise ID\n    station_name &lt;- cast@metadata$station[1]\n    cruise_id &lt;- cast@data$cruise_id[1]\n\n    # Generate a title with station name and cruise ID\n    overall_title &lt;- glue::glue(\"Station: {station_name}, Cruise ID: {cruise_id}\")\n\n    # Set margins: increase the outer margin for the title\n    par(oma = c(0, 0, 3, 0))  # Top outer margin increased for title\n\n    # Plotting function with specific parameters\n    oce::plot(\n      x = ctdDecimate(ctdTrim(cast)),\n      which = c(\n        \"photosynthetically_available_radiation\",\n        \"beam_attenuation\",\"beam_transmission\"\n      ),\n      main = \"\"  # No main title for individual subplots\n    )\n\n    # Place a single overall title at the top of the plot frame\n    mtext(overall_title, side = 3, line = 1, outer = TRUE, cex = 1.5)\n\n    # Reset outer margins to default\n    par(oma = c(0, 0, 0, 0))\n\n  }, error = function(e) {\n    print(e$message)  # Print any errors that occur during plotting\n  })\n}\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n\n\nloop through every cast, clean, & save\ncombined_df &lt;- data.frame()\nfor (i in seq(ctd_FK)){\n  tryCatch({\n    cast &lt;- ctd_FK[[i]]  # 1 is selecting only the first sublist\n    \n    # print(class(cast))\n    # clean cast \n    trimmed_cast &lt;- ctdTrim(cast)\n    decimated_cast &lt;- ctdDecimate(trimmed_cast, p = 0.5)  # binned to 0.5 m\n    \n    # convert to df\n    cast_df &lt;- as.data.frame(decimated_cast@data)\n    \n    # Add metadata\n    # assumes station ID and cruise ID the same for all & just uses 1st one\n    cast_df &lt;- mutate(\n      cast_df,\n      station = cast@data$station[1],\n      cruise_id = cast@data$cruise_id[1]\n    )\n  \n    # drop NA rows left by cleaning\n    cast_df &lt;- subset(cast_df, !is.na(scan))\n    \n    # Append the data to the combined dataframe\n    combined_df &lt;- rbind(combined_df, cast_df)\n  }, error = function(e){\n    print(glue(\"error in cast {cast@metadata$station[1]}\"))\n    print(e)\n  })\n}\n# Save to CSV\nfile_path &lt;- here(glue(\"data/cleaned/{cruise_id}.csv\"))\nwrite.csv(combined_df, file_path, row.names = FALSE)"
  },
  {
    "objectID": "cruise_report/cruise_reports/WS15152.html",
    "href": "cruise_report/cruise_reports/WS15152.html",
    "title": "WS15152",
    "section": "",
    "text": "WS15152\n\n\nsetup\nif (!nzchar(system.file(package = \"librarian\"))) {\n  install.packages(\"librarian\")\n}\n\nlibrarian::shelf(\n  quiet = TRUE,\n  readr, here, fs, ggplot2, glue, \"jiho/castr\", dplyr, oce, patchwork, purrr, tidyr\n)\n\n\n\n\nCode\nsource(here(\"R/cruise_load.R\"))\ncruise_df &lt;- cruise_load(params$cruise_id)\n\n\n\n\nplot depth & pressure vs time elapsed\ntryCatch({\n  plots &lt;- list()\n  \n  for (station_name in unique(cruise_df$station)) {\n    subset_df &lt;- filter(cruise_df, station == station_name)\n    plots[[station_name]] &lt;- ggplot(subset_df, aes(x = time_elapsed)) +\n      geom_point(aes(y = depth), color = \"blue\") +  # Plot depth in blue\n      geom_line(aes(y = sea_water_pressure), color = \"red\") +  # Plot sea water pressure in red\n      ggtitle(glue(\"{station_name}\")) +\n      theme(\n        axis.title.x = element_blank(),\n        axis.title.y = element_blank(),\n        axis.text.x = element_blank(),\n        axis.text.y = element_blank(),\n        axis.ticks.x = element_blank(),\n        axis.ticks.y = element_blank()\n      )  # Remove individual axis titles and text\n  }\n  \n  # drop nulls\n  plots &lt;- purrr::compact(plots)\n  \n  # Combine all plots into a grid\n  combined_plot &lt;- wrap_plots(plots) + \n    plot_layout(ncol = 4) +  # Adjust ncol to set number of columns in the grid\n    plot_annotation(\n      title = \"Depth (blue) and Pressure (red)\",\n      subtitle = \"Each panel represents a different station\",\n      caption = \"Time Elapsed (x-axis) vs Depth & Pressure (y-axis)\"\n    ) +\n    theme(\n      plot.tag = element_text(size = 12, face = \"bold\"),\n      plot.tag.position = \"topleft\",\n      axis.title.x = element_text(margin = margin(t = 10)),\n      axis.title.y = element_text(margin = margin(r = 10))\n    )\n  \n  print(combined_plot)\n}, error = function(er){\n  print(er)\n});\n\n\n\n\n\n\n\n\n\n\n\nplot across all stations\np &lt;- ggplot(cruise_df, aes(x = time, y = depth, fill = station)) +\n  geom_col() +  # This creates the bars\n  # geom_text(aes(label = station), vjust = -0.3) +  # This adds labels to each bar, adjust vjust for position\n  labs(x = \"Time\", y = \"Depth\", title = \"Depth over Time by Station\") +  # Set labels and title\n  theme_minimal()  # Use a minimal theme\nprint(p)\n\n\n\n\n\n\n\n\n\n\n\ncreate oce.ctd objects from dataframes\nctd_load &lt;- function(data, other_params = NULL) {\n  \n  # create csv into ctd object\n  test_ctd &lt;-\n    as.ctd(\n      salinity    = data$sea_water_salinity,\n      temperature = data$sea_water_temperature,\n      pressure    = data$sea_water_pressure,\n      station     = data$station\n    )\n  \n  # add additional columns to ctd object\n  if (!is.null(other_params)) {\n    for (param_name in other_params) {\n      test_ctd &lt;-\n        oceSetData(\n          object = test_ctd,\n          name   = param_name,\n          value  = data[[param_name]]\n        )\n    }\n  }\n  print(glue(\"{data$station[1]}:\\t{length(test_ctd@data$scan)} scans\"))\n\n\n  return(test_ctd)\n}\n\n# Define other parameters to add\nother_params &lt;- c(\n  \"cruise_id\", \"station\", \"time\", \"time_elapsed\", \n  \"latitude\", \"longitude\", \"sea_water_electrical_conductivity\", \n  \"CDOM\", \"dissolved_oxygen\",\"oxygen_saturation\", \"chlorophyll_concentration\", \n  \"chlorophyll_fluorescence\", \"photosynthetically_available_radiation\", \n  \"beam_attenuation\",\"beam_transmission\", \"depth\", \"sea_water_sigma_t\",\n  \"descent_rate\", \"sound_velocity\",\"altimeter\"\n)\n\n# Split data by station and create data list\nctd_FK &lt;- cruise_df %&gt;%\n  split(.$station) %&gt;%\n  map(~ ctd_load(.x, other_params = other_params)) # ~ is a lambda(x)\n\n\n10: 1212 scans\n12: 2800 scans\n16: 63 scans\n18: 2888 scans\n2:  1334 scans\n21LK:   3192 scans\n30: 2800 scans\n31: 1863 scans\n33: 1989 scans\n41: 1796 scans\n45: 1910 scans\n49: 96 scans\n51: 1027 scans\n53: 57 scans\n54: 69 scans\n54B:    70 scans\n55: 23 scans\n55B:    5 scans\n56: 1351 scans\n57: 1436 scans\n57.1:   3272 scans\n57.1B:  1886 scans\n57.2:   1766 scans\n57.2B:  1987 scans\n57.3:   1555 scans\n57B:    1816 scans\n58: 1626 scans\n59: 1591 scans\n60: 1232 scans\n64: 421 scans\n65: 36 scans\n68: 30 scans\n7:  1189 scans\n9:  3348 scans\n9.5:    9606 scans\nMR: 1600 scans\nWS: 2041 scans\n\n\n\n\nplotting scans for each cast in the first list\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # 1 is selecting only the first sublist\n  # print(i)\n  print(glue(\"=== station: {cast@metadata$station[1]}\"))\n  print(glue(\"# scans: {length(cast@data$scan)}\"))\n  plotScan(cast)\n}\n\n\n=== station: 10\n# scans: 1212\n\n\n\n\n\n\n\n\n\n=== station: 12\n# scans: 2800\n\n\n\n\n\n\n\n\n\n=== station: 16\n# scans: 63\n\n\n\n\n\n\n\n\n\n=== station: 18\n# scans: 2888\n\n\n\n\n\n\n\n\n\n=== station: 2\n# scans: 1334\n\n\n\n\n\n\n\n\n\n=== station: 21LK\n# scans: 3192\n\n\n\n\n\n\n\n\n\n=== station: 30\n# scans: 2800\n\n\n\n\n\n\n\n\n\n=== station: 31\n# scans: 1863\n\n\n\n\n\n\n\n\n\n=== station: 33\n# scans: 1989\n\n\n\n\n\n\n\n\n\n=== station: 41\n# scans: 1796\n\n\n\n\n\n\n\n\n\n=== station: 45\n# scans: 1910\n\n\n\n\n\n\n\n\n\n=== station: 49\n# scans: 96\n\n\n\n\n\n\n\n\n\n=== station: 51\n# scans: 1027\n\n\n\n\n\n\n\n\n\n=== station: 53\n# scans: 57\n\n\n\n\n\n\n\n\n\n=== station: 54\n# scans: 69\n\n\n\n\n\n\n\n\n\n=== station: 54B\n# scans: 70\n\n\n\n\n\n\n\n\n\n=== station: 55\n# scans: 23\n\n\n\n\n\n\n\n\n\n=== station: 55B\n# scans: 5\n\n\n\n\n\n\n\n\n\n=== station: 56\n# scans: 1351\n\n\n\n\n\n\n\n\n\n=== station: 57\n# scans: 1436\n\n\n\n\n\n\n\n\n\n=== station: 57.1\n# scans: 3272\n\n\n\n\n\n\n\n\n\n=== station: 57.1B\n# scans: 1886\n\n\n\n\n\n\n\n\n\n=== station: 57.2\n# scans: 1766\n\n\n\n\n\n\n\n\n\n=== station: 57.2B\n# scans: 1987\n\n\n\n\n\n\n\n\n\n=== station: 57.3\n# scans: 1555\n\n\n\n\n\n\n\n\n\n=== station: 57B\n# scans: 1816\n\n\n\n\n\n\n\n\n\n=== station: 58\n# scans: 1626\n\n\n\n\n\n\n\n\n\n=== station: 59\n# scans: 1591\n\n\n\n\n\n\n\n\n\n=== station: 60\n# scans: 1232\n\n\n\n\n\n\n\n\n\n=== station: 64\n# scans: 421\n\n\n\n\n\n\n\n\n\n=== station: 65\n# scans: 36\n\n\n\n\n\n\n\n\n\n=== station: 68\n# scans: 30\n\n\n\n\n\n\n\n\n\n=== station: 7\n# scans: 1189\n\n\n\n\n\n\n\n\n\n=== station: 9\n# scans: 3348\n\n\n\n\n\n\n\n\n\n=== station: 9.5\n# scans: 9606\n\n\n\n\n\n\n\n\n\n=== station: MR\n# scans: 1600\n\n\n\n\n\n\n\n\n\n=== station: WS\n# scans: 2041\n\n\n\n\n\n\n\n\n\n\n\nplotting each cast in the first list\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # 1 is selecting only the first sublist\n  tryCatch({\n    plot(ctdDecimate(ctdTrim(cast)))\n  }, error = function(e){\n    print(e)\n  })\n}\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1212' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2800' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2888' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1334' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3192' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2800' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1863' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1989' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1796' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1910' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1027' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 5' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1351' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1436' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3272' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1886' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1766' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1987' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1555' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1816' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1626' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1591' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1232' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 30' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1189' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3348' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 9606' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1600' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2041' in coercion to 'logical(1)'&gt;\n\n\n\n\nplotting other physical parameters for each cast\n# Loop through each CTD cast\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # Assuming each sublist contains only one relevant CTD object\n  tryCatch({\n    # Extract metadata for station name and cruise ID\n    station_name &lt;- cast@metadata$station[1]\n    cruise_id &lt;- cast@data$cruise_id[1]\n\n    # Generate a title with station name and cruise ID\n    overall_title &lt;- glue::glue(\"Station: {station_name}, Cruise ID: {cruise_id}\")\n\n    # Set margins: increase the outer margin for the title\n    par(oma = c(0, 0, 3, 0))  # Top outer margin increased for title\n\n    # Plotting function with specific parameters\n    oce::plot(\n      x = ctdDecimate(ctdTrim(cast)),\n      which = c(\n        \"sea_water_electrical_conductivity\",\n        \"descent_rate\", \"sound_velocity\",\n        \"sea_water_sigma_t\",\"altimeter\"\n      ),\n      main = \"\"  # No main title for individual subplots\n    )\n\n    # Place a single overall title at the top of the plot frame\n    mtext(overall_title, side = 3, line = 1, outer = TRUE, cex = 1.5)\n\n    # Reset outer margins to default\n    par(oma = c(0, 0, 0, 0))\n\n  }, error = function(e) {\n    print(e$message)  # Print any errors that occur during plotting\n  })\n}\n\n\n\n\n\n\n\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n[1] \"unknown xtype value (\\\"6.023636\\\")\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n\n\nplotting other nutrient parameters for each cast\n# Loop through each CTD cast\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # Assuming each sublist contains only one relevant CTD object\n  tryCatch({\n    # Extract metadata for station name and cruise ID\n    station_name &lt;- cast@metadata$station[1]\n    cruise_id &lt;- cast@data$cruise_id[1]\n\n    # Generate a title with station name and cruise ID\n    overall_title &lt;- glue::glue(\"Station: {station_name}, Cruise ID: {cruise_id}\")\n\n    # Set margins: increase the outer margin for the title\n    par(oma = c(0, 0, 3, 0))  # Top outer margin increased for title\n\n    # Plotting function with specific parameters\n    oce::plot(\n      x = ctdDecimate(ctdTrim(cast)),\n      which = c(\n        \"CDOM\", \"dissolved_oxygen\",\n        \"oxygen_saturation\",\n        \"chlorophyll_concentration\", \"chlorophyll_fluorescence\"\n      ),\n      main = \"\"  # No main title for individual subplots\n    )\n\n    # Place a single overall title at the top of the plot frame\n    mtext(overall_title, side = 3, line = 1, outer = TRUE, cex = 1.5)\n\n    # Reset outer margins to default\n    par(oma = c(0, 0, 0, 0))\n\n  }, error = function(e) {\n    print(e$message)  # Print any errors that occur during plotting\n  })\n}\n\n\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"plot.new has not been called yet\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n\n\n\n\nplotting other optical parameters for each cast\n# Loop through each CTD cast\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # Assuming each sublist contains only one relevant CTD object\n  tryCatch({\n    # Extract metadata for station name and cruise ID\n    station_name &lt;- cast@metadata$station[1]\n    cruise_id &lt;- cast@data$cruise_id[1]\n\n    # Generate a title with station name and cruise ID\n    overall_title &lt;- glue::glue(\"Station: {station_name}, Cruise ID: {cruise_id}\")\n\n    # Set margins: increase the outer margin for the title\n    par(oma = c(0, 0, 3, 0))  # Top outer margin increased for title\n\n    # Plotting function with specific parameters\n    oce::plot(\n      x = ctdDecimate(ctdTrim(cast)),\n      which = c(\n        \"photosynthetically_available_radiation\",\n        \"beam_attenuation\",\"beam_transmission\"\n      ),\n      main = \"\"  # No main title for individual subplots\n    )\n\n    # Place a single overall title at the top of the plot frame\n    mtext(overall_title, side = 3, line = 1, outer = TRUE, cex = 1.5)\n\n    # Reset outer margins to default\n    par(oma = c(0, 0, 0, 0))\n\n  }, error = function(e) {\n    print(e$message)  # Print any errors that occur during plotting\n  })\n}\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"plot.new has not been called yet\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n\n\nloop through every cast, clean, & save\ncombined_df &lt;- data.frame()\nfor (i in seq(ctd_FK)){\n  tryCatch({\n    cast &lt;- ctd_FK[[i]]  # 1 is selecting only the first sublist\n    \n    # print(class(cast))\n    # clean cast \n    trimmed_cast &lt;- ctdTrim(cast)\n    decimated_cast &lt;- ctdDecimate(trimmed_cast, p = 0.5)  # binned to 0.5 m\n    \n    # convert to df\n    cast_df &lt;- as.data.frame(decimated_cast@data)\n    \n    # Add metadata\n    # assumes station ID and cruise ID the same for all & just uses 1st one\n    cast_df &lt;- mutate(\n      cast_df,\n      station = cast@data$station[1],\n      cruise_id = cast@data$cruise_id[1]\n    )\n  \n    # drop NA rows left by cleaning\n    cast_df &lt;- subset(cast_df, !is.na(scan))\n    \n    # Append the data to the combined dataframe\n    combined_df &lt;- rbind(combined_df, cast_df)\n  }, error = function(e){\n    print(glue(\"error in cast {cast@metadata$station[1]}\"))\n    print(e)\n  })\n}\n# Save to CSV\nfile_path &lt;- here(glue(\"data/cleaned/{cruise_id}.csv\"))\nwrite.csv(combined_df, file_path, row.names = FALSE)"
  },
  {
    "objectID": "cruise_report/cruise_reports/WS1418.html",
    "href": "cruise_report/cruise_reports/WS1418.html",
    "title": "WS1418",
    "section": "",
    "text": "WS1418\n\n\nsetup\nif (!nzchar(system.file(package = \"librarian\"))) {\n  install.packages(\"librarian\")\n}\n\nlibrarian::shelf(\n  quiet = TRUE,\n  readr, here, fs, ggplot2, glue, \"jiho/castr\", dplyr, oce, patchwork, purrr, tidyr\n)\n\n\n\n\nCode\nsource(here(\"R/cruise_load.R\"))\ncruise_df &lt;- cruise_load(params$cruise_id)\n\n\n\n\nplot depth & pressure vs time elapsed\ntryCatch({\n  plots &lt;- list()\n  \n  for (station_name in unique(cruise_df$station)) {\n    subset_df &lt;- filter(cruise_df, station == station_name)\n    plots[[station_name]] &lt;- ggplot(subset_df, aes(x = time_elapsed)) +\n      geom_point(aes(y = depth), color = \"blue\") +  # Plot depth in blue\n      geom_line(aes(y = sea_water_pressure), color = \"red\") +  # Plot sea water pressure in red\n      ggtitle(glue(\"{station_name}\")) +\n      theme(\n        axis.title.x = element_blank(),\n        axis.title.y = element_blank(),\n        axis.text.x = element_blank(),\n        axis.text.y = element_blank(),\n        axis.ticks.x = element_blank(),\n        axis.ticks.y = element_blank()\n      )  # Remove individual axis titles and text\n  }\n  \n  # drop nulls\n  plots &lt;- purrr::compact(plots)\n  \n  # Combine all plots into a grid\n  combined_plot &lt;- wrap_plots(plots) + \n    plot_layout(ncol = 4) +  # Adjust ncol to set number of columns in the grid\n    plot_annotation(\n      title = \"Depth (blue) and Pressure (red)\",\n      subtitle = \"Each panel represents a different station\",\n      caption = \"Time Elapsed (x-axis) vs Depth & Pressure (y-axis)\"\n    ) +\n    theme(\n      plot.tag = element_text(size = 12, face = \"bold\"),\n      plot.tag.position = \"topleft\",\n      axis.title.x = element_text(margin = margin(t = 10)),\n      axis.title.y = element_text(margin = margin(r = 10))\n    )\n  \n  print(combined_plot)\n}, error = function(er){\n  print(er)\n});\n\n\n\n\n\n\n\n\n\n\n\nplot across all stations\np &lt;- ggplot(cruise_df, aes(x = time, y = depth, fill = station)) +\n  geom_col() +  # This creates the bars\n  # geom_text(aes(label = station), vjust = -0.3) +  # This adds labels to each bar, adjust vjust for position\n  labs(x = \"Time\", y = \"Depth\", title = \"Depth over Time by Station\") +  # Set labels and title\n  theme_minimal()  # Use a minimal theme\nprint(p)\n\n\n\n\n\n\n\n\n\n\n\ncreate oce.ctd objects from dataframes\nctd_load &lt;- function(data, other_params = NULL) {\n  \n  # create csv into ctd object\n  test_ctd &lt;-\n    as.ctd(\n      salinity    = data$sea_water_salinity,\n      temperature = data$sea_water_temperature,\n      pressure    = data$sea_water_pressure,\n      station     = data$station\n    )\n  \n  # add additional columns to ctd object\n  if (!is.null(other_params)) {\n    for (param_name in other_params) {\n      test_ctd &lt;-\n        oceSetData(\n          object = test_ctd,\n          name   = param_name,\n          value  = data[[param_name]]\n        )\n    }\n  }\n  print(glue(\"{data$station[1]}:\\t{length(test_ctd@data$scan)} scans\"))\n\n\n  return(test_ctd)\n}\n\n# Define other parameters to add\nother_params &lt;- c(\n  \"cruise_id\", \"station\", \"time\", \"time_elapsed\", \n  \"latitude\", \"longitude\", \"sea_water_electrical_conductivity\", \n  \"CDOM\", \"dissolved_oxygen\",\"oxygen_saturation\", \"chlorophyll_concentration\", \n  \"chlorophyll_fluorescence\", \"photosynthetically_available_radiation\", \n  \"beam_attenuation\",\"beam_transmission\", \"depth\", \"sea_water_sigma_t\",\n  \"descent_rate\", \"sound_velocity\",\"altimeter\"\n)\n\n# Split data by station and create data list\nctd_FK &lt;- cruise_df %&gt;%\n  split(.$station) %&gt;%\n  map(~ ctd_load(.x, other_params = other_params)) # ~ is a lambda(x)\n\n\n10: 1158 scans\n1016:   1787 scans\n3:  2133 scans\n30: 3892 scans\n31: 1646 scans\n33: 3112 scans\n41: 1320 scans\n45: 973 scans\n49: 1749 scans\n51: 1105 scans\n53: 10 scans\n54: 2924 scans\n54B:    318 scans\n55: 36 scans\n55B:    811 scans\n56: 1352 scans\n56B:    1336 scans\n57: 1880 scans\n57.1:   1493 scans\n57.1B:  1414 scans\n57.2:   2101 scans\n57.2B:  2689 scans\n57.3:   1630 scans\n57B:    1613 scans\n58: 1947 scans\n59: 1719 scans\n60: 2566 scans\n61: 1709 scans\n62: 1142 scans\n63: 1563 scans\n64: 1247 scans\n65: 1216 scans\n66: 1665 scans\n67: 1983 scans\n68: 1677 scans\n69: 1411 scans\n7:  1076 scans\n7.B:    835 scans\n70: 1047 scans\n71: 15 scans\n\n\n\n\nplotting scans for each cast in the first list\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # 1 is selecting only the first sublist\n  # print(i)\n  print(glue(\"=== station: {cast@metadata$station[1]}\"))\n  print(glue(\"# scans: {length(cast@data$scan)}\"))\n  plotScan(cast)\n}\n\n\n=== station: 10\n# scans: 1158\n\n\n\n\n\n\n\n\n\n=== station: 1016\n# scans: 1787\n\n\n\n\n\n\n\n\n\n=== station: 3\n# scans: 2133\n\n\n\n\n\n\n\n\n\n=== station: 30\n# scans: 3892\n\n\n\n\n\n\n\n\n\n=== station: 31\n# scans: 1646\n\n\n\n\n\n\n\n\n\n=== station: 33\n# scans: 3112\n\n\n\n\n\n\n\n\n\n=== station: 41\n# scans: 1320\n\n\n\n\n\n\n\n\n\n=== station: 45\n# scans: 973\n\n\n\n\n\n\n\n\n\n=== station: 49\n# scans: 1749\n\n\n\n\n\n\n\n\n\n=== station: 51\n# scans: 1105\n\n\n\n\n\n\n\n\n\n=== station: 53\n# scans: 10\n\n\n\n\n\n\n\n\n\n=== station: 54\n# scans: 2924\n\n\n\n\n\n\n\n\n\n=== station: 54B\n# scans: 318\n\n\n\n\n\n\n\n\n\n=== station: 55\n# scans: 36\n\n\n\n\n\n\n\n\n\n=== station: 55B\n# scans: 811\n\n\n\n\n\n\n\n\n\n=== station: 56\n# scans: 1352\n\n\n\n\n\n\n\n\n\n=== station: 56B\n# scans: 1336\n\n\n\n\n\n\n\n\n\n=== station: 57\n# scans: 1880\n\n\n\n\n\n\n\n\n\n=== station: 57.1\n# scans: 1493\n\n\n\n\n\n\n\n\n\n=== station: 57.1B\n# scans: 1414\n\n\n\n\n\n\n\n\n\n=== station: 57.2\n# scans: 2101\n\n\n\n\n\n\n\n\n\n=== station: 57.2B\n# scans: 2689\n\n\n\n\n\n\n\n\n\n=== station: 57.3\n# scans: 1630\n\n\n\n\n\n\n\n\n\n=== station: 57B\n# scans: 1613\n\n\n\n\n\n\n\n\n\n=== station: 58\n# scans: 1947\n\n\n\n\n\n\n\n\n\n=== station: 59\n# scans: 1719\n\n\n\n\n\n\n\n\n\n=== station: 60\n# scans: 2566\n\n\n\n\n\n\n\n\n\n=== station: 61\n# scans: 1709\n\n\n\n\n\n\n\n\n\n=== station: 62\n# scans: 1142\n\n\n\n\n\n\n\n\n\n=== station: 63\n# scans: 1563\n\n\n\n\n\n\n\n\n\n=== station: 64\n# scans: 1247\n\n\n\n\n\n\n\n\n\n=== station: 65\n# scans: 1216\n\n\n\n\n\n\n\n\n\n=== station: 66\n# scans: 1665\n\n\n\n\n\n\n\n\n\n=== station: 67\n# scans: 1983\n\n\n\n\n\n\n\n\n\n=== station: 68\n# scans: 1677\n\n\n\n\n\n\n\n\n\n=== station: 69\n# scans: 1411\n\n\n\n\n\n\n\n\n\n=== station: 7\n# scans: 1076\n\n\n\n\n\n\n\n\n\n=== station: 7.B\n# scans: 835\n\n\n\n\n\n\n\n\n\n=== station: 70\n# scans: 1047\n\n\n\n\n\n\n\n\n\n=== station: 71\n# scans: 15\n\n\n\n\n\n\n\n\n\n\n\nplotting each cast in the first list\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # 1 is selecting only the first sublist\n  tryCatch({\n    plot(ctdDecimate(ctdTrim(cast)))\n  }, error = function(e){\n    print(e)\n  })\n}\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1158' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1787' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2133' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3892' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1646' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3112' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1320' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 973' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1105' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2924' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 318' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 811' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1352' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1336' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1880' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1493' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1414' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2101' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2689' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1630' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1613' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1947' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1719' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2566' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1709' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1142' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1563' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1247' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1216' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1665' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1983' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1677' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1411' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1076' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 835' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1047' in coercion to 'logical(1)'&gt;\n\n\n\n\nplotting other physical parameters for each cast\n# Loop through each CTD cast\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # Assuming each sublist contains only one relevant CTD object\n  tryCatch({\n    # Extract metadata for station name and cruise ID\n    station_name &lt;- cast@metadata$station[1]\n    cruise_id &lt;- cast@data$cruise_id[1]\n\n    # Generate a title with station name and cruise ID\n    overall_title &lt;- glue::glue(\"Station: {station_name}, Cruise ID: {cruise_id}\")\n\n    # Set margins: increase the outer margin for the title\n    par(oma = c(0, 0, 3, 0))  # Top outer margin increased for title\n\n    # Plotting function with specific parameters\n    oce::plot(\n      x = ctdDecimate(ctdTrim(cast)),\n      which = c(\n        \"sea_water_electrical_conductivity\",\n        \"descent_rate\", \"sound_velocity\",\n        \"sea_water_sigma_t\",\"altimeter\"\n      ),\n      main = \"\"  # No main title for individual subplots\n    )\n\n    # Place a single overall title at the top of the plot frame\n    mtext(overall_title, side = 3, line = 1, outer = TRUE, cex = 1.5)\n\n    # Reset outer margins to default\n    par(oma = c(0, 0, 0, 0))\n\n  }, error = function(e) {\n    print(e$message)  # Print any errors that occur during plotting\n  })\n}\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n\n\nplotting other nutrient parameters for each cast\n# Loop through each CTD cast\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # Assuming each sublist contains only one relevant CTD object\n  tryCatch({\n    # Extract metadata for station name and cruise ID\n    station_name &lt;- cast@metadata$station[1]\n    cruise_id &lt;- cast@data$cruise_id[1]\n\n    # Generate a title with station name and cruise ID\n    overall_title &lt;- glue::glue(\"Station: {station_name}, Cruise ID: {cruise_id}\")\n\n    # Set margins: increase the outer margin for the title\n    par(oma = c(0, 0, 3, 0))  # Top outer margin increased for title\n\n    # Plotting function with specific parameters\n    oce::plot(\n      x = ctdDecimate(ctdTrim(cast)),\n      which = c(\n        \"CDOM\", \"dissolved_oxygen\",\n        \"oxygen_saturation\",\n        \"chlorophyll_concentration\", \"chlorophyll_fluorescence\"\n      ),\n      main = \"\"  # No main title for individual subplots\n    )\n\n    # Place a single overall title at the top of the plot frame\n    mtext(overall_title, side = 3, line = 1, outer = TRUE, cex = 1.5)\n\n    # Reset outer margins to default\n    par(oma = c(0, 0, 0, 0))\n\n  }, error = function(e) {\n    print(e$message)  # Print any errors that occur during plotting\n  })\n}\n\n\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"plot.new has not been called yet\"\n\n\n\n\nplotting other optical parameters for each cast\n# Loop through each CTD cast\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # Assuming each sublist contains only one relevant CTD object\n  tryCatch({\n    # Extract metadata for station name and cruise ID\n    station_name &lt;- cast@metadata$station[1]\n    cruise_id &lt;- cast@data$cruise_id[1]\n\n    # Generate a title with station name and cruise ID\n    overall_title &lt;- glue::glue(\"Station: {station_name}, Cruise ID: {cruise_id}\")\n\n    # Set margins: increase the outer margin for the title\n    par(oma = c(0, 0, 3, 0))  # Top outer margin increased for title\n\n    # Plotting function with specific parameters\n    oce::plot(\n      x = ctdDecimate(ctdTrim(cast)),\n      which = c(\n        \"photosynthetically_available_radiation\",\n        \"beam_attenuation\",\"beam_transmission\"\n      ),\n      main = \"\"  # No main title for individual subplots\n    )\n\n    # Place a single overall title at the top of the plot frame\n    mtext(overall_title, side = 3, line = 1, outer = TRUE, cex = 1.5)\n\n    # Reset outer margins to default\n    par(oma = c(0, 0, 0, 0))\n\n  }, error = function(e) {\n    print(e$message)  # Print any errors that occur during plotting\n  })\n}\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n\n\nloop through every cast, clean, & save\ncombined_df &lt;- data.frame()\nfor (i in seq(ctd_FK)){\n  tryCatch({\n    cast &lt;- ctd_FK[[i]]  # 1 is selecting only the first sublist\n    \n    # print(class(cast))\n    # clean cast \n    trimmed_cast &lt;- ctdTrim(cast)\n    decimated_cast &lt;- ctdDecimate(trimmed_cast, p = 0.5)  # binned to 0.5 m\n    \n    # convert to df\n    cast_df &lt;- as.data.frame(decimated_cast@data)\n    \n    # Add metadata\n    # assumes station ID and cruise ID the same for all & just uses 1st one\n    cast_df &lt;- mutate(\n      cast_df,\n      station = cast@data$station[1],\n      cruise_id = cast@data$cruise_id[1]\n    )\n  \n    # drop NA rows left by cleaning\n    cast_df &lt;- subset(cast_df, !is.na(scan))\n    \n    # Append the data to the combined dataframe\n    combined_df &lt;- rbind(combined_df, cast_df)\n  }, error = function(e){\n    print(glue(\"error in cast {cast@metadata$station[1]}\"))\n    print(e)\n  })\n}\n# Save to CSV\nfile_path &lt;- here(glue(\"data/cleaned/{cruise_id}.csv\"))\nwrite.csv(combined_df, file_path, row.names = FALSE)"
  },
  {
    "objectID": "cruise_report/cruise_reports/WS1207.html",
    "href": "cruise_report/cruise_reports/WS1207.html",
    "title": "WS1207",
    "section": "",
    "text": "WS1207\n\n\nsetup\nif (!nzchar(system.file(package = \"librarian\"))) {\n  install.packages(\"librarian\")\n}\n\nlibrarian::shelf(\n  quiet = TRUE,\n  readr, here, fs, ggplot2, glue, \"jiho/castr\", dplyr, oce, patchwork, purrr, tidyr\n)\n\n\n\n\nCode\nsource(here(\"R/cruise_load.R\"))\ncruise_df &lt;- cruise_load(params$cruise_id)\n\n\n\n\nplot depth & pressure vs time elapsed\ntryCatch({\n  plots &lt;- list()\n  \n  for (station_name in unique(cruise_df$station)) {\n    subset_df &lt;- filter(cruise_df, station == station_name)\n    plots[[station_name]] &lt;- ggplot(subset_df, aes(x = time_elapsed)) +\n      geom_point(aes(y = depth), color = \"blue\") +  # Plot depth in blue\n      geom_line(aes(y = sea_water_pressure), color = \"red\") +  # Plot sea water pressure in red\n      ggtitle(glue(\"{station_name}\")) +\n      theme(\n        axis.title.x = element_blank(),\n        axis.title.y = element_blank(),\n        axis.text.x = element_blank(),\n        axis.text.y = element_blank(),\n        axis.ticks.x = element_blank(),\n        axis.ticks.y = element_blank()\n      )  # Remove individual axis titles and text\n  }\n  \n  # drop nulls\n  plots &lt;- purrr::compact(plots)\n  \n  # Combine all plots into a grid\n  combined_plot &lt;- wrap_plots(plots) + \n    plot_layout(ncol = 4) +  # Adjust ncol to set number of columns in the grid\n    plot_annotation(\n      title = \"Depth (blue) and Pressure (red)\",\n      subtitle = \"Each panel represents a different station\",\n      caption = \"Time Elapsed (x-axis) vs Depth & Pressure (y-axis)\"\n    ) +\n    theme(\n      plot.tag = element_text(size = 12, face = \"bold\"),\n      plot.tag.position = \"topleft\",\n      axis.title.x = element_text(margin = margin(t = 10)),\n      axis.title.y = element_text(margin = margin(r = 10))\n    )\n  \n  print(combined_plot)\n}, error = function(er){\n  print(er)\n});\n\n\n\n\n\n\n\n\n\n\n\nplot across all stations\np &lt;- ggplot(cruise_df, aes(x = time, y = depth, fill = station)) +\n  geom_col() +  # This creates the bars\n  # geom_text(aes(label = station), vjust = -0.3) +  # This adds labels to each bar, adjust vjust for position\n  labs(x = \"Time\", y = \"Depth\", title = \"Depth over Time by Station\") +  # Set labels and title\n  theme_minimal()  # Use a minimal theme\nprint(p)\n\n\n\n\n\n\n\n\n\n\n\ncreate oce.ctd objects from dataframes\nctd_load &lt;- function(data, other_params = NULL) {\n  \n  # create csv into ctd object\n  test_ctd &lt;-\n    as.ctd(\n      salinity    = data$sea_water_salinity,\n      temperature = data$sea_water_temperature,\n      pressure    = data$sea_water_pressure,\n      station     = data$station\n    )\n  \n  # add additional columns to ctd object\n  if (!is.null(other_params)) {\n    for (param_name in other_params) {\n      test_ctd &lt;-\n        oceSetData(\n          object = test_ctd,\n          name   = param_name,\n          value  = data[[param_name]]\n        )\n    }\n  }\n  print(glue(\"{data$station[1]}:\\t{length(test_ctd@data$scan)} scans\"))\n\n\n  return(test_ctd)\n}\n\n# Define other parameters to add\nother_params &lt;- c(\n  \"cruise_id\", \"station\", \"time\", \"time_elapsed\", \n  \"latitude\", \"longitude\", \"sea_water_electrical_conductivity\", \n  \"CDOM\", \"dissolved_oxygen\",\"oxygen_saturation\", \"chlorophyll_concentration\", \n  \"chlorophyll_fluorescence\", \"photosynthetically_available_radiation\", \n  \"beam_attenuation\",\"beam_transmission\", \"depth\", \"sea_water_sigma_t\",\n  \"descent_rate\", \"sound_velocity\",\"altimeter\"\n)\n\n# Split data by station and create data list\nctd_FK &lt;- cruise_df %&gt;%\n  split(.$station) %&gt;%\n  map(~ ctd_load(.x, other_params = other_params)) # ~ is a lambda(x)\n\n\n1:  6229 scans\n10: 942 scans\n11: 5932 scans\n116:    2668 scans\n117:    2897 scans\n16: 2668 scans\n17: 2897 scans\n18: 3082 scans\n19: 600 scans\n20: 981 scans\n21: 2 scans\n21.5:   6642 scans\n22.5:   6773 scans\n23: 1437 scans\n24: 2437 scans\n25.5:   10862 scans\n28: 2225 scans\n29: 2954 scans\n3:  4950 scans\n30: 2133 scans\n31: 1438 scans\n34: 744 scans\n39: 905 scans\n42: 1043 scans\n49: 812 scans\n5:  1140 scans\n50: 817 scans\n53: 856 scans\n54: 825 scans\n56: 658 scans\n58: 3347 scans\n6:  4531 scans\n6.5:    4442 scans\n60: 1007 scans\n68: 1462 scans\n69: 922 scans\n7:  3066 scans\n9:  2669 scans\n9.5:    7519 scans\n\n\n\n\nplotting scans for each cast in the first list\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # 1 is selecting only the first sublist\n  # print(i)\n  print(glue(\"=== station: {cast@metadata$station[1]}\"))\n  print(glue(\"# scans: {length(cast@data$scan)}\"))\n  plotScan(cast)\n}\n\n\n=== station: 1\n# scans: 6229\n\n\n\n\n\n\n\n\n\n=== station: 10\n# scans: 942\n\n\n\n\n\n\n\n\n\n=== station: 11\n# scans: 5932\n\n\n\n\n\n\n\n\n\n=== station: 116\n# scans: 2668\n\n\n\n\n\n\n\n\n\n=== station: 117\n# scans: 2897\n\n\n\n\n\n\n\n\n\n=== station: 16\n# scans: 2668\n\n\n\n\n\n\n\n\n\n=== station: 17\n# scans: 2897\n\n\n\n\n\n\n\n\n\n=== station: 18\n# scans: 3082\n\n\n\n\n\n\n\n\n\n=== station: 19\n# scans: 600\n\n\n\n\n\n\n\n\n\n=== station: 20\n# scans: 981\n\n\n\n\n\n\n\n\n\n=== station: 21\n# scans: 2\n\n\n\n\n\n\n\n\n\n=== station: 21.5\n# scans: 6642\n\n\n\n\n\n\n\n\n\n=== station: 22.5\n# scans: 6773\n\n\n\n\n\n\n\n\n\n=== station: 23\n# scans: 1437\n\n\n\n\n\n\n\n\n\n=== station: 24\n# scans: 2437\n\n\n\n\n\n\n\n\n\n=== station: 25.5\n# scans: 10862\n\n\n\n\n\n\n\n\n\n=== station: 28\n# scans: 2225\n\n\n\n\n\n\n\n\n\n=== station: 29\n# scans: 2954\n\n\n\n\n\n\n\n\n\n=== station: 3\n# scans: 4950\n\n\n\n\n\n\n\n\n\n=== station: 30\n# scans: 2133\n\n\n\n\n\n\n\n\n\n=== station: 31\n# scans: 1438\n\n\n\n\n\n\n\n\n\n=== station: 34\n# scans: 744\n\n\n\n\n\n\n\n\n\n=== station: 39\n# scans: 905\n\n\n\n\n\n\n\n\n\n=== station: 42\n# scans: 1043\n\n\n\n\n\n\n\n\n\n=== station: 49\n# scans: 812\n\n\n\n\n\n\n\n\n\n=== station: 5\n# scans: 1140\n\n\n\n\n\n\n\n\n\n=== station: 50\n# scans: 817\n\n\n\n\n\n\n\n\n\n=== station: 53\n# scans: 856\n\n\n\n\n\n\n\n\n\n=== station: 54\n# scans: 825\n\n\n\n\n\n\n\n\n\n=== station: 56\n# scans: 658\n\n\n\n\n\n\n\n\n\n=== station: 58\n# scans: 3347\n\n\n\n\n\n\n\n\n\n=== station: 6\n# scans: 4531\n\n\n\n\n\n\n\n\n\n=== station: 6.5\n# scans: 4442\n\n\n\n\n\n\n\n\n\n=== station: 60\n# scans: 1007\n\n\n\n\n\n\n\n\n\n=== station: 68\n# scans: 1462\n\n\n\n\n\n\n\n\n\n=== station: 69\n# scans: 922\n\n\n\n\n\n\n\n\n\n=== station: 7\n# scans: 3066\n\n\n\n\n\n\n\n\n\n=== station: 9\n# scans: 2669\n\n\n\n\n\n\n\n\n\n=== station: 9.5\n# scans: 7519\n\n\n\n\n\n\n\n\n\n\n\nplotting each cast in the first list\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # 1 is selecting only the first sublist\n  tryCatch({\n    plot(ctdDecimate(ctdTrim(cast)))\n  }, error = function(e){\n    print(e)\n  })\n}\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 6229' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 942' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 5932' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2668' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2897' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2668' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2897' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3082' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 600' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 981' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 6642' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 6773' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1437' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2437' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 10862' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2225' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2954' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4950' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2133' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1438' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 744' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 905' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1043' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 812' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1140' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 817' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 856' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 825' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 658' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3347' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4531' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4442' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1007' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1462' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 922' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3066' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2669' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 7519' in coercion to 'logical(1)'&gt;\n\n\n\n\nplotting other physical parameters for each cast\n# Loop through each CTD cast\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # Assuming each sublist contains only one relevant CTD object\n  tryCatch({\n    # Extract metadata for station name and cruise ID\n    station_name &lt;- cast@metadata$station[1]\n    cruise_id &lt;- cast@data$cruise_id[1]\n\n    # Generate a title with station name and cruise ID\n    overall_title &lt;- glue::glue(\"Station: {station_name}, Cruise ID: {cruise_id}\")\n\n    # Set margins: increase the outer margin for the title\n    par(oma = c(0, 0, 3, 0))  # Top outer margin increased for title\n\n    # Plotting function with specific parameters\n    oce::plot(\n      x = ctdDecimate(ctdTrim(cast)),\n      which = c(\n        \"sea_water_electrical_conductivity\",\n        \"descent_rate\", \"sound_velocity\",\n        \"sea_water_sigma_t\",\"altimeter\"\n      ),\n      main = \"\"  # No main title for individual subplots\n    )\n\n    # Place a single overall title at the top of the plot frame\n    mtext(overall_title, side = 3, line = 1, outer = TRUE, cex = 1.5)\n\n    # Reset outer margins to default\n    par(oma = c(0, 0, 0, 0))\n\n  }, error = function(e) {\n    print(e$message)  # Print any errors that occur during plotting\n  })\n}\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n\n\nplotting other nutrient parameters for each cast\n# Loop through each CTD cast\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # Assuming each sublist contains only one relevant CTD object\n  tryCatch({\n    # Extract metadata for station name and cruise ID\n    station_name &lt;- cast@metadata$station[1]\n    cruise_id &lt;- cast@data$cruise_id[1]\n\n    # Generate a title with station name and cruise ID\n    overall_title &lt;- glue::glue(\"Station: {station_name}, Cruise ID: {cruise_id}\")\n\n    # Set margins: increase the outer margin for the title\n    par(oma = c(0, 0, 3, 0))  # Top outer margin increased for title\n\n    # Plotting function with specific parameters\n    oce::plot(\n      x = ctdDecimate(ctdTrim(cast)),\n      which = c(\n        \"CDOM\", \"dissolved_oxygen\",\n        \"oxygen_saturation\",\n        \"chlorophyll_concentration\", \"chlorophyll_fluorescence\"\n      ),\n      main = \"\"  # No main title for individual subplots\n    )\n\n    # Place a single overall title at the top of the plot frame\n    mtext(overall_title, side = 3, line = 1, outer = TRUE, cex = 1.5)\n\n    # Reset outer margins to default\n    par(oma = c(0, 0, 0, 0))\n\n  }, error = function(e) {\n    print(e$message)  # Print any errors that occur during plotting\n  })\n}\n\n\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n\n\n\n\nplotting other optical parameters for each cast\n# Loop through each CTD cast\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # Assuming each sublist contains only one relevant CTD object\n  tryCatch({\n    # Extract metadata for station name and cruise ID\n    station_name &lt;- cast@metadata$station[1]\n    cruise_id &lt;- cast@data$cruise_id[1]\n\n    # Generate a title with station name and cruise ID\n    overall_title &lt;- glue::glue(\"Station: {station_name}, Cruise ID: {cruise_id}\")\n\n    # Set margins: increase the outer margin for the title\n    par(oma = c(0, 0, 3, 0))  # Top outer margin increased for title\n\n    # Plotting function with specific parameters\n    oce::plot(\n      x = ctdDecimate(ctdTrim(cast)),\n      which = c(\n        \"photosynthetically_available_radiation\",\n        \"beam_attenuation\",\"beam_transmission\"\n      ),\n      main = \"\"  # No main title for individual subplots\n    )\n\n    # Place a single overall title at the top of the plot frame\n    mtext(overall_title, side = 3, line = 1, outer = TRUE, cex = 1.5)\n\n    # Reset outer margins to default\n    par(oma = c(0, 0, 0, 0))\n\n  }, error = function(e) {\n    print(e$message)  # Print any errors that occur during plotting\n  })\n}\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nloop through every cast, clean, & save\ncombined_df &lt;- data.frame()\nfor (i in seq(ctd_FK)){\n  tryCatch({\n    cast &lt;- ctd_FK[[i]]  # 1 is selecting only the first sublist\n    \n    # print(class(cast))\n    # clean cast \n    trimmed_cast &lt;- ctdTrim(cast)\n    decimated_cast &lt;- ctdDecimate(trimmed_cast, p = 0.5)  # binned to 0.5 m\n    \n    # convert to df\n    cast_df &lt;- as.data.frame(decimated_cast@data)\n    \n    # Add metadata\n    # assumes station ID and cruise ID the same for all & just uses 1st one\n    cast_df &lt;- mutate(\n      cast_df,\n      station = cast@data$station[1],\n      cruise_id = cast@data$cruise_id[1]\n    )\n  \n    # drop NA rows left by cleaning\n    cast_df &lt;- subset(cast_df, !is.na(scan))\n    \n    # Append the data to the combined dataframe\n    combined_df &lt;- rbind(combined_df, cast_df)\n  }, error = function(e){\n    print(glue(\"error in cast {cast@metadata$station[1]}\"))\n    print(e)\n  })\n}\n# Save to CSV\nfile_path &lt;- here(glue(\"data/cleaned/{cruise_id}.csv\"))\nwrite.csv(combined_df, file_path, row.names = FALSE)"
  },
  {
    "objectID": "cruise_report/cruise_reports/WS1116.html",
    "href": "cruise_report/cruise_reports/WS1116.html",
    "title": "WS1116",
    "section": "",
    "text": "WS1116\n\n\nsetup\nif (!nzchar(system.file(package = \"librarian\"))) {\n  install.packages(\"librarian\")\n}\n\nlibrarian::shelf(\n  quiet = TRUE,\n  readr, here, fs, ggplot2, glue, \"jiho/castr\", dplyr, oce, patchwork, purrr, tidyr\n)\n\n\n\n\nCode\nsource(here(\"R/cruise_load.R\"))\ncruise_df &lt;- cruise_load(params$cruise_id)\n\n\n\n\nplot depth & pressure vs time elapsed\ntryCatch({\n  plots &lt;- list()\n  \n  for (station_name in unique(cruise_df$station)) {\n    subset_df &lt;- filter(cruise_df, station == station_name)\n    plots[[station_name]] &lt;- ggplot(subset_df, aes(x = time_elapsed)) +\n      geom_point(aes(y = depth), color = \"blue\") +  # Plot depth in blue\n      geom_line(aes(y = sea_water_pressure), color = \"red\") +  # Plot sea water pressure in red\n      ggtitle(glue(\"{station_name}\")) +\n      theme(\n        axis.title.x = element_blank(),\n        axis.title.y = element_blank(),\n        axis.text.x = element_blank(),\n        axis.text.y = element_blank(),\n        axis.ticks.x = element_blank(),\n        axis.ticks.y = element_blank()\n      )  # Remove individual axis titles and text\n  }\n  \n  # drop nulls\n  plots &lt;- purrr::compact(plots)\n  \n  # Combine all plots into a grid\n  combined_plot &lt;- wrap_plots(plots) + \n    plot_layout(ncol = 4) +  # Adjust ncol to set number of columns in the grid\n    plot_annotation(\n      title = \"Depth (blue) and Pressure (red)\",\n      subtitle = \"Each panel represents a different station\",\n      caption = \"Time Elapsed (x-axis) vs Depth & Pressure (y-axis)\"\n    ) +\n    theme(\n      plot.tag = element_text(size = 12, face = \"bold\"),\n      plot.tag.position = \"topleft\",\n      axis.title.x = element_text(margin = margin(t = 10)),\n      axis.title.y = element_text(margin = margin(r = 10))\n    )\n  \n  print(combined_plot)\n}, error = function(er){\n  print(er)\n});\n\n\n\n\n\n\n\n\n\n\n\nplot across all stations\np &lt;- ggplot(cruise_df, aes(x = time, y = depth, fill = station)) +\n  geom_col() +  # This creates the bars\n  # geom_text(aes(label = station), vjust = -0.3) +  # This adds labels to each bar, adjust vjust for position\n  labs(x = \"Time\", y = \"Depth\", title = \"Depth over Time by Station\") +  # Set labels and title\n  theme_minimal()  # Use a minimal theme\nprint(p)\n\n\n\n\n\n\n\n\n\n\n\ncreate oce.ctd objects from dataframes\nctd_load &lt;- function(data, other_params = NULL) {\n  \n  # create csv into ctd object\n  test_ctd &lt;-\n    as.ctd(\n      salinity    = data$sea_water_salinity,\n      temperature = data$sea_water_temperature,\n      pressure    = data$sea_water_pressure,\n      station     = data$station\n    )\n  \n  # add additional columns to ctd object\n  if (!is.null(other_params)) {\n    for (param_name in other_params) {\n      test_ctd &lt;-\n        oceSetData(\n          object = test_ctd,\n          name   = param_name,\n          value  = data[[param_name]]\n        )\n    }\n  }\n  print(glue(\"{data$station[1]}:\\t{length(test_ctd@data$scan)} scans\"))\n\n\n  return(test_ctd)\n}\n\n# Define other parameters to add\nother_params &lt;- c(\n  \"cruise_id\", \"station\", \"time\", \"time_elapsed\", \n  \"latitude\", \"longitude\", \"sea_water_electrical_conductivity\", \n  \"CDOM\", \"dissolved_oxygen\",\"oxygen_saturation\", \"chlorophyll_concentration\", \n  \"chlorophyll_fluorescence\", \"photosynthetically_available_radiation\", \n  \"beam_attenuation\",\"beam_transmission\", \"depth\", \"sea_water_sigma_t\",\n  \"descent_rate\", \"sound_velocity\",\"altimeter\"\n)\n\n# Split data by station and create data list\nctd_FK &lt;- cruise_df %&gt;%\n  split(.$station) %&gt;%\n  map(~ ctd_load(.x, other_params = other_params)) # ~ is a lambda(x)\n\n\n1:  935 scans\n10: 490 scans\n12: 2033 scans\n16: 546 scans\n17: 554 scans\n18: 2148 scans\n19: 1505 scans\n20: 1013 scans\n21.5:   6307 scans\n22.5:   6128 scans\n23: 1077 scans\n24: 1880 scans\n25.5:   11722 scans\n28: 2000 scans\n29: 1995 scans\n3:  4755 scans\n30: 3281 scans\n31: 1379 scans\n5:  1007 scans\n6:  2587 scans\n6.5:    3846 scans\n7:  304 scans\n9:  2831 scans\n9.5:    7238 scans\n\n\n\n\nplotting scans for each cast in the first list\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # 1 is selecting only the first sublist\n  # print(i)\n  print(glue(\"=== station: {cast@metadata$station[1]}\"))\n  print(glue(\"# scans: {length(cast@data$scan)}\"))\n  plotScan(cast)\n}\n\n\n=== station: 1\n# scans: 935\n\n\n\n\n\n\n\n\n\n=== station: 10\n# scans: 490\n\n\n\n\n\n\n\n\n\n=== station: 12\n# scans: 2033\n\n\n\n\n\n\n\n\n\n=== station: 16\n# scans: 546\n\n\n\n\n\n\n\n\n\n=== station: 17\n# scans: 554\n\n\n\n\n\n\n\n\n\n=== station: 18\n# scans: 2148\n\n\n\n\n\n\n\n\n\n=== station: 19\n# scans: 1505\n\n\n\n\n\n\n\n\n\n=== station: 20\n# scans: 1013\n\n\n\n\n\n\n\n\n\n=== station: 21.5\n# scans: 6307\n\n\n\n\n\n\n\n\n\n=== station: 22.5\n# scans: 6128\n\n\n\n\n\n\n\n\n\n=== station: 23\n# scans: 1077\n\n\n\n\n\n\n\n\n\n=== station: 24\n# scans: 1880\n\n\n\n\n\n\n\n\n\n=== station: 25.5\n# scans: 11722\n\n\n\n\n\n\n\n\n\n=== station: 28\n# scans: 2000\n\n\n\n\n\n\n\n\n\n=== station: 29\n# scans: 1995\n\n\n\n\n\n\n\n\n\n=== station: 3\n# scans: 4755\n\n\n\n\n\n\n\n\n\n=== station: 30\n# scans: 3281\n\n\n\n\n\n\n\n\n\n=== station: 31\n# scans: 1379\n\n\n\n\n\n\n\n\n\n=== station: 5\n# scans: 1007\n\n\n\n\n\n\n\n\n\n=== station: 6\n# scans: 2587\n\n\n\n\n\n\n\n\n\n=== station: 6.5\n# scans: 3846\n\n\n\n\n\n\n\n\n\n=== station: 7\n# scans: 304\n\n\n\n\n\n\n\n\n\n=== station: 9\n# scans: 2831\n\n\n\n\n\n\n\n\n\n=== station: 9.5\n# scans: 7238\n\n\n\n\n\n\n\n\n\n\n\nplotting each cast in the first list\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # 1 is selecting only the first sublist\n  tryCatch({\n    plot(ctdDecimate(ctdTrim(cast)))\n  }, error = function(e){\n    print(e)\n  })\n}\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 935' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 490' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2033' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 546' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 554' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2148' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1505' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1013' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 6307' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 6128' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1077' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1880' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 11722' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2000' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1995' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4755' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3281' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1379' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1007' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2587' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3846' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 304' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2831' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 7238' in coercion to 'logical(1)'&gt;\n\n\n\n\nplotting other physical parameters for each cast\n# Loop through each CTD cast\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # Assuming each sublist contains only one relevant CTD object\n  tryCatch({\n    # Extract metadata for station name and cruise ID\n    station_name &lt;- cast@metadata$station[1]\n    cruise_id &lt;- cast@data$cruise_id[1]\n\n    # Generate a title with station name and cruise ID\n    overall_title &lt;- glue::glue(\"Station: {station_name}, Cruise ID: {cruise_id}\")\n\n    # Set margins: increase the outer margin for the title\n    par(oma = c(0, 0, 3, 0))  # Top outer margin increased for title\n\n    # Plotting function with specific parameters\n    oce::plot(\n      x = ctdDecimate(ctdTrim(cast)),\n      which = c(\n        \"sea_water_electrical_conductivity\",\n        \"descent_rate\", \"sound_velocity\",\n        \"sea_water_sigma_t\",\"altimeter\"\n      ),\n      main = \"\"  # No main title for individual subplots\n    )\n\n    # Place a single overall title at the top of the plot frame\n    mtext(overall_title, side = 3, line = 1, outer = TRUE, cex = 1.5)\n\n    # Reset outer margins to default\n    par(oma = c(0, 0, 0, 0))\n\n  }, error = function(e) {\n    print(e$message)  # Print any errors that occur during plotting\n  })\n}\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n[1] \"need finite 'xlim' values\"\n\n\n\n\nplotting other nutrient parameters for each cast\n# Loop through each CTD cast\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # Assuming each sublist contains only one relevant CTD object\n  tryCatch({\n    # Extract metadata for station name and cruise ID\n    station_name &lt;- cast@metadata$station[1]\n    cruise_id &lt;- cast@data$cruise_id[1]\n\n    # Generate a title with station name and cruise ID\n    overall_title &lt;- glue::glue(\"Station: {station_name}, Cruise ID: {cruise_id}\")\n\n    # Set margins: increase the outer margin for the title\n    par(oma = c(0, 0, 3, 0))  # Top outer margin increased for title\n\n    # Plotting function with specific parameters\n    oce::plot(\n      x = ctdDecimate(ctdTrim(cast)),\n      which = c(\n        \"CDOM\", \"dissolved_oxygen\",\n        \"oxygen_saturation\",\n        \"chlorophyll_concentration\", \"chlorophyll_fluorescence\"\n      ),\n      main = \"\"  # No main title for individual subplots\n    )\n\n    # Place a single overall title at the top of the plot frame\n    mtext(overall_title, side = 3, line = 1, outer = TRUE, cex = 1.5)\n\n    # Reset outer margins to default\n    par(oma = c(0, 0, 0, 0))\n\n  }, error = function(e) {\n    print(e$message)  # Print any errors that occur during plotting\n  })\n}\n\n\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n\n\n\n\nplotting other optical parameters for each cast\n# Loop through each CTD cast\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # Assuming each sublist contains only one relevant CTD object\n  tryCatch({\n    # Extract metadata for station name and cruise ID\n    station_name &lt;- cast@metadata$station[1]\n    cruise_id &lt;- cast@data$cruise_id[1]\n\n    # Generate a title with station name and cruise ID\n    overall_title &lt;- glue::glue(\"Station: {station_name}, Cruise ID: {cruise_id}\")\n\n    # Set margins: increase the outer margin for the title\n    par(oma = c(0, 0, 3, 0))  # Top outer margin increased for title\n\n    # Plotting function with specific parameters\n    oce::plot(\n      x = ctdDecimate(ctdTrim(cast)),\n      which = c(\n        \"photosynthetically_available_radiation\",\n        \"beam_attenuation\",\"beam_transmission\"\n      ),\n      main = \"\"  # No main title for individual subplots\n    )\n\n    # Place a single overall title at the top of the plot frame\n    mtext(overall_title, side = 3, line = 1, outer = TRUE, cex = 1.5)\n\n    # Reset outer margins to default\n    par(oma = c(0, 0, 0, 0))\n\n  }, error = function(e) {\n    print(e$message)  # Print any errors that occur during plotting\n  })\n}\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nloop through every cast, clean, & save\ncombined_df &lt;- data.frame()\nfor (i in seq(ctd_FK)){\n  tryCatch({\n    cast &lt;- ctd_FK[[i]]  # 1 is selecting only the first sublist\n    \n    # print(class(cast))\n    # clean cast \n    trimmed_cast &lt;- ctdTrim(cast)\n    decimated_cast &lt;- ctdDecimate(trimmed_cast, p = 0.5)  # binned to 0.5 m\n    \n    # convert to df\n    cast_df &lt;- as.data.frame(decimated_cast@data)\n    \n    # Add metadata\n    # assumes station ID and cruise ID the same for all & just uses 1st one\n    cast_df &lt;- mutate(\n      cast_df,\n      station = cast@data$station[1],\n      cruise_id = cast@data$cruise_id[1]\n    )\n  \n    # drop NA rows left by cleaning\n    cast_df &lt;- subset(cast_df, !is.na(scan))\n    \n    # Append the data to the combined dataframe\n    combined_df &lt;- rbind(combined_df, cast_df)\n  }, error = function(e){\n    print(glue(\"error in cast {cast@metadata$station[1]}\"))\n    print(e)\n  })\n}\n# Save to CSV\nfile_path &lt;- here(glue(\"data/cleaned/{cruise_id}.csv\"))\nwrite.csv(combined_df, file_path, row.names = FALSE)"
  },
  {
    "objectID": "cruise_report/cruise_reports/WS1106.html",
    "href": "cruise_report/cruise_reports/WS1106.html",
    "title": "WS1106",
    "section": "",
    "text": "WS1106\n\n\nsetup\nif (!nzchar(system.file(package = \"librarian\"))) {\n  install.packages(\"librarian\")\n}\n\nlibrarian::shelf(\n  quiet = TRUE,\n  readr, here, fs, ggplot2, glue, \"jiho/castr\", dplyr, oce, patchwork, purrr, tidyr\n)\n\n\n\n\nCode\nsource(here(\"R/cruise_load.R\"))\ncruise_df &lt;- cruise_load(params$cruise_id)\n\n\n\n\nplot depth & pressure vs time elapsed\ntryCatch({\n  plots &lt;- list()\n  \n  for (station_name in unique(cruise_df$station)) {\n    subset_df &lt;- filter(cruise_df, station == station_name)\n    plots[[station_name]] &lt;- ggplot(subset_df, aes(x = time_elapsed)) +\n      geom_point(aes(y = depth), color = \"blue\") +  # Plot depth in blue\n      geom_line(aes(y = sea_water_pressure), color = \"red\") +  # Plot sea water pressure in red\n      ggtitle(glue(\"{station_name}\")) +\n      theme(\n        axis.title.x = element_blank(),\n        axis.title.y = element_blank(),\n        axis.text.x = element_blank(),\n        axis.text.y = element_blank(),\n        axis.ticks.x = element_blank(),\n        axis.ticks.y = element_blank()\n      )  # Remove individual axis titles and text\n  }\n  \n  # drop nulls\n  plots &lt;- purrr::compact(plots)\n  \n  # Combine all plots into a grid\n  combined_plot &lt;- wrap_plots(plots) + \n    plot_layout(ncol = 4) +  # Adjust ncol to set number of columns in the grid\n    plot_annotation(\n      title = \"Depth (blue) and Pressure (red)\",\n      subtitle = \"Each panel represents a different station\",\n      caption = \"Time Elapsed (x-axis) vs Depth & Pressure (y-axis)\"\n    ) +\n    theme(\n      plot.tag = element_text(size = 12, face = \"bold\"),\n      plot.tag.position = \"topleft\",\n      axis.title.x = element_text(margin = margin(t = 10)),\n      axis.title.y = element_text(margin = margin(r = 10))\n    )\n  \n  print(combined_plot)\n}, error = function(er){\n  print(er)\n});\n\n\n\n\n\n\n\n\n\n\n\nplot across all stations\np &lt;- ggplot(cruise_df, aes(x = time, y = depth, fill = station)) +\n  geom_col() +  # This creates the bars\n  # geom_text(aes(label = station), vjust = -0.3) +  # This adds labels to each bar, adjust vjust for position\n  labs(x = \"Time\", y = \"Depth\", title = \"Depth over Time by Station\") +  # Set labels and title\n  theme_minimal()  # Use a minimal theme\nprint(p)\n\n\n\n\n\n\n\n\n\n\n\ncreate oce.ctd objects from dataframes\nctd_load &lt;- function(data, other_params = NULL) {\n  \n  # create csv into ctd object\n  test_ctd &lt;-\n    as.ctd(\n      salinity    = data$sea_water_salinity,\n      temperature = data$sea_water_temperature,\n      pressure    = data$sea_water_pressure,\n      station     = data$station\n    )\n  \n  # add additional columns to ctd object\n  if (!is.null(other_params)) {\n    for (param_name in other_params) {\n      test_ctd &lt;-\n        oceSetData(\n          object = test_ctd,\n          name   = param_name,\n          value  = data[[param_name]]\n        )\n    }\n  }\n  print(glue(\"{data$station[1]}:\\t{length(test_ctd@data$scan)} scans\"))\n\n\n  return(test_ctd)\n}\n\n# Define other parameters to add\nother_params &lt;- c(\n  \"cruise_id\", \"station\", \"time\", \"time_elapsed\", \n  \"latitude\", \"longitude\", \"sea_water_electrical_conductivity\", \n  \"CDOM\", \"dissolved_oxygen\",\"oxygen_saturation\", \"chlorophyll_concentration\", \n  \"chlorophyll_fluorescence\", \"photosynthetically_available_radiation\", \n  \"beam_attenuation\",\"beam_transmission\", \"depth\", \"sea_water_sigma_t\",\n  \"descent_rate\", \"sound_velocity\",\"altimeter\"\n)\n\n# Split data by station and create data list\nctd_FK &lt;- cruise_df %&gt;%\n  split(.$station) %&gt;%\n  map(~ ctd_load(.x, other_params = other_params)) # ~ is a lambda(x)\n\n\n1:  1580 scans\n10: 47 scans\n16: 117 scans\n17: 672 scans\n18: 1405 scans\n19: 637 scans\n20: 1072 scans\n21.5:   7743 scans\n22.5:   7190 scans\n23: 2153 scans\n24: 1642 scans\n25.5:   11768 scans\n28: 1905 scans\n29: 4060 scans\n3:  4294 scans\n30: 2399 scans\n31: 2353 scans\n34: 416 scans\n39: 932 scans\n42: 969 scans\n49: 127 scans\n50: 563 scans\n53: 91 scans\n54: 141 scans\n56: 497 scans\n58: 1200 scans\n6:  2103 scans\n6.5:    4498 scans\n60: 876 scans\n68: 368 scans\n69: 476 scans\n7:  532 scans\n9:  2702 scans\n9.5:    6332 scans\n\n\n\n\nplotting scans for each cast in the first list\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # 1 is selecting only the first sublist\n  # print(i)\n  print(glue(\"=== station: {cast@metadata$station[1]}\"))\n  print(glue(\"# scans: {length(cast@data$scan)}\"))\n  plotScan(cast)\n}\n\n\n=== station: 1\n# scans: 1580\n\n\n\n\n\n\n\n\n\n=== station: 10\n# scans: 47\n\n\n\n\n\n\n\n\n\n=== station: 16\n# scans: 117\n\n\n\n\n\n\n\n\n\n=== station: 17\n# scans: 672\n\n\n\n\n\n\n\n\n\n=== station: 18\n# scans: 1405\n\n\n\n\n\n\n\n\n\n=== station: 19\n# scans: 637\n\n\n\n\n\n\n\n\n\n=== station: 20\n# scans: 1072\n\n\n\n\n\n\n\n\n\n=== station: 21.5\n# scans: 7743\n\n\n\n\n\n\n\n\n\n=== station: 22.5\n# scans: 7190\n\n\n\n\n\n\n\n\n\n=== station: 23\n# scans: 2153\n\n\n\n\n\n\n\n\n\n=== station: 24\n# scans: 1642\n\n\n\n\n\n\n\n\n\n=== station: 25.5\n# scans: 11768\n\n\n\n\n\n\n\n\n\n=== station: 28\n# scans: 1905\n\n\n\n\n\n\n\n\n\n=== station: 29\n# scans: 4060\n\n\n\n\n\n\n\n\n\n=== station: 3\n# scans: 4294\n\n\n\n\n\n\n\n\n\n=== station: 30\n# scans: 2399\n\n\n\n\n\n\n\n\n\n=== station: 31\n# scans: 2353\n\n\n\n\n\n\n\n\n\n=== station: 34\n# scans: 416\n\n\n\n\n\n\n\n\n\n=== station: 39\n# scans: 932\n\n\n\n\n\n\n\n\n\n=== station: 42\n# scans: 969\n\n\n\n\n\n\n\n\n\n=== station: 49\n# scans: 127\n\n\n\n\n\n\n\n\n\n=== station: 50\n# scans: 563\n\n\n\n\n\n\n\n\n\n=== station: 53\n# scans: 91\n\n\n\n\n\n\n\n\n\n=== station: 54\n# scans: 141\n\n\n\n\n\n\n\n\n\n=== station: 56\n# scans: 497\n\n\n\n\n\n\n\n\n\n=== station: 58\n# scans: 1200\n\n\n\n\n\n\n\n\n\n=== station: 6\n# scans: 2103\n\n\n\n\n\n\n\n\n\n=== station: 6.5\n# scans: 4498\n\n\n\n\n\n\n\n\n\n=== station: 60\n# scans: 876\n\n\n\n\n\n\n\n\n\n=== station: 68\n# scans: 368\n\n\n\n\n\n\n\n\n\n=== station: 69\n# scans: 476\n\n\n\n\n\n\n\n\n\n=== station: 7\n# scans: 532\n\n\n\n\n\n\n\n\n\n=== station: 9\n# scans: 2702\n\n\n\n\n\n\n\n\n\n=== station: 9.5\n# scans: 6332\n\n\n\n\n\n\n\n\n\n\n\nplotting each cast in the first list\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # 1 is selecting only the first sublist\n  tryCatch({\n    plot(ctdDecimate(ctdTrim(cast)))\n  }, error = function(e){\n    print(e)\n  })\n}\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1580' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 117' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 672' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1405' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 637' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1072' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 7743' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 7190' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2153' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1642' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 11768' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1905' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4060' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4294' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2399' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2353' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 416' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 932' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 969' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 127' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 563' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 91' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 141' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 497' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1200' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2103' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4498' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 876' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 368' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 476' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 532' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2702' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 6332' in coercion to 'logical(1)'&gt;\n\n\n\n\nplotting other physical parameters for each cast\n# Loop through each CTD cast\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # Assuming each sublist contains only one relevant CTD object\n  tryCatch({\n    # Extract metadata for station name and cruise ID\n    station_name &lt;- cast@metadata$station[1]\n    cruise_id &lt;- cast@data$cruise_id[1]\n\n    # Generate a title with station name and cruise ID\n    overall_title &lt;- glue::glue(\"Station: {station_name}, Cruise ID: {cruise_id}\")\n\n    # Set margins: increase the outer margin for the title\n    par(oma = c(0, 0, 3, 0))  # Top outer margin increased for title\n\n    # Plotting function with specific parameters\n    oce::plot(\n      x = ctdDecimate(ctdTrim(cast)),\n      which = c(\n        \"sea_water_electrical_conductivity\",\n        \"descent_rate\", \"sound_velocity\",\n        \"sea_water_sigma_t\",\"altimeter\"\n      ),\n      main = \"\"  # No main title for individual subplots\n    )\n\n    # Place a single overall title at the top of the plot frame\n    mtext(overall_title, side = 3, line = 1, outer = TRUE, cex = 1.5)\n\n    # Reset outer margins to default\n    par(oma = c(0, 0, 0, 0))\n\n  }, error = function(e) {\n    print(e$message)  # Print any errors that occur during plotting\n  })\n}\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n\n\nplotting other nutrient parameters for each cast\n# Loop through each CTD cast\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # Assuming each sublist contains only one relevant CTD object\n  tryCatch({\n    # Extract metadata for station name and cruise ID\n    station_name &lt;- cast@metadata$station[1]\n    cruise_id &lt;- cast@data$cruise_id[1]\n\n    # Generate a title with station name and cruise ID\n    overall_title &lt;- glue::glue(\"Station: {station_name}, Cruise ID: {cruise_id}\")\n\n    # Set margins: increase the outer margin for the title\n    par(oma = c(0, 0, 3, 0))  # Top outer margin increased for title\n\n    # Plotting function with specific parameters\n    oce::plot(\n      x = ctdDecimate(ctdTrim(cast)),\n      which = c(\n        \"CDOM\", \"dissolved_oxygen\",\n        \"oxygen_saturation\",\n        \"chlorophyll_concentration\", \"chlorophyll_fluorescence\"\n      ),\n      main = \"\"  # No main title for individual subplots\n    )\n\n    # Place a single overall title at the top of the plot frame\n    mtext(overall_title, side = 3, line = 1, outer = TRUE, cex = 1.5)\n\n    # Reset outer margins to default\n    par(oma = c(0, 0, 0, 0))\n\n  }, error = function(e) {\n    print(e$message)  # Print any errors that occur during plotting\n  })\n}\n\n\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n\n\n\n\nplotting other optical parameters for each cast\n# Loop through each CTD cast\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # Assuming each sublist contains only one relevant CTD object\n  tryCatch({\n    # Extract metadata for station name and cruise ID\n    station_name &lt;- cast@metadata$station[1]\n    cruise_id &lt;- cast@data$cruise_id[1]\n\n    # Generate a title with station name and cruise ID\n    overall_title &lt;- glue::glue(\"Station: {station_name}, Cruise ID: {cruise_id}\")\n\n    # Set margins: increase the outer margin for the title\n    par(oma = c(0, 0, 3, 0))  # Top outer margin increased for title\n\n    # Plotting function with specific parameters\n    oce::plot(\n      x = ctdDecimate(ctdTrim(cast)),\n      which = c(\n        \"photosynthetically_available_radiation\",\n        \"beam_attenuation\",\"beam_transmission\"\n      ),\n      main = \"\"  # No main title for individual subplots\n    )\n\n    # Place a single overall title at the top of the plot frame\n    mtext(overall_title, side = 3, line = 1, outer = TRUE, cex = 1.5)\n\n    # Reset outer margins to default\n    par(oma = c(0, 0, 0, 0))\n\n  }, error = function(e) {\n    print(e$message)  # Print any errors that occur during plotting\n  })\n}\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n[1] \"need finite 'xlim' values\"\n\n\n\n\nloop through every cast, clean, & save\ncombined_df &lt;- data.frame()\nfor (i in seq(ctd_FK)){\n  tryCatch({\n    cast &lt;- ctd_FK[[i]]  # 1 is selecting only the first sublist\n    \n    # print(class(cast))\n    # clean cast \n    trimmed_cast &lt;- ctdTrim(cast)\n    decimated_cast &lt;- ctdDecimate(trimmed_cast, p = 0.5)  # binned to 0.5 m\n    \n    # convert to df\n    cast_df &lt;- as.data.frame(decimated_cast@data)\n    \n    # Add metadata\n    # assumes station ID and cruise ID the same for all & just uses 1st one\n    cast_df &lt;- mutate(\n      cast_df,\n      station = cast@data$station[1],\n      cruise_id = cast@data$cruise_id[1]\n    )\n  \n    # drop NA rows left by cleaning\n    cast_df &lt;- subset(cast_df, !is.na(scan))\n    \n    # Append the data to the combined dataframe\n    combined_df &lt;- rbind(combined_df, cast_df)\n  }, error = function(e){\n    print(glue(\"error in cast {cast@metadata$station[1]}\"))\n    print(e)\n  })\n}\n# Save to CSV\nfile_path &lt;- here(glue(\"data/cleaned/{cruise_id}.csv\"))\nwrite.csv(combined_df, file_path, row.names = FALSE)"
  },
  {
    "objectID": "cruise_report/cruise_reports/WS1018.html",
    "href": "cruise_report/cruise_reports/WS1018.html",
    "title": "WS1018",
    "section": "",
    "text": "WS1018\n\n\nsetup\nif (!nzchar(system.file(package = \"librarian\"))) {\n  install.packages(\"librarian\")\n}\n\nlibrarian::shelf(\n  quiet = TRUE,\n  readr, here, fs, ggplot2, glue, \"jiho/castr\", dplyr, oce, patchwork, purrr, tidyr\n)\n\n\n\n\nCode\nsource(here(\"R/cruise_load.R\"))\ncruise_df &lt;- cruise_load(params$cruise_id)\n\n\nWarning: One or more parsing issues, call `problems()` on your data frame for details,\ne.g.:\n  dat &lt;- vroom(...)\n  problems(dat)\n\n\n\n\nplot depth & pressure vs time elapsed\ntryCatch({\n  plots &lt;- list()\n  \n  for (station_name in unique(cruise_df$station)) {\n    subset_df &lt;- filter(cruise_df, station == station_name)\n    plots[[station_name]] &lt;- ggplot(subset_df, aes(x = time_elapsed)) +\n      geom_point(aes(y = depth), color = \"blue\") +  # Plot depth in blue\n      geom_line(aes(y = sea_water_pressure), color = \"red\") +  # Plot sea water pressure in red\n      ggtitle(glue(\"{station_name}\")) +\n      theme(\n        axis.title.x = element_blank(),\n        axis.title.y = element_blank(),\n        axis.text.x = element_blank(),\n        axis.text.y = element_blank(),\n        axis.ticks.x = element_blank(),\n        axis.ticks.y = element_blank()\n      )  # Remove individual axis titles and text\n  }\n  \n  # drop nulls\n  plots &lt;- purrr::compact(plots)\n  \n  # Combine all plots into a grid\n  combined_plot &lt;- wrap_plots(plots) + \n    plot_layout(ncol = 4) +  # Adjust ncol to set number of columns in the grid\n    plot_annotation(\n      title = \"Depth (blue) and Pressure (red)\",\n      subtitle = \"Each panel represents a different station\",\n      caption = \"Time Elapsed (x-axis) vs Depth & Pressure (y-axis)\"\n    ) +\n    theme(\n      plot.tag = element_text(size = 12, face = \"bold\"),\n      plot.tag.position = \"topleft\",\n      axis.title.x = element_text(margin = margin(t = 10)),\n      axis.title.y = element_text(margin = margin(r = 10))\n    )\n  \n  print(combined_plot)\n}, error = function(er){\n  print(er)\n});\n\n\n\n\n\n\n\n\n\n\n\nplot across all stations\np &lt;- ggplot(cruise_df, aes(x = time, y = depth, fill = station)) +\n  geom_col() +  # This creates the bars\n  # geom_text(aes(label = station), vjust = -0.3) +  # This adds labels to each bar, adjust vjust for position\n  labs(x = \"Time\", y = \"Depth\", title = \"Depth over Time by Station\") +  # Set labels and title\n  theme_minimal()  # Use a minimal theme\nprint(p)\n\n\n\n\n\n\n\n\n\n\n\ncreate oce.ctd objects from dataframes\nctd_load &lt;- function(data, other_params = NULL) {\n  \n  # create csv into ctd object\n  test_ctd &lt;-\n    as.ctd(\n      salinity    = data$sea_water_salinity,\n      temperature = data$sea_water_temperature,\n      pressure    = data$sea_water_pressure,\n      station     = data$station\n    )\n  \n  # add additional columns to ctd object\n  if (!is.null(other_params)) {\n    for (param_name in other_params) {\n      test_ctd &lt;-\n        oceSetData(\n          object = test_ctd,\n          name   = param_name,\n          value  = data[[param_name]]\n        )\n    }\n  }\n  print(glue(\"{data$station[1]}:\\t{length(test_ctd@data$scan)} scans\"))\n\n\n  return(test_ctd)\n}\n\n# Define other parameters to add\nother_params &lt;- c(\n  \"cruise_id\", \"station\", \"time\", \"time_elapsed\", \n  \"latitude\", \"longitude\", \"sea_water_electrical_conductivity\", \n  \"CDOM\", \"dissolved_oxygen\",\"oxygen_saturation\", \"chlorophyll_concentration\", \n  \"chlorophyll_fluorescence\", \"photosynthetically_available_radiation\", \n  \"beam_attenuation\",\"beam_transmission\", \"depth\", \"sea_water_sigma_t\",\n  \"descent_rate\", \"sound_velocity\",\"altimeter\"\n)\n\n# Split data by station and create data list\nctd_FK &lt;- cruise_df %&gt;%\n  split(.$station) %&gt;%\n  map(~ ctd_load(.x, other_params = other_params)) # ~ is a lambda(x)\n\n\n1:  2379 scans\n10: 567 scans\n12: 2073 scans\n16: 131 scans\n17: 1056 scans\n18: 1877 scans\n19: 680 scans\n20: 3091 scans\n21.5:   6724 scans\n22.5:   8825 scans\n23: 1057 scans\n24: 989 scans\n3:  3338 scans\n31: 2321 scans\n34: 1264 scans\n39: 18 scans\n42: 854 scans\n49: 210 scans\n5:  2152 scans\n50: 746 scans\n53: 564 scans\n54: 1208 scans\n56: 278 scans\n58: 1989 scans\n6:  4393 scans\n6.5:    4500 scans\n6.75:   7609 scans\n60: 1529 scans\n68: 664 scans\n69: 506 scans\n7:  130 scans\n8:  1560 scans\n9.5:    9735 scans\nCAL1:   2122 scans\nCAL5:   1707 scans\nCH2:    1587 scans\nCH5:    1559 scans\n\n\n\n\nplotting scans for each cast in the first list\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # 1 is selecting only the first sublist\n  # print(i)\n  print(glue(\"=== station: {cast@metadata$station[1]}\"))\n  print(glue(\"# scans: {length(cast@data$scan)}\"))\n  plotScan(cast)\n}\n\n\n=== station: 1\n# scans: 2379\n\n\n\n\n\n\n\n\n\n=== station: 10\n# scans: 567\n\n\n\n\n\n\n\n\n\n=== station: 12\n# scans: 2073\n\n\n\n\n\n\n\n\n\n=== station: 16\n# scans: 131\n\n\n\n\n\n\n\n\n\n=== station: 17\n# scans: 1056\n\n\n\n\n\n\n\n\n\n=== station: 18\n# scans: 1877\n\n\n\n\n\n\n\n\n\n=== station: 19\n# scans: 680\n\n\n\n\n\n\n\n\n\n=== station: 20\n# scans: 3091\n\n\n\n\n\n\n\n\n\n=== station: 21.5\n# scans: 6724\n\n\n\n\n\n\n\n\n\n=== station: 22.5\n# scans: 8825\n\n\n\n\n\n\n\n\n\n=== station: 23\n# scans: 1057\n\n\n\n\n\n\n\n\n\n=== station: 24\n# scans: 989\n\n\n\n\n\n\n\n\n\n=== station: 3\n# scans: 3338\n\n\n\n\n\n\n\n\n\n=== station: 31\n# scans: 2321\n\n\n\n\n\n\n\n\n\n=== station: 34\n# scans: 1264\n\n\n\n\n\n\n\n\n\n=== station: 39\n# scans: 18\n\n\n\n\n\n\n\n\n\n=== station: 42\n# scans: 854\n\n\n\n\n\n\n\n\n\n=== station: 49\n# scans: 210\n\n\n\n\n\n\n\n\n\n=== station: 5\n# scans: 2152\n\n\n\n\n\n\n\n\n\n=== station: 50\n# scans: 746\n\n\n\n\n\n\n\n\n\n=== station: 53\n# scans: 564\n\n\n\n\n\n\n\n\n\n=== station: 54\n# scans: 1208\n\n\n\n\n\n\n\n\n\n=== station: 56\n# scans: 278\n\n\n\n\n\n\n\n\n\n=== station: 58\n# scans: 1989\n\n\n\n\n\n\n\n\n\n=== station: 6\n# scans: 4393\n\n\n\n\n\n\n\n\n\n=== station: 6.5\n# scans: 4500\n\n\n\n\n\n\n\n\n\n=== station: 6.75\n# scans: 7609\n\n\n\n\n\n\n\n\n\n=== station: 60\n# scans: 1529\n\n\n\n\n\n\n\n\n\n=== station: 68\n# scans: 664\n\n\n\n\n\n\n\n\n\n=== station: 69\n# scans: 506\n\n\n\n\n\n\n\n\n\n=== station: 7\n# scans: 130\n\n\n\n\n\n\n\n\n\n=== station: 8\n# scans: 1560\n\n\n\n\n\n\n\n\n\n=== station: 9.5\n# scans: 9735\n\n\n\n\n\n\n\n\n\n=== station: CAL1\n# scans: 2122\n\n\n\n\n\n\n\n\n\n=== station: CAL5\n# scans: 1707\n\n\n\n\n\n\n\n\n\n=== station: CH2\n# scans: 1587\n\n\n\n\n\n\n\n\n\n=== station: CH5\n# scans: 1559\n\n\n\n\n\n\n\n\n\n\n\nplotting each cast in the first list\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # 1 is selecting only the first sublist\n  tryCatch({\n    plot(ctdDecimate(ctdTrim(cast)))\n  }, error = function(e){\n    print(e)\n  })\n}\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2379' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2073' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1056' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1877' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 680' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3091' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 6724' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 8825' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1057' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 989' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3338' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2321' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1264' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 854' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 210' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2152' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 746' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 564' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1208' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 278' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1989' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4393' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4500' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 7609' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1529' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 664' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 506' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1560' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 9735' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2122' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1707' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1587' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1559' in coercion to 'logical(1)'&gt;\n\n\n\n\nplotting other physical parameters for each cast\n# Loop through each CTD cast\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # Assuming each sublist contains only one relevant CTD object\n  tryCatch({\n    # Extract metadata for station name and cruise ID\n    station_name &lt;- cast@metadata$station[1]\n    cruise_id &lt;- cast@data$cruise_id[1]\n\n    # Generate a title with station name and cruise ID\n    overall_title &lt;- glue::glue(\"Station: {station_name}, Cruise ID: {cruise_id}\")\n\n    # Set margins: increase the outer margin for the title\n    par(oma = c(0, 0, 3, 0))  # Top outer margin increased for title\n\n    # Plotting function with specific parameters\n    oce::plot(\n      x = ctdDecimate(ctdTrim(cast)),\n      which = c(\n        \"sea_water_electrical_conductivity\",\n        \"descent_rate\", \"sound_velocity\",\n        \"sea_water_sigma_t\",\"altimeter\"\n      ),\n      main = \"\"  # No main title for individual subplots\n    )\n\n    # Place a single overall title at the top of the plot frame\n    mtext(overall_title, side = 3, line = 1, outer = TRUE, cex = 1.5)\n\n    # Reset outer margins to default\n    par(oma = c(0, 0, 0, 0))\n\n  }, error = function(e) {\n    print(e$message)  # Print any errors that occur during plotting\n  })\n}\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n\n\nplotting other nutrient parameters for each cast\n# Loop through each CTD cast\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # Assuming each sublist contains only one relevant CTD object\n  tryCatch({\n    # Extract metadata for station name and cruise ID\n    station_name &lt;- cast@metadata$station[1]\n    cruise_id &lt;- cast@data$cruise_id[1]\n\n    # Generate a title with station name and cruise ID\n    overall_title &lt;- glue::glue(\"Station: {station_name}, Cruise ID: {cruise_id}\")\n\n    # Set margins: increase the outer margin for the title\n    par(oma = c(0, 0, 3, 0))  # Top outer margin increased for title\n\n    # Plotting function with specific parameters\n    oce::plot(\n      x = ctdDecimate(ctdTrim(cast)),\n      which = c(\n        \"CDOM\", \"dissolved_oxygen\",\n        \"oxygen_saturation\",\n        \"chlorophyll_concentration\", \"chlorophyll_fluorescence\"\n      ),\n      main = \"\"  # No main title for individual subplots\n    )\n\n    # Place a single overall title at the top of the plot frame\n    mtext(overall_title, side = 3, line = 1, outer = TRUE, cex = 1.5)\n\n    # Reset outer margins to default\n    par(oma = c(0, 0, 0, 0))\n\n  }, error = function(e) {\n    print(e$message)  # Print any errors that occur during plotting\n  })\n}\n\n\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"plot.new has not been called yet\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"plot.new has not been called yet\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n\n\n\n\nplotting other optical parameters for each cast\n# Loop through each CTD cast\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # Assuming each sublist contains only one relevant CTD object\n  tryCatch({\n    # Extract metadata for station name and cruise ID\n    station_name &lt;- cast@metadata$station[1]\n    cruise_id &lt;- cast@data$cruise_id[1]\n\n    # Generate a title with station name and cruise ID\n    overall_title &lt;- glue::glue(\"Station: {station_name}, Cruise ID: {cruise_id}\")\n\n    # Set margins: increase the outer margin for the title\n    par(oma = c(0, 0, 3, 0))  # Top outer margin increased for title\n\n    # Plotting function with specific parameters\n    oce::plot(\n      x = ctdDecimate(ctdTrim(cast)),\n      which = c(\n        \"photosynthetically_available_radiation\",\n        \"beam_attenuation\",\"beam_transmission\"\n      ),\n      main = \"\"  # No main title for individual subplots\n    )\n\n    # Place a single overall title at the top of the plot frame\n    mtext(overall_title, side = 3, line = 1, outer = TRUE, cex = 1.5)\n\n    # Reset outer margins to default\n    par(oma = c(0, 0, 0, 0))\n\n  }, error = function(e) {\n    print(e$message)  # Print any errors that occur during plotting\n  })\n}\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n\n\nloop through every cast, clean, & save\ncombined_df &lt;- data.frame()\nfor (i in seq(ctd_FK)){\n  tryCatch({\n    cast &lt;- ctd_FK[[i]]  # 1 is selecting only the first sublist\n    \n    # print(class(cast))\n    # clean cast \n    trimmed_cast &lt;- ctdTrim(cast)\n    decimated_cast &lt;- ctdDecimate(trimmed_cast, p = 0.5)  # binned to 0.5 m\n    \n    # convert to df\n    cast_df &lt;- as.data.frame(decimated_cast@data)\n    \n    # Add metadata\n    # assumes station ID and cruise ID the same for all & just uses 1st one\n    cast_df &lt;- mutate(\n      cast_df,\n      station = cast@data$station[1],\n      cruise_id = cast@data$cruise_id[1]\n    )\n  \n    # drop NA rows left by cleaning\n    cast_df &lt;- subset(cast_df, !is.na(scan))\n    \n    # Append the data to the combined dataframe\n    combined_df &lt;- rbind(combined_df, cast_df)\n  }, error = function(e){\n    print(glue(\"error in cast {cast@metadata$station[1]}\"))\n    print(e)\n  })\n}\n# Save to CSV\nfile_path &lt;- here(glue(\"data/cleaned/{cruise_id}.csv\"))\nwrite.csv(combined_df, file_path, row.names = FALSE)"
  },
  {
    "objectID": "cruise_report/cruise_reports/WS1007.html",
    "href": "cruise_report/cruise_reports/WS1007.html",
    "title": "WS1007",
    "section": "",
    "text": "WS1007\n\n\nsetup\nif (!nzchar(system.file(package = \"librarian\"))) {\n  install.packages(\"librarian\")\n}\n\nlibrarian::shelf(\n  quiet = TRUE,\n  readr, here, fs, ggplot2, glue, \"jiho/castr\", dplyr, oce, patchwork, purrr, tidyr\n)\n\n\n\n\nCode\nsource(here(\"R/cruise_load.R\"))\ncruise_df &lt;- cruise_load(params$cruise_id)\n\n\nWarning: One or more parsing issues, call `problems()` on your data frame for details,\ne.g.:\n  dat &lt;- vroom(...)\n  problems(dat)\n\n\n\n\nplot depth & pressure vs time elapsed\ntryCatch({\n  plots &lt;- list()\n  \n  for (station_name in unique(cruise_df$station)) {\n    subset_df &lt;- filter(cruise_df, station == station_name)\n    plots[[station_name]] &lt;- ggplot(subset_df, aes(x = time_elapsed)) +\n      geom_point(aes(y = depth), color = \"blue\") +  # Plot depth in blue\n      geom_line(aes(y = sea_water_pressure), color = \"red\") +  # Plot sea water pressure in red\n      ggtitle(glue(\"{station_name}\")) +\n      theme(\n        axis.title.x = element_blank(),\n        axis.title.y = element_blank(),\n        axis.text.x = element_blank(),\n        axis.text.y = element_blank(),\n        axis.ticks.x = element_blank(),\n        axis.ticks.y = element_blank()\n      )  # Remove individual axis titles and text\n  }\n  \n  # drop nulls\n  plots &lt;- purrr::compact(plots)\n  \n  # Combine all plots into a grid\n  combined_plot &lt;- wrap_plots(plots) + \n    plot_layout(ncol = 4) +  # Adjust ncol to set number of columns in the grid\n    plot_annotation(\n      title = \"Depth (blue) and Pressure (red)\",\n      subtitle = \"Each panel represents a different station\",\n      caption = \"Time Elapsed (x-axis) vs Depth & Pressure (y-axis)\"\n    ) +\n    theme(\n      plot.tag = element_text(size = 12, face = \"bold\"),\n      plot.tag.position = \"topleft\",\n      axis.title.x = element_text(margin = margin(t = 10)),\n      axis.title.y = element_text(margin = margin(r = 10))\n    )\n  \n  print(combined_plot)\n}, error = function(er){\n  print(er)\n});\n\n\n\n\n\n\n\n\n\n\n\nplot across all stations\np &lt;- ggplot(cruise_df, aes(x = time, y = depth, fill = station)) +\n  geom_col() +  # This creates the bars\n  # geom_text(aes(label = station), vjust = -0.3) +  # This adds labels to each bar, adjust vjust for position\n  labs(x = \"Time\", y = \"Depth\", title = \"Depth over Time by Station\") +  # Set labels and title\n  theme_minimal()  # Use a minimal theme\nprint(p)\n\n\n\n\n\n\n\n\n\n\n\ncreate oce.ctd objects from dataframes\nctd_load &lt;- function(data, other_params = NULL) {\n  \n  # create csv into ctd object\n  test_ctd &lt;-\n    as.ctd(\n      salinity    = data$sea_water_salinity,\n      temperature = data$sea_water_temperature,\n      pressure    = data$sea_water_pressure,\n      station     = data$station\n    )\n  \n  # add additional columns to ctd object\n  if (!is.null(other_params)) {\n    for (param_name in other_params) {\n      test_ctd &lt;-\n        oceSetData(\n          object = test_ctd,\n          name   = param_name,\n          value  = data[[param_name]]\n        )\n    }\n  }\n  print(glue(\"{data$station[1]}:\\t{length(test_ctd@data$scan)} scans\"))\n\n\n  return(test_ctd)\n}\n\n# Define other parameters to add\nother_params &lt;- c(\n  \"cruise_id\", \"station\", \"time\", \"time_elapsed\", \n  \"latitude\", \"longitude\", \"sea_water_electrical_conductivity\", \n  \"CDOM\", \"dissolved_oxygen\",\"oxygen_saturation\", \"chlorophyll_concentration\", \n  \"chlorophyll_fluorescence\", \"photosynthetically_available_radiation\", \n  \"beam_attenuation\",\"beam_transmission\", \"depth\", \"sea_water_sigma_t\",\n  \"descent_rate\", \"sound_velocity\",\"altimeter\"\n)\n\n# Split data by station and create data list\nctd_FK &lt;- cruise_df %&gt;%\n  split(.$station) %&gt;%\n  map(~ ctd_load(.x, other_params = other_params)) # ~ is a lambda(x)\n\n\n1:  4964 scans\n10: 2040 scans\n12: 2767 scans\n16: 1898 scans\n17: 3458 scans\n18: 4103 scans\n19: 2642 scans\n20: 2453 scans\n21.5:   9355 scans\n22.5:   9047 scans\n23: 1875 scans\n24: 1873 scans\n31: 1824 scans\n34: 1172 scans\n39: 2366 scans\n42: 1504 scans\n49: 2951 scans\n5:  3354 scans\n50: 3095 scans\n53: 1922 scans\n54: 814 scans\n56: 803 scans\n58: 3072 scans\n6:  3644 scans\n6.5:    7348 scans\n60: 2318 scans\n675:    9556 scans\n68: 1445 scans\n69: 654 scans\n7:  1964 scans\n9:  4427 scans\n9.5:    7185 scans\nCAL1:   2613 scans\nCAL5:   6172 scans\nCH2:    3225 scans\nCH5:    3478 scans\n\n\n\n\nplotting scans for each cast in the first list\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # 1 is selecting only the first sublist\n  # print(i)\n  print(glue(\"=== station: {cast@metadata$station[1]}\"))\n  print(glue(\"# scans: {length(cast@data$scan)}\"))\n  plotScan(cast)\n}\n\n\n=== station: 1\n# scans: 4964\n\n\n\n\n\n\n\n\n\n=== station: 10\n# scans: 2040\n\n\n\n\n\n\n\n\n\n=== station: 12\n# scans: 2767\n\n\n\n\n\n\n\n\n\n=== station: 16\n# scans: 1898\n\n\n\n\n\n\n\n\n\n=== station: 17\n# scans: 3458\n\n\n\n\n\n\n\n\n\n=== station: 18\n# scans: 4103\n\n\n\n\n\n\n\n\n\n=== station: 19\n# scans: 2642\n\n\n\n\n\n\n\n\n\n=== station: 20\n# scans: 2453\n\n\n\n\n\n\n\n\n\n=== station: 21.5\n# scans: 9355\n\n\n\n\n\n\n\n\n\n=== station: 22.5\n# scans: 9047\n\n\n\n\n\n\n\n\n\n=== station: 23\n# scans: 1875\n\n\n\n\n\n\n\n\n\n=== station: 24\n# scans: 1873\n\n\n\n\n\n\n\n\n\n=== station: 31\n# scans: 1824\n\n\n\n\n\n\n\n\n\n=== station: 34\n# scans: 1172\n\n\n\n\n\n\n\n\n\n=== station: 39\n# scans: 2366\n\n\n\n\n\n\n\n\n\n=== station: 42\n# scans: 1504\n\n\n\n\n\n\n\n\n\n=== station: 49\n# scans: 2951\n\n\n\n\n\n\n\n\n\n=== station: 5\n# scans: 3354\n\n\n\n\n\n\n\n\n\n=== station: 50\n# scans: 3095\n\n\n\n\n\n\n\n\n\n=== station: 53\n# scans: 1922\n\n\n\n\n\n\n\n\n\n=== station: 54\n# scans: 814\n\n\n\n\n\n\n\n\n\n=== station: 56\n# scans: 803\n\n\n\n\n\n\n\n\n\n=== station: 58\n# scans: 3072\n\n\n\n\n\n\n\n\n\n=== station: 6\n# scans: 3644\n\n\n\n\n\n\n\n\n\n=== station: 6.5\n# scans: 7348\n\n\n\n\n\n\n\n\n\n=== station: 60\n# scans: 2318\n\n\n\n\n\n\n\n\n\n=== station: 675\n# scans: 9556\n\n\n\n\n\n\n\n\n\n=== station: 68\n# scans: 1445\n\n\n\n\n\n\n\n\n\n=== station: 69\n# scans: 654\n\n\n\n\n\n\n\n\n\n=== station: 7\n# scans: 1964\n\n\n\n\n\n\n\n\n\n=== station: 9\n# scans: 4427\n\n\n\n\n\n\n\n\n\n=== station: 9.5\n# scans: 7185\n\n\n\n\n\n\n\n\n\n=== station: CAL1\n# scans: 2613\n\n\n\n\n\n\n\n\n\n=== station: CAL5\n# scans: 6172\n\n\n\n\n\n\n\n\n\n=== station: CH2\n# scans: 3225\n\n\n\n\n\n\n\n\n\n=== station: CH5\n# scans: 3478\n\n\n\n\n\n\n\n\n\n\n\nplotting each cast in the first list\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # 1 is selecting only the first sublist\n  tryCatch({\n    plot(ctdDecimate(ctdTrim(cast)))\n  }, error = function(e){\n    print(e)\n  })\n}\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4964' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2040' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2767' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1898' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3458' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4103' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2642' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2453' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 9355' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 9047' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1875' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1873' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1824' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1172' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2366' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1504' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2951' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3354' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3095' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1922' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 814' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 803' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3072' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3644' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 7348' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2318' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 9556' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1445' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 654' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1964' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4427' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 7185' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2613' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 6172' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3225' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3478' in coercion to 'logical(1)'&gt;\n\n\n\n\nplotting other physical parameters for each cast\n# Loop through each CTD cast\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # Assuming each sublist contains only one relevant CTD object\n  tryCatch({\n    # Extract metadata for station name and cruise ID\n    station_name &lt;- cast@metadata$station[1]\n    cruise_id &lt;- cast@data$cruise_id[1]\n\n    # Generate a title with station name and cruise ID\n    overall_title &lt;- glue::glue(\"Station: {station_name}, Cruise ID: {cruise_id}\")\n\n    # Set margins: increase the outer margin for the title\n    par(oma = c(0, 0, 3, 0))  # Top outer margin increased for title\n\n    # Plotting function with specific parameters\n    oce::plot(\n      x = ctdDecimate(ctdTrim(cast)),\n      which = c(\n        \"sea_water_electrical_conductivity\",\n        \"descent_rate\", \"sound_velocity\",\n        \"sea_water_sigma_t\",\"altimeter\"\n      ),\n      main = \"\"  # No main title for individual subplots\n    )\n\n    # Place a single overall title at the top of the plot frame\n    mtext(overall_title, side = 3, line = 1, outer = TRUE, cex = 1.5)\n\n    # Reset outer margins to default\n    par(oma = c(0, 0, 0, 0))\n\n  }, error = function(e) {\n    print(e$message)  # Print any errors that occur during plotting\n  })\n}\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n\n\nplotting other nutrient parameters for each cast\n# Loop through each CTD cast\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # Assuming each sublist contains only one relevant CTD object\n  tryCatch({\n    # Extract metadata for station name and cruise ID\n    station_name &lt;- cast@metadata$station[1]\n    cruise_id &lt;- cast@data$cruise_id[1]\n\n    # Generate a title with station name and cruise ID\n    overall_title &lt;- glue::glue(\"Station: {station_name}, Cruise ID: {cruise_id}\")\n\n    # Set margins: increase the outer margin for the title\n    par(oma = c(0, 0, 3, 0))  # Top outer margin increased for title\n\n    # Plotting function with specific parameters\n    oce::plot(\n      x = ctdDecimate(ctdTrim(cast)),\n      which = c(\n        \"CDOM\", \"dissolved_oxygen\",\n        \"oxygen_saturation\",\n        \"chlorophyll_concentration\", \"chlorophyll_fluorescence\"\n      ),\n      main = \"\"  # No main title for individual subplots\n    )\n\n    # Place a single overall title at the top of the plot frame\n    mtext(overall_title, side = 3, line = 1, outer = TRUE, cex = 1.5)\n\n    # Reset outer margins to default\n    par(oma = c(0, 0, 0, 0))\n\n  }, error = function(e) {\n    print(e$message)  # Print any errors that occur during plotting\n  })\n}\n\n\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n\n\n\n\nplotting other optical parameters for each cast\n# Loop through each CTD cast\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # Assuming each sublist contains only one relevant CTD object\n  tryCatch({\n    # Extract metadata for station name and cruise ID\n    station_name &lt;- cast@metadata$station[1]\n    cruise_id &lt;- cast@data$cruise_id[1]\n\n    # Generate a title with station name and cruise ID\n    overall_title &lt;- glue::glue(\"Station: {station_name}, Cruise ID: {cruise_id}\")\n\n    # Set margins: increase the outer margin for the title\n    par(oma = c(0, 0, 3, 0))  # Top outer margin increased for title\n\n    # Plotting function with specific parameters\n    oce::plot(\n      x = ctdDecimate(ctdTrim(cast)),\n      which = c(\n        \"photosynthetically_available_radiation\",\n        \"beam_attenuation\",\"beam_transmission\"\n      ),\n      main = \"\"  # No main title for individual subplots\n    )\n\n    # Place a single overall title at the top of the plot frame\n    mtext(overall_title, side = 3, line = 1, outer = TRUE, cex = 1.5)\n\n    # Reset outer margins to default\n    par(oma = c(0, 0, 0, 0))\n\n  }, error = function(e) {\n    print(e$message)  # Print any errors that occur during plotting\n  })\n}\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nloop through every cast, clean, & save\ncombined_df &lt;- data.frame()\nfor (i in seq(ctd_FK)){\n  tryCatch({\n    cast &lt;- ctd_FK[[i]]  # 1 is selecting only the first sublist\n    \n    # print(class(cast))\n    # clean cast \n    trimmed_cast &lt;- ctdTrim(cast)\n    decimated_cast &lt;- ctdDecimate(trimmed_cast, p = 0.5)  # binned to 0.5 m\n    \n    # convert to df\n    cast_df &lt;- as.data.frame(decimated_cast@data)\n    \n    # Add metadata\n    # assumes station ID and cruise ID the same for all & just uses 1st one\n    cast_df &lt;- mutate(\n      cast_df,\n      station = cast@data$station[1],\n      cruise_id = cast@data$cruise_id[1]\n    )\n  \n    # drop NA rows left by cleaning\n    cast_df &lt;- subset(cast_df, !is.na(scan))\n    \n    # Append the data to the combined dataframe\n    combined_df &lt;- rbind(combined_df, cast_df)\n  }, error = function(e){\n    print(glue(\"error in cast {cast@metadata$station[1]}\"))\n    print(e)\n  })\n}\n# Save to CSV\nfile_path &lt;- here(glue(\"data/cleaned/{cruise_id}.csv\"))\nwrite.csv(combined_df, file_path, row.names = FALSE)"
  },
  {
    "objectID": "cruise_report/cruise_reports/WS0923.html",
    "href": "cruise_report/cruise_reports/WS0923.html",
    "title": "WS0923",
    "section": "",
    "text": "WS0923\n\n\nsetup\nif (!nzchar(system.file(package = \"librarian\"))) {\n  install.packages(\"librarian\")\n}\n\nlibrarian::shelf(\n  quiet = TRUE,\n  readr, here, fs, ggplot2, glue, \"jiho/castr\", dplyr, oce, patchwork, purrr, tidyr\n)\n\n\n\n\nCode\nsource(here(\"R/cruise_load.R\"))\ncruise_df &lt;- cruise_load(params$cruise_id)\n\n\nWarning: One or more parsing issues, call `problems()` on your data frame for details,\ne.g.:\n  dat &lt;- vroom(...)\n  problems(dat)\n\n\n\n\nplot depth & pressure vs time elapsed\ntryCatch({\n  plots &lt;- list()\n  \n  for (station_name in unique(cruise_df$station)) {\n    subset_df &lt;- filter(cruise_df, station == station_name)\n    plots[[station_name]] &lt;- ggplot(subset_df, aes(x = time_elapsed)) +\n      geom_point(aes(y = depth), color = \"blue\") +  # Plot depth in blue\n      geom_line(aes(y = sea_water_pressure), color = \"red\") +  # Plot sea water pressure in red\n      ggtitle(glue(\"{station_name}\")) +\n      theme(\n        axis.title.x = element_blank(),\n        axis.title.y = element_blank(),\n        axis.text.x = element_blank(),\n        axis.text.y = element_blank(),\n        axis.ticks.x = element_blank(),\n        axis.ticks.y = element_blank()\n      )  # Remove individual axis titles and text\n  }\n  \n  # drop nulls\n  plots &lt;- purrr::compact(plots)\n  \n  # Combine all plots into a grid\n  combined_plot &lt;- wrap_plots(plots) + \n    plot_layout(ncol = 4) +  # Adjust ncol to set number of columns in the grid\n    plot_annotation(\n      title = \"Depth (blue) and Pressure (red)\",\n      subtitle = \"Each panel represents a different station\",\n      caption = \"Time Elapsed (x-axis) vs Depth & Pressure (y-axis)\"\n    ) +\n    theme(\n      plot.tag = element_text(size = 12, face = \"bold\"),\n      plot.tag.position = \"topleft\",\n      axis.title.x = element_text(margin = margin(t = 10)),\n      axis.title.y = element_text(margin = margin(r = 10))\n    )\n  \n  print(combined_plot)\n}, error = function(er){\n  print(er)\n});\n\n\n\n\n\n\n\n\n\n\n\nplot across all stations\np &lt;- ggplot(cruise_df, aes(x = time, y = depth, fill = station)) +\n  geom_col() +  # This creates the bars\n  # geom_text(aes(label = station), vjust = -0.3) +  # This adds labels to each bar, adjust vjust for position\n  labs(x = \"Time\", y = \"Depth\", title = \"Depth over Time by Station\") +  # Set labels and title\n  theme_minimal()  # Use a minimal theme\nprint(p)\n\n\n\n\n\n\n\n\n\n\n\ncreate oce.ctd objects from dataframes\nctd_load &lt;- function(data, other_params = NULL) {\n  \n  # create csv into ctd object\n  test_ctd &lt;-\n    as.ctd(\n      salinity    = data$sea_water_salinity,\n      temperature = data$sea_water_temperature,\n      pressure    = data$sea_water_pressure,\n      station     = data$station\n    )\n  \n  # add additional columns to ctd object\n  if (!is.null(other_params)) {\n    for (param_name in other_params) {\n      test_ctd &lt;-\n        oceSetData(\n          object = test_ctd,\n          name   = param_name,\n          value  = data[[param_name]]\n        )\n    }\n  }\n  print(glue(\"{data$station[1]}:\\t{length(test_ctd@data$scan)} scans\"))\n\n\n  return(test_ctd)\n}\n\n# Define other parameters to add\nother_params &lt;- c(\n  \"cruise_id\", \"station\", \"time\", \"time_elapsed\", \n  \"latitude\", \"longitude\", \"sea_water_electrical_conductivity\", \n  \"CDOM\", \"dissolved_oxygen\",\"oxygen_saturation\", \"chlorophyll_concentration\", \n  \"chlorophyll_fluorescence\", \"photosynthetically_available_radiation\", \n  \"beam_attenuation\",\"beam_transmission\", \"depth\", \"sea_water_sigma_t\",\n  \"descent_rate\", \"sound_velocity\",\"altimeter\"\n)\n\n# Split data by station and create data list\nctd_FK &lt;- cruise_df %&gt;%\n  split(.$station) %&gt;%\n  map(~ ctd_load(.x, other_params = other_params)) # ~ is a lambda(x)\n\n\n1:  4544 scans\n10: 2163 scans\n12: 4926 scans\n16: 2431 scans\n17: 3044 scans\n18: 2966 scans\n19: 2169 scans\n21: 5143 scans\n21.5:   9374 scans\n22.5:   6579 scans\n22.5B:  12 scans\n23: 2563 scans\n24: 2263 scans\n3:  5876 scans\n31: 3217 scans\n34: 1535 scans\n34B:    89 scans\n39: 3931 scans\n42: 1815 scans\n49: 2857 scans\n495:    2926 scans\n5:  1689 scans\n50: 3779 scans\n53: 2431 scans\n54: 2124 scans\n56: 2532 scans\n58: 2324 scans\n6:  3329 scans\n6.5:    6568 scans\n6.75:   7312 scans\n60: 1790 scans\n68: 2791 scans\n69: 1943 scans\n7:  3203 scans\n9:  3307 scans\n9.5:    8417 scans\nCAL01:  3926 scans\nCAL05:  3141 scans\nCH2:    3821 scans\nCH5:    4845 scans\n\n\n\n\nplotting scans for each cast in the first list\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # 1 is selecting only the first sublist\n  # print(i)\n  print(glue(\"=== station: {cast@metadata$station[1]}\"))\n  print(glue(\"# scans: {length(cast@data$scan)}\"))\n  plotScan(cast)\n}\n\n\n=== station: 1\n# scans: 4544\n\n\n\n\n\n\n\n\n\n=== station: 10\n# scans: 2163\n\n\n\n\n\n\n\n\n\n=== station: 12\n# scans: 4926\n\n\n\n\n\n\n\n\n\n=== station: 16\n# scans: 2431\n\n\n\n\n\n\n\n\n\n=== station: 17\n# scans: 3044\n\n\n\n\n\n\n\n\n\n=== station: 18\n# scans: 2966\n\n\n\n\n\n\n\n\n\n=== station: 19\n# scans: 2169\n\n\n\n\n\n\n\n\n\n=== station: 21\n# scans: 5143\n\n\n\n\n\n\n\n\n\n=== station: 21.5\n# scans: 9374\n\n\n\n\n\n\n\n\n\n=== station: 22.5\n# scans: 6579\n\n\n\n\n\n\n\n\n\n=== station: 22.5B\n# scans: 12\n\n\n\n\n\n\n\n\n\n=== station: 23\n# scans: 2563\n\n\n\n\n\n\n\n\n\n=== station: 24\n# scans: 2263\n\n\n\n\n\n\n\n\n\n=== station: 3\n# scans: 5876\n\n\n\n\n\n\n\n\n\n=== station: 31\n# scans: 3217\n\n\n\n\n\n\n\n\n\n=== station: 34\n# scans: 1535\n\n\n\n\n\n\n\n\n\n=== station: 34B\n# scans: 89\n\n\n\n\n\n\n\n\n\n=== station: 39\n# scans: 3931\n\n\n\n\n\n\n\n\n\n=== station: 42\n# scans: 1815\n\n\n\n\n\n\n\n\n\n=== station: 49\n# scans: 2857\n\n\n\n\n\n\n\n\n\n=== station: 495\n# scans: 2926\n\n\n\n\n\n\n\n\n\n=== station: 5\n# scans: 1689\n\n\n\n\n\n\n\n\n\n=== station: 50\n# scans: 3779\n\n\n\n\n\n\n\n\n\n=== station: 53\n# scans: 2431\n\n\n\n\n\n\n\n\n\n=== station: 54\n# scans: 2124\n\n\n\n\n\n\n\n\n\n=== station: 56\n# scans: 2532\n\n\n\n\n\n\n\n\n\n=== station: 58\n# scans: 2324\n\n\n\n\n\n\n\n\n\n=== station: 6\n# scans: 3329\n\n\n\n\n\n\n\n\n\n=== station: 6.5\n# scans: 6568\n\n\n\n\n\n\n\n\n\n=== station: 6.75\n# scans: 7312\n\n\n\n\n\n\n\n\n\n=== station: 60\n# scans: 1790\n\n\n\n\n\n\n\n\n\n=== station: 68\n# scans: 2791\n\n\n\n\n\n\n\n\n\n=== station: 69\n# scans: 1943\n\n\n\n\n\n\n\n\n\n=== station: 7\n# scans: 3203\n\n\n\n\n\n\n\n\n\n=== station: 9\n# scans: 3307\n\n\n\n\n\n\n\n\n\n=== station: 9.5\n# scans: 8417\n\n\n\n\n\n\n\n\n\n=== station: CAL01\n# scans: 3926\n\n\n\n\n\n\n\n\n\n=== station: CAL05\n# scans: 3141\n\n\n\n\n\n\n\n\n\n=== station: CH2\n# scans: 3821\n\n\n\n\n\n\n\n\n\n=== station: CH5\n# scans: 4845\n\n\n\n\n\n\n\n\n\n\n\nplotting each cast in the first list\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # 1 is selecting only the first sublist\n  tryCatch({\n    plot(ctdDecimate(ctdTrim(cast)))\n  }, error = function(e){\n    print(e)\n  })\n}\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4544' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2163' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4926' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2431' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3044' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2966' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2169' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 5143' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 9374' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 6579' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2563' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2263' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 5876' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3217' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1535' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3931' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1815' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2857' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2926' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1689' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3779' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2431' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2124' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2532' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2324' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3329' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 6568' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 7312' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1790' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2791' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1943' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3203' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3307' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 8417' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3926' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3141' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3821' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4845' in coercion to 'logical(1)'&gt;\n\n\n\n\nplotting other physical parameters for each cast\n# Loop through each CTD cast\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # Assuming each sublist contains only one relevant CTD object\n  tryCatch({\n    # Extract metadata for station name and cruise ID\n    station_name &lt;- cast@metadata$station[1]\n    cruise_id &lt;- cast@data$cruise_id[1]\n\n    # Generate a title with station name and cruise ID\n    overall_title &lt;- glue::glue(\"Station: {station_name}, Cruise ID: {cruise_id}\")\n\n    # Set margins: increase the outer margin for the title\n    par(oma = c(0, 0, 3, 0))  # Top outer margin increased for title\n\n    # Plotting function with specific parameters\n    oce::plot(\n      x = ctdDecimate(ctdTrim(cast)),\n      which = c(\n        \"sea_water_electrical_conductivity\",\n        \"descent_rate\", \"sound_velocity\",\n        \"sea_water_sigma_t\",\"altimeter\"\n      ),\n      main = \"\"  # No main title for individual subplots\n    )\n\n    # Place a single overall title at the top of the plot frame\n    mtext(overall_title, side = 3, line = 1, outer = TRUE, cex = 1.5)\n\n    # Reset outer margins to default\n    par(oma = c(0, 0, 0, 0))\n\n  }, error = function(e) {\n    print(e$message)  # Print any errors that occur during plotting\n  })\n}\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n\n\nplotting other nutrient parameters for each cast\n# Loop through each CTD cast\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # Assuming each sublist contains only one relevant CTD object\n  tryCatch({\n    # Extract metadata for station name and cruise ID\n    station_name &lt;- cast@metadata$station[1]\n    cruise_id &lt;- cast@data$cruise_id[1]\n\n    # Generate a title with station name and cruise ID\n    overall_title &lt;- glue::glue(\"Station: {station_name}, Cruise ID: {cruise_id}\")\n\n    # Set margins: increase the outer margin for the title\n    par(oma = c(0, 0, 3, 0))  # Top outer margin increased for title\n\n    # Plotting function with specific parameters\n    oce::plot(\n      x = ctdDecimate(ctdTrim(cast)),\n      which = c(\n        \"CDOM\", \"dissolved_oxygen\",\n        \"oxygen_saturation\",\n        \"chlorophyll_concentration\", \"chlorophyll_fluorescence\"\n      ),\n      main = \"\"  # No main title for individual subplots\n    )\n\n    # Place a single overall title at the top of the plot frame\n    mtext(overall_title, side = 3, line = 1, outer = TRUE, cex = 1.5)\n\n    # Reset outer margins to default\n    par(oma = c(0, 0, 0, 0))\n\n  }, error = function(e) {\n    print(e$message)  # Print any errors that occur during plotting\n  })\n}\n\n\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"plot.new has not been called yet\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n\n\n\n\nplotting other optical parameters for each cast\n# Loop through each CTD cast\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # Assuming each sublist contains only one relevant CTD object\n  tryCatch({\n    # Extract metadata for station name and cruise ID\n    station_name &lt;- cast@metadata$station[1]\n    cruise_id &lt;- cast@data$cruise_id[1]\n\n    # Generate a title with station name and cruise ID\n    overall_title &lt;- glue::glue(\"Station: {station_name}, Cruise ID: {cruise_id}\")\n\n    # Set margins: increase the outer margin for the title\n    par(oma = c(0, 0, 3, 0))  # Top outer margin increased for title\n\n    # Plotting function with specific parameters\n    oce::plot(\n      x = ctdDecimate(ctdTrim(cast)),\n      which = c(\n        \"photosynthetically_available_radiation\",\n        \"beam_attenuation\",\"beam_transmission\"\n      ),\n      main = \"\"  # No main title for individual subplots\n    )\n\n    # Place a single overall title at the top of the plot frame\n    mtext(overall_title, side = 3, line = 1, outer = TRUE, cex = 1.5)\n\n    # Reset outer margins to default\n    par(oma = c(0, 0, 0, 0))\n\n  }, error = function(e) {\n    print(e$message)  # Print any errors that occur during plotting\n  })\n}\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n[1] \"need finite 'xlim' values\"\n\n\n\n\nloop through every cast, clean, & save\ncombined_df &lt;- data.frame()\nfor (i in seq(ctd_FK)){\n  tryCatch({\n    cast &lt;- ctd_FK[[i]]  # 1 is selecting only the first sublist\n    \n    # print(class(cast))\n    # clean cast \n    trimmed_cast &lt;- ctdTrim(cast)\n    decimated_cast &lt;- ctdDecimate(trimmed_cast, p = 0.5)  # binned to 0.5 m\n    \n    # convert to df\n    cast_df &lt;- as.data.frame(decimated_cast@data)\n    \n    # Add metadata\n    # assumes station ID and cruise ID the same for all & just uses 1st one\n    cast_df &lt;- mutate(\n      cast_df,\n      station = cast@data$station[1],\n      cruise_id = cast@data$cruise_id[1]\n    )\n  \n    # drop NA rows left by cleaning\n    cast_df &lt;- subset(cast_df, !is.na(scan))\n    \n    # Append the data to the combined dataframe\n    combined_df &lt;- rbind(combined_df, cast_df)\n  }, error = function(e){\n    print(glue(\"error in cast {cast@metadata$station[1]}\"))\n    print(e)\n  })\n}\n# Save to CSV\nfile_path &lt;- here(glue(\"data/cleaned/{cruise_id}.csv\"))\nwrite.csv(combined_df, file_path, row.names = FALSE)"
  },
  {
    "objectID": "cruise_report/cruise_reports/WS0914.html",
    "href": "cruise_report/cruise_reports/WS0914.html",
    "title": "WS0914",
    "section": "",
    "text": "WS0914\n\n\nsetup\nif (!nzchar(system.file(package = \"librarian\"))) {\n  install.packages(\"librarian\")\n}\n\nlibrarian::shelf(\n  quiet = TRUE,\n  readr, here, fs, ggplot2, glue, \"jiho/castr\", dplyr, oce, patchwork, purrr, tidyr\n)\n\n\n\n\nCode\nsource(here(\"R/cruise_load.R\"))\ncruise_df &lt;- cruise_load(params$cruise_id)\n\n\n\n\nplot depth & pressure vs time elapsed\ntryCatch({\n  plots &lt;- list()\n  \n  for (station_name in unique(cruise_df$station)) {\n    subset_df &lt;- filter(cruise_df, station == station_name)\n    plots[[station_name]] &lt;- ggplot(subset_df, aes(x = time_elapsed)) +\n      geom_point(aes(y = depth), color = \"blue\") +  # Plot depth in blue\n      geom_line(aes(y = sea_water_pressure), color = \"red\") +  # Plot sea water pressure in red\n      ggtitle(glue(\"{station_name}\")) +\n      theme(\n        axis.title.x = element_blank(),\n        axis.title.y = element_blank(),\n        axis.text.x = element_blank(),\n        axis.text.y = element_blank(),\n        axis.ticks.x = element_blank(),\n        axis.ticks.y = element_blank()\n      )  # Remove individual axis titles and text\n  }\n  \n  # drop nulls\n  plots &lt;- purrr::compact(plots)\n  \n  # Combine all plots into a grid\n  combined_plot &lt;- wrap_plots(plots) + \n    plot_layout(ncol = 4) +  # Adjust ncol to set number of columns in the grid\n    plot_annotation(\n      title = \"Depth (blue) and Pressure (red)\",\n      subtitle = \"Each panel represents a different station\",\n      caption = \"Time Elapsed (x-axis) vs Depth & Pressure (y-axis)\"\n    ) +\n    theme(\n      plot.tag = element_text(size = 12, face = \"bold\"),\n      plot.tag.position = \"topleft\",\n      axis.title.x = element_text(margin = margin(t = 10)),\n      axis.title.y = element_text(margin = margin(r = 10))\n    )\n  \n  print(combined_plot)\n}, error = function(er){\n  print(er)\n});\n\n\n\n\n\n\n\n\n\n\n\nplot across all stations\np &lt;- ggplot(cruise_df, aes(x = time, y = depth, fill = station)) +\n  geom_col() +  # This creates the bars\n  # geom_text(aes(label = station), vjust = -0.3) +  # This adds labels to each bar, adjust vjust for position\n  labs(x = \"Time\", y = \"Depth\", title = \"Depth over Time by Station\") +  # Set labels and title\n  theme_minimal()  # Use a minimal theme\nprint(p)\n\n\n\n\n\n\n\n\n\n\n\ncreate oce.ctd objects from dataframes\nctd_load &lt;- function(data, other_params = NULL) {\n  \n  # create csv into ctd object\n  test_ctd &lt;-\n    as.ctd(\n      salinity    = data$sea_water_salinity,\n      temperature = data$sea_water_temperature,\n      pressure    = data$sea_water_pressure,\n      station     = data$station\n    )\n  \n  # add additional columns to ctd object\n  if (!is.null(other_params)) {\n    for (param_name in other_params) {\n      test_ctd &lt;-\n        oceSetData(\n          object = test_ctd,\n          name   = param_name,\n          value  = data[[param_name]]\n        )\n    }\n  }\n  print(glue(\"{data$station[1]}:\\t{length(test_ctd@data$scan)} scans\"))\n\n\n  return(test_ctd)\n}\n\n# Define other parameters to add\nother_params &lt;- c(\n  \"cruise_id\", \"station\", \"time\", \"time_elapsed\", \n  \"latitude\", \"longitude\", \"sea_water_electrical_conductivity\", \n  \"CDOM\", \"dissolved_oxygen\",\"oxygen_saturation\", \"chlorophyll_concentration\", \n  \"chlorophyll_fluorescence\", \"photosynthetically_available_radiation\", \n  \"beam_attenuation\",\"beam_transmission\", \"depth\", \"sea_water_sigma_t\",\n  \"descent_rate\", \"sound_velocity\",\"altimeter\"\n)\n\n# Split data by station and create data list\nctd_FK &lt;- cruise_df %&gt;%\n  split(.$station) %&gt;%\n  map(~ ctd_load(.x, other_params = other_params)) # ~ is a lambda(x)\n\n\n10: 1451 scans\n12: 6463 scans\n120:    4133 scans\n16: 4035 scans\n17: 3270 scans\n18: 3132 scans\n19: 3385 scans\n205:    6720 scans\n225:    9180 scans\n225A:   8876 scans\n23: 1891 scans\n24: 3845 scans\n3:  5824 scans\n34: 1267 scans\n42: 1875 scans\n48: 286 scans\n54: 2779 scans\n58: 5346 scans\n6:  4001 scans\n60: 49 scans\n65: 4033 scans\n68: 152 scans\n69: 295 scans\n6C: 7758 scans\n7:  209 scans\n9:  4926 scans\n95: 10269 scans\nCAL1:   207 scans\nCAL5:   2895 scans\nCH2:    3559 scans\nCH5:    2903 scans\n\n\n\n\nplotting scans for each cast in the first list\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # 1 is selecting only the first sublist\n  # print(i)\n  print(glue(\"=== station: {cast@metadata$station[1]}\"))\n  print(glue(\"# scans: {length(cast@data$scan)}\"))\n  plotScan(cast)\n}\n\n\n=== station: 10\n# scans: 1451\n\n\n\n\n\n\n\n\n\n=== station: 12\n# scans: 6463\n\n\n\n\n\n\n\n\n\n=== station: 120\n# scans: 4133\n\n\n\n\n\n\n\n\n\n=== station: 16\n# scans: 4035\n\n\n\n\n\n\n\n\n\n=== station: 17\n# scans: 3270\n\n\n\n\n\n\n\n\n\n=== station: 18\n# scans: 3132\n\n\n\n\n\n\n\n\n\n=== station: 19\n# scans: 3385\n\n\n\n\n\n\n\n\n\n=== station: 205\n# scans: 6720\n\n\n\n\n\n\n\n\n\n=== station: 225\n# scans: 9180\n\n\n\n\n\n\n\n\n\n=== station: 225A\n# scans: 8876\n\n\n\n\n\n\n\n\n\n=== station: 23\n# scans: 1891\n\n\n\n\n\n\n\n\n\n=== station: 24\n# scans: 3845\n\n\n\n\n\n\n\n\n\n=== station: 3\n# scans: 5824\n\n\n\n\n\n\n\n\n\n=== station: 34\n# scans: 1267\n\n\n\n\n\n\n\n\n\n=== station: 42\n# scans: 1875\n\n\n\n\n\n\n\n\n\n=== station: 48\n# scans: 286\n\n\n\n\n\n\n\n\n\n=== station: 54\n# scans: 2779\n\n\n\n\n\n\n\n\n\n=== station: 58\n# scans: 5346\n\n\n\n\n\n\n\n\n\n=== station: 6\n# scans: 4001\n\n\n\n\n\n\n\n\n\n=== station: 60\n# scans: 49\n\n\n\n\n\n\n\n\n\n=== station: 65\n# scans: 4033\n\n\n\n\n\n\n\n\n\n=== station: 68\n# scans: 152\n\n\n\n\n\n\n\n\n\n=== station: 69\n# scans: 295\n\n\n\n\n\n\n\n\n\n=== station: 6C\n# scans: 7758\n\n\n\n\n\n\n\n\n\n=== station: 7\n# scans: 209\n\n\n\n\n\n\n\n\n\n=== station: 9\n# scans: 4926\n\n\n\n\n\n\n\n\n\n=== station: 95\n# scans: 10269\n\n\n\n\n\n\n\n\n\n=== station: CAL1\n# scans: 207\n\n\n\n\n\n\n\n\n\n=== station: CAL5\n# scans: 2895\n\n\n\n\n\n\n\n\n\n=== station: CH2\n# scans: 3559\n\n\n\n\n\n\n\n\n\n=== station: CH5\n# scans: 2903\n\n\n\n\n\n\n\n\n\n\n\nplotting each cast in the first list\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # 1 is selecting only the first sublist\n  tryCatch({\n    plot(ctdDecimate(ctdTrim(cast)))\n  }, error = function(e){\n    print(e)\n  })\n}\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1451' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 6463' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4133' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4035' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3270' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3132' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3385' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 6720' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 9180' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 8876' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1891' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3845' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 5824' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1875' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2779' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 5346' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4001' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 49' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4033' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 295' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 7758' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 209' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4926' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 10269' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2895' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3559' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2903' in coercion to 'logical(1)'&gt;\n\n\n\n\nplotting other physical parameters for each cast\n# Loop through each CTD cast\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # Assuming each sublist contains only one relevant CTD object\n  tryCatch({\n    # Extract metadata for station name and cruise ID\n    station_name &lt;- cast@metadata$station[1]\n    cruise_id &lt;- cast@data$cruise_id[1]\n\n    # Generate a title with station name and cruise ID\n    overall_title &lt;- glue::glue(\"Station: {station_name}, Cruise ID: {cruise_id}\")\n\n    # Set margins: increase the outer margin for the title\n    par(oma = c(0, 0, 3, 0))  # Top outer margin increased for title\n\n    # Plotting function with specific parameters\n    oce::plot(\n      x = ctdDecimate(ctdTrim(cast)),\n      which = c(\n        \"sea_water_electrical_conductivity\",\n        \"descent_rate\", \"sound_velocity\",\n        \"sea_water_sigma_t\",\"altimeter\"\n      ),\n      main = \"\"  # No main title for individual subplots\n    )\n\n    # Place a single overall title at the top of the plot frame\n    mtext(overall_title, side = 3, line = 1, outer = TRUE, cex = 1.5)\n\n    # Reset outer margins to default\n    par(oma = c(0, 0, 0, 0))\n\n  }, error = function(e) {\n    print(e$message)  # Print any errors that occur during plotting\n  })\n}\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n\n\nplotting other nutrient parameters for each cast\n# Loop through each CTD cast\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # Assuming each sublist contains only one relevant CTD object\n  tryCatch({\n    # Extract metadata for station name and cruise ID\n    station_name &lt;- cast@metadata$station[1]\n    cruise_id &lt;- cast@data$cruise_id[1]\n\n    # Generate a title with station name and cruise ID\n    overall_title &lt;- glue::glue(\"Station: {station_name}, Cruise ID: {cruise_id}\")\n\n    # Set margins: increase the outer margin for the title\n    par(oma = c(0, 0, 3, 0))  # Top outer margin increased for title\n\n    # Plotting function with specific parameters\n    oce::plot(\n      x = ctdDecimate(ctdTrim(cast)),\n      which = c(\n        \"CDOM\", \"dissolved_oxygen\",\n        \"oxygen_saturation\",\n        \"chlorophyll_concentration\", \"chlorophyll_fluorescence\"\n      ),\n      main = \"\"  # No main title for individual subplots\n    )\n\n    # Place a single overall title at the top of the plot frame\n    mtext(overall_title, side = 3, line = 1, outer = TRUE, cex = 1.5)\n\n    # Reset outer margins to default\n    par(oma = c(0, 0, 0, 0))\n\n  }, error = function(e) {\n    print(e$message)  # Print any errors that occur during plotting\n  })\n}\n\n\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"plot.new has not been called yet\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n\n\n\n\nplotting other optical parameters for each cast\n# Loop through each CTD cast\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # Assuming each sublist contains only one relevant CTD object\n  tryCatch({\n    # Extract metadata for station name and cruise ID\n    station_name &lt;- cast@metadata$station[1]\n    cruise_id &lt;- cast@data$cruise_id[1]\n\n    # Generate a title with station name and cruise ID\n    overall_title &lt;- glue::glue(\"Station: {station_name}, Cruise ID: {cruise_id}\")\n\n    # Set margins: increase the outer margin for the title\n    par(oma = c(0, 0, 3, 0))  # Top outer margin increased for title\n\n    # Plotting function with specific parameters\n    oce::plot(\n      x = ctdDecimate(ctdTrim(cast)),\n      which = c(\n        \"photosynthetically_available_radiation\",\n        \"beam_attenuation\",\"beam_transmission\"\n      ),\n      main = \"\"  # No main title for individual subplots\n    )\n\n    # Place a single overall title at the top of the plot frame\n    mtext(overall_title, side = 3, line = 1, outer = TRUE, cex = 1.5)\n\n    # Reset outer margins to default\n    par(oma = c(0, 0, 0, 0))\n\n  }, error = function(e) {\n    print(e$message)  # Print any errors that occur during plotting\n  })\n}\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n\n\nloop through every cast, clean, & save\ncombined_df &lt;- data.frame()\nfor (i in seq(ctd_FK)){\n  tryCatch({\n    cast &lt;- ctd_FK[[i]]  # 1 is selecting only the first sublist\n    \n    # print(class(cast))\n    # clean cast \n    trimmed_cast &lt;- ctdTrim(cast)\n    decimated_cast &lt;- ctdDecimate(trimmed_cast, p = 0.5)  # binned to 0.5 m\n    \n    # convert to df\n    cast_df &lt;- as.data.frame(decimated_cast@data)\n    \n    # Add metadata\n    # assumes station ID and cruise ID the same for all & just uses 1st one\n    cast_df &lt;- mutate(\n      cast_df,\n      station = cast@data$station[1],\n      cruise_id = cast@data$cruise_id[1]\n    )\n  \n    # drop NA rows left by cleaning\n    cast_df &lt;- subset(cast_df, !is.na(scan))\n    \n    # Append the data to the combined dataframe\n    combined_df &lt;- rbind(combined_df, cast_df)\n  }, error = function(e){\n    print(glue(\"error in cast {cast@metadata$station[1]}\"))\n    print(e)\n  })\n}\n# Save to CSV\nfile_path &lt;- here(glue(\"data/cleaned/{cruise_id}.csv\"))\nwrite.csv(combined_df, file_path, row.names = FALSE)"
  },
  {
    "objectID": "cruise_report/cruise_reports/WS0901.html",
    "href": "cruise_report/cruise_reports/WS0901.html",
    "title": "WS0901",
    "section": "",
    "text": "WS0901\n\n\nsetup\nif (!nzchar(system.file(package = \"librarian\"))) {\n  install.packages(\"librarian\")\n}\n\nlibrarian::shelf(\n  quiet = TRUE,\n  readr, here, fs, ggplot2, glue, \"jiho/castr\", dplyr, oce, patchwork, purrr, tidyr\n)\n\n\n\n\nCode\nsource(here(\"R/cruise_load.R\"))\ncruise_df &lt;- cruise_load(params$cruise_id)\n\n\n\n\nplot depth & pressure vs time elapsed\ntryCatch({\n  plots &lt;- list()\n  \n  for (station_name in unique(cruise_df$station)) {\n    subset_df &lt;- filter(cruise_df, station == station_name)\n    plots[[station_name]] &lt;- ggplot(subset_df, aes(x = time_elapsed)) +\n      geom_point(aes(y = depth), color = \"blue\") +  # Plot depth in blue\n      geom_line(aes(y = sea_water_pressure), color = \"red\") +  # Plot sea water pressure in red\n      ggtitle(glue(\"{station_name}\")) +\n      theme(\n        axis.title.x = element_blank(),\n        axis.title.y = element_blank(),\n        axis.text.x = element_blank(),\n        axis.text.y = element_blank(),\n        axis.ticks.x = element_blank(),\n        axis.ticks.y = element_blank()\n      )  # Remove individual axis titles and text\n  }\n  \n  # drop nulls\n  plots &lt;- purrr::compact(plots)\n  \n  # Combine all plots into a grid\n  combined_plot &lt;- wrap_plots(plots) + \n    plot_layout(ncol = 4) +  # Adjust ncol to set number of columns in the grid\n    plot_annotation(\n      title = \"Depth (blue) and Pressure (red)\",\n      subtitle = \"Each panel represents a different station\",\n      caption = \"Time Elapsed (x-axis) vs Depth & Pressure (y-axis)\"\n    ) +\n    theme(\n      plot.tag = element_text(size = 12, face = \"bold\"),\n      plot.tag.position = \"topleft\",\n      axis.title.x = element_text(margin = margin(t = 10)),\n      axis.title.y = element_text(margin = margin(r = 10))\n    )\n  \n  print(combined_plot)\n}, error = function(er){\n  print(er)\n});\n\n\n\n\n\n\n\n\n\n\n\nplot across all stations\np &lt;- ggplot(cruise_df, aes(x = time, y = depth, fill = station)) +\n  geom_col() +  # This creates the bars\n  # geom_text(aes(label = station), vjust = -0.3) +  # This adds labels to each bar, adjust vjust for position\n  labs(x = \"Time\", y = \"Depth\", title = \"Depth over Time by Station\") +  # Set labels and title\n  theme_minimal()  # Use a minimal theme\nprint(p)\n\n\n\n\n\n\n\n\n\n\n\ncreate oce.ctd objects from dataframes\nctd_load &lt;- function(data, other_params = NULL) {\n  \n  # create csv into ctd object\n  test_ctd &lt;-\n    as.ctd(\n      salinity    = data$sea_water_salinity,\n      temperature = data$sea_water_temperature,\n      pressure    = data$sea_water_pressure,\n      station     = data$station\n    )\n  \n  # add additional columns to ctd object\n  if (!is.null(other_params)) {\n    for (param_name in other_params) {\n      test_ctd &lt;-\n        oceSetData(\n          object = test_ctd,\n          name   = param_name,\n          value  = data[[param_name]]\n        )\n    }\n  }\n  print(glue(\"{data$station[1]}:\\t{length(test_ctd@data$scan)} scans\"))\n\n\n  return(test_ctd)\n}\n\n# Define other parameters to add\nother_params &lt;- c(\n  \"cruise_id\", \"station\", \"time\", \"time_elapsed\", \n  \"latitude\", \"longitude\", \"sea_water_electrical_conductivity\", \n  \"CDOM\", \"dissolved_oxygen\",\"oxygen_saturation\", \"chlorophyll_concentration\", \n  \"chlorophyll_fluorescence\", \"photosynthetically_available_radiation\", \n  \"beam_attenuation\",\"beam_transmission\", \"depth\", \"sea_water_sigma_t\",\n  \"descent_rate\", \"sound_velocity\",\"altimeter\"\n)\n\n# Split data by station and create data list\nctd_FK &lt;- cruise_df %&gt;%\n  split(.$station) %&gt;%\n  map(~ ctd_load(.x, other_params = other_params)) # ~ is a lambda(x)\n\n\n1:  2904 scans\n10: 3854 scans\n12: 4659 scans\n16: 2680 scans\n17: 4954 scans\n18: 2431 scans\n19: 1817 scans\n2:  3195 scans\n20: 2617 scans\n21.5:   9376 scans\n22.5:   7665 scans\n23: 2189 scans\n24: 2178 scans\n25.5:   13391 scans\n27: 7591 scans\n28: 3249 scans\n29: 5066 scans\n3:  5446 scans\n30: 4730 scans\n31: 2749 scans\n34: 1448 scans\n39: 2267 scans\n42: 2946 scans\n49: 5 scans\n5:  2457 scans\n50: 2762 scans\n53: 25 scans\n54: 2353 scans\n56: 2691 scans\n58: 3126 scans\n6:  5278 scans\n6.5:    4952 scans\n60: 2458 scans\n68: 1446 scans\n69: 2157 scans\n7:  2460 scans\n9:  3560 scans\n9.5:    9219 scans\nCAL1:   1868 scans\nCAL5:   4165 scans\nCH2:    5546 scans\nCH5:    4846 scans\n\n\n\n\nplotting scans for each cast in the first list\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # 1 is selecting only the first sublist\n  # print(i)\n  print(glue(\"=== station: {cast@metadata$station[1]}\"))\n  print(glue(\"# scans: {length(cast@data$scan)}\"))\n  plotScan(cast)\n}\n\n\n=== station: 1\n# scans: 2904\n\n\n\n\n\n\n\n\n\n=== station: 10\n# scans: 3854\n\n\n\n\n\n\n\n\n\n=== station: 12\n# scans: 4659\n\n\n\n\n\n\n\n\n\n=== station: 16\n# scans: 2680\n\n\n\n\n\n\n\n\n\n=== station: 17\n# scans: 4954\n\n\n\n\n\n\n\n\n\n=== station: 18\n# scans: 2431\n\n\n\n\n\n\n\n\n\n=== station: 19\n# scans: 1817\n\n\n\n\n\n\n\n\n\n=== station: 2\n# scans: 3195\n\n\n\n\n\n\n\n\n\n=== station: 20\n# scans: 2617\n\n\n\n\n\n\n\n\n\n=== station: 21.5\n# scans: 9376\n\n\n\n\n\n\n\n\n\n=== station: 22.5\n# scans: 7665\n\n\n\n\n\n\n\n\n\n=== station: 23\n# scans: 2189\n\n\n\n\n\n\n\n\n\n=== station: 24\n# scans: 2178\n\n\n\n\n\n\n\n\n\n=== station: 25.5\n# scans: 13391\n\n\n\n\n\n\n\n\n\n=== station: 27\n# scans: 7591\n\n\n\n\n\n\n\n\n\n=== station: 28\n# scans: 3249\n\n\n\n\n\n\n\n\n\n=== station: 29\n# scans: 5066\n\n\n\n\n\n\n\n\n\n=== station: 3\n# scans: 5446\n\n\n\n\n\n\n\n\n\n=== station: 30\n# scans: 4730\n\n\n\n\n\n\n\n\n\n=== station: 31\n# scans: 2749\n\n\n\n\n\n\n\n\n\n=== station: 34\n# scans: 1448\n\n\n\n\n\n\n\n\n\n=== station: 39\n# scans: 2267\n\n\n\n\n\n\n\n\n\n=== station: 42\n# scans: 2946\n\n\n\n\n\n\n\n\n\n=== station: 49\n# scans: 5\n\n\n\n\n\n\n\n\n\n=== station: 5\n# scans: 2457\n\n\n\n\n\n\n\n\n\n=== station: 50\n# scans: 2762\n\n\n\n\n\n\n\n\n\n=== station: 53\n# scans: 25\n\n\n\n\n\n\n\n\n\n=== station: 54\n# scans: 2353\n\n\n\n\n\n\n\n\n\n=== station: 56\n# scans: 2691\n\n\n\n\n\n\n\n\n\n=== station: 58\n# scans: 3126\n\n\n\n\n\n\n\n\n\n=== station: 6\n# scans: 5278\n\n\n\n\n\n\n\n\n\n=== station: 6.5\n# scans: 4952\n\n\n\n\n\n\n\n\n\n=== station: 60\n# scans: 2458\n\n\n\n\n\n\n\n\n\n=== station: 68\n# scans: 1446\n\n\n\n\n\n\n\n\n\n=== station: 69\n# scans: 2157\n\n\n\n\n\n\n\n\n\n=== station: 7\n# scans: 2460\n\n\n\n\n\n\n\n\n\n=== station: 9\n# scans: 3560\n\n\n\n\n\n\n\n\n\n=== station: 9.5\n# scans: 9219\n\n\n\n\n\n\n\n\n\n=== station: CAL1\n# scans: 1868\n\n\n\n\n\n\n\n\n\n=== station: CAL5\n# scans: 4165\n\n\n\n\n\n\n\n\n\n=== station: CH2\n# scans: 5546\n\n\n\n\n\n\n\n\n\n=== station: CH5\n# scans: 4846\n\n\n\n\n\n\n\n\n\n\n\nplotting each cast in the first list\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # 1 is selecting only the first sublist\n  tryCatch({\n    plot(ctdDecimate(ctdTrim(cast)))\n  }, error = function(e){\n    print(e)\n  })\n}\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2904' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3854' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4659' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2680' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4954' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2431' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1817' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3195' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2617' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 9376' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 7665' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2189' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2178' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 13391' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 7591' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3249' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 5066' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 5446' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4730' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2749' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1448' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2267' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2946' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 5' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2457' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2762' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2353' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2691' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3126' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 5278' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4952' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2458' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1446' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2157' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2460' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3560' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 9219' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1868' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4165' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 5546' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4846' in coercion to 'logical(1)'&gt;\n\n\n\n\nplotting other physical parameters for each cast\n# Loop through each CTD cast\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # Assuming each sublist contains only one relevant CTD object\n  tryCatch({\n    # Extract metadata for station name and cruise ID\n    station_name &lt;- cast@metadata$station[1]\n    cruise_id &lt;- cast@data$cruise_id[1]\n\n    # Generate a title with station name and cruise ID\n    overall_title &lt;- glue::glue(\"Station: {station_name}, Cruise ID: {cruise_id}\")\n\n    # Set margins: increase the outer margin for the title\n    par(oma = c(0, 0, 3, 0))  # Top outer margin increased for title\n\n    # Plotting function with specific parameters\n    oce::plot(\n      x = ctdDecimate(ctdTrim(cast)),\n      which = c(\n        \"sea_water_electrical_conductivity\",\n        \"descent_rate\", \"sound_velocity\",\n        \"sea_water_sigma_t\",\"altimeter\"\n      ),\n      main = \"\"  # No main title for individual subplots\n    )\n\n    # Place a single overall title at the top of the plot frame\n    mtext(overall_title, side = 3, line = 1, outer = TRUE, cex = 1.5)\n\n    # Reset outer margins to default\n    par(oma = c(0, 0, 0, 0))\n\n  }, error = function(e) {\n    print(e$message)  # Print any errors that occur during plotting\n  })\n}\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"unknown xtype value (\\\"4.326023\\\")\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n\n\nplotting other nutrient parameters for each cast\n# Loop through each CTD cast\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # Assuming each sublist contains only one relevant CTD object\n  tryCatch({\n    # Extract metadata for station name and cruise ID\n    station_name &lt;- cast@metadata$station[1]\n    cruise_id &lt;- cast@data$cruise_id[1]\n\n    # Generate a title with station name and cruise ID\n    overall_title &lt;- glue::glue(\"Station: {station_name}, Cruise ID: {cruise_id}\")\n\n    # Set margins: increase the outer margin for the title\n    par(oma = c(0, 0, 3, 0))  # Top outer margin increased for title\n\n    # Plotting function with specific parameters\n    oce::plot(\n      x = ctdDecimate(ctdTrim(cast)),\n      which = c(\n        \"CDOM\", \"dissolved_oxygen\",\n        \"oxygen_saturation\",\n        \"chlorophyll_concentration\", \"chlorophyll_fluorescence\"\n      ),\n      main = \"\"  # No main title for individual subplots\n    )\n\n    # Place a single overall title at the top of the plot frame\n    mtext(overall_title, side = 3, line = 1, outer = TRUE, cex = 1.5)\n\n    # Reset outer margins to default\n    par(oma = c(0, 0, 0, 0))\n\n  }, error = function(e) {\n    print(e$message)  # Print any errors that occur during plotting\n  })\n}\n\n\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n\n\n\n\nplotting other optical parameters for each cast\n# Loop through each CTD cast\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # Assuming each sublist contains only one relevant CTD object\n  tryCatch({\n    # Extract metadata for station name and cruise ID\n    station_name &lt;- cast@metadata$station[1]\n    cruise_id &lt;- cast@data$cruise_id[1]\n\n    # Generate a title with station name and cruise ID\n    overall_title &lt;- glue::glue(\"Station: {station_name}, Cruise ID: {cruise_id}\")\n\n    # Set margins: increase the outer margin for the title\n    par(oma = c(0, 0, 3, 0))  # Top outer margin increased for title\n\n    # Plotting function with specific parameters\n    oce::plot(\n      x = ctdDecimate(ctdTrim(cast)),\n      which = c(\n        \"photosynthetically_available_radiation\",\n        \"beam_attenuation\",\"beam_transmission\"\n      ),\n      main = \"\"  # No main title for individual subplots\n    )\n\n    # Place a single overall title at the top of the plot frame\n    mtext(overall_title, side = 3, line = 1, outer = TRUE, cex = 1.5)\n\n    # Reset outer margins to default\n    par(oma = c(0, 0, 0, 0))\n\n  }, error = function(e) {\n    print(e$message)  # Print any errors that occur during plotting\n  })\n}\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n\n\nloop through every cast, clean, & save\ncombined_df &lt;- data.frame()\nfor (i in seq(ctd_FK)){\n  tryCatch({\n    cast &lt;- ctd_FK[[i]]  # 1 is selecting only the first sublist\n    \n    # print(class(cast))\n    # clean cast \n    trimmed_cast &lt;- ctdTrim(cast)\n    decimated_cast &lt;- ctdDecimate(trimmed_cast, p = 0.5)  # binned to 0.5 m\n    \n    # convert to df\n    cast_df &lt;- as.data.frame(decimated_cast@data)\n    \n    # Add metadata\n    # assumes station ID and cruise ID the same for all & just uses 1st one\n    cast_df &lt;- mutate(\n      cast_df,\n      station = cast@data$station[1],\n      cruise_id = cast@data$cruise_id[1]\n    )\n  \n    # drop NA rows left by cleaning\n    cast_df &lt;- subset(cast_df, !is.na(scan))\n    \n    # Append the data to the combined dataframe\n    combined_df &lt;- rbind(combined_df, cast_df)\n  }, error = function(e){\n    print(glue(\"error in cast {cast@metadata$station[1]}\"))\n    print(e)\n  })\n}\n# Save to CSV\nfile_path &lt;- here(glue(\"data/cleaned/{cruise_id}.csv\"))\nwrite.csv(combined_df, file_path, row.names = FALSE)"
  },
  {
    "objectID": "cruise_report/cruise_reports/WS0802.html",
    "href": "cruise_report/cruise_reports/WS0802.html",
    "title": "WS0802",
    "section": "",
    "text": "WS0802\n\n\nsetup\nif (!nzchar(system.file(package = \"librarian\"))) {\n  install.packages(\"librarian\")\n}\n\nlibrarian::shelf(\n  quiet = TRUE,\n  readr, here, fs, ggplot2, glue, \"jiho/castr\", dplyr, oce, patchwork, purrr, tidyr\n)\n\n\n\n\nCode\nsource(here(\"R/cruise_load.R\"))\ncruise_df &lt;- cruise_load(params$cruise_id)\n\n\n\n\nplot depth & pressure vs time elapsed\ntryCatch({\n  plots &lt;- list()\n  \n  for (station_name in unique(cruise_df$station)) {\n    subset_df &lt;- filter(cruise_df, station == station_name)\n    plots[[station_name]] &lt;- ggplot(subset_df, aes(x = time_elapsed)) +\n      geom_point(aes(y = depth), color = \"blue\") +  # Plot depth in blue\n      geom_line(aes(y = sea_water_pressure), color = \"red\") +  # Plot sea water pressure in red\n      ggtitle(glue(\"{station_name}\")) +\n      theme(\n        axis.title.x = element_blank(),\n        axis.title.y = element_blank(),\n        axis.text.x = element_blank(),\n        axis.text.y = element_blank(),\n        axis.ticks.x = element_blank(),\n        axis.ticks.y = element_blank()\n      )  # Remove individual axis titles and text\n  }\n  \n  # drop nulls\n  plots &lt;- purrr::compact(plots)\n  \n  # Combine all plots into a grid\n  combined_plot &lt;- wrap_plots(plots) + \n    plot_layout(ncol = 4) +  # Adjust ncol to set number of columns in the grid\n    plot_annotation(\n      title = \"Depth (blue) and Pressure (red)\",\n      subtitle = \"Each panel represents a different station\",\n      caption = \"Time Elapsed (x-axis) vs Depth & Pressure (y-axis)\"\n    ) +\n    theme(\n      plot.tag = element_text(size = 12, face = \"bold\"),\n      plot.tag.position = \"topleft\",\n      axis.title.x = element_text(margin = margin(t = 10)),\n      axis.title.y = element_text(margin = margin(r = 10))\n    )\n  \n  print(combined_plot)\n}, error = function(er){\n  print(er)\n});\n\n\n\n\n\n\n\n\n\n\n\nplot across all stations\np &lt;- ggplot(cruise_df, aes(x = time, y = depth, fill = station)) +\n  geom_col() +  # This creates the bars\n  # geom_text(aes(label = station), vjust = -0.3) +  # This adds labels to each bar, adjust vjust for position\n  labs(x = \"Time\", y = \"Depth\", title = \"Depth over Time by Station\") +  # Set labels and title\n  theme_minimal()  # Use a minimal theme\nprint(p)\n\n\n\n\n\n\n\n\n\n\n\ncreate oce.ctd objects from dataframes\nctd_load &lt;- function(data, other_params = NULL) {\n  \n  # create csv into ctd object\n  test_ctd &lt;-\n    as.ctd(\n      salinity    = data$sea_water_salinity,\n      temperature = data$sea_water_temperature,\n      pressure    = data$sea_water_pressure,\n      station     = data$station\n    )\n  \n  # add additional columns to ctd object\n  if (!is.null(other_params)) {\n    for (param_name in other_params) {\n      test_ctd &lt;-\n        oceSetData(\n          object = test_ctd,\n          name   = param_name,\n          value  = data[[param_name]]\n        )\n    }\n  }\n  print(glue(\"{data$station[1]}:\\t{length(test_ctd@data$scan)} scans\"))\n\n\n  return(test_ctd)\n}\n\n# Define other parameters to add\nother_params &lt;- c(\n  \"cruise_id\", \"station\", \"time\", \"time_elapsed\", \n  \"latitude\", \"longitude\", \"sea_water_electrical_conductivity\", \n  \"CDOM\", \"dissolved_oxygen\",\"oxygen_saturation\", \"chlorophyll_concentration\", \n  \"chlorophyll_fluorescence\", \"photosynthetically_available_radiation\", \n  \"beam_attenuation\",\"beam_transmission\", \"depth\", \"sea_water_sigma_t\",\n  \"descent_rate\", \"sound_velocity\",\"altimeter\"\n)\n\n# Split data by station and create data list\nctd_FK &lt;- cruise_df %&gt;%\n  split(.$station) %&gt;%\n  map(~ ctd_load(.x, other_params = other_params)) # ~ is a lambda(x)\n\n\n1:  3878 scans\n10: 430 scans\n12: 3242 scans\n16: 1597 scans\n17: 3245 scans\n18: 3242 scans\n19: 3022 scans\n20: 2971 scans\n20A:    3 scans\n215:    7240 scans\n225:    5971 scans\n23: 2575 scans\n24: 2590 scans\n25.5:   12274 scans\n27: 2656 scans\n29: 3347 scans\n3:  5807 scans\n30: 3703 scans\n31: 2597 scans\n34: 1900 scans\n39: 2142 scans\n42: 2842 scans\n49: 2096 scans\n50: 2923 scans\n53: 2072 scans\n54: 1477 scans\n56: 1020 scans\n58: 2940 scans\n60: 1556 scans\n68: 1472 scans\n69: 1713 scans\n7:  1639 scans\n9:  3574 scans\n9.5:    5458 scans\nCAL1:   1677 scans\nCAL5:   2754 scans\nCH2:    2172 scans\nCH5:    3352 scans\n\n\n\n\nplotting scans for each cast in the first list\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # 1 is selecting only the first sublist\n  # print(i)\n  print(glue(\"=== station: {cast@metadata$station[1]}\"))\n  print(glue(\"# scans: {length(cast@data$scan)}\"))\n  plotScan(cast)\n}\n\n\n=== station: 1\n# scans: 3878\n\n\n\n\n\n\n\n\n\n=== station: 10\n# scans: 430\n\n\n\n\n\n\n\n\n\n=== station: 12\n# scans: 3242\n\n\n\n\n\n\n\n\n\n=== station: 16\n# scans: 1597\n\n\n\n\n\n\n\n\n\n=== station: 17\n# scans: 3245\n\n\n\n\n\n\n\n\n\n=== station: 18\n# scans: 3242\n\n\n\n\n\n\n\n\n\n=== station: 19\n# scans: 3022\n\n\n\n\n\n\n\n\n\n=== station: 20\n# scans: 2971\n\n\n\n\n\n\n\n\n\n=== station: 20A\n# scans: 3\n\n\n\n\n\n\n\n\n\n=== station: 215\n# scans: 7240\n\n\n\n\n\n\n\n\n\n=== station: 225\n# scans: 5971\n\n\n\n\n\n\n\n\n\n=== station: 23\n# scans: 2575\n\n\n\n\n\n\n\n\n\n=== station: 24\n# scans: 2590\n\n\n\n\n\n\n\n\n\n=== station: 25.5\n# scans: 12274\n\n\n\n\n\n\n\n\n\n=== station: 27\n# scans: 2656\n\n\n\n\n\n\n\n\n\n=== station: 29\n# scans: 3347\n\n\n\n\n\n\n\n\n\n=== station: 3\n# scans: 5807\n\n\n\n\n\n\n\n\n\n=== station: 30\n# scans: 3703\n\n\n\n\n\n\n\n\n\n=== station: 31\n# scans: 2597\n\n\n\n\n\n\n\n\n\n=== station: 34\n# scans: 1900\n\n\n\n\n\n\n\n\n\n=== station: 39\n# scans: 2142\n\n\n\n\n\n\n\n\n\n=== station: 42\n# scans: 2842\n\n\n\n\n\n\n\n\n\n=== station: 49\n# scans: 2096\n\n\n\n\n\n\n\n\n\n=== station: 50\n# scans: 2923\n\n\n\n\n\n\n\n\n\n=== station: 53\n# scans: 2072\n\n\n\n\n\n\n\n\n\n=== station: 54\n# scans: 1477\n\n\n\n\n\n\n\n\n\n=== station: 56\n# scans: 1020\n\n\n\n\n\n\n\n\n\n=== station: 58\n# scans: 2940\n\n\n\n\n\n\n\n\n\n=== station: 60\n# scans: 1556\n\n\n\n\n\n\n\n\n\n=== station: 68\n# scans: 1472\n\n\n\n\n\n\n\n\n\n=== station: 69\n# scans: 1713\n\n\n\n\n\n\n\n\n\n=== station: 7\n# scans: 1639\n\n\n\n\n\n\n\n\n\n=== station: 9\n# scans: 3574\n\n\n\n\n\n\n\n\n\n=== station: 9.5\n# scans: 5458\n\n\n\n\n\n\n\n\n\n=== station: CAL1\n# scans: 1677\n\n\n\n\n\n\n\n\n\n=== station: CAL5\n# scans: 2754\n\n\n\n\n\n\n\n\n\n=== station: CH2\n# scans: 2172\n\n\n\n\n\n\n\n\n\n=== station: CH5\n# scans: 3352\n\n\n\n\n\n\n\n\n\n\n\nplotting each cast in the first list\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # 1 is selecting only the first sublist\n  tryCatch({\n    plot(ctdDecimate(ctdTrim(cast)))\n  }, error = function(e){\n    print(e)\n  })\n}\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3878' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 430' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3242' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1597' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3245' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3242' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3022' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2971' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 7240' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 5971' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2575' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2590' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 12274' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2656' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3347' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 5807' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3703' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2597' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1900' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2142' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2842' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2096' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2923' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2072' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1477' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1020' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2940' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1556' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1472' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1713' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1639' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3574' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 5458' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1677' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2754' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2172' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3352' in coercion to 'logical(1)'&gt;\n\n\n\n\nplotting other physical parameters for each cast\n# Loop through each CTD cast\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # Assuming each sublist contains only one relevant CTD object\n  tryCatch({\n    # Extract metadata for station name and cruise ID\n    station_name &lt;- cast@metadata$station[1]\n    cruise_id &lt;- cast@data$cruise_id[1]\n\n    # Generate a title with station name and cruise ID\n    overall_title &lt;- glue::glue(\"Station: {station_name}, Cruise ID: {cruise_id}\")\n\n    # Set margins: increase the outer margin for the title\n    par(oma = c(0, 0, 3, 0))  # Top outer margin increased for title\n\n    # Plotting function with specific parameters\n    oce::plot(\n      x = ctdDecimate(ctdTrim(cast)),\n      which = c(\n        \"sea_water_electrical_conductivity\",\n        \"descent_rate\", \"sound_velocity\",\n        \"sea_water_sigma_t\",\"altimeter\"\n      ),\n      main = \"\"  # No main title for individual subplots\n    )\n\n    # Place a single overall title at the top of the plot frame\n    mtext(overall_title, side = 3, line = 1, outer = TRUE, cex = 1.5)\n\n    # Reset outer margins to default\n    par(oma = c(0, 0, 0, 0))\n\n  }, error = function(e) {\n    print(e$message)  # Print any errors that occur during plotting\n  })\n}\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n\n\nplotting other nutrient parameters for each cast\n# Loop through each CTD cast\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # Assuming each sublist contains only one relevant CTD object\n  tryCatch({\n    # Extract metadata for station name and cruise ID\n    station_name &lt;- cast@metadata$station[1]\n    cruise_id &lt;- cast@data$cruise_id[1]\n\n    # Generate a title with station name and cruise ID\n    overall_title &lt;- glue::glue(\"Station: {station_name}, Cruise ID: {cruise_id}\")\n\n    # Set margins: increase the outer margin for the title\n    par(oma = c(0, 0, 3, 0))  # Top outer margin increased for title\n\n    # Plotting function with specific parameters\n    oce::plot(\n      x = ctdDecimate(ctdTrim(cast)),\n      which = c(\n        \"CDOM\", \"dissolved_oxygen\",\n        \"oxygen_saturation\",\n        \"chlorophyll_concentration\", \"chlorophyll_fluorescence\"\n      ),\n      main = \"\"  # No main title for individual subplots\n    )\n\n    # Place a single overall title at the top of the plot frame\n    mtext(overall_title, side = 3, line = 1, outer = TRUE, cex = 1.5)\n\n    # Reset outer margins to default\n    par(oma = c(0, 0, 0, 0))\n\n  }, error = function(e) {\n    print(e$message)  # Print any errors that occur during plotting\n  })\n}\n\n\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"plot.new has not been called yet\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n\n\n\n\nplotting other optical parameters for each cast\n# Loop through each CTD cast\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # Assuming each sublist contains only one relevant CTD object\n  tryCatch({\n    # Extract metadata for station name and cruise ID\n    station_name &lt;- cast@metadata$station[1]\n    cruise_id &lt;- cast@data$cruise_id[1]\n\n    # Generate a title with station name and cruise ID\n    overall_title &lt;- glue::glue(\"Station: {station_name}, Cruise ID: {cruise_id}\")\n\n    # Set margins: increase the outer margin for the title\n    par(oma = c(0, 0, 3, 0))  # Top outer margin increased for title\n\n    # Plotting function with specific parameters\n    oce::plot(\n      x = ctdDecimate(ctdTrim(cast)),\n      which = c(\n        \"photosynthetically_available_radiation\",\n        \"beam_attenuation\",\"beam_transmission\"\n      ),\n      main = \"\"  # No main title for individual subplots\n    )\n\n    # Place a single overall title at the top of the plot frame\n    mtext(overall_title, side = 3, line = 1, outer = TRUE, cex = 1.5)\n\n    # Reset outer margins to default\n    par(oma = c(0, 0, 0, 0))\n\n  }, error = function(e) {\n    print(e$message)  # Print any errors that occur during plotting\n  })\n}\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"plot.new has not been called yet\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n\n\nloop through every cast, clean, & save\ncombined_df &lt;- data.frame()\nfor (i in seq(ctd_FK)){\n  tryCatch({\n    cast &lt;- ctd_FK[[i]]  # 1 is selecting only the first sublist\n    \n    # print(class(cast))\n    # clean cast \n    trimmed_cast &lt;- ctdTrim(cast)\n    decimated_cast &lt;- ctdDecimate(trimmed_cast, p = 0.5)  # binned to 0.5 m\n    \n    # convert to df\n    cast_df &lt;- as.data.frame(decimated_cast@data)\n    \n    # Add metadata\n    # assumes station ID and cruise ID the same for all & just uses 1st one\n    cast_df &lt;- mutate(\n      cast_df,\n      station = cast@data$station[1],\n      cruise_id = cast@data$cruise_id[1]\n    )\n  \n    # drop NA rows left by cleaning\n    cast_df &lt;- subset(cast_df, !is.na(scan))\n    \n    # Append the data to the combined dataframe\n    combined_df &lt;- rbind(combined_df, cast_df)\n  }, error = function(e){\n    print(glue(\"error in cast {cast@metadata$station[1]}\"))\n    print(e)\n  })\n}\n# Save to CSV\nfile_path &lt;- here(glue(\"data/cleaned/{cruise_id}.csv\"))\nwrite.csv(combined_df, file_path, row.names = FALSE)"
  },
  {
    "objectID": "cruise_report/cruise_reports/WS0704.html",
    "href": "cruise_report/cruise_reports/WS0704.html",
    "title": "WS0704",
    "section": "",
    "text": "WS0704\n\n\nsetup\nif (!nzchar(system.file(package = \"librarian\"))) {\n  install.packages(\"librarian\")\n}\n\nlibrarian::shelf(\n  quiet = TRUE,\n  readr, here, fs, ggplot2, glue, \"jiho/castr\", dplyr, oce, patchwork, purrr, tidyr\n)\n\n\n\n\nCode\nsource(here(\"R/cruise_load.R\"))\ncruise_df &lt;- cruise_load(params$cruise_id)\n\n\n\n\nplot depth & pressure vs time elapsed\ntryCatch({\n  plots &lt;- list()\n  \n  for (station_name in unique(cruise_df$station)) {\n    subset_df &lt;- filter(cruise_df, station == station_name)\n    plots[[station_name]] &lt;- ggplot(subset_df, aes(x = time_elapsed)) +\n      geom_point(aes(y = depth), color = \"blue\") +  # Plot depth in blue\n      geom_line(aes(y = sea_water_pressure), color = \"red\") +  # Plot sea water pressure in red\n      ggtitle(glue(\"{station_name}\")) +\n      theme(\n        axis.title.x = element_blank(),\n        axis.title.y = element_blank(),\n        axis.text.x = element_blank(),\n        axis.text.y = element_blank(),\n        axis.ticks.x = element_blank(),\n        axis.ticks.y = element_blank()\n      )  # Remove individual axis titles and text\n  }\n  \n  # drop nulls\n  plots &lt;- purrr::compact(plots)\n  \n  # Combine all plots into a grid\n  combined_plot &lt;- wrap_plots(plots) + \n    plot_layout(ncol = 4) +  # Adjust ncol to set number of columns in the grid\n    plot_annotation(\n      title = \"Depth (blue) and Pressure (red)\",\n      subtitle = \"Each panel represents a different station\",\n      caption = \"Time Elapsed (x-axis) vs Depth & Pressure (y-axis)\"\n    ) +\n    theme(\n      plot.tag = element_text(size = 12, face = \"bold\"),\n      plot.tag.position = \"topleft\",\n      axis.title.x = element_text(margin = margin(t = 10)),\n      axis.title.y = element_text(margin = margin(r = 10))\n    )\n  \n  print(combined_plot)\n}, error = function(er){\n  print(er)\n});\n\n\nWarning: Removed 11 rows containing missing values or values outside the scale range\n(`geom_point()`).\n\n\nWarning: Removed 1 row containing missing values or values outside the scale range\n(`geom_point()`).\nRemoved 1 row containing missing values or values outside the scale range\n(`geom_point()`).\n\n\nWarning: Removed 2 rows containing missing values or values outside the scale range\n(`geom_point()`).\n\n\nWarning: Removed 1 row containing missing values or values outside the scale range\n(`geom_point()`).\n\n\n\n\n\n\n\n\n\n\n\nplot across all stations\np &lt;- ggplot(cruise_df, aes(x = time, y = depth, fill = station)) +\n  geom_col() +  # This creates the bars\n  # geom_text(aes(label = station), vjust = -0.3) +  # This adds labels to each bar, adjust vjust for position\n  labs(x = \"Time\", y = \"Depth\", title = \"Depth over Time by Station\") +  # Set labels and title\n  theme_minimal()  # Use a minimal theme\nprint(p)\n\n\nWarning: Removed 16 rows containing missing values or values outside the scale range\n(`geom_col()`).\n\n\n\n\n\n\n\n\n\n\n\ncreate oce.ctd objects from dataframes\nctd_load &lt;- function(data, other_params = NULL) {\n  \n  # create csv into ctd object\n  test_ctd &lt;-\n    as.ctd(\n      salinity    = data$sea_water_salinity,\n      temperature = data$sea_water_temperature,\n      pressure    = data$sea_water_pressure,\n      station     = data$station\n    )\n  \n  # add additional columns to ctd object\n  if (!is.null(other_params)) {\n    for (param_name in other_params) {\n      test_ctd &lt;-\n        oceSetData(\n          object = test_ctd,\n          name   = param_name,\n          value  = data[[param_name]]\n        )\n    }\n  }\n  print(glue(\"{data$station[1]}:\\t{length(test_ctd@data$scan)} scans\"))\n\n\n  return(test_ctd)\n}\n\n# Define other parameters to add\nother_params &lt;- c(\n  \"cruise_id\", \"station\", \"time\", \"time_elapsed\", \n  \"latitude\", \"longitude\", \"sea_water_electrical_conductivity\", \n  \"CDOM\", \"dissolved_oxygen\",\"oxygen_saturation\", \"chlorophyll_concentration\", \n  \"chlorophyll_fluorescence\", \"photosynthetically_available_radiation\", \n  \"beam_attenuation\",\"beam_transmission\", \"depth\", \"sea_water_sigma_t\",\n  \"descent_rate\", \"sound_velocity\",\"altimeter\"\n)\n\n# Split data by station and create data list\nctd_FK &lt;- cruise_df %&gt;%\n  split(.$station) %&gt;%\n  map(~ ctd_load(.x, other_params = other_params)) # ~ is a lambda(x)\n\n\n1:  1853 scans\n10: 2234 scans\n12: 2447 scans\n16: 2260 scans\n17: 1918 scans\n18: 2828 scans\n19: 1801 scans\n20: 3075 scans\n21.5:   7785 scans\n22.5:   8338 scans\n23: 2794 scans\n24: 3166 scans\n25.5:   14214 scans\n27: 4877 scans\n28: 2984 scans\n29: 3647 scans\n3:  3781 scans\n30: 2366 scans\n33: 3841 scans\n34: 2946 scans\n39: 2420 scans\n42: 1863 scans\n49: 1686 scans\n5:  1333 scans\n50: 2252 scans\n53: 2436 scans\n54: 3077 scans\n56: 2901 scans\n58: 1830 scans\n6:  3197 scans\n6.5:    3963 scans\n60: 2985 scans\n68: 2543 scans\n69: 2408 scans\n7:  1747 scans\n9:  3284 scans\n9.5:    5859 scans\nCAL1:   2145 scans\nCAL5:   3485 scans\nCH2:    2821 scans\nCH5:    2437 scans\n\n\n\n\nplotting scans for each cast in the first list\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # 1 is selecting only the first sublist\n  # print(i)\n  print(glue(\"=== station: {cast@metadata$station[1]}\"))\n  print(glue(\"# scans: {length(cast@data$scan)}\"))\n  plotScan(cast)\n}\n\n\n=== station: 1\n# scans: 1853\n\n\n\n\n\n\n\n\n\n=== station: 10\n# scans: 2234\n\n\n\n\n\n\n\n\n\n=== station: 12\n# scans: 2447\n\n\n\n\n\n\n\n\n\n=== station: 16\n# scans: 2260\n\n\n\n\n\n\n\n\n\n=== station: 17\n# scans: 1918\n\n\n\n\n\n\n\n\n\n=== station: 18\n# scans: 2828\n\n\n\n\n\n\n\n\n\n=== station: 19\n# scans: 1801\n\n\n\n\n\n\n\n\n\n=== station: 20\n# scans: 3075\n\n\n\n\n\n\n\n\n\n=== station: 21.5\n# scans: 7785\n\n\n\n\n\n\n\n\n\n=== station: 22.5\n# scans: 8338\n\n\n\n\n\n\n\n\n\n=== station: 23\n# scans: 2794\n\n\n\n\n\n\n\n\n\n=== station: 24\n# scans: 3166\n\n\n\n\n\n\n\n\n\n=== station: 25.5\n# scans: 14214\n\n\n\n\n\n\n\n\n\n=== station: 27\n# scans: 4877\n\n\n\n\n\n\n\n\n\n=== station: 28\n# scans: 2984\n\n\n\n\n\n\n\n\n\n=== station: 29\n# scans: 3647\n\n\n\n\n\n\n\n\n\n=== station: 3\n# scans: 3781\n\n\n\n\n\n\n\n\n\n=== station: 30\n# scans: 2366\n\n\n\n\n\n\n\n\n\n=== station: 33\n# scans: 3841\n\n\n\n\n\n\n\n\n\n=== station: 34\n# scans: 2946\n\n\n\n\n\n\n\n\n\n=== station: 39\n# scans: 2420\n\n\n\n\n\n\n\n\n\n=== station: 42\n# scans: 1863\n\n\n\n\n\n\n\n\n\n=== station: 49\n# scans: 1686\n\n\n\n\n\n\n\n\n\n=== station: 5\n# scans: 1333\n\n\n\n\n\n\n\n\n\n=== station: 50\n# scans: 2252\n\n\n\n\n\n\n\n\n\n=== station: 53\n# scans: 2436\n\n\n\n\n\n\n\n\n\n=== station: 54\n# scans: 3077\n\n\n\n\n\n\n\n\n\n=== station: 56\n# scans: 2901\n\n\n\n\n\n\n\n\n\n=== station: 58\n# scans: 1830\n\n\n\n\n\n\n\n\n\n=== station: 6\n# scans: 3197\n\n\n\n\n\n\n\n\n\n=== station: 6.5\n# scans: 3963\n\n\n\n\n\n\n\n\n\n=== station: 60\n# scans: 2985\n\n\n\n\n\n\n\n\n\n=== station: 68\n# scans: 2543\n\n\n\n\n\n\n\n\n\n=== station: 69\n# scans: 2408\n\n\n\n\n\n\n\n\n\n=== station: 7\n# scans: 1747\n\n\n\n\n\n\n\n\n\n=== station: 9\n# scans: 3284\n\n\n\n\n\n\n\n\n\n=== station: 9.5\n# scans: 5859\n\n\n\n\n\n\n\n\n\n=== station: CAL1\n# scans: 2145\n\n\n\n\n\n\n\n\n\n=== station: CAL5\n# scans: 3485\n\n\n\n\n\n\n\n\n\n=== station: CH2\n# scans: 2821\n\n\n\n\n\n\n\n\n\n=== station: CH5\n# scans: 2437\n\n\n\n\n\n\n\n\n\n\n\nplotting each cast in the first list\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # 1 is selecting only the first sublist\n  tryCatch({\n    plot(ctdDecimate(ctdTrim(cast)))\n  }, error = function(e){\n    print(e)\n  })\n}\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1853' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2234' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2447' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2260' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1918' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2828' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1801' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3075' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 7785' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 8338' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2794' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3166' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 14214' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4877' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2984' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3647' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3781' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2366' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3841' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2946' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1863' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1686' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1333' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2252' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2901' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1830' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3197' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3963' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2985' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2543' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3284' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 5859' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2145' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3485' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2821' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2437' in coercion to 'logical(1)'&gt;\n\n\n\n\nplotting other physical parameters for each cast\n# Loop through each CTD cast\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # Assuming each sublist contains only one relevant CTD object\n  tryCatch({\n    # Extract metadata for station name and cruise ID\n    station_name &lt;- cast@metadata$station[1]\n    cruise_id &lt;- cast@data$cruise_id[1]\n\n    # Generate a title with station name and cruise ID\n    overall_title &lt;- glue::glue(\"Station: {station_name}, Cruise ID: {cruise_id}\")\n\n    # Set margins: increase the outer margin for the title\n    par(oma = c(0, 0, 3, 0))  # Top outer margin increased for title\n\n    # Plotting function with specific parameters\n    oce::plot(\n      x = ctdDecimate(ctdTrim(cast)),\n      which = c(\n        \"sea_water_electrical_conductivity\",\n        \"descent_rate\", \"sound_velocity\",\n        \"sea_water_sigma_t\",\"altimeter\"\n      ),\n      main = \"\"  # No main title for individual subplots\n    )\n\n    # Place a single overall title at the top of the plot frame\n    mtext(overall_title, side = 3, line = 1, outer = TRUE, cex = 1.5)\n\n    # Reset outer margins to default\n    par(oma = c(0, 0, 0, 0))\n\n  }, error = function(e) {\n    print(e$message)  # Print any errors that occur during plotting\n  })\n}\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"missing value where TRUE/FALSE needed\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"missing value where TRUE/FALSE needed\"\n[1] \"missing value where TRUE/FALSE needed\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"missing value where TRUE/FALSE needed\"\n[1] \"missing value where TRUE/FALSE needed\"\n\n\n\n\nplotting other nutrient parameters for each cast\n# Loop through each CTD cast\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # Assuming each sublist contains only one relevant CTD object\n  tryCatch({\n    # Extract metadata for station name and cruise ID\n    station_name &lt;- cast@metadata$station[1]\n    cruise_id &lt;- cast@data$cruise_id[1]\n\n    # Generate a title with station name and cruise ID\n    overall_title &lt;- glue::glue(\"Station: {station_name}, Cruise ID: {cruise_id}\")\n\n    # Set margins: increase the outer margin for the title\n    par(oma = c(0, 0, 3, 0))  # Top outer margin increased for title\n\n    # Plotting function with specific parameters\n    oce::plot(\n      x = ctdDecimate(ctdTrim(cast)),\n      which = c(\n        \"CDOM\", \"dissolved_oxygen\",\n        \"oxygen_saturation\",\n        \"chlorophyll_concentration\", \"chlorophyll_fluorescence\"\n      ),\n      main = \"\"  # No main title for individual subplots\n    )\n\n    # Place a single overall title at the top of the plot frame\n    mtext(overall_title, side = 3, line = 1, outer = TRUE, cex = 1.5)\n\n    # Reset outer margins to default\n    par(oma = c(0, 0, 0, 0))\n\n  }, error = function(e) {\n    print(e$message)  # Print any errors that occur during plotting\n  })\n}\n\n\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n\n\n\n\nplotting other optical parameters for each cast\n# Loop through each CTD cast\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # Assuming each sublist contains only one relevant CTD object\n  tryCatch({\n    # Extract metadata for station name and cruise ID\n    station_name &lt;- cast@metadata$station[1]\n    cruise_id &lt;- cast@data$cruise_id[1]\n\n    # Generate a title with station name and cruise ID\n    overall_title &lt;- glue::glue(\"Station: {station_name}, Cruise ID: {cruise_id}\")\n\n    # Set margins: increase the outer margin for the title\n    par(oma = c(0, 0, 3, 0))  # Top outer margin increased for title\n\n    # Plotting function with specific parameters\n    oce::plot(\n      x = ctdDecimate(ctdTrim(cast)),\n      which = c(\n        \"photosynthetically_available_radiation\",\n        \"beam_attenuation\",\"beam_transmission\"\n      ),\n      main = \"\"  # No main title for individual subplots\n    )\n\n    # Place a single overall title at the top of the plot frame\n    mtext(overall_title, side = 3, line = 1, outer = TRUE, cex = 1.5)\n\n    # Reset outer margins to default\n    par(oma = c(0, 0, 0, 0))\n\n  }, error = function(e) {\n    print(e$message)  # Print any errors that occur during plotting\n  })\n}\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n[1] \"missing value where TRUE/FALSE needed\"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n[1] \"missing value where TRUE/FALSE needed\"\n[1] \"missing value where TRUE/FALSE needed\"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n[1] \"missing value where TRUE/FALSE needed\"\n[1] \"missing value where TRUE/FALSE needed\"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nloop through every cast, clean, & save\ncombined_df &lt;- data.frame()\nfor (i in seq(ctd_FK)){\n  tryCatch({\n    cast &lt;- ctd_FK[[i]]  # 1 is selecting only the first sublist\n    \n    # print(class(cast))\n    # clean cast \n    trimmed_cast &lt;- ctdTrim(cast)\n    decimated_cast &lt;- ctdDecimate(trimmed_cast, p = 0.5)  # binned to 0.5 m\n    \n    # convert to df\n    cast_df &lt;- as.data.frame(decimated_cast@data)\n    \n    # Add metadata\n    # assumes station ID and cruise ID the same for all & just uses 1st one\n    cast_df &lt;- mutate(\n      cast_df,\n      station = cast@data$station[1],\n      cruise_id = cast@data$cruise_id[1]\n    )\n  \n    # drop NA rows left by cleaning\n    cast_df &lt;- subset(cast_df, !is.na(scan))\n    \n    # Append the data to the combined dataframe\n    combined_df &lt;- rbind(combined_df, cast_df)\n  }, error = function(e){\n    print(glue(\"error in cast {cast@metadata$station[1]}\"))\n    print(e)\n  })\n}\n# Save to CSV\nfile_path &lt;- here(glue(\"data/cleaned/{cruise_id}.csv\"))\nwrite.csv(combined_df, file_path, row.names = FALSE)"
  },
  {
    "objectID": "cruise_report/cruise_reports/WS0618.html",
    "href": "cruise_report/cruise_reports/WS0618.html",
    "title": "WS0618",
    "section": "",
    "text": "WS0618\n\n\nsetup\nif (!nzchar(system.file(package = \"librarian\"))) {\n  install.packages(\"librarian\")\n}\n\nlibrarian::shelf(\n  quiet = TRUE,\n  readr, here, fs, ggplot2, glue, \"jiho/castr\", dplyr, oce, patchwork, purrr, tidyr\n)\n\n\n\n\nCode\nsource(here(\"R/cruise_load.R\"))\ncruise_df &lt;- cruise_load(params$cruise_id)\n\n\n\n\nplot depth & pressure vs time elapsed\ntryCatch({\n  plots &lt;- list()\n  \n  for (station_name in unique(cruise_df$station)) {\n    subset_df &lt;- filter(cruise_df, station == station_name)\n    plots[[station_name]] &lt;- ggplot(subset_df, aes(x = time_elapsed)) +\n      geom_point(aes(y = depth), color = \"blue\") +  # Plot depth in blue\n      geom_line(aes(y = sea_water_pressure), color = \"red\") +  # Plot sea water pressure in red\n      ggtitle(glue(\"{station_name}\")) +\n      theme(\n        axis.title.x = element_blank(),\n        axis.title.y = element_blank(),\n        axis.text.x = element_blank(),\n        axis.text.y = element_blank(),\n        axis.ticks.x = element_blank(),\n        axis.ticks.y = element_blank()\n      )  # Remove individual axis titles and text\n  }\n  \n  # drop nulls\n  plots &lt;- purrr::compact(plots)\n  \n  # Combine all plots into a grid\n  combined_plot &lt;- wrap_plots(plots) + \n    plot_layout(ncol = 4) +  # Adjust ncol to set number of columns in the grid\n    plot_annotation(\n      title = \"Depth (blue) and Pressure (red)\",\n      subtitle = \"Each panel represents a different station\",\n      caption = \"Time Elapsed (x-axis) vs Depth & Pressure (y-axis)\"\n    ) +\n    theme(\n      plot.tag = element_text(size = 12, face = \"bold\"),\n      plot.tag.position = \"topleft\",\n      axis.title.x = element_text(margin = margin(t = 10)),\n      axis.title.y = element_text(margin = margin(r = 10))\n    )\n  \n  print(combined_plot)\n}, error = function(er){\n  print(er)\n});\n\n\n`geom_line()`: Each group consists of only one observation.\n Do you need to adjust the group aesthetic?\n\n\n\n\n\n\n\n\n\n\n\nplot across all stations\np &lt;- ggplot(cruise_df, aes(x = time, y = depth, fill = station)) +\n  geom_col() +  # This creates the bars\n  # geom_text(aes(label = station), vjust = -0.3) +  # This adds labels to each bar, adjust vjust for position\n  labs(x = \"Time\", y = \"Depth\", title = \"Depth over Time by Station\") +  # Set labels and title\n  theme_minimal()  # Use a minimal theme\nprint(p)\n\n\n\n\n\n\n\n\n\n\n\ncreate oce.ctd objects from dataframes\nctd_load &lt;- function(data, other_params = NULL) {\n  \n  # create csv into ctd object\n  test_ctd &lt;-\n    as.ctd(\n      salinity    = data$sea_water_salinity,\n      temperature = data$sea_water_temperature,\n      pressure    = data$sea_water_pressure,\n      station     = data$station\n    )\n  \n  # add additional columns to ctd object\n  if (!is.null(other_params)) {\n    for (param_name in other_params) {\n      test_ctd &lt;-\n        oceSetData(\n          object = test_ctd,\n          name   = param_name,\n          value  = data[[param_name]]\n        )\n    }\n  }\n  print(glue(\"{data$station[1]}:\\t{length(test_ctd@data$scan)} scans\"))\n\n\n  return(test_ctd)\n}\n\n# Define other parameters to add\nother_params &lt;- c(\n  \"cruise_id\", \"station\", \"time\", \"time_elapsed\", \n  \"latitude\", \"longitude\", \"sea_water_electrical_conductivity\", \n  \"CDOM\", \"dissolved_oxygen\",\"oxygen_saturation\", \"chlorophyll_concentration\", \n  \"chlorophyll_fluorescence\", \"photosynthetically_available_radiation\", \n  \"beam_attenuation\",\"beam_transmission\", \"depth\", \"sea_water_sigma_t\",\n  \"descent_rate\", \"sound_velocity\",\"altimeter\"\n)\n\n# Split data by station and create data list\nctd_FK &lt;- cruise_df %&gt;%\n  split(.$station) %&gt;%\n  map(~ ctd_load(.x, other_params = other_params)) # ~ is a lambda(x)\n\n\n1:  2461 scans\n10: 1755 scans\n12: 2483 scans\n16: 2270 scans\n17: 3888 scans\n18: 3192 scans\n19: 2231 scans\n20: 3079 scans\n21: 3863 scans\n21.5:   8325 scans\n22.5:   7788 scans\n23: 2471 scans\n24: 2205 scans\n25.5:   13216 scans\n27: 4111 scans\n28: 2983 scans\n29: 3485 scans\n3:  4005 scans\n30: 3251 scans\n31: 2549 scans\n32: 1550 scans\n33: 1835 scans\n34: 2999 scans\n39: 3588 scans\n44: 3265 scans\n49: 3052 scans\n5:  1789 scans\n50: 5310 scans\n53: 2513 scans\n54: 2750 scans\n56: 2870 scans\n58: 895 scans\n6:  4260 scans\n6.5:    5552 scans\n60: 1980 scans\n68: 1398 scans\n7:  1656 scans\n9:  3349 scans\n9.5:    6905 scans\nCAL1:   3339 scans\nCAL5:   3990 scans\nCH2:    4880 scans\nCH5:    5026 scans\nCH5A:   1 scans\nDT1:    2752 scans\nDT10:   3314 scans\nDT11:   4356 scans\nDT2:    2072 scans\nDT4:    4815 scans\nDT7:    19906 scans\nDT9:    4678 scans\n\n\n\n\nplotting scans for each cast in the first list\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # 1 is selecting only the first sublist\n  # print(i)\n  print(glue(\"=== station: {cast@metadata$station[1]}\"))\n  print(glue(\"# scans: {length(cast@data$scan)}\"))\n  plotScan(cast)\n}\n\n\n=== station: 1\n# scans: 2461\n\n\n\n\n\n\n\n\n\n=== station: 10\n# scans: 1755\n\n\n\n\n\n\n\n\n\n=== station: 12\n# scans: 2483\n\n\n\n\n\n\n\n\n\n=== station: 16\n# scans: 2270\n\n\n\n\n\n\n\n\n\n=== station: 17\n# scans: 3888\n\n\n\n\n\n\n\n\n\n=== station: 18\n# scans: 3192\n\n\n\n\n\n\n\n\n\n=== station: 19\n# scans: 2231\n\n\n\n\n\n\n\n\n\n=== station: 20\n# scans: 3079\n\n\n\n\n\n\n\n\n\n=== station: 21\n# scans: 3863\n\n\n\n\n\n\n\n\n\n=== station: 21.5\n# scans: 8325\n\n\n\n\n\n\n\n\n\n=== station: 22.5\n# scans: 7788\n\n\n\n\n\n\n\n\n\n=== station: 23\n# scans: 2471\n\n\n\n\n\n\n\n\n\n=== station: 24\n# scans: 2205\n\n\n\n\n\n\n\n\n\n=== station: 25.5\n# scans: 13216\n\n\n\n\n\n\n\n\n\n=== station: 27\n# scans: 4111\n\n\n\n\n\n\n\n\n\n=== station: 28\n# scans: 2983\n\n\n\n\n\n\n\n\n\n=== station: 29\n# scans: 3485\n\n\n\n\n\n\n\n\n\n=== station: 3\n# scans: 4005\n\n\n\n\n\n\n\n\n\n=== station: 30\n# scans: 3251\n\n\n\n\n\n\n\n\n\n=== station: 31\n# scans: 2549\n\n\n\n\n\n\n\n\n\n=== station: 32\n# scans: 1550\n\n\n\n\n\n\n\n\n\n=== station: 33\n# scans: 1835\n\n\n\n\n\n\n\n\n\n=== station: 34\n# scans: 2999\n\n\n\n\n\n\n\n\n\n=== station: 39\n# scans: 3588\n\n\n\n\n\n\n\n\n\n=== station: 44\n# scans: 3265\n\n\n\n\n\n\n\n\n\n=== station: 49\n# scans: 3052\n\n\n\n\n\n\n\n\n\n=== station: 5\n# scans: 1789\n\n\n\n\n\n\n\n\n\n=== station: 50\n# scans: 5310\n\n\n\n\n\n\n\n\n\n=== station: 53\n# scans: 2513\n\n\n\n\n\n\n\n\n\n=== station: 54\n# scans: 2750\n\n\n\n\n\n\n\n\n\n=== station: 56\n# scans: 2870\n\n\n\n\n\n\n\n\n\n=== station: 58\n# scans: 895\n\n\n\n\n\n\n\n\n\n=== station: 6\n# scans: 4260\n\n\n\n\n\n\n\n\n\n=== station: 6.5\n# scans: 5552\n\n\n\n\n\n\n\n\n\n=== station: 60\n# scans: 1980\n\n\n\n\n\n\n\n\n\n=== station: 68\n# scans: 1398\n\n\n\n\n\n\n\n\n\n=== station: 7\n# scans: 1656\n\n\n\n\n\n\n\n\n\n=== station: 9\n# scans: 3349\n\n\n\n\n\n\n\n\n\n=== station: 9.5\n# scans: 6905\n\n\n\n\n\n\n\n\n\n=== station: CAL1\n# scans: 3339\n\n\n\n\n\n\n\n\n\n=== station: CAL5\n# scans: 3990\n\n\n\n\n\n\n\n\n\n=== station: CH2\n# scans: 4880\n\n\n\n\n\n\n\n\n\n=== station: CH5\n# scans: 5026\n\n\n\n\n\n\n\n\n\n=== station: CH5A\n# scans: 1\n\n\n\n\n\n\n\n\n\n=== station: DT1\n# scans: 2752\n\n\n\n\n\n\n\n\n\n=== station: DT10\n# scans: 3314\n\n\n\n\n\n\n\n\n\n=== station: DT11\n# scans: 4356\n\n\n\n\n\n\n\n\n\n=== station: DT2\n# scans: 2072\n\n\n\n\n\n\n\n\n\n=== station: DT4\n# scans: 4815\n\n\n\n\n\n\n\n\n\n=== station: DT7\n# scans: 19906\n\n\n\n\n\n\n\n\n\n=== station: DT9\n# scans: 4678\n\n\n\n\n\n\n\n\n\n\n\nplotting each cast in the first list\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # 1 is selecting only the first sublist\n  tryCatch({\n    plot(ctdDecimate(ctdTrim(cast)))\n  }, error = function(e){\n    print(e)\n  })\n}\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2461' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1755' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2483' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2270' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3888' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3192' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2231' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3079' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3863' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 8325' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 7788' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2471' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2205' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 13216' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4111' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2983' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3485' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4005' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3251' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2549' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1550' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1835' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2999' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3588' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3265' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3052' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1789' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 5310' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2513' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2750' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2870' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 895' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4260' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 5552' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1980' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1398' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1656' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3349' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 6905' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3339' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3990' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4880' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 5026' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2752' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3314' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4356' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2072' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4815' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 19906' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4678' in coercion to 'logical(1)'&gt;\n\n\n\n\nplotting other physical parameters for each cast\n# Loop through each CTD cast\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # Assuming each sublist contains only one relevant CTD object\n  tryCatch({\n    # Extract metadata for station name and cruise ID\n    station_name &lt;- cast@metadata$station[1]\n    cruise_id &lt;- cast@data$cruise_id[1]\n\n    # Generate a title with station name and cruise ID\n    overall_title &lt;- glue::glue(\"Station: {station_name}, Cruise ID: {cruise_id}\")\n\n    # Set margins: increase the outer margin for the title\n    par(oma = c(0, 0, 3, 0))  # Top outer margin increased for title\n\n    # Plotting function with specific parameters\n    oce::plot(\n      x = ctdDecimate(ctdTrim(cast)),\n      which = c(\n        \"sea_water_electrical_conductivity\",\n        \"descent_rate\", \"sound_velocity\",\n        \"sea_water_sigma_t\",\"altimeter\"\n      ),\n      main = \"\"  # No main title for individual subplots\n    )\n\n    # Place a single overall title at the top of the plot frame\n    mtext(overall_title, side = 3, line = 1, outer = TRUE, cex = 1.5)\n\n    # Reset outer margins to default\n    par(oma = c(0, 0, 0, 0))\n\n  }, error = function(e) {\n    print(e$message)  # Print any errors that occur during plotting\n  })\n}\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"unknown xtype value (\\\"6.04817\\\")\"\n\n\n\n\nplotting other nutrient parameters for each cast\n# Loop through each CTD cast\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # Assuming each sublist contains only one relevant CTD object\n  tryCatch({\n    # Extract metadata for station name and cruise ID\n    station_name &lt;- cast@metadata$station[1]\n    cruise_id &lt;- cast@data$cruise_id[1]\n\n    # Generate a title with station name and cruise ID\n    overall_title &lt;- glue::glue(\"Station: {station_name}, Cruise ID: {cruise_id}\")\n\n    # Set margins: increase the outer margin for the title\n    par(oma = c(0, 0, 3, 0))  # Top outer margin increased for title\n\n    # Plotting function with specific parameters\n    oce::plot(\n      x = ctdDecimate(ctdTrim(cast)),\n      which = c(\n        \"CDOM\", \"dissolved_oxygen\",\n        \"oxygen_saturation\",\n        \"chlorophyll_concentration\", \"chlorophyll_fluorescence\"\n      ),\n      main = \"\"  # No main title for individual subplots\n    )\n\n    # Place a single overall title at the top of the plot frame\n    mtext(overall_title, side = 3, line = 1, outer = TRUE, cex = 1.5)\n\n    # Reset outer margins to default\n    par(oma = c(0, 0, 0, 0))\n\n  }, error = function(e) {\n    print(e$message)  # Print any errors that occur during plotting\n  })\n}\n\n\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n\n\n\n\nplotting other optical parameters for each cast\n# Loop through each CTD cast\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # Assuming each sublist contains only one relevant CTD object\n  tryCatch({\n    # Extract metadata for station name and cruise ID\n    station_name &lt;- cast@metadata$station[1]\n    cruise_id &lt;- cast@data$cruise_id[1]\n\n    # Generate a title with station name and cruise ID\n    overall_title &lt;- glue::glue(\"Station: {station_name}, Cruise ID: {cruise_id}\")\n\n    # Set margins: increase the outer margin for the title\n    par(oma = c(0, 0, 3, 0))  # Top outer margin increased for title\n\n    # Plotting function with specific parameters\n    oce::plot(\n      x = ctdDecimate(ctdTrim(cast)),\n      which = c(\n        \"photosynthetically_available_radiation\",\n        \"beam_attenuation\",\"beam_transmission\"\n      ),\n      main = \"\"  # No main title for individual subplots\n    )\n\n    # Place a single overall title at the top of the plot frame\n    mtext(overall_title, side = 3, line = 1, outer = TRUE, cex = 1.5)\n\n    # Reset outer margins to default\n    par(oma = c(0, 0, 0, 0))\n\n  }, error = function(e) {\n    print(e$message)  # Print any errors that occur during plotting\n  })\n}\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n[1] \"unknown xtype value (\\\"529.94\\\")\"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nloop through every cast, clean, & save\ncombined_df &lt;- data.frame()\nfor (i in seq(ctd_FK)){\n  tryCatch({\n    cast &lt;- ctd_FK[[i]]  # 1 is selecting only the first sublist\n    \n    # print(class(cast))\n    # clean cast \n    trimmed_cast &lt;- ctdTrim(cast)\n    decimated_cast &lt;- ctdDecimate(trimmed_cast, p = 0.5)  # binned to 0.5 m\n    \n    # convert to df\n    cast_df &lt;- as.data.frame(decimated_cast@data)\n    \n    # Add metadata\n    # assumes station ID and cruise ID the same for all & just uses 1st one\n    cast_df &lt;- mutate(\n      cast_df,\n      station = cast@data$station[1],\n      cruise_id = cast@data$cruise_id[1]\n    )\n  \n    # drop NA rows left by cleaning\n    cast_df &lt;- subset(cast_df, !is.na(scan))\n    \n    # Append the data to the combined dataframe\n    combined_df &lt;- rbind(combined_df, cast_df)\n  }, error = function(e){\n    print(glue(\"error in cast {cast@metadata$station[1]}\"))\n    print(e)\n  })\n}\n# Save to CSV\nfile_path &lt;- here(glue(\"data/cleaned/{cruise_id}.csv\"))\nwrite.csv(combined_df, file_path, row.names = FALSE)"
  },
  {
    "objectID": "cruise_report/cruise_reports/WS0603.html",
    "href": "cruise_report/cruise_reports/WS0603.html",
    "title": "WS0603",
    "section": "",
    "text": "WS0603\n\n\nsetup\nif (!nzchar(system.file(package = \"librarian\"))) {\n  install.packages(\"librarian\")\n}\n\nlibrarian::shelf(\n  quiet = TRUE,\n  readr, here, fs, ggplot2, glue, \"jiho/castr\", dplyr, oce, patchwork, purrr, tidyr\n)\n\n\n\n\nCode\nsource(here(\"R/cruise_load.R\"))\ncruise_df &lt;- cruise_load(params$cruise_id)\n\n\n\n\nplot depth & pressure vs time elapsed\ntryCatch({\n  plots &lt;- list()\n  \n  for (station_name in unique(cruise_df$station)) {\n    subset_df &lt;- filter(cruise_df, station == station_name)\n    plots[[station_name]] &lt;- ggplot(subset_df, aes(x = time_elapsed)) +\n      geom_point(aes(y = depth), color = \"blue\") +  # Plot depth in blue\n      geom_line(aes(y = sea_water_pressure), color = \"red\") +  # Plot sea water pressure in red\n      ggtitle(glue(\"{station_name}\")) +\n      theme(\n        axis.title.x = element_blank(),\n        axis.title.y = element_blank(),\n        axis.text.x = element_blank(),\n        axis.text.y = element_blank(),\n        axis.ticks.x = element_blank(),\n        axis.ticks.y = element_blank()\n      )  # Remove individual axis titles and text\n  }\n  \n  # drop nulls\n  plots &lt;- purrr::compact(plots)\n  \n  # Combine all plots into a grid\n  combined_plot &lt;- wrap_plots(plots) + \n    plot_layout(ncol = 4) +  # Adjust ncol to set number of columns in the grid\n    plot_annotation(\n      title = \"Depth (blue) and Pressure (red)\",\n      subtitle = \"Each panel represents a different station\",\n      caption = \"Time Elapsed (x-axis) vs Depth & Pressure (y-axis)\"\n    ) +\n    theme(\n      plot.tag = element_text(size = 12, face = \"bold\"),\n      plot.tag.position = \"topleft\",\n      axis.title.x = element_text(margin = margin(t = 10)),\n      axis.title.y = element_text(margin = margin(r = 10))\n    )\n  \n  print(combined_plot)\n}, error = function(er){\n  print(er)\n});\n\n\nWarning: Removed 2 rows containing missing values or values outside the scale range\n(`geom_point()`).\n\n\nWarning: Removed 1 row containing missing values or values outside the scale range\n(`geom_point()`).\n\n\nWarning: Removed 1 row containing missing values or values outside the scale range\n(`geom_line()`).\n\n\n\n\n\n\n\n\n\n\n\nplot across all stations\np &lt;- ggplot(cruise_df, aes(x = time, y = depth, fill = station)) +\n  geom_col() +  # This creates the bars\n  # geom_text(aes(label = station), vjust = -0.3) +  # This adds labels to each bar, adjust vjust for position\n  labs(x = \"Time\", y = \"Depth\", title = \"Depth over Time by Station\") +  # Set labels and title\n  theme_minimal()  # Use a minimal theme\nprint(p)\n\n\nWarning: Removed 2 rows containing missing values or values outside the scale range\n(`geom_col()`).\n\n\n\n\n\n\n\n\n\n\n\ncreate oce.ctd objects from dataframes\nctd_load &lt;- function(data, other_params = NULL) {\n  \n  # create csv into ctd object\n  test_ctd &lt;-\n    as.ctd(\n      salinity    = data$sea_water_salinity,\n      temperature = data$sea_water_temperature,\n      pressure    = data$sea_water_pressure,\n      station     = data$station\n    )\n  \n  # add additional columns to ctd object\n  if (!is.null(other_params)) {\n    for (param_name in other_params) {\n      test_ctd &lt;-\n        oceSetData(\n          object = test_ctd,\n          name   = param_name,\n          value  = data[[param_name]]\n        )\n    }\n  }\n  print(glue(\"{data$station[1]}:\\t{length(test_ctd@data$scan)} scans\"))\n\n\n  return(test_ctd)\n}\n\n# Define other parameters to add\nother_params &lt;- c(\n  \"cruise_id\", \"station\", \"time\", \"time_elapsed\", \n  \"latitude\", \"longitude\", \"sea_water_electrical_conductivity\", \n  \"CDOM\", \"dissolved_oxygen\",\"oxygen_saturation\", \"chlorophyll_concentration\", \n  \"chlorophyll_fluorescence\", \"photosynthetically_available_radiation\", \n  \"beam_attenuation\",\"beam_transmission\", \"depth\", \"sea_water_sigma_t\",\n  \"descent_rate\", \"sound_velocity\",\"altimeter\"\n)\n\n# Split data by station and create data list\nctd_FK &lt;- cruise_df %&gt;%\n  split(.$station) %&gt;%\n  map(~ ctd_load(.x, other_params = other_params)) # ~ is a lambda(x)\n\n\n1:  2086 scans\n10: 1827 scans\n11: 1768 scans\n12: 3241 scans\n13: 2172 scans\n14: 3181 scans\n15: 3259 scans\n15.5:   7861 scans\n16: 1791 scans\n17: 2621 scans\n18: 2117 scans\n19: 1937 scans\n2:  2006 scans\n20: 2778 scans\n21: 2913 scans\n21.5:   8184 scans\n22: 2327 scans\n22.5:   9177 scans\n23: 1942 scans\n24: 2294 scans\n25: 3841 scans\n25.5:   13714 scans\n26: 2765 scans\n27: 2367 scans\n28: 3306 scans\n28.5:   3374 scans\n29: 3456 scans\n29.5:   2809 scans\n3:  3574 scans\n30: 2984 scans\n31: 2170 scans\n32: 3043 scans\n33: 2941 scans\n34: 2027 scans\n39: 2433 scans\n4:  1851 scans\n40: 2750 scans\n41: 2540 scans\n42: 2515 scans\n44: 2646 scans\n45: 2058 scans\n46: 2266 scans\n47: 2580 scans\n48: 2180 scans\n49: 2526 scans\n5:  2053 scans\n5.5:    1616 scans\n50: 2688 scans\n51: 2807 scans\n52: 2638 scans\n53: 4680 scans\n54: 2533 scans\n55: 2411 scans\n56: 2480 scans\n57: 2683 scans\n58: 3424 scans\n59: 2626 scans\n6:  3416 scans\n6.5:    6731 scans\n60: 2347 scans\n61: 3846 scans\n62: 2455 scans\n63: 2320 scans\n64: 2513 scans\n65: 2160 scans\n66: 2378 scans\n67: 3270 scans\n68: 2377 scans\n69: 3046 scans\n7:  1920 scans\n70: 2311 scans\n71: 1554 scans\n8:  1780 scans\n9:  2711 scans\n9.5:    6632 scans\nCAL1:   2129 scans\nCAL2:   2508 scans\nCAL3:   3914 scans\nCAL4:   3208 scans\nCAL5:   3886 scans\nCH1:    3097 scans\nCH2:    5196 scans\nCH3:    3501 scans\nCH4:    6340 scans\nCH5:    5815 scans\nDT1:    2896 scans\nDT10:   2393 scans\nDT11:   2415 scans\nDT2:    2883 scans\nDT3:    3973 scans\nDT4:    5743 scans\nDT5:    4618 scans\nDT6:    6878 scans\nDT7:    19101 scans\nDT8:    8860 scans\nDT9:    4512 scans\n\n\n\n\nplotting scans for each cast in the first list\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # 1 is selecting only the first sublist\n  # print(i)\n  print(glue(\"=== station: {cast@metadata$station[1]}\"))\n  print(glue(\"# scans: {length(cast@data$scan)}\"))\n  plotScan(cast)\n}\n\n\n=== station: 1\n# scans: 2086\n\n\n\n\n\n\n\n\n\n=== station: 10\n# scans: 1827\n\n\n\n\n\n\n\n\n\n=== station: 11\n# scans: 1768\n\n\n\n\n\n\n\n\n\n=== station: 12\n# scans: 3241\n\n\n\n\n\n\n\n\n\n=== station: 13\n# scans: 2172\n\n\n\n\n\n\n\n\n\n=== station: 14\n# scans: 3181\n\n\n\n\n\n\n\n\n\n=== station: 15\n# scans: 3259\n\n\n\n\n\n\n\n\n\n=== station: 15.5\n# scans: 7861\n\n\n\n\n\n\n\n\n\n=== station: 16\n# scans: 1791\n\n\n\n\n\n\n\n\n\n=== station: 17\n# scans: 2621\n\n\n\n\n\n\n\n\n\n=== station: 18\n# scans: 2117\n\n\n\n\n\n\n\n\n\n=== station: 19\n# scans: 1937\n\n\n\n\n\n\n\n\n\n=== station: 2\n# scans: 2006\n\n\n\n\n\n\n\n\n\n=== station: 20\n# scans: 2778\n\n\n\n\n\n\n\n\n\n=== station: 21\n# scans: 2913\n\n\n\n\n\n\n\n\n\n=== station: 21.5\n# scans: 8184\n\n\n\n\n\n\n\n\n\n=== station: 22\n# scans: 2327\n\n\n\n\n\n\n\n\n\n=== station: 22.5\n# scans: 9177\n\n\n\n\n\n\n\n\n\n=== station: 23\n# scans: 1942\n\n\n\n\n\n\n\n\n\n=== station: 24\n# scans: 2294\n\n\n\n\n\n\n\n\n\n=== station: 25\n# scans: 3841\n\n\n\n\n\n\n\n\n\n=== station: 25.5\n# scans: 13714\n\n\n\n\n\n\n\n\n\n=== station: 26\n# scans: 2765\n\n\n\n\n\n\n\n\n\n=== station: 27\n# scans: 2367\n\n\n\n\n\n\n\n\n\n=== station: 28\n# scans: 3306\n\n\n\n\n\n\n\n\n\n=== station: 28.5\n# scans: 3374\n\n\n\n\n\n\n\n\n\n=== station: 29\n# scans: 3456\n\n\n\n\n\n\n\n\n\n=== station: 29.5\n# scans: 2809\n\n\n\n\n\n\n\n\n\n=== station: 3\n# scans: 3574\n\n\n\n\n\n\n\n\n\n=== station: 30\n# scans: 2984\n\n\n\n\n\n\n\n\n\n=== station: 31\n# scans: 2170\n\n\n\n\n\n\n\n\n\n=== station: 32\n# scans: 3043\n\n\n\n\n\n\n\n\n\n=== station: 33\n# scans: 2941\n\n\n\n\n\n\n\n\n\n=== station: 34\n# scans: 2027\n\n\n\n\n\n\n\n\n\n=== station: 39\n# scans: 2433\n\n\n\n\n\n\n\n\n\n=== station: 4\n# scans: 1851\n\n\n\n\n\n\n\n\n\n=== station: 40\n# scans: 2750\n\n\n\n\n\n\n\n\n\n=== station: 41\n# scans: 2540\n\n\n\n\n\n\n\n\n\n=== station: 42\n# scans: 2515\n\n\n\n\n\n\n\n\n\n=== station: 44\n# scans: 2646\n\n\n\n\n\n\n\n\n\n=== station: 45\n# scans: 2058\n\n\n\n\n\n\n\n\n\n=== station: 46\n# scans: 2266\n\n\n\n\n\n\n\n\n\n=== station: 47\n# scans: 2580\n\n\n\n\n\n\n\n\n\n=== station: 48\n# scans: 2180\n\n\n\n\n\n\n\n\n\n=== station: 49\n# scans: 2526\n\n\n\n\n\n\n\n\n\n=== station: 5\n# scans: 2053\n\n\n\n\n\n\n\n\n\n=== station: 5.5\n# scans: 1616\n\n\n\n\n\n\n\n\n\n=== station: 50\n# scans: 2688\n\n\n\n\n\n\n\n\n\n=== station: 51\n# scans: 2807\n\n\n\n\n\n\n\n\n\n=== station: 52\n# scans: 2638\n\n\n\n\n\n\n\n\n\n=== station: 53\n# scans: 4680\n\n\n\n\n\n\n\n\n\n=== station: 54\n# scans: 2533\n\n\n\n\n\n\n\n\n\n=== station: 55\n# scans: 2411\n\n\n\n\n\n\n\n\n\n=== station: 56\n# scans: 2480\n\n\n\n\n\n\n\n\n\n=== station: 57\n# scans: 2683\n\n\n\n\n\n\n\n\n\n=== station: 58\n# scans: 3424\n\n\n\n\n\n\n\n\n\n=== station: 59\n# scans: 2626\n\n\n\n\n\n\n\n\n\n=== station: 6\n# scans: 3416\n\n\n\n\n\n\n\n\n\n=== station: 6.5\n# scans: 6731\n\n\n\n\n\n\n\n\n\n=== station: 60\n# scans: 2347\n\n\n\n\n\n\n\n\n\n=== station: 61\n# scans: 3846\n\n\n\n\n\n\n\n\n\n=== station: 62\n# scans: 2455\n\n\n\n\n\n\n\n\n\n=== station: 63\n# scans: 2320\n\n\n\n\n\n\n\n\n\n=== station: 64\n# scans: 2513\n\n\n\n\n\n\n\n\n\n=== station: 65\n# scans: 2160\n\n\n\n\n\n\n\n\n\n=== station: 66\n# scans: 2378\n\n\n\n\n\n\n\n\n\n=== station: 67\n# scans: 3270\n\n\n\n\n\n\n\n\n\n=== station: 68\n# scans: 2377\n\n\n\n\n\n\n\n\n\n=== station: 69\n# scans: 3046\n\n\n\n\n\n\n\n\n\n=== station: 7\n# scans: 1920\n\n\n\n\n\n\n\n\n\n=== station: 70\n# scans: 2311\n\n\n\n\n\n\n\n\n\n=== station: 71\n# scans: 1554\n\n\n\n\n\n\n\n\n\n=== station: 8\n# scans: 1780\n\n\n\n\n\n\n\n\n\n=== station: 9\n# scans: 2711\n\n\n\n\n\n\n\n\n\n=== station: 9.5\n# scans: 6632\n\n\n\n\n\n\n\n\n\n=== station: CAL1\n# scans: 2129\n\n\n\n\n\n\n\n\n\n=== station: CAL2\n# scans: 2508\n\n\n\n\n\n\n\n\n\n=== station: CAL3\n# scans: 3914\n\n\n\n\n\n\n\n\n\n=== station: CAL4\n# scans: 3208\n\n\n\n\n\n\n\n\n\n=== station: CAL5\n# scans: 3886\n\n\n\n\n\n\n\n\n\n=== station: CH1\n# scans: 3097\n\n\n\n\n\n\n\n\n\n=== station: CH2\n# scans: 5196\n\n\n\n\n\n\n\n\n\n=== station: CH3\n# scans: 3501\n\n\n\n\n\n\n\n\n\n=== station: CH4\n# scans: 6340\n\n\n\n\n\n\n\n\n\n=== station: CH5\n# scans: 5815\n\n\n\n\n\n\n\n\n\n=== station: DT1\n# scans: 2896\n\n\n\n\n\n\n\n\n\n=== station: DT10\n# scans: 2393\n\n\n\n\n\n\n\n\n\n=== station: DT11\n# scans: 2415\n\n\n\n\n\n\n\n\n\n=== station: DT2\n# scans: 2883\n\n\n\n\n\n\n\n\n\n=== station: DT3\n# scans: 3973\n\n\n\n\n\n\n\n\n\n=== station: DT4\n# scans: 5743\n\n\n\n\n\n\n\n\n\n=== station: DT5\n# scans: 4618\n\n\n\n\n\n\n\n\n\n=== station: DT6\n# scans: 6878\n\n\n\n\n\n\n\n\n\n=== station: DT7\n# scans: 19101\n\n\n\n\n\n\n\n\n\n=== station: DT8\n# scans: 8860\n\n\n\n\n\n\n\n\n\n=== station: DT9\n# scans: 4512\n\n\n\n\n\n\n\n\n\n\n\nplotting each cast in the first list\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # 1 is selecting only the first sublist\n  tryCatch({\n    plot(ctdDecimate(ctdTrim(cast)))\n  }, error = function(e){\n    print(e)\n  })\n}\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2086' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1827' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1768' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3241' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2172' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3181' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3259' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 7861' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1791' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2621' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2117' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1937' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2006' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2778' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2913' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 8184' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2327' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 9177' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1942' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2294' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3841' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 13714' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2765' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2367' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3306' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3374' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3456' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2809' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3574' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2984' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2170' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3043' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2941' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2027' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2433' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1851' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2750' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2540' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2515' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2646' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2058' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2266' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2580' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2180' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2526' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2053' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1616' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2688' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2807' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2638' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4680' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2533' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2411' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2480' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2683' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3424' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2626' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3416' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 6731' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2347' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3846' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2455' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2320' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2513' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2160' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2378' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3270' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2377' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3046' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1920' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2311' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1554' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1780' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2711' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 6632' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2129' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2508' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3914' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3208' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3886' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3097' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 5196' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3501' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 6340' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 5815' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2896' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2393' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2415' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2883' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3973' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 5743' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4618' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 6878' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 19101' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 8860' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4512' in coercion to 'logical(1)'&gt;\n\n\n\n\nplotting other physical parameters for each cast\n# Loop through each CTD cast\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # Assuming each sublist contains only one relevant CTD object\n  tryCatch({\n    # Extract metadata for station name and cruise ID\n    station_name &lt;- cast@metadata$station[1]\n    cruise_id &lt;- cast@data$cruise_id[1]\n\n    # Generate a title with station name and cruise ID\n    overall_title &lt;- glue::glue(\"Station: {station_name}, Cruise ID: {cruise_id}\")\n\n    # Set margins: increase the outer margin for the title\n    par(oma = c(0, 0, 3, 0))  # Top outer margin increased for title\n\n    # Plotting function with specific parameters\n    oce::plot(\n      x = ctdDecimate(ctdTrim(cast)),\n      which = c(\n        \"sea_water_electrical_conductivity\",\n        \"descent_rate\", \"sound_velocity\",\n        \"sea_water_sigma_t\",\"altimeter\"\n      ),\n      main = \"\"  # No main title for individual subplots\n    )\n\n    # Place a single overall title at the top of the plot frame\n    mtext(overall_title, side = 3, line = 1, outer = TRUE, cex = 1.5)\n\n    # Reset outer margins to default\n    par(oma = c(0, 0, 0, 0))\n\n  }, error = function(e) {\n    print(e$message)  # Print any errors that occur during plotting\n  })\n}\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n\n\nplotting other nutrient parameters for each cast\n# Loop through each CTD cast\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # Assuming each sublist contains only one relevant CTD object\n  tryCatch({\n    # Extract metadata for station name and cruise ID\n    station_name &lt;- cast@metadata$station[1]\n    cruise_id &lt;- cast@data$cruise_id[1]\n\n    # Generate a title with station name and cruise ID\n    overall_title &lt;- glue::glue(\"Station: {station_name}, Cruise ID: {cruise_id}\")\n\n    # Set margins: increase the outer margin for the title\n    par(oma = c(0, 0, 3, 0))  # Top outer margin increased for title\n\n    # Plotting function with specific parameters\n    oce::plot(\n      x = ctdDecimate(ctdTrim(cast)),\n      which = c(\n        \"CDOM\", \"dissolved_oxygen\",\n        \"oxygen_saturation\",\n        \"chlorophyll_concentration\", \"chlorophyll_fluorescence\"\n      ),\n      main = \"\"  # No main title for individual subplots\n    )\n\n    # Place a single overall title at the top of the plot frame\n    mtext(overall_title, side = 3, line = 1, outer = TRUE, cex = 1.5)\n\n    # Reset outer margins to default\n    par(oma = c(0, 0, 0, 0))\n\n  }, error = function(e) {\n    print(e$message)  # Print any errors that occur during plotting\n  })\n}\n\n\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n\n\n\n\nplotting other optical parameters for each cast\n# Loop through each CTD cast\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # Assuming each sublist contains only one relevant CTD object\n  tryCatch({\n    # Extract metadata for station name and cruise ID\n    station_name &lt;- cast@metadata$station[1]\n    cruise_id &lt;- cast@data$cruise_id[1]\n\n    # Generate a title with station name and cruise ID\n    overall_title &lt;- glue::glue(\"Station: {station_name}, Cruise ID: {cruise_id}\")\n\n    # Set margins: increase the outer margin for the title\n    par(oma = c(0, 0, 3, 0))  # Top outer margin increased for title\n\n    # Plotting function with specific parameters\n    oce::plot(\n      x = ctdDecimate(ctdTrim(cast)),\n      which = c(\n        \"photosynthetically_available_radiation\",\n        \"beam_attenuation\",\"beam_transmission\"\n      ),\n      main = \"\"  # No main title for individual subplots\n    )\n\n    # Place a single overall title at the top of the plot frame\n    mtext(overall_title, side = 3, line = 1, outer = TRUE, cex = 1.5)\n\n    # Reset outer margins to default\n    par(oma = c(0, 0, 0, 0))\n\n  }, error = function(e) {\n    print(e$message)  # Print any errors that occur during plotting\n  })\n}\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n[1] \"the condition has length &gt; 1\"\n[1] \"the condition has length &gt; 1\"\n[1] \"the condition has length &gt; 1\"\n[1] \"the condition has length &gt; 1\"\n\n\n\n\n\n\n\n\n\n[1] \"the condition has length &gt; 1\"\n[1] \"the condition has length &gt; 1\"\n[1] \"the condition has length &gt; 1\"\n[1] \"the condition has length &gt; 1\"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"the condition has length &gt; 1\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"the condition has length &gt; 1\"\n[1] \"the condition has length &gt; 1\"\n\n\n[1] \"the condition has length &gt; 1\"\n\n\n\n\nloop through every cast, clean, & save\ncombined_df &lt;- data.frame()\nfor (i in seq(ctd_FK)){\n  tryCatch({\n    cast &lt;- ctd_FK[[i]]  # 1 is selecting only the first sublist\n    \n    # print(class(cast))\n    # clean cast \n    trimmed_cast &lt;- ctdTrim(cast)\n    decimated_cast &lt;- ctdDecimate(trimmed_cast, p = 0.5)  # binned to 0.5 m\n    \n    # convert to df\n    cast_df &lt;- as.data.frame(decimated_cast@data)\n    \n    # Add metadata\n    # assumes station ID and cruise ID the same for all & just uses 1st one\n    cast_df &lt;- mutate(\n      cast_df,\n      station = cast@data$station[1],\n      cruise_id = cast@data$cruise_id[1]\n    )\n  \n    # drop NA rows left by cleaning\n    cast_df &lt;- subset(cast_df, !is.na(scan))\n    \n    # Append the data to the combined dataframe\n    combined_df &lt;- rbind(combined_df, cast_df)\n  }, error = function(e){\n    print(glue(\"error in cast {cast@metadata$station[1]}\"))\n    print(e)\n  })\n}\n# Save to CSV\nfile_path &lt;- here(glue(\"data/cleaned/{cruise_id}.csv\"))\nwrite.csv(combined_df, file_path, row.names = FALSE)"
  },
  {
    "objectID": "cruise_report/cruise_reports/SAV1803.html",
    "href": "cruise_report/cruise_reports/SAV1803.html",
    "title": "SAV1803",
    "section": "",
    "text": "SAV1803\n\n\nsetup\nif (!nzchar(system.file(package = \"librarian\"))) {\n  install.packages(\"librarian\")\n}\n\nlibrarian::shelf(\n  quiet = TRUE,\n  readr, here, fs, ggplot2, glue, \"jiho/castr\", dplyr, oce, patchwork, purrr, tidyr\n)\n\n\n\n\nCode\nsource(here(\"R/cruise_load.R\"))\ncruise_df &lt;- cruise_load(params$cruise_id)\n\n\n\n\nplot depth & pressure vs time elapsed\ntryCatch({\n  plots &lt;- list()\n  \n  for (station_name in unique(cruise_df$station)) {\n    subset_df &lt;- filter(cruise_df, station == station_name)\n    plots[[station_name]] &lt;- ggplot(subset_df, aes(x = time_elapsed)) +\n      geom_point(aes(y = depth), color = \"blue\") +  # Plot depth in blue\n      geom_line(aes(y = sea_water_pressure), color = \"red\") +  # Plot sea water pressure in red\n      ggtitle(glue(\"{station_name}\")) +\n      theme(\n        axis.title.x = element_blank(),\n        axis.title.y = element_blank(),\n        axis.text.x = element_blank(),\n        axis.text.y = element_blank(),\n        axis.ticks.x = element_blank(),\n        axis.ticks.y = element_blank()\n      )  # Remove individual axis titles and text\n  }\n  \n  # drop nulls\n  plots &lt;- purrr::compact(plots)\n  \n  # Combine all plots into a grid\n  combined_plot &lt;- wrap_plots(plots) + \n    plot_layout(ncol = 4) +  # Adjust ncol to set number of columns in the grid\n    plot_annotation(\n      title = \"Depth (blue) and Pressure (red)\",\n      subtitle = \"Each panel represents a different station\",\n      caption = \"Time Elapsed (x-axis) vs Depth & Pressure (y-axis)\"\n    ) +\n    theme(\n      plot.tag = element_text(size = 12, face = \"bold\"),\n      plot.tag.position = \"topleft\",\n      axis.title.x = element_text(margin = margin(t = 10)),\n      axis.title.y = element_text(margin = margin(r = 10))\n    )\n  \n  print(combined_plot)\n}, error = function(er){\n  print(er)\n});\n\n\n`geom_line()`: Each group consists of only one observation.\n Do you need to adjust the group aesthetic?\n\n\n\n\n\n\n\n\n\n\n\nplot across all stations\np &lt;- ggplot(cruise_df, aes(x = time, y = depth, fill = station)) +\n  geom_col() +  # This creates the bars\n  # geom_text(aes(label = station), vjust = -0.3) +  # This adds labels to each bar, adjust vjust for position\n  labs(x = \"Time\", y = \"Depth\", title = \"Depth over Time by Station\") +  # Set labels and title\n  theme_minimal()  # Use a minimal theme\nprint(p)\n\n\n\n\n\n\n\n\n\n\n\ncreate oce.ctd objects from dataframes\nctd_load &lt;- function(data, other_params = NULL) {\n  \n  # create csv into ctd object\n  test_ctd &lt;-\n    as.ctd(\n      salinity    = data$sea_water_salinity,\n      temperature = data$sea_water_temperature,\n      pressure    = data$sea_water_pressure,\n      station     = data$station\n    )\n  \n  # add additional columns to ctd object\n  if (!is.null(other_params)) {\n    for (param_name in other_params) {\n      test_ctd &lt;-\n        oceSetData(\n          object = test_ctd,\n          name   = param_name,\n          value  = data[[param_name]]\n        )\n    }\n  }\n  print(glue(\"{data$station[1]}:\\t{length(test_ctd@data$scan)} scans\"))\n\n\n  return(test_ctd)\n}\n\n# Define other parameters to add\nother_params &lt;- c(\n  \"cruise_id\", \"station\", \"time\", \"time_elapsed\", \n  \"latitude\", \"longitude\", \"sea_water_electrical_conductivity\", \n  \"CDOM\", \"dissolved_oxygen\",\"oxygen_saturation\", \"chlorophyll_concentration\", \n  \"chlorophyll_fluorescence\", \"photosynthetically_available_radiation\", \n  \"beam_attenuation\",\"beam_transmission\", \"depth\", \"sea_water_sigma_t\",\n  \"descent_rate\", \"sound_velocity\",\"altimeter\"\n)\n\n# Split data by station and create data list\nctd_FK &lt;- cruise_df %&gt;%\n  split(.$station) %&gt;%\n  map(~ ctd_load(.x, other_params = other_params)) # ~ is a lambda(x)\n\n\n12: 4471 scans\n17: 3475 scans\n18: 5410 scans\n2:  4547 scans\n21: 3834 scans\n21.5:   9899 scans\n3:  5338 scans\n31: 2474 scans\n33: 3980 scans\n41: 2472 scans\n45: 4068 scans\n49: 1 scans\n51: 2371 scans\n54: 2835 scans\n55: 589 scans\n56: 2159 scans\n57: 2403 scans\n57.1:   2588 scans\n57.2:   5074 scans\n57.3:   2227 scans\n58: 3359 scans\n59: 2444 scans\n60: 2378 scans\n62: 2588 scans\n68: 1983 scans\n7:  2266 scans\n9:  4690 scans\n9.5:    9743 scans\nMR: 3576 scans\nMRV2:   102 scans\nWS: 1977 scans\n\n\n\n\nplotting scans for each cast in the first list\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # 1 is selecting only the first sublist\n  # print(i)\n  print(glue(\"=== station: {cast@metadata$station[1]}\"))\n  print(glue(\"# scans: {length(cast@data$scan)}\"))\n  plotScan(cast)\n}\n\n\n=== station: 12\n# scans: 4471\n\n\n\n\n\n\n\n\n\n=== station: 17\n# scans: 3475\n\n\n\n\n\n\n\n\n\n=== station: 18\n# scans: 5410\n\n\n\n\n\n\n\n\n\n=== station: 2\n# scans: 4547\n\n\n\n\n\n\n\n\n\n=== station: 21\n# scans: 3834\n\n\n\n\n\n\n\n\n\n=== station: 21.5\n# scans: 9899\n\n\n\n\n\n\n\n\n\n=== station: 3\n# scans: 5338\n\n\n\n\n\n\n\n\n\n=== station: 31\n# scans: 2474\n\n\n\n\n\n\n\n\n\n=== station: 33\n# scans: 3980\n\n\n\n\n\n\n\n\n\n=== station: 41\n# scans: 2472\n\n\n\n\n\n\n\n\n\n=== station: 45\n# scans: 4068\n\n\n\n\n\n\n\n\n\n=== station: 49\n# scans: 1\n\n\n\n\n\n\n\n\n\n=== station: 51\n# scans: 2371\n\n\n\n\n\n\n\n\n\n=== station: 54\n# scans: 2835\n\n\n\n\n\n\n\n\n\n=== station: 55\n# scans: 589\n\n\n\n\n\n\n\n\n\n=== station: 56\n# scans: 2159\n\n\n\n\n\n\n\n\n\n=== station: 57\n# scans: 2403\n\n\n\n\n\n\n\n\n\n=== station: 57.1\n# scans: 2588\n\n\n\n\n\n\n\n\n\n=== station: 57.2\n# scans: 5074\n\n\n\n\n\n\n\n\n\n=== station: 57.3\n# scans: 2227\n\n\n\n\n\n\n\n\n\n=== station: 58\n# scans: 3359\n\n\n\n\n\n\n\n\n\n=== station: 59\n# scans: 2444\n\n\n\n\n\n\n\n\n\n=== station: 60\n# scans: 2378\n\n\n\n\n\n\n\n\n\n=== station: 62\n# scans: 2588\n\n\n\n\n\n\n\n\n\n=== station: 68\n# scans: 1983\n\n\n\n\n\n\n\n\n\n=== station: 7\n# scans: 2266\n\n\n\n\n\n\n\n\n\n=== station: 9\n# scans: 4690\n\n\n\n\n\n\n\n\n\n=== station: 9.5\n# scans: 9743\n\n\n\n\n\n\n\n\n\n=== station: MR\n# scans: 3576\n\n\n\n\n\n\n\n\n\n=== station: MRV2\n# scans: 102\n\n\n\n\n\n\n\n\n\n=== station: WS\n# scans: 1977\n\n\n\n\n\n\n\n\n\n\n\nplotting each cast in the first list\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # 1 is selecting only the first sublist\n  tryCatch({\n    plot(ctdDecimate(ctdTrim(cast)))\n  }, error = function(e){\n    print(e)\n  })\n}\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4471' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3475' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 5410' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4547' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3834' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 9899' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 5338' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2474' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3980' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2472' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4068' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2371' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2835' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2159' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2403' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2588' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 5074' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2227' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3359' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2444' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2378' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1983' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2266' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4690' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 9743' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3576' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 102' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1977' in coercion to 'logical(1)'&gt;\n\n\n\n\nplotting other physical parameters for each cast\n# Loop through each CTD cast\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # Assuming each sublist contains only one relevant CTD object\n  tryCatch({\n    # Extract metadata for station name and cruise ID\n    station_name &lt;- cast@metadata$station[1]\n    cruise_id &lt;- cast@data$cruise_id[1]\n\n    # Generate a title with station name and cruise ID\n    overall_title &lt;- glue::glue(\"Station: {station_name}, Cruise ID: {cruise_id}\")\n\n    # Set margins: increase the outer margin for the title\n    par(oma = c(0, 0, 3, 0))  # Top outer margin increased for title\n\n    # Plotting function with specific parameters\n    oce::plot(\n      x = ctdDecimate(ctdTrim(cast)),\n      which = c(\n        \"sea_water_electrical_conductivity\",\n        \"descent_rate\", \"sound_velocity\",\n        \"sea_water_sigma_t\",\"altimeter\"\n      ),\n      main = \"\"  # No main title for individual subplots\n    )\n\n    # Place a single overall title at the top of the plot frame\n    mtext(overall_title, side = 3, line = 1, outer = TRUE, cex = 1.5)\n\n    # Reset outer margins to default\n    par(oma = c(0, 0, 0, 0))\n\n  }, error = function(e) {\n    print(e$message)  # Print any errors that occur during plotting\n  })\n}\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"sea_water_electrical_conductivitydescent_ratesound_velocitysea_water_sigma_taltimeter\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"sea_water_electrical_conductivitydescent_ratesound_velocitysea_water_sigma_taltimeter\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"sea_water_electrical_conductivitydescent_ratesound_velocitysea_water_sigma_taltimeter\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"sea_water_electrical_conductivitydescent_ratesound_velocitysea_water_sigma_taltimeter\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"sea_water_electrical_conductivitydescent_ratesound_velocitysea_water_sigma_taltimeter\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"sea_water_electrical_conductivitydescent_ratesound_velocitysea_water_sigma_taltimeter\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"sea_water_electrical_conductivitydescent_ratesound_velocitysea_water_sigma_taltimeter\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"sea_water_electrical_conductivitydescent_ratesound_velocitysea_water_sigma_taltimeter\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"sea_water_electrical_conductivitydescent_ratesound_velocitysea_water_sigma_taltimeter\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"sea_water_electrical_conductivitydescent_ratesound_velocitysea_water_sigma_taltimeter\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"need finite 'xlim' values\"\n[1] \"unknown xtype value (\\\"4.703773\\\")\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"sea_water_electrical_conductivitydescent_ratesound_velocitysea_water_sigma_taltimeter\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"sea_water_electrical_conductivitydescent_ratesound_velocitysea_water_sigma_taltimeter\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"sea_water_electrical_conductivitydescent_ratesound_velocitysea_water_sigma_taltimeter\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"sea_water_electrical_conductivitydescent_ratesound_velocitysea_water_sigma_taltimeter\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"sea_water_electrical_conductivitydescent_ratesound_velocitysea_water_sigma_taltimeter\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"sea_water_electrical_conductivitydescent_ratesound_velocitysea_water_sigma_taltimeter\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"sea_water_electrical_conductivitydescent_ratesound_velocitysea_water_sigma_taltimeter\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"sea_water_electrical_conductivitydescent_ratesound_velocitysea_water_sigma_taltimeter\\\" cannot be handled\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"sea_water_electrical_conductivitydescent_ratesound_velocitysea_water_sigma_taltimeter\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"sea_water_electrical_conductivitydescent_ratesound_velocitysea_water_sigma_taltimeter\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"sea_water_electrical_conductivitydescent_ratesound_velocitysea_water_sigma_taltimeter\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"sea_water_electrical_conductivitydescent_ratesound_velocitysea_water_sigma_taltimeter\\\" cannot be handled\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"sea_water_electrical_conductivitydescent_ratesound_velocitysea_water_sigma_taltimeter\\\" cannot be handled\"\n\n\n\n\nplotting other nutrient parameters for each cast\n# Loop through each CTD cast\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # Assuming each sublist contains only one relevant CTD object\n  tryCatch({\n    # Extract metadata for station name and cruise ID\n    station_name &lt;- cast@metadata$station[1]\n    cruise_id &lt;- cast@data$cruise_id[1]\n\n    # Generate a title with station name and cruise ID\n    overall_title &lt;- glue::glue(\"Station: {station_name}, Cruise ID: {cruise_id}\")\n\n    # Set margins: increase the outer margin for the title\n    par(oma = c(0, 0, 3, 0))  # Top outer margin increased for title\n\n    # Plotting function with specific parameters\n    oce::plot(\n      x = ctdDecimate(ctdTrim(cast)),\n      which = c(\n        \"CDOM\", \"dissolved_oxygen\",\n        \"oxygen_saturation\",\n        \"chlorophyll_concentration\", \"chlorophyll_fluorescence\"\n      ),\n      main = \"\"  # No main title for individual subplots\n    )\n\n    # Place a single overall title at the top of the plot frame\n    mtext(overall_title, side = 3, line = 1, outer = TRUE, cex = 1.5)\n\n    # Reset outer margins to default\n    par(oma = c(0, 0, 0, 0))\n\n  }, error = function(e) {\n    print(e$message)  # Print any errors that occur during plotting\n  })\n}\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"unknown xtype value (\\\"4.5246\\\")\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n\n\n\n\nplotting other optical parameters for each cast\n# Loop through each CTD cast\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # Assuming each sublist contains only one relevant CTD object\n  tryCatch({\n    # Extract metadata for station name and cruise ID\n    station_name &lt;- cast@metadata$station[1]\n    cruise_id &lt;- cast@data$cruise_id[1]\n\n    # Generate a title with station name and cruise ID\n    overall_title &lt;- glue::glue(\"Station: {station_name}, Cruise ID: {cruise_id}\")\n\n    # Set margins: increase the outer margin for the title\n    par(oma = c(0, 0, 3, 0))  # Top outer margin increased for title\n\n    # Plotting function with specific parameters\n    oce::plot(\n      x = ctdDecimate(ctdTrim(cast)),\n      which = c(\n        \"photosynthetically_available_radiation\",\n        \"beam_attenuation\",\"beam_transmission\"\n      ),\n      main = \"\"  # No main title for individual subplots\n    )\n\n    # Place a single overall title at the top of the plot frame\n    mtext(overall_title, side = 3, line = 1, outer = TRUE, cex = 1.5)\n\n    # Reset outer margins to default\n    par(oma = c(0, 0, 0, 0))\n\n  }, error = function(e) {\n    print(e$message)  # Print any errors that occur during plotting\n  })\n}\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"unknown xtype value (\\\"23.793\\\")\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n\n\nloop through every cast, clean, & save\ncombined_df &lt;- data.frame()\nfor (i in seq(ctd_FK)){\n  tryCatch({\n    cast &lt;- ctd_FK[[i]]  # 1 is selecting only the first sublist\n    \n    # print(class(cast))\n    # clean cast \n    trimmed_cast &lt;- ctdTrim(cast)\n    decimated_cast &lt;- ctdDecimate(trimmed_cast, p = 0.5)  # binned to 0.5 m\n    \n    # convert to df\n    cast_df &lt;- as.data.frame(decimated_cast@data)\n    \n    # Add metadata\n    # assumes station ID and cruise ID the same for all & just uses 1st one\n    cast_df &lt;- mutate(\n      cast_df,\n      station = cast@data$station[1],\n      cruise_id = cast@data$cruise_id[1]\n    )\n  \n    # drop NA rows left by cleaning\n    cast_df &lt;- subset(cast_df, !is.na(scan))\n    \n    # Append the data to the combined dataframe\n    combined_df &lt;- rbind(combined_df, cast_df)\n  }, error = function(e){\n    print(glue(\"error in cast {cast@metadata$station[1]}\"))\n    print(e)\n  })\n}\n# Save to CSV\nfile_path &lt;- here(glue(\"data/cleaned/{cruise_id}.csv\"))\nwrite.csv(combined_df, file_path, row.names = FALSE)"
  },
  {
    "objectID": "index.html",
    "href": "index.html",
    "title": "SEUS MBON Cruise Data",
    "section": "",
    "text": "Raw data comes from https://gcoos5.geos.tamu.edu/erddap. The data hosted there has already had some processing done, but this cleans it even further.\nAfter processing the cleaned data will be in ./data/cleaned/. A version of the cleaned data is hosted by USF IMaRS at here.\nThe code below is used for fetching the data. Cleaning is done per-cruise, code can be found alongside visualizations in the Cruise Reports.\n\n\nsetup\nif (!nzchar(system.file(package = \"librarian\"))) {\n  install.packages(\"librarian\")\n}\n\nlibrarian::shelf(\n  quiet = TRUE,\n  librarian, conflicted, ggplot2, tibble, tidyr, readr, purrr, dplyr, stringr,\n  forcats, lubridate, glue, fs, magrittr, here, rerddap, cli,\n)\n\n\n\n  These packages will be installed:\n\n  'rerddap'\n\n  It may take some time.\n\n\nalso installing the dependencies 'hoardr', 'ncdf4'\n\n\nsetup\nconflicts_prefer(\n  dplyr::filter(),\n  dplyr::select()\n)\n\n\n[conflicted] Will prefer dplyr::filter over any other package.\n\n\n[conflicted] Will prefer dplyr::select over any other package.\n\n\nsetup\n# source(here(\"R\", \"ctd_download.R\"))\n\n\n\n\nlist all cruises\n\"https://gcoos5.geos.tamu.edu/erddap/\" %&gt;%\n  Sys.setenv(RERDDAP_DEFAULT_URL = .)\n\n# search for  all cruise ctd tables in ERDDAP\nall_cruise_info &lt;-\n  ed_search_adv(\n    query     = \"Walton Smith CTD\",\n    # maxTime   = \"2016-01-01T01:00:00Z\",\n    page_size = 1e4\n  )\n\n# find unique cruise names\nall_cruise_ids &lt;-\n  str_extract(all_cruise_info$info$title, \"(WS|SAV|WB|H)\\\\d{3,5}\") %&gt;%\n  unique()\n\n# print info about cruise IDs found\ncli::cli_alert_info(\n  c(\n    \"{col_green(\\\"Number of files queried\\\")}: \",\n    \"{nrow(all_cruise_info$info)} files\\n\",\n    \"{col_blue(\\\"N cruises:\\\")} {length(all_cruise_ids)}\\n\\n\"\n  )\n)\n\n\n Number of files queried: 3542 files\nN cruises: 69\n\n\nlist all cruises\nprint(all_cruise_ids)\n\n\n [1] \"WS0603\"   \"WS0612\"   \"WS0618\"   \"WS0623\"   \"WS0704\"   \"WS0718\"  \n [7] \"WS0802\"   \"WS0807\"   \"WS0901\"   \"WS0906\"   \"WS0914\"   \"WS0919\"  \n[13] \"WS0923\"   \"WS1004\"   \"WS1007\"   \"WS1015\"   \"WS1018\"   \"WS1102\"  \n[19] \"WS1106\"   \"WS1113\"   \"WS1116\"   \"WS1202\"   \"WS1207\"   \"WS1212\"  \n[25] \"WS1418\"   \"WS15103\"  \"WS15152\"  \"WS15208\"  \"WS15264\"  \"WS15320\" \n[31] \"WS16004\"  \"WS16074\"  \"WS16207\"  \"WS16263\"  \"WS16319\"  \"WS17030\" \n[37] \"WS17086\"  \"WS17170\"  \"WS17212\"  \"WS17282\"  \"WS18008\"  \"WS18120\" \n[43] \"WS18218\"  \"WS18285\"  \"WS18351\"  \"WS19028\"  \"WS19119\"  \"WS19210\" \n[49] \"WS19266\"  \"WS19322\"  \"WS20006\"  \"WS20231\"  \"WS20279\"  \"WS20342\" \n[55] \"WS21032\"  \"WS21093\"  \"WS21151\"  \"WS21212\"  \"WS21338\"  \"WS22022\" \n[61] \"WS22072\"  \"WS22141\"  \"WS22215\"  \"WS22281\"  \"WS22337\"  \"WS23010\" \n[67] \"WS23061\"  \"SAV1803\"  \"SAV18173\"\n\n\n\n\nget ready for download\ndir_data_dwnld_save &lt;- here(\"data\", \"raw\", \"ctd\")       # download path\ndir_data_avg_save   &lt;- here(\"data\", \"processed\", \"ctd\") # averaged path\n\ndir_create(dir_data_avg_save)"
  },
  {
    "objectID": "cruise_report/cruise_reports.html",
    "href": "cruise_report/cruise_reports.html",
    "title": "Cruise Reports",
    "section": "",
    "text": "SAV1803\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nSAV18173\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nWS0603\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nWS0612\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nWS0618\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nWS0623\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nWS0704\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nWS0718\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nWS0802\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nWS0807\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nWS0901\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nWS0906\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nWS0914\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nWS0919\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nWS0923\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nWS1004\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nWS1007\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nWS1015\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nWS1018\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nWS1102\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nWS1106\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nWS1113\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nWS1116\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nWS1202\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nWS1207\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nWS1212\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nWS1418\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nWS15103\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nWS15152\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nWS15208\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nWS15264\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nWS15320\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nWS16004\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nWS16074\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nWS16207\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nWS16263\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nWS16319\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nWS17030\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nWS17086\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nWS17170\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nWS17212\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nWS17282\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nWS18008\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nWS18120\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nWS18218\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nWS18285\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nWS18351\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nWS19028\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nWS19119\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nWS19210\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nWS19266\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nWS19322\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nWS20006\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nWS20231\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nWS20279\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nWS20342\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nWS21032\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nWS21093\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nWS21151\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nWS21212\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nWS21338\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nWS22022\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nWS22072\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nWS22141\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nWS22215\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nWS22281\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nWS22337\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nWS23010\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nWS23061\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nNo matching items"
  },
  {
    "objectID": "cruise_report/cruise_report_template.html",
    "href": "cruise_report/cruise_report_template.html",
    "title": "WS22072",
    "section": "",
    "text": "WS22072\n\n\nsetup\nif (!nzchar(system.file(package = \"librarian\"))) {\n  install.packages(\"librarian\")\n}\n\nlibrarian::shelf(\n  quiet = TRUE,\n  readr, here, fs, ggplot2, glue, \"jiho/castr\", dplyr, oce, patchwork, purrr, tidyr\n)\n\n\n\n  These packages will be installed:\n\n  'castr', 'oce', 'patchwork'\n\n  It may take some time.\n\n\nalso installing the dependency 'gsw'\n\n\nRunning `R CMD build`...\n\n\n\n\nCode\nsource(here(\"R/cruise_load.R\"))\ncruise_df &lt;- cruise_load(params$cruise_id)\n\n\n\n\nplot depth & pressure vs time elapsed\ntryCatch({\n  plots &lt;- list()\n  \n  for (station_name in unique(cruise_df$station)) {\n    subset_df &lt;- filter(cruise_df, station == station_name)\n    plots[[station_name]] &lt;- ggplot(subset_df, aes(x = time_elapsed)) +\n      geom_point(aes(y = depth), color = \"blue\") +  # Plot depth in blue\n      geom_line(aes(y = sea_water_pressure), color = \"red\") +  # Plot sea water pressure in red\n      ggtitle(glue(\"{station_name}\")) +\n      theme(\n        axis.title.x = element_blank(),\n        axis.title.y = element_blank(),\n        axis.text.x = element_blank(),\n        axis.text.y = element_blank(),\n        axis.ticks.x = element_blank(),\n        axis.ticks.y = element_blank()\n      )  # Remove individual axis titles and text\n  }\n  \n  # drop nulls\n  plots &lt;- purrr::compact(plots)\n  \n  # Combine all plots into a grid\n  combined_plot &lt;- wrap_plots(plots) + \n    plot_layout(ncol = 4) +  # Adjust ncol to set number of columns in the grid\n    plot_annotation(\n      title = \"Depth (blue) and Pressure (red)\",\n      subtitle = \"Each panel represents a different station\",\n      caption = \"Time Elapsed (x-axis) vs Depth & Pressure (y-axis)\"\n    ) +\n    theme(\n      plot.tag = element_text(size = 12, face = \"bold\"),\n      plot.tag.position = \"topleft\",\n      axis.title.x = element_text(margin = margin(t = 10)),\n      axis.title.y = element_text(margin = margin(r = 10))\n    )\n  \n  print(combined_plot)\n}, error = function(er){\n  print(er)\n});\n\n\n\n\n\n\n\n\n\n\n\nplot across all stations\np &lt;- ggplot(cruise_df, aes(x = time, y = depth, fill = station)) +\n  geom_col() +  # This creates the bars\n  # geom_text(aes(label = station), vjust = -0.3) +  # This adds labels to each bar, adjust vjust for position\n  labs(x = \"Time\", y = \"Depth\", title = \"Depth over Time by Station\") +  # Set labels and title\n  theme_minimal()  # Use a minimal theme\nprint(p)\n\n\n\n\n\n\n\n\n\n\n\ncreate oce.ctd objects from dataframes\nctd_load &lt;- function(data, other_params = NULL) {\n  \n  # create csv into ctd object\n  test_ctd &lt;-\n    as.ctd(\n      salinity    = data$sea_water_salinity,\n      temperature = data$sea_water_temperature,\n      pressure    = data$sea_water_pressure,\n      station     = data$station\n    )\n  \n  # add additional columns to ctd object\n  if (!is.null(other_params)) {\n    for (param_name in other_params) {\n      test_ctd &lt;-\n        oceSetData(\n          object = test_ctd,\n          name   = param_name,\n          value  = data[[param_name]]\n        )\n    }\n  }\n  print(glue(\"{data$station[1]}:\\t{length(test_ctd@data$scan)} scans\"))\n\n\n  return(test_ctd)\n}\n\n# Define other parameters to add\nother_params &lt;- c(\n  \"cruise_id\", \"station\", \"time\", \"time_elapsed\", \n  \"latitude\", \"longitude\", \"sea_water_electrical_conductivity\", \n  \"CDOM\", \"dissolved_oxygen\",\"oxygen_saturation\", \"chlorophyll_concentration\", \n  \"chlorophyll_fluorescence\", \"photosynthetically_available_radiation\", \n  \"beam_attenuation\",\"beam_transmission\", \"depth\", \"sea_water_sigma_t\",\n  \"descent_rate\", \"sound_velocity\",\"altimeter\"\n)\n\n# Split data by station and create data list\nctd_FK &lt;- cruise_df %&gt;%\n  split(.$station) %&gt;%\n  map(~ ctd_load(.x, other_params = other_params)) # ~ is a lambda(x)\n\n\n.006_5: 7772 scans\n.007:   2435 scans\n.010:   89 scans\n.012:   4880 scans\n.016:   2678 scans\n.018:   4330 scans\n.02:    2592 scans\n.03:    4489 scans\n.030:   5316 scans\n.031:   3472 scans\n.033:   2922 scans\n.041:   2540 scans\n.045:   2945 scans\n.047:   2890 scans\n.049:   21 scans\n.051:   2626 scans\n.053:   1462 scans\n.054:   263 scans\n.055:   2816 scans\n.056:   3008 scans\n.057:   3061 scans\n.057_1: 2557 scans\n.057_2: 3079 scans\n.057_3: 3090 scans\n.058:   3267 scans\n.060:   3379 scans\n.064:   75 scans\n.065:   170 scans\n.068:   3054 scans\n.09:    4631 scans\n.09_5:  9529 scans\n.21LK:  5318 scans\n.AMI1:  2649 scans\n.AMI2:  3702 scans\n.AMI3:  3783 scans\n.AMI4:  4402 scans\n.AMI5:  5974 scans\n.AMI6:  4733 scans\n.AMI7:  4527 scans\n.AMI8:  4414 scans\n.AMI9:  5509 scans\n.BG1:   2905 scans\n.BG2:   3330 scans\n.BG3:   3503 scans\n.BG4:   3822 scans\n.CAL1:  2522 scans\n.CAL2:  3038 scans\n.CAL3:  3021 scans\n.CAL4:  3058 scans\n.CAL5:  3663 scans\n.CAL6:  4525 scans\n.EK_IN: 2736 scans\n.EK_MID:    2583 scans\n.EK_OFF:    4189 scans\n.GP5:   4239 scans\n.KW1:   3043 scans\n.KW2:   3222 scans\n.KW4:   3975 scans\n.MR:    5130 scans\n.RP1:   2674 scans\n.RP2:   2992 scans\n.RP3:   3006 scans\n.RP4:   3284 scans\n.TB1:   2765 scans\n.TB10:  5235 scans\n.TB2:   3147 scans\n.TB3:   3714 scans\n.TB4:   3818 scans\n.TB5:   4079 scans\n.V1:    2773 scans\n.V2:    3260 scans\n.V3:    3631 scans\n.V4:    3965 scans\n.V5:    4663 scans\n.V6:    4003 scans\n.V7:    4883 scans\n.V8:    6137 scans\n.V9:    4846 scans\n.WS:    4022 scans\n\n\n\n\nplotting scans for each cast in the first list\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # 1 is selecting only the first sublist\n  # print(i)\n  print(glue(\"=== station: {cast@metadata$station[1]}\"))\n  print(glue(\"# scans: {length(cast@data$scan)}\"))\n  plotScan(cast)\n}\n\n\n=== station: .006_5\n# scans: 7772\n\n\n\n\n\n\n\n\n\n=== station: .007\n# scans: 2435\n\n\n\n\n\n\n\n\n\n=== station: .010\n# scans: 89\n\n\n\n\n\n\n\n\n\n=== station: .012\n# scans: 4880\n\n\n\n\n\n\n\n\n\n=== station: .016\n# scans: 2678\n\n\n\n\n\n\n\n\n\n=== station: .018\n# scans: 4330\n\n\n\n\n\n\n\n\n\n=== station: .02\n# scans: 2592\n\n\n\n\n\n\n\n\n\n=== station: .03\n# scans: 4489\n\n\n\n\n\n\n\n\n\n=== station: .030\n# scans: 5316\n\n\n\n\n\n\n\n\n\n=== station: .031\n# scans: 3472\n\n\n\n\n\n\n\n\n\n=== station: .033\n# scans: 2922\n\n\n\n\n\n\n\n\n\n=== station: .041\n# scans: 2540\n\n\n\n\n\n\n\n\n\n=== station: .045\n# scans: 2945\n\n\n\n\n\n\n\n\n\n=== station: .047\n# scans: 2890\n\n\n\n\n\n\n\n\n\n=== station: .049\n# scans: 21\n\n\n\n\n\n\n\n\n\n=== station: .051\n# scans: 2626\n\n\n\n\n\n\n\n\n\n=== station: .053\n# scans: 1462\n\n\n\n\n\n\n\n\n\n=== station: .054\n# scans: 263\n\n\n\n\n\n\n\n\n\n=== station: .055\n# scans: 2816\n\n\n\n\n\n\n\n\n\n=== station: .056\n# scans: 3008\n\n\n\n\n\n\n\n\n\n=== station: .057\n# scans: 3061\n\n\n\n\n\n\n\n\n\n=== station: .057_1\n# scans: 2557\n\n\n\n\n\n\n\n\n\n=== station: .057_2\n# scans: 3079\n\n\n\n\n\n\n\n\n\n=== station: .057_3\n# scans: 3090\n\n\n\n\n\n\n\n\n\n=== station: .058\n# scans: 3267\n\n\n\n\n\n\n\n\n\n=== station: .060\n# scans: 3379\n\n\n\n\n\n\n\n\n\n=== station: .064\n# scans: 75\n\n\n\n\n\n\n\n\n\n=== station: .065\n# scans: 170\n\n\n\n\n\n\n\n\n\n=== station: .068\n# scans: 3054\n\n\n\n\n\n\n\n\n\n=== station: .09\n# scans: 4631\n\n\n\n\n\n\n\n\n\n=== station: .09_5\n# scans: 9529\n\n\n\n\n\n\n\n\n\n=== station: .21LK\n# scans: 5318\n\n\n\n\n\n\n\n\n\n=== station: .AMI1\n# scans: 2649\n\n\n\n\n\n\n\n\n\n=== station: .AMI2\n# scans: 3702\n\n\n\n\n\n\n\n\n\n=== station: .AMI3\n# scans: 3783\n\n\n\n\n\n\n\n\n\n=== station: .AMI4\n# scans: 4402\n\n\n\n\n\n\n\n\n\n=== station: .AMI5\n# scans: 5974\n\n\n\n\n\n\n\n\n\n=== station: .AMI6\n# scans: 4733\n\n\n\n\n\n\n\n\n\n=== station: .AMI7\n# scans: 4527\n\n\n\n\n\n\n\n\n\n=== station: .AMI8\n# scans: 4414\n\n\n\n\n\n\n\n\n\n=== station: .AMI9\n# scans: 5509\n\n\n\n\n\n\n\n\n\n=== station: .BG1\n# scans: 2905\n\n\n\n\n\n\n\n\n\n=== station: .BG2\n# scans: 3330\n\n\n\n\n\n\n\n\n\n=== station: .BG3\n# scans: 3503\n\n\n\n\n\n\n\n\n\n=== station: .BG4\n# scans: 3822\n\n\n\n\n\n\n\n\n\n=== station: .CAL1\n# scans: 2522\n\n\n\n\n\n\n\n\n\n=== station: .CAL2\n# scans: 3038\n\n\n\n\n\n\n\n\n\n=== station: .CAL3\n# scans: 3021\n\n\n\n\n\n\n\n\n\n=== station: .CAL4\n# scans: 3058\n\n\n\n\n\n\n\n\n\n=== station: .CAL5\n# scans: 3663\n\n\n\n\n\n\n\n\n\n=== station: .CAL6\n# scans: 4525\n\n\n\n\n\n\n\n\n\n=== station: .EK_IN\n# scans: 2736\n\n\n\n\n\n\n\n\n\n=== station: .EK_MID\n# scans: 2583\n\n\n\n\n\n\n\n\n\n=== station: .EK_OFF\n# scans: 4189\n\n\n\n\n\n\n\n\n\n=== station: .GP5\n# scans: 4239\n\n\n\n\n\n\n\n\n\n=== station: .KW1\n# scans: 3043\n\n\n\n\n\n\n\n\n\n=== station: .KW2\n# scans: 3222\n\n\n\n\n\n\n\n\n\n=== station: .KW4\n# scans: 3975\n\n\n\n\n\n\n\n\n\n=== station: .MR\n# scans: 5130\n\n\n\n\n\n\n\n\n\n=== station: .RP1\n# scans: 2674\n\n\n\n\n\n\n\n\n\n=== station: .RP2\n# scans: 2992\n\n\n\n\n\n\n\n\n\n=== station: .RP3\n# scans: 3006\n\n\n\n\n\n\n\n\n\n=== station: .RP4\n# scans: 3284\n\n\n\n\n\n\n\n\n\n=== station: .TB1\n# scans: 2765\n\n\n\n\n\n\n\n\n\n=== station: .TB10\n# scans: 5235\n\n\n\n\n\n\n\n\n\n=== station: .TB2\n# scans: 3147\n\n\n\n\n\n\n\n\n\n=== station: .TB3\n# scans: 3714\n\n\n\n\n\n\n\n\n\n=== station: .TB4\n# scans: 3818\n\n\n\n\n\n\n\n\n\n=== station: .TB5\n# scans: 4079\n\n\n\n\n\n\n\n\n\n=== station: .V1\n# scans: 2773\n\n\n\n\n\n\n\n\n\n=== station: .V2\n# scans: 3260\n\n\n\n\n\n\n\n\n\n=== station: .V3\n# scans: 3631\n\n\n\n\n\n\n\n\n\n=== station: .V4\n# scans: 3965\n\n\n\n\n\n\n\n\n\n=== station: .V5\n# scans: 4663\n\n\n\n\n\n\n\n\n\n=== station: .V6\n# scans: 4003\n\n\n\n\n\n\n\n\n\n=== station: .V7\n# scans: 4883\n\n\n\n\n\n\n\n\n\n=== station: .V8\n# scans: 6137\n\n\n\n\n\n\n\n\n\n=== station: .V9\n# scans: 4846\n\n\n\n\n\n\n\n\n\n=== station: .WS\n# scans: 4022\n\n\n\n\n\n\n\n\n\n\n\nplotting each cast in the first list\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # 1 is selecting only the first sublist\n  tryCatch({\n    plot(ctdDecimate(ctdTrim(cast)))\n  }, error = function(e){\n    print(e)\n  })\n}\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 7772' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2435' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 89' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4880' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2678' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4330' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2592' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4489' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 5316' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3472' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2922' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2540' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2945' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2890' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2626' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1462' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2816' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3008' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3061' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2557' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3079' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3090' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3267' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3379' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3054' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4631' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 9529' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 5318' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2649' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3702' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3783' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4402' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 5974' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4733' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4527' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4414' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 5509' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2905' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3330' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3503' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3822' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2522' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3038' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3021' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3058' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3663' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4525' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2736' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2583' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4189' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4239' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3043' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3222' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3975' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 5130' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2674' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2992' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3006' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3284' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2765' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 5235' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3147' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3714' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3818' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4079' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2773' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3260' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3631' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3965' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4663' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4003' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4883' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 6137' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4846' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4022' in coercion to 'logical(1)'&gt;\n\n\n\n\nplotting other physical parameters for each cast\n# Loop through each CTD cast\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # Assuming each sublist contains only one relevant CTD object\n  tryCatch({\n    # Extract metadata for station name and cruise ID\n    station_name &lt;- cast@metadata$station[1]\n    cruise_id &lt;- cast@data$cruise_id[1]\n\n    # Generate a title with station name and cruise ID\n    overall_title &lt;- glue::glue(\"Station: {station_name}, Cruise ID: {cruise_id}\")\n\n    # Set margins: increase the outer margin for the title\n    par(oma = c(0, 0, 3, 0))  # Top outer margin increased for title\n\n    # Plotting function with specific parameters\n    oce::plot(\n      x = ctdDecimate(ctdTrim(cast)),\n      which = c(\n        \"sea_water_electrical_conductivity\",\n        \"descent_rate\", \"sound_velocity\",\n        \"sea_water_sigma_t\",\"altimeter\"\n      ),\n      main = \"\"  # No main title for individual subplots\n    )\n\n    # Place a single overall title at the top of the plot frame\n    mtext(overall_title, side = 3, line = 1, outer = TRUE, cex = 1.5)\n\n    # Reset outer margins to default\n    par(oma = c(0, 0, 0, 0))\n\n  }, error = function(e) {\n    print(e$message)  # Print any errors that occur during plotting\n  })\n}\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n\n\nplotting other nutrient parameters for each cast\n# Loop through each CTD cast\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # Assuming each sublist contains only one relevant CTD object\n  tryCatch({\n    # Extract metadata for station name and cruise ID\n    station_name &lt;- cast@metadata$station[1]\n    cruise_id &lt;- cast@data$cruise_id[1]\n\n    # Generate a title with station name and cruise ID\n    overall_title &lt;- glue::glue(\"Station: {station_name}, Cruise ID: {cruise_id}\")\n\n    # Set margins: increase the outer margin for the title\n    par(oma = c(0, 0, 3, 0))  # Top outer margin increased for title\n\n    # Plotting function with specific parameters\n    oce::plot(\n      x = ctdDecimate(ctdTrim(cast)),\n      which = c(\n        \"CDOM\", \"dissolved_oxygen\",\n        \"oxygen_saturation\",\n        \"chlorophyll_concentration\", \"chlorophyll_fluorescence\"\n      ),\n      main = \"\"  # No main title for individual subplots\n    )\n\n    # Place a single overall title at the top of the plot frame\n    mtext(overall_title, side = 3, line = 1, outer = TRUE, cex = 1.5)\n\n    # Reset outer margins to default\n    par(oma = c(0, 0, 0, 0))\n\n  }, error = function(e) {\n    print(e$message)  # Print any errors that occur during plotting\n  })\n}\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n\n\nplotting other optical parameters for each cast\n# Loop through each CTD cast\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # Assuming each sublist contains only one relevant CTD object\n  tryCatch({\n    # Extract metadata for station name and cruise ID\n    station_name &lt;- cast@metadata$station[1]\n    cruise_id &lt;- cast@data$cruise_id[1]\n\n    # Generate a title with station name and cruise ID\n    overall_title &lt;- glue::glue(\"Station: {station_name}, Cruise ID: {cruise_id}\")\n\n    # Set margins: increase the outer margin for the title\n    par(oma = c(0, 0, 3, 0))  # Top outer margin increased for title\n\n    # Plotting function with specific parameters\n    oce::plot(\n      x = ctdDecimate(ctdTrim(cast)),\n      which = c(\n        \"photosynthetically_available_radiation\",\n        \"beam_attenuation\",\"beam_transmission\"\n      ),\n      main = \"\"  # No main title for individual subplots\n    )\n\n    # Place a single overall title at the top of the plot frame\n    mtext(overall_title, side = 3, line = 1, outer = TRUE, cex = 1.5)\n\n    # Reset outer margins to default\n    par(oma = c(0, 0, 0, 0))\n\n  }, error = function(e) {\n    print(e$message)  # Print any errors that occur during plotting\n  })\n}\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n\n\nloop through every cast, clean, & save\ncombined_df &lt;- data.frame()\nfor (i in seq(ctd_FK)){\n  tryCatch({\n    cast &lt;- ctd_FK[[i]]  # 1 is selecting only the first sublist\n    \n    # print(class(cast))\n    # clean cast \n    trimmed_cast &lt;- ctdTrim(cast)\n    decimated_cast &lt;- ctdDecimate(trimmed_cast, p = 0.5)  # binned to 0.5 m\n    \n    # convert to df\n    cast_df &lt;- as.data.frame(decimated_cast@data)\n    \n    # Add metadata\n    # assumes station ID and cruise ID the same for all & just uses 1st one\n    cast_df &lt;- mutate(\n      cast_df,\n      station = cast@data$station[1],\n      cruise_id = cast@data$cruise_id[1]\n    )\n  \n    # drop NA rows left by cleaning\n    cast_df &lt;- subset(cast_df, !is.na(scan))\n    \n    # Append the data to the combined dataframe\n    combined_df &lt;- rbind(combined_df, cast_df)\n  }, error = function(e){\n    print(glue(\"error in cast {cast@metadata$station[1]}\"))\n    print(e)\n  })\n}\n# Save to CSV\nfile_path &lt;- here(glue(\"data/cleaned/{cruise_id}.csv\"))\nwrite.csv(combined_df, file_path, row.names = FALSE)"
  },
  {
    "objectID": "cruise_report/cruise_reports/SAV18173.html",
    "href": "cruise_report/cruise_reports/SAV18173.html",
    "title": "SAV18173",
    "section": "",
    "text": "SAV18173\n\n\nsetup\nif (!nzchar(system.file(package = \"librarian\"))) {\n  install.packages(\"librarian\")\n}\n\nlibrarian::shelf(\n  quiet = TRUE,\n  readr, here, fs, ggplot2, glue, \"jiho/castr\", dplyr, oce, patchwork, purrr, tidyr\n)\n\n\n\n\nCode\nsource(here(\"R/cruise_load.R\"))\ncruise_df &lt;- cruise_load(params$cruise_id)\n\n\n\n\nplot depth & pressure vs time elapsed\ntryCatch({\n  plots &lt;- list()\n  \n  for (station_name in unique(cruise_df$station)) {\n    subset_df &lt;- filter(cruise_df, station == station_name)\n    plots[[station_name]] &lt;- ggplot(subset_df, aes(x = time_elapsed)) +\n      geom_point(aes(y = depth), color = \"blue\") +  # Plot depth in blue\n      geom_line(aes(y = sea_water_pressure), color = \"red\") +  # Plot sea water pressure in red\n      ggtitle(glue(\"{station_name}\")) +\n      theme(\n        axis.title.x = element_blank(),\n        axis.title.y = element_blank(),\n        axis.text.x = element_blank(),\n        axis.text.y = element_blank(),\n        axis.ticks.x = element_blank(),\n        axis.ticks.y = element_blank()\n      )  # Remove individual axis titles and text\n  }\n  \n  # drop nulls\n  plots &lt;- purrr::compact(plots)\n  \n  # Combine all plots into a grid\n  combined_plot &lt;- wrap_plots(plots) + \n    plot_layout(ncol = 4) +  # Adjust ncol to set number of columns in the grid\n    plot_annotation(\n      title = \"Depth (blue) and Pressure (red)\",\n      subtitle = \"Each panel represents a different station\",\n      caption = \"Time Elapsed (x-axis) vs Depth & Pressure (y-axis)\"\n    ) +\n    theme(\n      plot.tag = element_text(size = 12, face = \"bold\"),\n      plot.tag.position = \"topleft\",\n      axis.title.x = element_text(margin = margin(t = 10)),\n      axis.title.y = element_text(margin = margin(r = 10))\n    )\n  \n  print(combined_plot)\n}, error = function(er){\n  print(er)\n});\n\n\n\n\n\n\n\n\n\n\n\nplot across all stations\np &lt;- ggplot(cruise_df, aes(x = time, y = depth, fill = station)) +\n  geom_col() +  # This creates the bars\n  # geom_text(aes(label = station), vjust = -0.3) +  # This adds labels to each bar, adjust vjust for position\n  labs(x = \"Time\", y = \"Depth\", title = \"Depth over Time by Station\") +  # Set labels and title\n  theme_minimal()  # Use a minimal theme\nprint(p)\n\n\n\n\n\n\n\n\n\n\n\ncreate oce.ctd objects from dataframes\nctd_load &lt;- function(data, other_params = NULL) {\n  \n  # create csv into ctd object\n  test_ctd &lt;-\n    as.ctd(\n      salinity    = data$sea_water_salinity,\n      temperature = data$sea_water_temperature,\n      pressure    = data$sea_water_pressure,\n      station     = data$station\n    )\n  \n  # add additional columns to ctd object\n  if (!is.null(other_params)) {\n    for (param_name in other_params) {\n      test_ctd &lt;-\n        oceSetData(\n          object = test_ctd,\n          name   = param_name,\n          value  = data[[param_name]]\n        )\n    }\n  }\n  print(glue(\"{data$station[1]}:\\t{length(test_ctd@data$scan)} scans\"))\n\n\n  return(test_ctd)\n}\n\n# Define other parameters to add\nother_params &lt;- c(\n  \"cruise_id\", \"station\", \"time\", \"time_elapsed\", \n  \"latitude\", \"longitude\", \"sea_water_electrical_conductivity\", \n  \"CDOM\", \"dissolved_oxygen\",\"oxygen_saturation\", \"chlorophyll_concentration\", \n  \"chlorophyll_fluorescence\", \"photosynthetically_available_radiation\", \n  \"beam_attenuation\",\"beam_transmission\", \"depth\", \"sea_water_sigma_t\",\n  \"descent_rate\", \"sound_velocity\",\"altimeter\"\n)\n\n# Split data by station and create data list\nctd_FK &lt;- cruise_df %&gt;%\n  split(.$station) %&gt;%\n  map(~ ctd_load(.x, other_params = other_params)) # ~ is a lambda(x)\n\n\n02: 3761 scans\n07: 154 scans\n09: 4899 scans\n10: 1942 scans\n12: 3517 scans\n16: 1830 scans\n18: 3016 scans\n21.LK:  3019 scans\n30: 3668 scans\n31: 3836 scans\n33: 3375 scans\n41: 2123 scans\n45: 2086 scans\n49: 743 scans\n51: 2741 scans\n54: 5793 scans\n55: 492 scans\n56: 1351 scans\n57: 4208 scans\n57.1:   1904 scans\n57.2:   2661 scans\n57.3:   4044 scans\n58: 3194 scans\n59: 3083 scans\n60: 2333 scans\n62: 2310 scans\n64: 198 scans\n65: 636 scans\n68: 2496 scans\n9.5:    11806 scans\nMR: 1453 scans\nMR.REDO:    2342 scans\nWS: 2836 scans\n\n\n\n\nplotting scans for each cast in the first list\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # 1 is selecting only the first sublist\n  # print(i)\n  print(glue(\"=== station: {cast@metadata$station[1]}\"))\n  print(glue(\"# scans: {length(cast@data$scan)}\"))\n  plotScan(cast)\n}\n\n\n=== station: 02\n# scans: 3761\n\n\n\n\n\n\n\n\n\n=== station: 07\n# scans: 154\n\n\n\n\n\n\n\n\n\n=== station: 09\n# scans: 4899\n\n\n\n\n\n\n\n\n\n=== station: 10\n# scans: 1942\n\n\n\n\n\n\n\n\n\n=== station: 12\n# scans: 3517\n\n\n\n\n\n\n\n\n\n=== station: 16\n# scans: 1830\n\n\n\n\n\n\n\n\n\n=== station: 18\n# scans: 3016\n\n\n\n\n\n\n\n\n\n=== station: 21.LK\n# scans: 3019\n\n\n\n\n\n\n\n\n\n=== station: 30\n# scans: 3668\n\n\n\n\n\n\n\n\n\n=== station: 31\n# scans: 3836\n\n\n\n\n\n\n\n\n\n=== station: 33\n# scans: 3375\n\n\n\n\n\n\n\n\n\n=== station: 41\n# scans: 2123\n\n\n\n\n\n\n\n\n\n=== station: 45\n# scans: 2086\n\n\n\n\n\n\n\n\n\n=== station: 49\n# scans: 743\n\n\n\n\n\n\n\n\n\n=== station: 51\n# scans: 2741\n\n\n\n\n\n\n\n\n\n=== station: 54\n# scans: 5793\n\n\n\n\n\n\n\n\n\n=== station: 55\n# scans: 492\n\n\n\n\n\n\n\n\n\n=== station: 56\n# scans: 1351\n\n\n\n\n\n\n\n\n\n=== station: 57\n# scans: 4208\n\n\n\n\n\n\n\n\n\n=== station: 57.1\n# scans: 1904\n\n\n\n\n\n\n\n\n\n=== station: 57.2\n# scans: 2661\n\n\n\n\n\n\n\n\n\n=== station: 57.3\n# scans: 4044\n\n\n\n\n\n\n\n\n\n=== station: 58\n# scans: 3194\n\n\n\n\n\n\n\n\n\n=== station: 59\n# scans: 3083\n\n\n\n\n\n\n\n\n\n=== station: 60\n# scans: 2333\n\n\n\n\n\n\n\n\n\n=== station: 62\n# scans: 2310\n\n\n\n\n\n\n\n\n\n=== station: 64\n# scans: 198\n\n\n\n\n\n\n\n\n\n=== station: 65\n# scans: 636\n\n\n\n\n\n\n\n\n\n=== station: 68\n# scans: 2496\n\n\n\n\n\n\n\n\n\n=== station: 9.5\n# scans: 11806\n\n\n\n\n\n\n\n\n\n=== station: MR\n# scans: 1453\n\n\n\n\n\n\n\n\n\n=== station: MR.REDO\n# scans: 2342\n\n\n\n\n\n\n\n\n\n=== station: WS\n# scans: 2836\n\n\n\n\n\n\n\n\n\n\n\nplotting each cast in the first list\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # 1 is selecting only the first sublist\n  tryCatch({\n    plot(ctdDecimate(ctdTrim(cast)))\n  }, error = function(e){\n    print(e)\n  })\n}\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3761' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4899' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1942' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3517' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1830' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3016' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3019' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3668' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3836' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3375' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2123' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2086' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 743' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2741' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 5793' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 492' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1351' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4208' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1904' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2661' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4044' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3194' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3083' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2333' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2310' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 198' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 636' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2496' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 11806' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1453' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2342' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2836' in coercion to 'logical(1)'&gt;\n\n\n\n\nplotting other physical parameters for each cast\n# Loop through each CTD cast\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # Assuming each sublist contains only one relevant CTD object\n  tryCatch({\n    # Extract metadata for station name and cruise ID\n    station_name &lt;- cast@metadata$station[1]\n    cruise_id &lt;- cast@data$cruise_id[1]\n\n    # Generate a title with station name and cruise ID\n    overall_title &lt;- glue::glue(\"Station: {station_name}, Cruise ID: {cruise_id}\")\n\n    # Set margins: increase the outer margin for the title\n    par(oma = c(0, 0, 3, 0))  # Top outer margin increased for title\n\n    # Plotting function with specific parameters\n    oce::plot(\n      x = ctdDecimate(ctdTrim(cast)),\n      which = c(\n        \"sea_water_electrical_conductivity\",\n        \"descent_rate\", \"sound_velocity\",\n        \"sea_water_sigma_t\",\"altimeter\"\n      ),\n      main = \"\"  # No main title for individual subplots\n    )\n\n    # Place a single overall title at the top of the plot frame\n    mtext(overall_title, side = 3, line = 1, outer = TRUE, cex = 1.5)\n\n    # Reset outer margins to default\n    par(oma = c(0, 0, 0, 0))\n\n  }, error = function(e) {\n    print(e$message)  # Print any errors that occur during plotting\n  })\n}\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"sea_water_electrical_conductivitydescent_ratesound_velocitysea_water_sigma_taltimeter\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"sea_water_electrical_conductivitydescent_ratesound_velocitysea_water_sigma_taltimeter\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"sea_water_electrical_conductivitydescent_ratesound_velocitysea_water_sigma_taltimeter\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"sea_water_electrical_conductivitydescent_ratesound_velocitysea_water_sigma_taltimeter\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"sea_water_electrical_conductivitydescent_ratesound_velocitysea_water_sigma_taltimeter\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"sea_water_electrical_conductivitydescent_ratesound_velocitysea_water_sigma_taltimeter\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"sea_water_electrical_conductivitydescent_ratesound_velocitysea_water_sigma_taltimeter\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"sea_water_electrical_conductivitydescent_ratesound_velocitysea_water_sigma_taltimeter\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"sea_water_electrical_conductivitydescent_ratesound_velocitysea_water_sigma_taltimeter\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"sea_water_electrical_conductivitydescent_ratesound_velocitysea_water_sigma_taltimeter\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"sea_water_electrical_conductivitydescent_ratesound_velocitysea_water_sigma_taltimeter\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"sea_water_electrical_conductivitydescent_ratesound_velocitysea_water_sigma_taltimeter\\\" cannot be handled\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"sea_water_electrical_conductivitydescent_ratesound_velocitysea_water_sigma_taltimeter\\\" cannot be handled\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"sea_water_electrical_conductivitydescent_ratesound_velocitysea_water_sigma_taltimeter\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"sea_water_electrical_conductivitydescent_ratesound_velocitysea_water_sigma_taltimeter\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"sea_water_electrical_conductivitydescent_ratesound_velocitysea_water_sigma_taltimeter\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"sea_water_electrical_conductivitydescent_ratesound_velocitysea_water_sigma_taltimeter\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"sea_water_electrical_conductivitydescent_ratesound_velocitysea_water_sigma_taltimeter\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"sea_water_electrical_conductivitydescent_ratesound_velocitysea_water_sigma_taltimeter\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"sea_water_electrical_conductivitydescent_ratesound_velocitysea_water_sigma_taltimeter\\\" cannot be handled\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"sea_water_electrical_conductivitydescent_ratesound_velocitysea_water_sigma_taltimeter\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"sea_water_electrical_conductivitydescent_ratesound_velocitysea_water_sigma_taltimeter\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"sea_water_electrical_conductivitydescent_ratesound_velocitysea_water_sigma_taltimeter\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"sea_water_electrical_conductivitydescent_ratesound_velocitysea_water_sigma_taltimeter\\\" cannot be handled\"\n\n\n\n\nplotting other nutrient parameters for each cast\n# Loop through each CTD cast\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # Assuming each sublist contains only one relevant CTD object\n  tryCatch({\n    # Extract metadata for station name and cruise ID\n    station_name &lt;- cast@metadata$station[1]\n    cruise_id &lt;- cast@data$cruise_id[1]\n\n    # Generate a title with station name and cruise ID\n    overall_title &lt;- glue::glue(\"Station: {station_name}, Cruise ID: {cruise_id}\")\n\n    # Set margins: increase the outer margin for the title\n    par(oma = c(0, 0, 3, 0))  # Top outer margin increased for title\n\n    # Plotting function with specific parameters\n    oce::plot(\n      x = ctdDecimate(ctdTrim(cast)),\n      which = c(\n        \"CDOM\", \"dissolved_oxygen\",\n        \"oxygen_saturation\",\n        \"chlorophyll_concentration\", \"chlorophyll_fluorescence\"\n      ),\n      main = \"\"  # No main title for individual subplots\n    )\n\n    # Place a single overall title at the top of the plot frame\n    mtext(overall_title, side = 3, line = 1, outer = TRUE, cex = 1.5)\n\n    # Reset outer margins to default\n    par(oma = c(0, 0, 0, 0))\n\n  }, error = function(e) {\n    print(e$message)  # Print any errors that occur during plotting\n  })\n}\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n\n\n\n\nplotting other optical parameters for each cast\n# Loop through each CTD cast\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # Assuming each sublist contains only one relevant CTD object\n  tryCatch({\n    # Extract metadata for station name and cruise ID\n    station_name &lt;- cast@metadata$station[1]\n    cruise_id &lt;- cast@data$cruise_id[1]\n\n    # Generate a title with station name and cruise ID\n    overall_title &lt;- glue::glue(\"Station: {station_name}, Cruise ID: {cruise_id}\")\n\n    # Set margins: increase the outer margin for the title\n    par(oma = c(0, 0, 3, 0))  # Top outer margin increased for title\n\n    # Plotting function with specific parameters\n    oce::plot(\n      x = ctdDecimate(ctdTrim(cast)),\n      which = c(\n        \"photosynthetically_available_radiation\",\n        \"beam_attenuation\",\"beam_transmission\"\n      ),\n      main = \"\"  # No main title for individual subplots\n    )\n\n    # Place a single overall title at the top of the plot frame\n    mtext(overall_title, side = 3, line = 1, outer = TRUE, cex = 1.5)\n\n    # Reset outer margins to default\n    par(oma = c(0, 0, 0, 0))\n\n  }, error = function(e) {\n    print(e$message)  # Print any errors that occur during plotting\n  })\n}\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n\n\nloop through every cast, clean, & save\ncombined_df &lt;- data.frame()\nfor (i in seq(ctd_FK)){\n  tryCatch({\n    cast &lt;- ctd_FK[[i]]  # 1 is selecting only the first sublist\n    \n    # print(class(cast))\n    # clean cast \n    trimmed_cast &lt;- ctdTrim(cast)\n    decimated_cast &lt;- ctdDecimate(trimmed_cast, p = 0.5)  # binned to 0.5 m\n    \n    # convert to df\n    cast_df &lt;- as.data.frame(decimated_cast@data)\n    \n    # Add metadata\n    # assumes station ID and cruise ID the same for all & just uses 1st one\n    cast_df &lt;- mutate(\n      cast_df,\n      station = cast@data$station[1],\n      cruise_id = cast@data$cruise_id[1]\n    )\n  \n    # drop NA rows left by cleaning\n    cast_df &lt;- subset(cast_df, !is.na(scan))\n    \n    # Append the data to the combined dataframe\n    combined_df &lt;- rbind(combined_df, cast_df)\n  }, error = function(e){\n    print(glue(\"error in cast {cast@metadata$station[1]}\"))\n    print(e)\n  })\n}\n# Save to CSV\nfile_path &lt;- here(glue(\"data/cleaned/{cruise_id}.csv\"))\nwrite.csv(combined_df, file_path, row.names = FALSE)"
  },
  {
    "objectID": "cruise_report/cruise_reports/WS0612.html",
    "href": "cruise_report/cruise_reports/WS0612.html",
    "title": "WS0612",
    "section": "",
    "text": "WS0612\n\n\nsetup\nif (!nzchar(system.file(package = \"librarian\"))) {\n  install.packages(\"librarian\")\n}\n\nlibrarian::shelf(\n  quiet = TRUE,\n  readr, here, fs, ggplot2, glue, \"jiho/castr\", dplyr, oce, patchwork, purrr, tidyr\n)\n\n\n\n\nCode\nsource(here(\"R/cruise_load.R\"))\ncruise_df &lt;- cruise_load(params$cruise_id)\n\n\n\n\nplot depth & pressure vs time elapsed\ntryCatch({\n  plots &lt;- list()\n  \n  for (station_name in unique(cruise_df$station)) {\n    subset_df &lt;- filter(cruise_df, station == station_name)\n    plots[[station_name]] &lt;- ggplot(subset_df, aes(x = time_elapsed)) +\n      geom_point(aes(y = depth), color = \"blue\") +  # Plot depth in blue\n      geom_line(aes(y = sea_water_pressure), color = \"red\") +  # Plot sea water pressure in red\n      ggtitle(glue(\"{station_name}\")) +\n      theme(\n        axis.title.x = element_blank(),\n        axis.title.y = element_blank(),\n        axis.text.x = element_blank(),\n        axis.text.y = element_blank(),\n        axis.ticks.x = element_blank(),\n        axis.ticks.y = element_blank()\n      )  # Remove individual axis titles and text\n  }\n  \n  # drop nulls\n  plots &lt;- purrr::compact(plots)\n  \n  # Combine all plots into a grid\n  combined_plot &lt;- wrap_plots(plots) + \n    plot_layout(ncol = 4) +  # Adjust ncol to set number of columns in the grid\n    plot_annotation(\n      title = \"Depth (blue) and Pressure (red)\",\n      subtitle = \"Each panel represents a different station\",\n      caption = \"Time Elapsed (x-axis) vs Depth & Pressure (y-axis)\"\n    ) +\n    theme(\n      plot.tag = element_text(size = 12, face = \"bold\"),\n      plot.tag.position = \"topleft\",\n      axis.title.x = element_text(margin = margin(t = 10)),\n      axis.title.y = element_text(margin = margin(r = 10))\n    )\n  \n  print(combined_plot)\n}, error = function(er){\n  print(er)\n});\n\n\nWarning: Removed 1 row containing missing values or values outside the scale range\n(`geom_point()`).\n\n\n\n\n\n\n\n\n\n\n\nplot across all stations\np &lt;- ggplot(cruise_df, aes(x = time, y = depth, fill = station)) +\n  geom_col() +  # This creates the bars\n  # geom_text(aes(label = station), vjust = -0.3) +  # This adds labels to each bar, adjust vjust for position\n  labs(x = \"Time\", y = \"Depth\", title = \"Depth over Time by Station\") +  # Set labels and title\n  theme_minimal()  # Use a minimal theme\nprint(p)\n\n\nWarning: Removed 1 row containing missing values or values outside the scale range\n(`geom_col()`).\n\n\n\n\n\n\n\n\n\n\n\ncreate oce.ctd objects from dataframes\nctd_load &lt;- function(data, other_params = NULL) {\n  \n  # create csv into ctd object\n  test_ctd &lt;-\n    as.ctd(\n      salinity    = data$sea_water_salinity,\n      temperature = data$sea_water_temperature,\n      pressure    = data$sea_water_pressure,\n      station     = data$station\n    )\n  \n  # add additional columns to ctd object\n  if (!is.null(other_params)) {\n    for (param_name in other_params) {\n      test_ctd &lt;-\n        oceSetData(\n          object = test_ctd,\n          name   = param_name,\n          value  = data[[param_name]]\n        )\n    }\n  }\n  print(glue(\"{data$station[1]}:\\t{length(test_ctd@data$scan)} scans\"))\n\n\n  return(test_ctd)\n}\n\n# Define other parameters to add\nother_params &lt;- c(\n  \"cruise_id\", \"station\", \"time\", \"time_elapsed\", \n  \"latitude\", \"longitude\", \"sea_water_electrical_conductivity\", \n  \"CDOM\", \"dissolved_oxygen\",\"oxygen_saturation\", \"chlorophyll_concentration\", \n  \"chlorophyll_fluorescence\", \"photosynthetically_available_radiation\", \n  \"beam_attenuation\",\"beam_transmission\", \"depth\", \"sea_water_sigma_t\",\n  \"descent_rate\", \"sound_velocity\",\"altimeter\"\n)\n\n# Split data by station and create data list\nctd_FK &lt;- cruise_df %&gt;%\n  split(.$station) %&gt;%\n  map(~ ctd_load(.x, other_params = other_params)) # ~ is a lambda(x)\n\n\n1:  2163 scans\n10: 2343 scans\n11: 2428 scans\n12: 2949 scans\n13: 2431 scans\n14: 2227 scans\n15: 3413 scans\n15.5:   8025 scans\n16: 1565 scans\n17: 2178 scans\n18: 2990 scans\n19: 1720 scans\n2:  1723 scans\n20: 2174 scans\n21: 2952 scans\n21.5:   8665 scans\n22: 3052 scans\n22.5:   7534 scans\n23: 1885 scans\n24: 2222 scans\n25: 4505 scans\n25.5:   13944 scans\n26: 1902 scans\n27: 2479 scans\n28: 2904 scans\n28.5:   3383 scans\n29: 3671 scans\n29.5:   3787 scans\n3:  4536 scans\n30: 3288 scans\n30.5:   2764 scans\n31: 2428 scans\n32: 1713 scans\n33: 2750 scans\n34: 1677 scans\n39: 2079 scans\n4:  1324 scans\n40: 2081 scans\n41: 2931 scans\n42: 638 scans\n45: 2443 scans\n46: 2665 scans\n47: 2516 scans\n48: 1949 scans\n49: 1632 scans\n5:  1867 scans\n5.5:    1860 scans\n50: 2314 scans\n51: 1563 scans\n52: 2683 scans\n53: 29 scans\n54: 1257 scans\n55: 1122 scans\n56: 1906 scans\n57: 2307 scans\n6:  2189 scans\n6.5:    7225 scans\n60: 1629 scans\n61: 1538 scans\n62: 1782 scans\n63: 1887 scans\n64: 875 scans\n65: 1460 scans\n66: 1556 scans\n67: 1801 scans\n68: 1843 scans\n69: 1675 scans\n7:  1776 scans\n70: 2274 scans\n71: 2083 scans\n8:  2272 scans\n9:  3483 scans\n9.5:    7644 scans\nCAL1:   2611 scans\nCAL2:   1364 scans\nCAL3:   2714 scans\nCAL4:   2748 scans\nCAL5:   3267 scans\nCH1:    2871 scans\nCH2:    2856 scans\nCH3:    2543 scans\nCH4:    3251 scans\nCH5:    4048 scans\nDT01:   3024 scans\nDT02:   2604 scans\nDT03:   4488 scans\nDT04:   5008 scans\nDT05:   4623 scans\nDT06:   8535 scans\nDT07:   19828 scans\nDT08:   9116 scans\nDT09:   4978 scans\nDT10:   2648 scans\nDT11:   2443 scans\nDTXX:   522 scans\n\n\n\n\nplotting scans for each cast in the first list\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # 1 is selecting only the first sublist\n  # print(i)\n  print(glue(\"=== station: {cast@metadata$station[1]}\"))\n  print(glue(\"# scans: {length(cast@data$scan)}\"))\n  plotScan(cast)\n}\n\n\n=== station: 1\n# scans: 2163\n\n\n\n\n\n\n\n\n\n=== station: 10\n# scans: 2343\n\n\n\n\n\n\n\n\n\n=== station: 11\n# scans: 2428\n\n\n\n\n\n\n\n\n\n=== station: 12\n# scans: 2949\n\n\n\n\n\n\n\n\n\n=== station: 13\n# scans: 2431\n\n\n\n\n\n\n\n\n\n=== station: 14\n# scans: 2227\n\n\n\n\n\n\n\n\n\n=== station: 15\n# scans: 3413\n\n\n\n\n\n\n\n\n\n=== station: 15.5\n# scans: 8025\n\n\n\n\n\n\n\n\n\n=== station: 16\n# scans: 1565\n\n\n\n\n\n\n\n\n\n=== station: 17\n# scans: 2178\n\n\n\n\n\n\n\n\n\n=== station: 18\n# scans: 2990\n\n\n\n\n\n\n\n\n\n=== station: 19\n# scans: 1720\n\n\n\n\n\n\n\n\n\n=== station: 2\n# scans: 1723\n\n\n\n\n\n\n\n\n\n=== station: 20\n# scans: 2174\n\n\n\n\n\n\n\n\n\n=== station: 21\n# scans: 2952\n\n\n\n\n\n\n\n\n\n=== station: 21.5\n# scans: 8665\n\n\n\n\n\n\n\n\n\n=== station: 22\n# scans: 3052\n\n\n\n\n\n\n\n\n\n=== station: 22.5\n# scans: 7534\n\n\n\n\n\n\n\n\n\n=== station: 23\n# scans: 1885\n\n\n\n\n\n\n\n\n\n=== station: 24\n# scans: 2222\n\n\n\n\n\n\n\n\n\n=== station: 25\n# scans: 4505\n\n\n\n\n\n\n\n\n\n=== station: 25.5\n# scans: 13944\n\n\n\n\n\n\n\n\n\n=== station: 26\n# scans: 1902\n\n\n\n\n\n\n\n\n\n=== station: 27\n# scans: 2479\n\n\n\n\n\n\n\n\n\n=== station: 28\n# scans: 2904\n\n\n\n\n\n\n\n\n\n=== station: 28.5\n# scans: 3383\n\n\n\n\n\n\n\n\n\n=== station: 29\n# scans: 3671\n\n\n\n\n\n\n\n\n\n=== station: 29.5\n# scans: 3787\n\n\n\n\n\n\n\n\n\n=== station: 3\n# scans: 4536\n\n\n\n\n\n\n\n\n\n=== station: 30\n# scans: 3288\n\n\n\n\n\n\n\n\n\n=== station: 30.5\n# scans: 2764\n\n\n\n\n\n\n\n\n\n=== station: 31\n# scans: 2428\n\n\n\n\n\n\n\n\n\n=== station: 32\n# scans: 1713\n\n\n\n\n\n\n\n\n\n=== station: 33\n# scans: 2750\n\n\n\n\n\n\n\n\n\n=== station: 34\n# scans: 1677\n\n\n\n\n\n\n\n\n\n=== station: 39\n# scans: 2079\n\n\n\n\n\n\n\n\n\n=== station: 4\n# scans: 1324\n\n\n\n\n\n\n\n\n\n=== station: 40\n# scans: 2081\n\n\n\n\n\n\n\n\n\n=== station: 41\n# scans: 2931\n\n\n\n\n\n\n\n\n\n=== station: 42\n# scans: 638\n\n\n\n\n\n\n\n\n\n=== station: 45\n# scans: 2443\n\n\n\n\n\n\n\n\n\n=== station: 46\n# scans: 2665\n\n\n\n\n\n\n\n\n\n=== station: 47\n# scans: 2516\n\n\n\n\n\n\n\n\n\n=== station: 48\n# scans: 1949\n\n\n\n\n\n\n\n\n\n=== station: 49\n# scans: 1632\n\n\n\n\n\n\n\n\n\n=== station: 5\n# scans: 1867\n\n\n\n\n\n\n\n\n\n=== station: 5.5\n# scans: 1860\n\n\n\n\n\n\n\n\n\n=== station: 50\n# scans: 2314\n\n\n\n\n\n\n\n\n\n=== station: 51\n# scans: 1563\n\n\n\n\n\n\n\n\n\n=== station: 52\n# scans: 2683\n\n\n\n\n\n\n\n\n\n=== station: 53\n# scans: 29\n\n\n\n\n\n\n\n\n\n=== station: 54\n# scans: 1257\n\n\n\n\n\n\n\n\n\n=== station: 55\n# scans: 1122\n\n\n\n\n\n\n\n\n\n=== station: 56\n# scans: 1906\n\n\n\n\n\n\n\n\n\n=== station: 57\n# scans: 2307\n\n\n\n\n\n\n\n\n\n=== station: 6\n# scans: 2189\n\n\n\n\n\n\n\n\n\n=== station: 6.5\n# scans: 7225\n\n\n\n\n\n\n\n\n\n=== station: 60\n# scans: 1629\n\n\n\n\n\n\n\n\n\n=== station: 61\n# scans: 1538\n\n\n\n\n\n\n\n\n\n=== station: 62\n# scans: 1782\n\n\n\n\n\n\n\n\n\n=== station: 63\n# scans: 1887\n\n\n\n\n\n\n\n\n\n=== station: 64\n# scans: 875\n\n\n\n\n\n\n\n\n\n=== station: 65\n# scans: 1460\n\n\n\n\n\n\n\n\n\n=== station: 66\n# scans: 1556\n\n\n\n\n\n\n\n\n\n=== station: 67\n# scans: 1801\n\n\n\n\n\n\n\n\n\n=== station: 68\n# scans: 1843\n\n\n\n\n\n\n\n\n\n=== station: 69\n# scans: 1675\n\n\n\n\n\n\n\n\n\n=== station: 7\n# scans: 1776\n\n\n\n\n\n\n\n\n\n=== station: 70\n# scans: 2274\n\n\n\n\n\n\n\n\n\n=== station: 71\n# scans: 2083\n\n\n\n\n\n\n\n\n\n=== station: 8\n# scans: 2272\n\n\n\n\n\n\n\n\n\n=== station: 9\n# scans: 3483\n\n\n\n\n\n\n\n\n\n=== station: 9.5\n# scans: 7644\n\n\n\n\n\n\n\n\n\n=== station: CAL1\n# scans: 2611\n\n\n\n\n\n\n\n\n\n=== station: CAL2\n# scans: 1364\n\n\n\n\n\n\n\n\n\n=== station: CAL3\n# scans: 2714\n\n\n\n\n\n\n\n\n\n=== station: CAL4\n# scans: 2748\n\n\n\n\n\n\n\n\n\n=== station: CAL5\n# scans: 3267\n\n\n\n\n\n\n\n\n\n=== station: CH1\n# scans: 2871\n\n\n\n\n\n\n\n\n\n=== station: CH2\n# scans: 2856\n\n\n\n\n\n\n\n\n\n=== station: CH3\n# scans: 2543\n\n\n\n\n\n\n\n\n\n=== station: CH4\n# scans: 3251\n\n\n\n\n\n\n\n\n\n=== station: CH5\n# scans: 4048\n\n\n\n\n\n\n\n\n\n=== station: DT01\n# scans: 3024\n\n\n\n\n\n\n\n\n\n=== station: DT02\n# scans: 2604\n\n\n\n\n\n\n\n\n\n=== station: DT03\n# scans: 4488\n\n\n\n\n\n\n\n\n\n=== station: DT04\n# scans: 5008\n\n\n\n\n\n\n\n\n\n=== station: DT05\n# scans: 4623\n\n\n\n\n\n\n\n\n\n=== station: DT06\n# scans: 8535\n\n\n\n\n\n\n\n\n\n=== station: DT07\n# scans: 19828\n\n\n\n\n\n\n\n\n\n=== station: DT08\n# scans: 9116\n\n\n\n\n\n\n\n\n\n=== station: DT09\n# scans: 4978\n\n\n\n\n\n\n\n\n\n=== station: DT10\n# scans: 2648\n\n\n\n\n\n\n\n\n\n=== station: DT11\n# scans: 2443\n\n\n\n\n\n\n\n\n\n=== station: DTXX\n# scans: 522\n\n\n\n\n\n\n\n\n\n\n\nplotting each cast in the first list\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # 1 is selecting only the first sublist\n  tryCatch({\n    plot(ctdDecimate(ctdTrim(cast)))\n  }, error = function(e){\n    print(e)\n  })\n}\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2163' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2343' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2428' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2949' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2431' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2227' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3413' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 8025' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1565' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2178' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2990' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1720' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1723' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2174' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2952' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 8665' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3052' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 7534' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1885' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2222' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4505' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 13944' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1902' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2479' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2904' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3383' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3671' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3787' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4536' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3288' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2764' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2428' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1713' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2750' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1677' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2079' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1324' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2081' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2931' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 638' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2443' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2665' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2516' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1949' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1632' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1867' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1860' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2314' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1563' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2683' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1257' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1122' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1906' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2307' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2189' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 7225' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1629' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1538' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1782' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1887' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1460' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1556' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1801' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1843' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1675' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1776' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2274' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2083' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2272' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3483' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 7644' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2611' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1364' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2714' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2748' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3267' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2871' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2856' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2543' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3251' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4048' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3024' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2604' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4488' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 5008' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4623' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 8535' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 19828' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 9116' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4978' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2648' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2443' in coercion to 'logical(1)'&gt;\n\n\n\n\nplotting other physical parameters for each cast\n# Loop through each CTD cast\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # Assuming each sublist contains only one relevant CTD object\n  tryCatch({\n    # Extract metadata for station name and cruise ID\n    station_name &lt;- cast@metadata$station[1]\n    cruise_id &lt;- cast@data$cruise_id[1]\n\n    # Generate a title with station name and cruise ID\n    overall_title &lt;- glue::glue(\"Station: {station_name}, Cruise ID: {cruise_id}\")\n\n    # Set margins: increase the outer margin for the title\n    par(oma = c(0, 0, 3, 0))  # Top outer margin increased for title\n\n    # Plotting function with specific parameters\n    oce::plot(\n      x = ctdDecimate(ctdTrim(cast)),\n      which = c(\n        \"sea_water_electrical_conductivity\",\n        \"descent_rate\", \"sound_velocity\",\n        \"sea_water_sigma_t\",\"altimeter\"\n      ),\n      main = \"\"  # No main title for individual subplots\n    )\n\n    # Place a single overall title at the top of the plot frame\n    mtext(overall_title, side = 3, line = 1, outer = TRUE, cex = 1.5)\n\n    # Reset outer margins to default\n    par(oma = c(0, 0, 0, 0))\n\n  }, error = function(e) {\n    print(e$message)  # Print any errors that occur during plotting\n  })\n}\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n\n\nplotting other nutrient parameters for each cast\n# Loop through each CTD cast\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # Assuming each sublist contains only one relevant CTD object\n  tryCatch({\n    # Extract metadata for station name and cruise ID\n    station_name &lt;- cast@metadata$station[1]\n    cruise_id &lt;- cast@data$cruise_id[1]\n\n    # Generate a title with station name and cruise ID\n    overall_title &lt;- glue::glue(\"Station: {station_name}, Cruise ID: {cruise_id}\")\n\n    # Set margins: increase the outer margin for the title\n    par(oma = c(0, 0, 3, 0))  # Top outer margin increased for title\n\n    # Plotting function with specific parameters\n    oce::plot(\n      x = ctdDecimate(ctdTrim(cast)),\n      which = c(\n        \"CDOM\", \"dissolved_oxygen\",\n        \"oxygen_saturation\",\n        \"chlorophyll_concentration\", \"chlorophyll_fluorescence\"\n      ),\n      main = \"\"  # No main title for individual subplots\n    )\n\n    # Place a single overall title at the top of the plot frame\n    mtext(overall_title, side = 3, line = 1, outer = TRUE, cex = 1.5)\n\n    # Reset outer margins to default\n    par(oma = c(0, 0, 0, 0))\n\n  }, error = function(e) {\n    print(e$message)  # Print any errors that occur during plotting\n  })\n}\n\n\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n\n\n\n\nplotting other optical parameters for each cast\n# Loop through each CTD cast\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # Assuming each sublist contains only one relevant CTD object\n  tryCatch({\n    # Extract metadata for station name and cruise ID\n    station_name &lt;- cast@metadata$station[1]\n    cruise_id &lt;- cast@data$cruise_id[1]\n\n    # Generate a title with station name and cruise ID\n    overall_title &lt;- glue::glue(\"Station: {station_name}, Cruise ID: {cruise_id}\")\n\n    # Set margins: increase the outer margin for the title\n    par(oma = c(0, 0, 3, 0))  # Top outer margin increased for title\n\n    # Plotting function with specific parameters\n    oce::plot(\n      x = ctdDecimate(ctdTrim(cast)),\n      which = c(\n        \"photosynthetically_available_radiation\",\n        \"beam_attenuation\",\"beam_transmission\"\n      ),\n      main = \"\"  # No main title for individual subplots\n    )\n\n    # Place a single overall title at the top of the plot frame\n    mtext(overall_title, side = 3, line = 1, outer = TRUE, cex = 1.5)\n\n    # Reset outer margins to default\n    par(oma = c(0, 0, 0, 0))\n\n  }, error = function(e) {\n    print(e$message)  # Print any errors that occur during plotting\n  })\n}\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n\n\nloop through every cast, clean, & save\ncombined_df &lt;- data.frame()\nfor (i in seq(ctd_FK)){\n  tryCatch({\n    cast &lt;- ctd_FK[[i]]  # 1 is selecting only the first sublist\n    \n    # print(class(cast))\n    # clean cast \n    trimmed_cast &lt;- ctdTrim(cast)\n    decimated_cast &lt;- ctdDecimate(trimmed_cast, p = 0.5)  # binned to 0.5 m\n    \n    # convert to df\n    cast_df &lt;- as.data.frame(decimated_cast@data)\n    \n    # Add metadata\n    # assumes station ID and cruise ID the same for all & just uses 1st one\n    cast_df &lt;- mutate(\n      cast_df,\n      station = cast@data$station[1],\n      cruise_id = cast@data$cruise_id[1]\n    )\n  \n    # drop NA rows left by cleaning\n    cast_df &lt;- subset(cast_df, !is.na(scan))\n    \n    # Append the data to the combined dataframe\n    combined_df &lt;- rbind(combined_df, cast_df)\n  }, error = function(e){\n    print(glue(\"error in cast {cast@metadata$station[1]}\"))\n    print(e)\n  })\n}\n# Save to CSV\nfile_path &lt;- here(glue(\"data/cleaned/{cruise_id}.csv\"))\nwrite.csv(combined_df, file_path, row.names = FALSE)"
  },
  {
    "objectID": "cruise_report/cruise_reports/WS0623.html",
    "href": "cruise_report/cruise_reports/WS0623.html",
    "title": "WS0623",
    "section": "",
    "text": "WS0623\n\n\nsetup\nif (!nzchar(system.file(package = \"librarian\"))) {\n  install.packages(\"librarian\")\n}\n\nlibrarian::shelf(\n  quiet = TRUE,\n  readr, here, fs, ggplot2, glue, \"jiho/castr\", dplyr, oce, patchwork, purrr, tidyr\n)\n\n\n\n\nCode\nsource(here(\"R/cruise_load.R\"))\ncruise_df &lt;- cruise_load(params$cruise_id)\n\n\n\n\nplot depth & pressure vs time elapsed\ntryCatch({\n  plots &lt;- list()\n  \n  for (station_name in unique(cruise_df$station)) {\n    subset_df &lt;- filter(cruise_df, station == station_name)\n    plots[[station_name]] &lt;- ggplot(subset_df, aes(x = time_elapsed)) +\n      geom_point(aes(y = depth), color = \"blue\") +  # Plot depth in blue\n      geom_line(aes(y = sea_water_pressure), color = \"red\") +  # Plot sea water pressure in red\n      ggtitle(glue(\"{station_name}\")) +\n      theme(\n        axis.title.x = element_blank(),\n        axis.title.y = element_blank(),\n        axis.text.x = element_blank(),\n        axis.text.y = element_blank(),\n        axis.ticks.x = element_blank(),\n        axis.ticks.y = element_blank()\n      )  # Remove individual axis titles and text\n  }\n  \n  # drop nulls\n  plots &lt;- purrr::compact(plots)\n  \n  # Combine all plots into a grid\n  combined_plot &lt;- wrap_plots(plots) + \n    plot_layout(ncol = 4) +  # Adjust ncol to set number of columns in the grid\n    plot_annotation(\n      title = \"Depth (blue) and Pressure (red)\",\n      subtitle = \"Each panel represents a different station\",\n      caption = \"Time Elapsed (x-axis) vs Depth & Pressure (y-axis)\"\n    ) +\n    theme(\n      plot.tag = element_text(size = 12, face = \"bold\"),\n      plot.tag.position = \"topleft\",\n      axis.title.x = element_text(margin = margin(t = 10)),\n      axis.title.y = element_text(margin = margin(r = 10))\n    )\n  \n  print(combined_plot)\n}, error = function(er){\n  print(er)\n});\n\n\nWarning: Removed 1 row containing missing values or values outside the scale range\n(`geom_point()`).\nRemoved 1 row containing missing values or values outside the scale range\n(`geom_point()`).\n\n\nWarning: Removed 2 rows containing missing values or values outside the scale range\n(`geom_point()`).\n\n\nWarning: Removed 1 row containing missing values or values outside the scale range\n(`geom_point()`).\n\n\n\n\n\n\n\n\n\n\n\nplot across all stations\np &lt;- ggplot(cruise_df, aes(x = time, y = depth, fill = station)) +\n  geom_col() +  # This creates the bars\n  # geom_text(aes(label = station), vjust = -0.3) +  # This adds labels to each bar, adjust vjust for position\n  labs(x = \"Time\", y = \"Depth\", title = \"Depth over Time by Station\") +  # Set labels and title\n  theme_minimal()  # Use a minimal theme\nprint(p)\n\n\nWarning: Removed 5 rows containing missing values or values outside the scale range\n(`geom_col()`).\n\n\n\n\n\n\n\n\n\n\n\ncreate oce.ctd objects from dataframes\nctd_load &lt;- function(data, other_params = NULL) {\n  \n  # create csv into ctd object\n  test_ctd &lt;-\n    as.ctd(\n      salinity    = data$sea_water_salinity,\n      temperature = data$sea_water_temperature,\n      pressure    = data$sea_water_pressure,\n      station     = data$station\n    )\n  \n  # add additional columns to ctd object\n  if (!is.null(other_params)) {\n    for (param_name in other_params) {\n      test_ctd &lt;-\n        oceSetData(\n          object = test_ctd,\n          name   = param_name,\n          value  = data[[param_name]]\n        )\n    }\n  }\n  print(glue(\"{data$station[1]}:\\t{length(test_ctd@data$scan)} scans\"))\n\n\n  return(test_ctd)\n}\n\n# Define other parameters to add\nother_params &lt;- c(\n  \"cruise_id\", \"station\", \"time\", \"time_elapsed\", \n  \"latitude\", \"longitude\", \"sea_water_electrical_conductivity\", \n  \"CDOM\", \"dissolved_oxygen\",\"oxygen_saturation\", \"chlorophyll_concentration\", \n  \"chlorophyll_fluorescence\", \"photosynthetically_available_radiation\", \n  \"beam_attenuation\",\"beam_transmission\", \"depth\", \"sea_water_sigma_t\",\n  \"descent_rate\", \"sound_velocity\",\"altimeter\"\n)\n\n# Split data by station and create data list\nctd_FK &lt;- cruise_df %&gt;%\n  split(.$station) %&gt;%\n  map(~ ctd_load(.x, other_params = other_params)) # ~ is a lambda(x)\n\n\n10: 1584 scans\n16: 1410 scans\n17: 2397 scans\n18: 3917 scans\n19: 2042 scans\n20: 4840 scans\n23: 2119 scans\n24: 3548 scans\n28: 3769 scans\n29: 3200 scans\n3:  3694 scans\n30: 2394 scans\n31: 3003 scans\n34: 2728 scans\n39: 2036 scans\n42: 2000 scans\n49: 1602 scans\n5:  2060 scans\n50: 2845 scans\n53: 2442 scans\n54: 2184 scans\n56: 1958 scans\n58: 1815 scans\n6:  8525 scans\n6.5:    6130 scans\n60: 2258 scans\n68: 1531 scans\n69: 1956 scans\n7:  1585 scans\n9:  2713 scans\nCAL1:   1605 scans\nCAL5:   2178 scans\nCH2:    2715 scans\nCH5:    2765 scans\n\n\n\n\nplotting scans for each cast in the first list\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # 1 is selecting only the first sublist\n  # print(i)\n  print(glue(\"=== station: {cast@metadata$station[1]}\"))\n  print(glue(\"# scans: {length(cast@data$scan)}\"))\n  plotScan(cast)\n}\n\n\n=== station: 10\n# scans: 1584\n\n\n\n\n\n\n\n\n\n=== station: 16\n# scans: 1410\n\n\n\n\n\n\n\n\n\n=== station: 17\n# scans: 2397\n\n\n\n\n\n\n\n\n\n=== station: 18\n# scans: 3917\n\n\n\n\n\n\n\n\n\n=== station: 19\n# scans: 2042\n\n\n\n\n\n\n\n\n\n=== station: 20\n# scans: 4840\n\n\n\n\n\n\n\n\n\n=== station: 23\n# scans: 2119\n\n\n\n\n\n\n\n\n\n=== station: 24\n# scans: 3548\n\n\n\n\n\n\n\n\n\n=== station: 28\n# scans: 3769\n\n\n\n\n\n\n\n\n\n=== station: 29\n# scans: 3200\n\n\n\n\n\n\n\n\n\n=== station: 3\n# scans: 3694\n\n\n\n\n\n\n\n\n\n=== station: 30\n# scans: 2394\n\n\n\n\n\n\n\n\n\n=== station: 31\n# scans: 3003\n\n\n\n\n\n\n\n\n\n=== station: 34\n# scans: 2728\n\n\n\n\n\n\n\n\n\n=== station: 39\n# scans: 2036\n\n\n\n\n\n\n\n\n\n=== station: 42\n# scans: 2000\n\n\n\n\n\n\n\n\n\n=== station: 49\n# scans: 1602\n\n\n\n\n\n\n\n\n\n=== station: 5\n# scans: 2060\n\n\n\n\n\n\n\n\n\n=== station: 50\n# scans: 2845\n\n\n\n\n\n\n\n\n\n=== station: 53\n# scans: 2442\n\n\n\n\n\n\n\n\n\n=== station: 54\n# scans: 2184\n\n\n\n\n\n\n\n\n\n=== station: 56\n# scans: 1958\n\n\n\n\n\n\n\n\n\n=== station: 58\n# scans: 1815\n\n\n\n\n\n\n\n\n\n=== station: 6\n# scans: 8525\n\n\n\n\n\n\n\n\n\n=== station: 6.5\n# scans: 6130\n\n\n\n\n\n\n\n\n\n=== station: 60\n# scans: 2258\n\n\n\n\n\n\n\n\n\n=== station: 68\n# scans: 1531\n\n\n\n\n\n\n\n\n\n=== station: 69\n# scans: 1956\n\n\n\n\n\n\n\n\n\n=== station: 7\n# scans: 1585\n\n\n\n\n\n\n\n\n\n=== station: 9\n# scans: 2713\n\n\n\n\n\n\n\n\n\n=== station: CAL1\n# scans: 1605\n\n\n\n\n\n\n\n\n\n=== station: CAL5\n# scans: 2178\n\n\n\n\n\n\n\n\n\n=== station: CH2\n# scans: 2715\n\n\n\n\n\n\n\n\n\n=== station: CH5\n# scans: 2765\n\n\n\n\n\n\n\n\n\n\n\nplotting each cast in the first list\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # 1 is selecting only the first sublist\n  tryCatch({\n    plot(ctdDecimate(ctdTrim(cast)))\n  }, error = function(e){\n    print(e)\n  })\n}\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1584' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1410' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2397' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3917' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2042' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4840' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2119' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3548' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3769' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3200' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3694' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2394' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3003' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2728' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2000' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1602' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2060' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2845' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2442' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1958' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1815' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 8525' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 6130' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2258' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1531' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1956' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1585' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2713' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1605' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2178' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2715' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2765' in coercion to 'logical(1)'&gt;\n\n\n\n\nplotting other physical parameters for each cast\n# Loop through each CTD cast\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # Assuming each sublist contains only one relevant CTD object\n  tryCatch({\n    # Extract metadata for station name and cruise ID\n    station_name &lt;- cast@metadata$station[1]\n    cruise_id &lt;- cast@data$cruise_id[1]\n\n    # Generate a title with station name and cruise ID\n    overall_title &lt;- glue::glue(\"Station: {station_name}, Cruise ID: {cruise_id}\")\n\n    # Set margins: increase the outer margin for the title\n    par(oma = c(0, 0, 3, 0))  # Top outer margin increased for title\n\n    # Plotting function with specific parameters\n    oce::plot(\n      x = ctdDecimate(ctdTrim(cast)),\n      which = c(\n        \"sea_water_electrical_conductivity\",\n        \"descent_rate\", \"sound_velocity\",\n        \"sea_water_sigma_t\",\"altimeter\"\n      ),\n      main = \"\"  # No main title for individual subplots\n    )\n\n    # Place a single overall title at the top of the plot frame\n    mtext(overall_title, side = 3, line = 1, outer = TRUE, cex = 1.5)\n\n    # Reset outer margins to default\n    par(oma = c(0, 0, 0, 0))\n\n  }, error = function(e) {\n    print(e$message)  # Print any errors that occur during plotting\n  })\n}\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n[1] \"missing value where TRUE/FALSE needed\"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n[1] \"need finite 'xlim' values\"\n[1] \"missing value where TRUE/FALSE needed\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n\n\nplotting other nutrient parameters for each cast\n# Loop through each CTD cast\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # Assuming each sublist contains only one relevant CTD object\n  tryCatch({\n    # Extract metadata for station name and cruise ID\n    station_name &lt;- cast@metadata$station[1]\n    cruise_id &lt;- cast@data$cruise_id[1]\n\n    # Generate a title with station name and cruise ID\n    overall_title &lt;- glue::glue(\"Station: {station_name}, Cruise ID: {cruise_id}\")\n\n    # Set margins: increase the outer margin for the title\n    par(oma = c(0, 0, 3, 0))  # Top outer margin increased for title\n\n    # Plotting function with specific parameters\n    oce::plot(\n      x = ctdDecimate(ctdTrim(cast)),\n      which = c(\n        \"CDOM\", \"dissolved_oxygen\",\n        \"oxygen_saturation\",\n        \"chlorophyll_concentration\", \"chlorophyll_fluorescence\"\n      ),\n      main = \"\"  # No main title for individual subplots\n    )\n\n    # Place a single overall title at the top of the plot frame\n    mtext(overall_title, side = 3, line = 1, outer = TRUE, cex = 1.5)\n\n    # Reset outer margins to default\n    par(oma = c(0, 0, 0, 0))\n\n  }, error = function(e) {\n    print(e$message)  # Print any errors that occur during plotting\n  })\n}\n\n\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n\n\n\n\nplotting other optical parameters for each cast\n# Loop through each CTD cast\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # Assuming each sublist contains only one relevant CTD object\n  tryCatch({\n    # Extract metadata for station name and cruise ID\n    station_name &lt;- cast@metadata$station[1]\n    cruise_id &lt;- cast@data$cruise_id[1]\n\n    # Generate a title with station name and cruise ID\n    overall_title &lt;- glue::glue(\"Station: {station_name}, Cruise ID: {cruise_id}\")\n\n    # Set margins: increase the outer margin for the title\n    par(oma = c(0, 0, 3, 0))  # Top outer margin increased for title\n\n    # Plotting function with specific parameters\n    oce::plot(\n      x = ctdDecimate(ctdTrim(cast)),\n      which = c(\n        \"photosynthetically_available_radiation\",\n        \"beam_attenuation\",\"beam_transmission\"\n      ),\n      main = \"\"  # No main title for individual subplots\n    )\n\n    # Place a single overall title at the top of the plot frame\n    mtext(overall_title, side = 3, line = 1, outer = TRUE, cex = 1.5)\n\n    # Reset outer margins to default\n    par(oma = c(0, 0, 0, 0))\n\n  }, error = function(e) {\n    print(e$message)  # Print any errors that occur during plotting\n  })\n}\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n[1] \"missing value where TRUE/FALSE needed\"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n[1] \"missing value where TRUE/FALSE needed\"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nloop through every cast, clean, & save\ncombined_df &lt;- data.frame()\nfor (i in seq(ctd_FK)){\n  tryCatch({\n    cast &lt;- ctd_FK[[i]]  # 1 is selecting only the first sublist\n    \n    # print(class(cast))\n    # clean cast \n    trimmed_cast &lt;- ctdTrim(cast)\n    decimated_cast &lt;- ctdDecimate(trimmed_cast, p = 0.5)  # binned to 0.5 m\n    \n    # convert to df\n    cast_df &lt;- as.data.frame(decimated_cast@data)\n    \n    # Add metadata\n    # assumes station ID and cruise ID the same for all & just uses 1st one\n    cast_df &lt;- mutate(\n      cast_df,\n      station = cast@data$station[1],\n      cruise_id = cast@data$cruise_id[1]\n    )\n  \n    # drop NA rows left by cleaning\n    cast_df &lt;- subset(cast_df, !is.na(scan))\n    \n    # Append the data to the combined dataframe\n    combined_df &lt;- rbind(combined_df, cast_df)\n  }, error = function(e){\n    print(glue(\"error in cast {cast@metadata$station[1]}\"))\n    print(e)\n  })\n}\n# Save to CSV\nfile_path &lt;- here(glue(\"data/cleaned/{cruise_id}.csv\"))\nwrite.csv(combined_df, file_path, row.names = FALSE)"
  },
  {
    "objectID": "cruise_report/cruise_reports/WS0718.html",
    "href": "cruise_report/cruise_reports/WS0718.html",
    "title": "WS0718",
    "section": "",
    "text": "WS0718\n\n\nsetup\nif (!nzchar(system.file(package = \"librarian\"))) {\n  install.packages(\"librarian\")\n}\n\nlibrarian::shelf(\n  quiet = TRUE,\n  readr, here, fs, ggplot2, glue, \"jiho/castr\", dplyr, oce, patchwork, purrr, tidyr\n)\n\n\n\n\nCode\nsource(here(\"R/cruise_load.R\"))\ncruise_df &lt;- cruise_load(params$cruise_id)\n\n\n\n\nplot depth & pressure vs time elapsed\ntryCatch({\n  plots &lt;- list()\n  \n  for (station_name in unique(cruise_df$station)) {\n    subset_df &lt;- filter(cruise_df, station == station_name)\n    plots[[station_name]] &lt;- ggplot(subset_df, aes(x = time_elapsed)) +\n      geom_point(aes(y = depth), color = \"blue\") +  # Plot depth in blue\n      geom_line(aes(y = sea_water_pressure), color = \"red\") +  # Plot sea water pressure in red\n      ggtitle(glue(\"{station_name}\")) +\n      theme(\n        axis.title.x = element_blank(),\n        axis.title.y = element_blank(),\n        axis.text.x = element_blank(),\n        axis.text.y = element_blank(),\n        axis.ticks.x = element_blank(),\n        axis.ticks.y = element_blank()\n      )  # Remove individual axis titles and text\n  }\n  \n  # drop nulls\n  plots &lt;- purrr::compact(plots)\n  \n  # Combine all plots into a grid\n  combined_plot &lt;- wrap_plots(plots) + \n    plot_layout(ncol = 4) +  # Adjust ncol to set number of columns in the grid\n    plot_annotation(\n      title = \"Depth (blue) and Pressure (red)\",\n      subtitle = \"Each panel represents a different station\",\n      caption = \"Time Elapsed (x-axis) vs Depth & Pressure (y-axis)\"\n    ) +\n    theme(\n      plot.tag = element_text(size = 12, face = \"bold\"),\n      plot.tag.position = \"topleft\",\n      axis.title.x = element_text(margin = margin(t = 10)),\n      axis.title.y = element_text(margin = margin(r = 10))\n    )\n  \n  print(combined_plot)\n}, error = function(er){\n  print(er)\n});\n\n\n\n\n\n\n\n\n\n\n\nplot across all stations\np &lt;- ggplot(cruise_df, aes(x = time, y = depth, fill = station)) +\n  geom_col() +  # This creates the bars\n  # geom_text(aes(label = station), vjust = -0.3) +  # This adds labels to each bar, adjust vjust for position\n  labs(x = \"Time\", y = \"Depth\", title = \"Depth over Time by Station\") +  # Set labels and title\n  theme_minimal()  # Use a minimal theme\nprint(p)\n\n\n\n\n\n\n\n\n\n\n\ncreate oce.ctd objects from dataframes\nctd_load &lt;- function(data, other_params = NULL) {\n  \n  # create csv into ctd object\n  test_ctd &lt;-\n    as.ctd(\n      salinity    = data$sea_water_salinity,\n      temperature = data$sea_water_temperature,\n      pressure    = data$sea_water_pressure,\n      station     = data$station\n    )\n  \n  # add additional columns to ctd object\n  if (!is.null(other_params)) {\n    for (param_name in other_params) {\n      test_ctd &lt;-\n        oceSetData(\n          object = test_ctd,\n          name   = param_name,\n          value  = data[[param_name]]\n        )\n    }\n  }\n  print(glue(\"{data$station[1]}:\\t{length(test_ctd@data$scan)} scans\"))\n\n\n  return(test_ctd)\n}\n\n# Define other parameters to add\nother_params &lt;- c(\n  \"cruise_id\", \"station\", \"time\", \"time_elapsed\", \n  \"latitude\", \"longitude\", \"sea_water_electrical_conductivity\", \n  \"CDOM\", \"dissolved_oxygen\",\"oxygen_saturation\", \"chlorophyll_concentration\", \n  \"chlorophyll_fluorescence\", \"photosynthetically_available_radiation\", \n  \"beam_attenuation\",\"beam_transmission\", \"depth\", \"sea_water_sigma_t\",\n  \"descent_rate\", \"sound_velocity\",\"altimeter\"\n)\n\n# Split data by station and create data list\nctd_FK &lt;- cruise_df %&gt;%\n  split(.$station) %&gt;%\n  map(~ ctd_load(.x, other_params = other_params)) # ~ is a lambda(x)\n\n\n1:  2955 scans\n10: 2156 scans\n16: 3419 scans\n17: 1539 scans\n18: 2 scans\n19: 2954 scans\n20: 2659 scans\n21.5:   8735 scans\n22.5:   10486 scans\n23: 1611 scans\n24: 2410 scans\n25.5:   12776 scans\n27: 3242 scans\n28: 2963 scans\n29: 1478 scans\n3:  3513 scans\n30: 5487 scans\n31: 1612 scans\n34: 1490 scans\n39: 880 scans\n42: 1872 scans\n49: 947 scans\n5:  1845 scans\n50: 1682 scans\n53: 2697 scans\n54: 2837 scans\n56: 2569 scans\n58: 1950 scans\n6:  1286 scans\n6.5:    5128 scans\n60: 1135 scans\n68: 6 scans\n69: 3397 scans\n7:  2006 scans\n9:  3611 scans\n9.5:    8684 scans\nCAL1:   1215 scans\nCAL5:   2892 scans\nCH2:    982 scans\nCH5:    3239 scans\n\n\n\n\nplotting scans for each cast in the first list\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # 1 is selecting only the first sublist\n  # print(i)\n  print(glue(\"=== station: {cast@metadata$station[1]}\"))\n  print(glue(\"# scans: {length(cast@data$scan)}\"))\n  plotScan(cast)\n}\n\n\n=== station: 1\n# scans: 2955\n\n\n\n\n\n\n\n\n\n=== station: 10\n# scans: 2156\n\n\n\n\n\n\n\n\n\n=== station: 16\n# scans: 3419\n\n\n\n\n\n\n\n\n\n=== station: 17\n# scans: 1539\n\n\n\n\n\n\n\n\n\n=== station: 18\n# scans: 2\n\n\n\n\n\n\n\n\n\n=== station: 19\n# scans: 2954\n\n\n\n\n\n\n\n\n\n=== station: 20\n# scans: 2659\n\n\n\n\n\n\n\n\n\n=== station: 21.5\n# scans: 8735\n\n\n\n\n\n\n\n\n\n=== station: 22.5\n# scans: 10486\n\n\n\n\n\n\n\n\n\n=== station: 23\n# scans: 1611\n\n\n\n\n\n\n\n\n\n=== station: 24\n# scans: 2410\n\n\n\n\n\n\n\n\n\n=== station: 25.5\n# scans: 12776\n\n\n\n\n\n\n\n\n\n=== station: 27\n# scans: 3242\n\n\n\n\n\n\n\n\n\n=== station: 28\n# scans: 2963\n\n\n\n\n\n\n\n\n\n=== station: 29\n# scans: 1478\n\n\n\n\n\n\n\n\n\n=== station: 3\n# scans: 3513\n\n\n\n\n\n\n\n\n\n=== station: 30\n# scans: 5487\n\n\n\n\n\n\n\n\n\n=== station: 31\n# scans: 1612\n\n\n\n\n\n\n\n\n\n=== station: 34\n# scans: 1490\n\n\n\n\n\n\n\n\n\n=== station: 39\n# scans: 880\n\n\n\n\n\n\n\n\n\n=== station: 42\n# scans: 1872\n\n\n\n\n\n\n\n\n\n=== station: 49\n# scans: 947\n\n\n\n\n\n\n\n\n\n=== station: 5\n# scans: 1845\n\n\n\n\n\n\n\n\n\n=== station: 50\n# scans: 1682\n\n\n\n\n\n\n\n\n\n=== station: 53\n# scans: 2697\n\n\n\n\n\n\n\n\n\n=== station: 54\n# scans: 2837\n\n\n\n\n\n\n\n\n\n=== station: 56\n# scans: 2569\n\n\n\n\n\n\n\n\n\n=== station: 58\n# scans: 1950\n\n\n\n\n\n\n\n\n\n=== station: 6\n# scans: 1286\n\n\n\n\n\n\n\n\n\n=== station: 6.5\n# scans: 5128\n\n\n\n\n\n\n\n\n\n=== station: 60\n# scans: 1135\n\n\n\n\n\n\n\n\n\n=== station: 68\n# scans: 6\n\n\n\n\n\n\n\n\n\n=== station: 69\n# scans: 3397\n\n\n\n\n\n\n\n\n\n=== station: 7\n# scans: 2006\n\n\n\n\n\n\n\n\n\n=== station: 9\n# scans: 3611\n\n\n\n\n\n\n\n\n\n=== station: 9.5\n# scans: 8684\n\n\n\n\n\n\n\n\n\n=== station: CAL1\n# scans: 1215\n\n\n\n\n\n\n\n\n\n=== station: CAL5\n# scans: 2892\n\n\n\n\n\n\n\n\n\n=== station: CH2\n# scans: 982\n\n\n\n\n\n\n\n\n\n=== station: CH5\n# scans: 3239\n\n\n\n\n\n\n\n\n\n\n\nplotting each cast in the first list\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # 1 is selecting only the first sublist\n  tryCatch({\n    plot(ctdDecimate(ctdTrim(cast)))\n  }, error = function(e){\n    print(e)\n  })\n}\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2955' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2156' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3419' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1539' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2954' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2659' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 8735' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 10486' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1611' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2410' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 12776' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3242' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2963' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1478' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3513' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 5487' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1612' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1490' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 880' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1872' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 947' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1845' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1682' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2697' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2837' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2569' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1950' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1286' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 5128' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1135' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3397' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2006' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3611' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 8684' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1215' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2892' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 982' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3239' in coercion to 'logical(1)'&gt;\n\n\n\n\nplotting other physical parameters for each cast\n# Loop through each CTD cast\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # Assuming each sublist contains only one relevant CTD object\n  tryCatch({\n    # Extract metadata for station name and cruise ID\n    station_name &lt;- cast@metadata$station[1]\n    cruise_id &lt;- cast@data$cruise_id[1]\n\n    # Generate a title with station name and cruise ID\n    overall_title &lt;- glue::glue(\"Station: {station_name}, Cruise ID: {cruise_id}\")\n\n    # Set margins: increase the outer margin for the title\n    par(oma = c(0, 0, 3, 0))  # Top outer margin increased for title\n\n    # Plotting function with specific parameters\n    oce::plot(\n      x = ctdDecimate(ctdTrim(cast)),\n      which = c(\n        \"sea_water_electrical_conductivity\",\n        \"descent_rate\", \"sound_velocity\",\n        \"sea_water_sigma_t\",\"altimeter\"\n      ),\n      main = \"\"  # No main title for individual subplots\n    )\n\n    # Place a single overall title at the top of the plot frame\n    mtext(overall_title, side = 3, line = 1, outer = TRUE, cex = 1.5)\n\n    # Reset outer margins to default\n    par(oma = c(0, 0, 0, 0))\n\n  }, error = function(e) {\n    print(e$message)  # Print any errors that occur during plotting\n  })\n}\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n\n\nplotting other nutrient parameters for each cast\n# Loop through each CTD cast\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # Assuming each sublist contains only one relevant CTD object\n  tryCatch({\n    # Extract metadata for station name and cruise ID\n    station_name &lt;- cast@metadata$station[1]\n    cruise_id &lt;- cast@data$cruise_id[1]\n\n    # Generate a title with station name and cruise ID\n    overall_title &lt;- glue::glue(\"Station: {station_name}, Cruise ID: {cruise_id}\")\n\n    # Set margins: increase the outer margin for the title\n    par(oma = c(0, 0, 3, 0))  # Top outer margin increased for title\n\n    # Plotting function with specific parameters\n    oce::plot(\n      x = ctdDecimate(ctdTrim(cast)),\n      which = c(\n        \"CDOM\", \"dissolved_oxygen\",\n        \"oxygen_saturation\",\n        \"chlorophyll_concentration\", \"chlorophyll_fluorescence\"\n      ),\n      main = \"\"  # No main title for individual subplots\n    )\n\n    # Place a single overall title at the top of the plot frame\n    mtext(overall_title, side = 3, line = 1, outer = TRUE, cex = 1.5)\n\n    # Reset outer margins to default\n    par(oma = c(0, 0, 0, 0))\n\n  }, error = function(e) {\n    print(e$message)  # Print any errors that occur during plotting\n  })\n}\n\n\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"plot.new has not been called yet\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n\n\n\n\nplotting other optical parameters for each cast\n# Loop through each CTD cast\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # Assuming each sublist contains only one relevant CTD object\n  tryCatch({\n    # Extract metadata for station name and cruise ID\n    station_name &lt;- cast@metadata$station[1]\n    cruise_id &lt;- cast@data$cruise_id[1]\n\n    # Generate a title with station name and cruise ID\n    overall_title &lt;- glue::glue(\"Station: {station_name}, Cruise ID: {cruise_id}\")\n\n    # Set margins: increase the outer margin for the title\n    par(oma = c(0, 0, 3, 0))  # Top outer margin increased for title\n\n    # Plotting function with specific parameters\n    oce::plot(\n      x = ctdDecimate(ctdTrim(cast)),\n      which = c(\n        \"photosynthetically_available_radiation\",\n        \"beam_attenuation\",\"beam_transmission\"\n      ),\n      main = \"\"  # No main title for individual subplots\n    )\n\n    # Place a single overall title at the top of the plot frame\n    mtext(overall_title, side = 3, line = 1, outer = TRUE, cex = 1.5)\n\n    # Reset outer margins to default\n    par(oma = c(0, 0, 0, 0))\n\n  }, error = function(e) {\n    print(e$message)  # Print any errors that occur during plotting\n  })\n}\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n\n\nloop through every cast, clean, & save\ncombined_df &lt;- data.frame()\nfor (i in seq(ctd_FK)){\n  tryCatch({\n    cast &lt;- ctd_FK[[i]]  # 1 is selecting only the first sublist\n    \n    # print(class(cast))\n    # clean cast \n    trimmed_cast &lt;- ctdTrim(cast)\n    decimated_cast &lt;- ctdDecimate(trimmed_cast, p = 0.5)  # binned to 0.5 m\n    \n    # convert to df\n    cast_df &lt;- as.data.frame(decimated_cast@data)\n    \n    # Add metadata\n    # assumes station ID and cruise ID the same for all & just uses 1st one\n    cast_df &lt;- mutate(\n      cast_df,\n      station = cast@data$station[1],\n      cruise_id = cast@data$cruise_id[1]\n    )\n  \n    # drop NA rows left by cleaning\n    cast_df &lt;- subset(cast_df, !is.na(scan))\n    \n    # Append the data to the combined dataframe\n    combined_df &lt;- rbind(combined_df, cast_df)\n  }, error = function(e){\n    print(glue(\"error in cast {cast@metadata$station[1]}\"))\n    print(e)\n  })\n}\n# Save to CSV\nfile_path &lt;- here(glue(\"data/cleaned/{cruise_id}.csv\"))\nwrite.csv(combined_df, file_path, row.names = FALSE)"
  },
  {
    "objectID": "cruise_report/cruise_reports/WS0807.html",
    "href": "cruise_report/cruise_reports/WS0807.html",
    "title": "WS0807",
    "section": "",
    "text": "WS0807\n\n\nsetup\nif (!nzchar(system.file(package = \"librarian\"))) {\n  install.packages(\"librarian\")\n}\n\nlibrarian::shelf(\n  quiet = TRUE,\n  readr, here, fs, ggplot2, glue, \"jiho/castr\", dplyr, oce, patchwork, purrr, tidyr\n)\n\n\n\n\nCode\nsource(here(\"R/cruise_load.R\"))\ncruise_df &lt;- cruise_load(params$cruise_id)\n\n\n\n\nplot depth & pressure vs time elapsed\ntryCatch({\n  plots &lt;- list()\n  \n  for (station_name in unique(cruise_df$station)) {\n    subset_df &lt;- filter(cruise_df, station == station_name)\n    plots[[station_name]] &lt;- ggplot(subset_df, aes(x = time_elapsed)) +\n      geom_point(aes(y = depth), color = \"blue\") +  # Plot depth in blue\n      geom_line(aes(y = sea_water_pressure), color = \"red\") +  # Plot sea water pressure in red\n      ggtitle(glue(\"{station_name}\")) +\n      theme(\n        axis.title.x = element_blank(),\n        axis.title.y = element_blank(),\n        axis.text.x = element_blank(),\n        axis.text.y = element_blank(),\n        axis.ticks.x = element_blank(),\n        axis.ticks.y = element_blank()\n      )  # Remove individual axis titles and text\n  }\n  \n  # drop nulls\n  plots &lt;- purrr::compact(plots)\n  \n  # Combine all plots into a grid\n  combined_plot &lt;- wrap_plots(plots) + \n    plot_layout(ncol = 4) +  # Adjust ncol to set number of columns in the grid\n    plot_annotation(\n      title = \"Depth (blue) and Pressure (red)\",\n      subtitle = \"Each panel represents a different station\",\n      caption = \"Time Elapsed (x-axis) vs Depth & Pressure (y-axis)\"\n    ) +\n    theme(\n      plot.tag = element_text(size = 12, face = \"bold\"),\n      plot.tag.position = \"topleft\",\n      axis.title.x = element_text(margin = margin(t = 10)),\n      axis.title.y = element_text(margin = margin(r = 10))\n    )\n  \n  print(combined_plot)\n}, error = function(er){\n  print(er)\n});\n\n\n\n\n\n\n\n\n\n\n\nplot across all stations\np &lt;- ggplot(cruise_df, aes(x = time, y = depth, fill = station)) +\n  geom_col() +  # This creates the bars\n  # geom_text(aes(label = station), vjust = -0.3) +  # This adds labels to each bar, adjust vjust for position\n  labs(x = \"Time\", y = \"Depth\", title = \"Depth over Time by Station\") +  # Set labels and title\n  theme_minimal()  # Use a minimal theme\nprint(p)\n\n\n\n\n\n\n\n\n\n\n\ncreate oce.ctd objects from dataframes\nctd_load &lt;- function(data, other_params = NULL) {\n  \n  # create csv into ctd object\n  test_ctd &lt;-\n    as.ctd(\n      salinity    = data$sea_water_salinity,\n      temperature = data$sea_water_temperature,\n      pressure    = data$sea_water_pressure,\n      station     = data$station\n    )\n  \n  # add additional columns to ctd object\n  if (!is.null(other_params)) {\n    for (param_name in other_params) {\n      test_ctd &lt;-\n        oceSetData(\n          object = test_ctd,\n          name   = param_name,\n          value  = data[[param_name]]\n        )\n    }\n  }\n  print(glue(\"{data$station[1]}:\\t{length(test_ctd@data$scan)} scans\"))\n\n\n  return(test_ctd)\n}\n\n# Define other parameters to add\nother_params &lt;- c(\n  \"cruise_id\", \"station\", \"time\", \"time_elapsed\", \n  \"latitude\", \"longitude\", \"sea_water_electrical_conductivity\", \n  \"CDOM\", \"dissolved_oxygen\",\"oxygen_saturation\", \"chlorophyll_concentration\", \n  \"chlorophyll_fluorescence\", \"photosynthetically_available_radiation\", \n  \"beam_attenuation\",\"beam_transmission\", \"depth\", \"sea_water_sigma_t\",\n  \"descent_rate\", \"sound_velocity\",\"altimeter\"\n)\n\n# Split data by station and create data list\nctd_FK &lt;- cruise_df %&gt;%\n  split(.$station) %&gt;%\n  map(~ ctd_load(.x, other_params = other_params)) # ~ is a lambda(x)\n\n\n10: 1003 scans\n12: 2095 scans\n16: 1235 scans\n17: 1377 scans\n18: 2011 scans\n19: 869 scans\n20: 1752 scans\n21.5:   7247 scans\n22.5:   7545 scans\n23: 1798 scans\n24: 1307 scans\n25.5:   15033 scans\n27: 1952 scans\n28: 2683 scans\n29: 1922 scans\n30: 1334 scans\n31: 1926 scans\n34: 1654 scans\n39: 982 scans\n42: 2367 scans\n49: 585 scans\n5:  2370 scans\n50: 563 scans\n53: 506 scans\n54: 830 scans\n56: 394 scans\n58: 1736 scans\n6:  4275 scans\n6.5:    5169 scans\n60: 906 scans\n68: 1387 scans\n69: 836 scans\n7:  1412 scans\n9:  3463 scans\n9.5:    7086 scans\nCAL1:   1575 scans\nCAL5:   1053 scans\nCH2:    1205 scans\nCH5:    1855 scans\n\n\n\n\nplotting scans for each cast in the first list\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # 1 is selecting only the first sublist\n  # print(i)\n  print(glue(\"=== station: {cast@metadata$station[1]}\"))\n  print(glue(\"# scans: {length(cast@data$scan)}\"))\n  plotScan(cast)\n}\n\n\n=== station: 10\n# scans: 1003\n\n\n\n\n\n\n\n\n\n=== station: 12\n# scans: 2095\n\n\n\n\n\n\n\n\n\n=== station: 16\n# scans: 1235\n\n\n\n\n\n\n\n\n\n=== station: 17\n# scans: 1377\n\n\n\n\n\n\n\n\n\n=== station: 18\n# scans: 2011\n\n\n\n\n\n\n\n\n\n=== station: 19\n# scans: 869\n\n\n\n\n\n\n\n\n\n=== station: 20\n# scans: 1752\n\n\n\n\n\n\n\n\n\n=== station: 21.5\n# scans: 7247\n\n\n\n\n\n\n\n\n\n=== station: 22.5\n# scans: 7545\n\n\n\n\n\n\n\n\n\n=== station: 23\n# scans: 1798\n\n\n\n\n\n\n\n\n\n=== station: 24\n# scans: 1307\n\n\n\n\n\n\n\n\n\n=== station: 25.5\n# scans: 15033\n\n\n\n\n\n\n\n\n\n=== station: 27\n# scans: 1952\n\n\n\n\n\n\n\n\n\n=== station: 28\n# scans: 2683\n\n\n\n\n\n\n\n\n\n=== station: 29\n# scans: 1922\n\n\n\n\n\n\n\n\n\n=== station: 30\n# scans: 1334\n\n\n\n\n\n\n\n\n\n=== station: 31\n# scans: 1926\n\n\n\n\n\n\n\n\n\n=== station: 34\n# scans: 1654\n\n\n\n\n\n\n\n\n\n=== station: 39\n# scans: 982\n\n\n\n\n\n\n\n\n\n=== station: 42\n# scans: 2367\n\n\n\n\n\n\n\n\n\n=== station: 49\n# scans: 585\n\n\n\n\n\n\n\n\n\n=== station: 5\n# scans: 2370\n\n\n\n\n\n\n\n\n\n=== station: 50\n# scans: 563\n\n\n\n\n\n\n\n\n\n=== station: 53\n# scans: 506\n\n\n\n\n\n\n\n\n\n=== station: 54\n# scans: 830\n\n\n\n\n\n\n\n\n\n=== station: 56\n# scans: 394\n\n\n\n\n\n\n\n\n\n=== station: 58\n# scans: 1736\n\n\n\n\n\n\n\n\n\n=== station: 6\n# scans: 4275\n\n\n\n\n\n\n\n\n\n=== station: 6.5\n# scans: 5169\n\n\n\n\n\n\n\n\n\n=== station: 60\n# scans: 906\n\n\n\n\n\n\n\n\n\n=== station: 68\n# scans: 1387\n\n\n\n\n\n\n\n\n\n=== station: 69\n# scans: 836\n\n\n\n\n\n\n\n\n\n=== station: 7\n# scans: 1412\n\n\n\n\n\n\n\n\n\n=== station: 9\n# scans: 3463\n\n\n\n\n\n\n\n\n\n=== station: 9.5\n# scans: 7086\n\n\n\n\n\n\n\n\n\n=== station: CAL1\n# scans: 1575\n\n\n\n\n\n\n\n\n\n=== station: CAL5\n# scans: 1053\n\n\n\n\n\n\n\n\n\n=== station: CH2\n# scans: 1205\n\n\n\n\n\n\n\n\n\n=== station: CH5\n# scans: 1855\n\n\n\n\n\n\n\n\n\n\n\nplotting each cast in the first list\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # 1 is selecting only the first sublist\n  tryCatch({\n    plot(ctdDecimate(ctdTrim(cast)))\n  }, error = function(e){\n    print(e)\n  })\n}\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1003' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2095' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1235' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1377' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2011' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 869' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1752' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 7247' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 7545' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1798' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1307' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 15033' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1952' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2683' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1922' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1334' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1926' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1654' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 982' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2367' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 585' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2370' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 563' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 506' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 830' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 394' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1736' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4275' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 5169' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 906' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1387' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 836' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1412' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3463' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 7086' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1575' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1053' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1205' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1855' in coercion to 'logical(1)'&gt;\n\n\n\n\nplotting other physical parameters for each cast\n# Loop through each CTD cast\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # Assuming each sublist contains only one relevant CTD object\n  tryCatch({\n    # Extract metadata for station name and cruise ID\n    station_name &lt;- cast@metadata$station[1]\n    cruise_id &lt;- cast@data$cruise_id[1]\n\n    # Generate a title with station name and cruise ID\n    overall_title &lt;- glue::glue(\"Station: {station_name}, Cruise ID: {cruise_id}\")\n\n    # Set margins: increase the outer margin for the title\n    par(oma = c(0, 0, 3, 0))  # Top outer margin increased for title\n\n    # Plotting function with specific parameters\n    oce::plot(\n      x = ctdDecimate(ctdTrim(cast)),\n      which = c(\n        \"sea_water_electrical_conductivity\",\n        \"descent_rate\", \"sound_velocity\",\n        \"sea_water_sigma_t\",\"altimeter\"\n      ),\n      main = \"\"  # No main title for individual subplots\n    )\n\n    # Place a single overall title at the top of the plot frame\n    mtext(overall_title, side = 3, line = 1, outer = TRUE, cex = 1.5)\n\n    # Reset outer margins to default\n    par(oma = c(0, 0, 0, 0))\n\n  }, error = function(e) {\n    print(e$message)  # Print any errors that occur during plotting\n  })\n}\n\n\n\n\n\n\n\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n\n\nplotting other nutrient parameters for each cast\n# Loop through each CTD cast\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # Assuming each sublist contains only one relevant CTD object\n  tryCatch({\n    # Extract metadata for station name and cruise ID\n    station_name &lt;- cast@metadata$station[1]\n    cruise_id &lt;- cast@data$cruise_id[1]\n\n    # Generate a title with station name and cruise ID\n    overall_title &lt;- glue::glue(\"Station: {station_name}, Cruise ID: {cruise_id}\")\n\n    # Set margins: increase the outer margin for the title\n    par(oma = c(0, 0, 3, 0))  # Top outer margin increased for title\n\n    # Plotting function with specific parameters\n    oce::plot(\n      x = ctdDecimate(ctdTrim(cast)),\n      which = c(\n        \"CDOM\", \"dissolved_oxygen\",\n        \"oxygen_saturation\",\n        \"chlorophyll_concentration\", \"chlorophyll_fluorescence\"\n      ),\n      main = \"\"  # No main title for individual subplots\n    )\n\n    # Place a single overall title at the top of the plot frame\n    mtext(overall_title, side = 3, line = 1, outer = TRUE, cex = 1.5)\n\n    # Reset outer margins to default\n    par(oma = c(0, 0, 0, 0))\n\n  }, error = function(e) {\n    print(e$message)  # Print any errors that occur during plotting\n  })\n}\n\n\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n\n\n\n\nplotting other optical parameters for each cast\n# Loop through each CTD cast\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # Assuming each sublist contains only one relevant CTD object\n  tryCatch({\n    # Extract metadata for station name and cruise ID\n    station_name &lt;- cast@metadata$station[1]\n    cruise_id &lt;- cast@data$cruise_id[1]\n\n    # Generate a title with station name and cruise ID\n    overall_title &lt;- glue::glue(\"Station: {station_name}, Cruise ID: {cruise_id}\")\n\n    # Set margins: increase the outer margin for the title\n    par(oma = c(0, 0, 3, 0))  # Top outer margin increased for title\n\n    # Plotting function with specific parameters\n    oce::plot(\n      x = ctdDecimate(ctdTrim(cast)),\n      which = c(\n        \"photosynthetically_available_radiation\",\n        \"beam_attenuation\",\"beam_transmission\"\n      ),\n      main = \"\"  # No main title for individual subplots\n    )\n\n    # Place a single overall title at the top of the plot frame\n    mtext(overall_title, side = 3, line = 1, outer = TRUE, cex = 1.5)\n\n    # Reset outer margins to default\n    par(oma = c(0, 0, 0, 0))\n\n  }, error = function(e) {\n    print(e$message)  # Print any errors that occur during plotting\n  })\n}\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n\n\nloop through every cast, clean, & save\ncombined_df &lt;- data.frame()\nfor (i in seq(ctd_FK)){\n  tryCatch({\n    cast &lt;- ctd_FK[[i]]  # 1 is selecting only the first sublist\n    \n    # print(class(cast))\n    # clean cast \n    trimmed_cast &lt;- ctdTrim(cast)\n    decimated_cast &lt;- ctdDecimate(trimmed_cast, p = 0.5)  # binned to 0.5 m\n    \n    # convert to df\n    cast_df &lt;- as.data.frame(decimated_cast@data)\n    \n    # Add metadata\n    # assumes station ID and cruise ID the same for all & just uses 1st one\n    cast_df &lt;- mutate(\n      cast_df,\n      station = cast@data$station[1],\n      cruise_id = cast@data$cruise_id[1]\n    )\n  \n    # drop NA rows left by cleaning\n    cast_df &lt;- subset(cast_df, !is.na(scan))\n    \n    # Append the data to the combined dataframe\n    combined_df &lt;- rbind(combined_df, cast_df)\n  }, error = function(e){\n    print(glue(\"error in cast {cast@metadata$station[1]}\"))\n    print(e)\n  })\n}\n# Save to CSV\nfile_path &lt;- here(glue(\"data/cleaned/{cruise_id}.csv\"))\nwrite.csv(combined_df, file_path, row.names = FALSE)"
  },
  {
    "objectID": "cruise_report/cruise_reports/WS0906.html",
    "href": "cruise_report/cruise_reports/WS0906.html",
    "title": "WS0906",
    "section": "",
    "text": "WS0906\n\n\nsetup\nif (!nzchar(system.file(package = \"librarian\"))) {\n  install.packages(\"librarian\")\n}\n\nlibrarian::shelf(\n  quiet = TRUE,\n  readr, here, fs, ggplot2, glue, \"jiho/castr\", dplyr, oce, patchwork, purrr, tidyr\n)\n\n\n\n\nCode\nsource(here(\"R/cruise_load.R\"))\ncruise_df &lt;- cruise_load(params$cruise_id)\n\n\n\n\nplot depth & pressure vs time elapsed\ntryCatch({\n  plots &lt;- list()\n  \n  for (station_name in unique(cruise_df$station)) {\n    subset_df &lt;- filter(cruise_df, station == station_name)\n    plots[[station_name]] &lt;- ggplot(subset_df, aes(x = time_elapsed)) +\n      geom_point(aes(y = depth), color = \"blue\") +  # Plot depth in blue\n      geom_line(aes(y = sea_water_pressure), color = \"red\") +  # Plot sea water pressure in red\n      ggtitle(glue(\"{station_name}\")) +\n      theme(\n        axis.title.x = element_blank(),\n        axis.title.y = element_blank(),\n        axis.text.x = element_blank(),\n        axis.text.y = element_blank(),\n        axis.ticks.x = element_blank(),\n        axis.ticks.y = element_blank()\n      )  # Remove individual axis titles and text\n  }\n  \n  # drop nulls\n  plots &lt;- purrr::compact(plots)\n  \n  # Combine all plots into a grid\n  combined_plot &lt;- wrap_plots(plots) + \n    plot_layout(ncol = 4) +  # Adjust ncol to set number of columns in the grid\n    plot_annotation(\n      title = \"Depth (blue) and Pressure (red)\",\n      subtitle = \"Each panel represents a different station\",\n      caption = \"Time Elapsed (x-axis) vs Depth & Pressure (y-axis)\"\n    ) +\n    theme(\n      plot.tag = element_text(size = 12, face = \"bold\"),\n      plot.tag.position = \"topleft\",\n      axis.title.x = element_text(margin = margin(t = 10)),\n      axis.title.y = element_text(margin = margin(r = 10))\n    )\n  \n  print(combined_plot)\n}, error = function(er){\n  print(er)\n});\n\n\n\n\n\n\n\n\n\n\n\nplot across all stations\np &lt;- ggplot(cruise_df, aes(x = time, y = depth, fill = station)) +\n  geom_col() +  # This creates the bars\n  # geom_text(aes(label = station), vjust = -0.3) +  # This adds labels to each bar, adjust vjust for position\n  labs(x = \"Time\", y = \"Depth\", title = \"Depth over Time by Station\") +  # Set labels and title\n  theme_minimal()  # Use a minimal theme\nprint(p)\n\n\n\n\n\n\n\n\n\n\n\ncreate oce.ctd objects from dataframes\nctd_load &lt;- function(data, other_params = NULL) {\n  \n  # create csv into ctd object\n  test_ctd &lt;-\n    as.ctd(\n      salinity    = data$sea_water_salinity,\n      temperature = data$sea_water_temperature,\n      pressure    = data$sea_water_pressure,\n      station     = data$station\n    )\n  \n  # add additional columns to ctd object\n  if (!is.null(other_params)) {\n    for (param_name in other_params) {\n      test_ctd &lt;-\n        oceSetData(\n          object = test_ctd,\n          name   = param_name,\n          value  = data[[param_name]]\n        )\n    }\n  }\n  print(glue(\"{data$station[1]}:\\t{length(test_ctd@data$scan)} scans\"))\n\n\n  return(test_ctd)\n}\n\n# Define other parameters to add\nother_params &lt;- c(\n  \"cruise_id\", \"station\", \"time\", \"time_elapsed\", \n  \"latitude\", \"longitude\", \"sea_water_electrical_conductivity\", \n  \"CDOM\", \"dissolved_oxygen\",\"oxygen_saturation\", \"chlorophyll_concentration\", \n  \"chlorophyll_fluorescence\", \"photosynthetically_available_radiation\", \n  \"beam_attenuation\",\"beam_transmission\", \"depth\", \"sea_water_sigma_t\",\n  \"descent_rate\", \"sound_velocity\",\"altimeter\"\n)\n\n# Split data by station and create data list\nctd_FK &lt;- cruise_df %&gt;%\n  split(.$station) %&gt;%\n  map(~ ctd_load(.x, other_params = other_params)) # ~ is a lambda(x)\n\n\n1:  2041 scans\n10: 2172 scans\n12: 4516 scans\n16: 1588 scans\n17: 2343 scans\n18: 3408 scans\n20.5:   3252 scans\n21.5:   9796 scans\n22.5:   7345 scans\n23: 3792 scans\n24: 3930 scans\n3:  6331 scans\n31: 2018 scans\n34: 1468 scans\n42: 1657 scans\n5.5:    1569 scans\n50: 608 scans\n56: 1918 scans\n58: 1895 scans\n6.5:    5406 scans\n6.75:   9812 scans\n60: 1542 scans\n68: 1228 scans\n69: 1072 scans\n8:  1879 scans\n9.5:    8068 scans\nCAL1:   36 scans\nCAL4:   861 scans\nCH2:    1908 scans\n\n\n\n\nplotting scans for each cast in the first list\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # 1 is selecting only the first sublist\n  # print(i)\n  print(glue(\"=== station: {cast@metadata$station[1]}\"))\n  print(glue(\"# scans: {length(cast@data$scan)}\"))\n  plotScan(cast)\n}\n\n\n=== station: 1\n# scans: 2041\n\n\n\n\n\n\n\n\n\n=== station: 10\n# scans: 2172\n\n\n\n\n\n\n\n\n\n=== station: 12\n# scans: 4516\n\n\n\n\n\n\n\n\n\n=== station: 16\n# scans: 1588\n\n\n\n\n\n\n\n\n\n=== station: 17\n# scans: 2343\n\n\n\n\n\n\n\n\n\n=== station: 18\n# scans: 3408\n\n\n\n\n\n\n\n\n\n=== station: 20.5\n# scans: 3252\n\n\n\n\n\n\n\n\n\n=== station: 21.5\n# scans: 9796\n\n\n\n\n\n\n\n\n\n=== station: 22.5\n# scans: 7345\n\n\n\n\n\n\n\n\n\n=== station: 23\n# scans: 3792\n\n\n\n\n\n\n\n\n\n=== station: 24\n# scans: 3930\n\n\n\n\n\n\n\n\n\n=== station: 3\n# scans: 6331\n\n\n\n\n\n\n\n\n\n=== station: 31\n# scans: 2018\n\n\n\n\n\n\n\n\n\n=== station: 34\n# scans: 1468\n\n\n\n\n\n\n\n\n\n=== station: 42\n# scans: 1657\n\n\n\n\n\n\n\n\n\n=== station: 5.5\n# scans: 1569\n\n\n\n\n\n\n\n\n\n=== station: 50\n# scans: 608\n\n\n\n\n\n\n\n\n\n=== station: 56\n# scans: 1918\n\n\n\n\n\n\n\n\n\n=== station: 58\n# scans: 1895\n\n\n\n\n\n\n\n\n\n=== station: 6.5\n# scans: 5406\n\n\n\n\n\n\n\n\n\n=== station: 6.75\n# scans: 9812\n\n\n\n\n\n\n\n\n\n=== station: 60\n# scans: 1542\n\n\n\n\n\n\n\n\n\n=== station: 68\n# scans: 1228\n\n\n\n\n\n\n\n\n\n=== station: 69\n# scans: 1072\n\n\n\n\n\n\n\n\n\n=== station: 8\n# scans: 1879\n\n\n\n\n\n\n\n\n\n=== station: 9.5\n# scans: 8068\n\n\n\n\n\n\n\n\n\n=== station: CAL1\n# scans: 36\n\n\n\n\n\n\n\n\n\n=== station: CAL4\n# scans: 861\n\n\n\n\n\n\n\n\n\n=== station: CH2\n# scans: 1908\n\n\n\n\n\n\n\n\n\n\n\nplotting each cast in the first list\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # 1 is selecting only the first sublist\n  tryCatch({\n    plot(ctdDecimate(ctdTrim(cast)))\n  }, error = function(e){\n    print(e)\n  })\n}\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2041' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2172' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4516' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1588' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2343' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3408' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3252' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 9796' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 7345' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3792' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3930' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 6331' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2018' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1468' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1657' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1569' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 608' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1918' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1895' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 5406' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 9812' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1542' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1228' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1072' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1879' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 8068' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 36' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 861' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1908' in coercion to 'logical(1)'&gt;\n\n\n\n\nplotting other physical parameters for each cast\n# Loop through each CTD cast\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # Assuming each sublist contains only one relevant CTD object\n  tryCatch({\n    # Extract metadata for station name and cruise ID\n    station_name &lt;- cast@metadata$station[1]\n    cruise_id &lt;- cast@data$cruise_id[1]\n\n    # Generate a title with station name and cruise ID\n    overall_title &lt;- glue::glue(\"Station: {station_name}, Cruise ID: {cruise_id}\")\n\n    # Set margins: increase the outer margin for the title\n    par(oma = c(0, 0, 3, 0))  # Top outer margin increased for title\n\n    # Plotting function with specific parameters\n    oce::plot(\n      x = ctdDecimate(ctdTrim(cast)),\n      which = c(\n        \"sea_water_electrical_conductivity\",\n        \"descent_rate\", \"sound_velocity\",\n        \"sea_water_sigma_t\",\"altimeter\"\n      ),\n      main = \"\"  # No main title for individual subplots\n    )\n\n    # Place a single overall title at the top of the plot frame\n    mtext(overall_title, side = 3, line = 1, outer = TRUE, cex = 1.5)\n\n    # Reset outer margins to default\n    par(oma = c(0, 0, 0, 0))\n\n  }, error = function(e) {\n    print(e$message)  # Print any errors that occur during plotting\n  })\n}\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n\n\nplotting other nutrient parameters for each cast\n# Loop through each CTD cast\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # Assuming each sublist contains only one relevant CTD object\n  tryCatch({\n    # Extract metadata for station name and cruise ID\n    station_name &lt;- cast@metadata$station[1]\n    cruise_id &lt;- cast@data$cruise_id[1]\n\n    # Generate a title with station name and cruise ID\n    overall_title &lt;- glue::glue(\"Station: {station_name}, Cruise ID: {cruise_id}\")\n\n    # Set margins: increase the outer margin for the title\n    par(oma = c(0, 0, 3, 0))  # Top outer margin increased for title\n\n    # Plotting function with specific parameters\n    oce::plot(\n      x = ctdDecimate(ctdTrim(cast)),\n      which = c(\n        \"CDOM\", \"dissolved_oxygen\",\n        \"oxygen_saturation\",\n        \"chlorophyll_concentration\", \"chlorophyll_fluorescence\"\n      ),\n      main = \"\"  # No main title for individual subplots\n    )\n\n    # Place a single overall title at the top of the plot frame\n    mtext(overall_title, side = 3, line = 1, outer = TRUE, cex = 1.5)\n\n    # Reset outer margins to default\n    par(oma = c(0, 0, 0, 0))\n\n  }, error = function(e) {\n    print(e$message)  # Print any errors that occur during plotting\n  })\n}\n\n\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n\n\n\n\nplotting other optical parameters for each cast\n# Loop through each CTD cast\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # Assuming each sublist contains only one relevant CTD object\n  tryCatch({\n    # Extract metadata for station name and cruise ID\n    station_name &lt;- cast@metadata$station[1]\n    cruise_id &lt;- cast@data$cruise_id[1]\n\n    # Generate a title with station name and cruise ID\n    overall_title &lt;- glue::glue(\"Station: {station_name}, Cruise ID: {cruise_id}\")\n\n    # Set margins: increase the outer margin for the title\n    par(oma = c(0, 0, 3, 0))  # Top outer margin increased for title\n\n    # Plotting function with specific parameters\n    oce::plot(\n      x = ctdDecimate(ctdTrim(cast)),\n      which = c(\n        \"photosynthetically_available_radiation\",\n        \"beam_attenuation\",\"beam_transmission\"\n      ),\n      main = \"\"  # No main title for individual subplots\n    )\n\n    # Place a single overall title at the top of the plot frame\n    mtext(overall_title, side = 3, line = 1, outer = TRUE, cex = 1.5)\n\n    # Reset outer margins to default\n    par(oma = c(0, 0, 0, 0))\n\n  }, error = function(e) {\n    print(e$message)  # Print any errors that occur during plotting\n  })\n}\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n\n\nloop through every cast, clean, & save\ncombined_df &lt;- data.frame()\nfor (i in seq(ctd_FK)){\n  tryCatch({\n    cast &lt;- ctd_FK[[i]]  # 1 is selecting only the first sublist\n    \n    # print(class(cast))\n    # clean cast \n    trimmed_cast &lt;- ctdTrim(cast)\n    decimated_cast &lt;- ctdDecimate(trimmed_cast, p = 0.5)  # binned to 0.5 m\n    \n    # convert to df\n    cast_df &lt;- as.data.frame(decimated_cast@data)\n    \n    # Add metadata\n    # assumes station ID and cruise ID the same for all & just uses 1st one\n    cast_df &lt;- mutate(\n      cast_df,\n      station = cast@data$station[1],\n      cruise_id = cast@data$cruise_id[1]\n    )\n  \n    # drop NA rows left by cleaning\n    cast_df &lt;- subset(cast_df, !is.na(scan))\n    \n    # Append the data to the combined dataframe\n    combined_df &lt;- rbind(combined_df, cast_df)\n  }, error = function(e){\n    print(glue(\"error in cast {cast@metadata$station[1]}\"))\n    print(e)\n  })\n}\n# Save to CSV\nfile_path &lt;- here(glue(\"data/cleaned/{cruise_id}.csv\"))\nwrite.csv(combined_df, file_path, row.names = FALSE)"
  },
  {
    "objectID": "cruise_report/cruise_reports/WS0919.html",
    "href": "cruise_report/cruise_reports/WS0919.html",
    "title": "WS0919",
    "section": "",
    "text": "WS0919\n\n\nsetup\nif (!nzchar(system.file(package = \"librarian\"))) {\n  install.packages(\"librarian\")\n}\n\nlibrarian::shelf(\n  quiet = TRUE,\n  readr, here, fs, ggplot2, glue, \"jiho/castr\", dplyr, oce, patchwork, purrr, tidyr\n)\n\n\n\n\nCode\nsource(here(\"R/cruise_load.R\"))\ncruise_df &lt;- cruise_load(params$cruise_id)\n\n\n\n\nplot depth & pressure vs time elapsed\ntryCatch({\n  plots &lt;- list()\n  \n  for (station_name in unique(cruise_df$station)) {\n    subset_df &lt;- filter(cruise_df, station == station_name)\n    plots[[station_name]] &lt;- ggplot(subset_df, aes(x = time_elapsed)) +\n      geom_point(aes(y = depth), color = \"blue\") +  # Plot depth in blue\n      geom_line(aes(y = sea_water_pressure), color = \"red\") +  # Plot sea water pressure in red\n      ggtitle(glue(\"{station_name}\")) +\n      theme(\n        axis.title.x = element_blank(),\n        axis.title.y = element_blank(),\n        axis.text.x = element_blank(),\n        axis.text.y = element_blank(),\n        axis.ticks.x = element_blank(),\n        axis.ticks.y = element_blank()\n      )  # Remove individual axis titles and text\n  }\n  \n  # drop nulls\n  plots &lt;- purrr::compact(plots)\n  \n  # Combine all plots into a grid\n  combined_plot &lt;- wrap_plots(plots) + \n    plot_layout(ncol = 4) +  # Adjust ncol to set number of columns in the grid\n    plot_annotation(\n      title = \"Depth (blue) and Pressure (red)\",\n      subtitle = \"Each panel represents a different station\",\n      caption = \"Time Elapsed (x-axis) vs Depth & Pressure (y-axis)\"\n    ) +\n    theme(\n      plot.tag = element_text(size = 12, face = \"bold\"),\n      plot.tag.position = \"topleft\",\n      axis.title.x = element_text(margin = margin(t = 10)),\n      axis.title.y = element_text(margin = margin(r = 10))\n    )\n  \n  print(combined_plot)\n}, error = function(er){\n  print(er)\n});\n\n\n\n\n\n\n\n\n\n\n\nplot across all stations\np &lt;- ggplot(cruise_df, aes(x = time, y = depth, fill = station)) +\n  geom_col() +  # This creates the bars\n  # geom_text(aes(label = station), vjust = -0.3) +  # This adds labels to each bar, adjust vjust for position\n  labs(x = \"Time\", y = \"Depth\", title = \"Depth over Time by Station\") +  # Set labels and title\n  theme_minimal()  # Use a minimal theme\nprint(p)\n\n\n\n\n\n\n\n\n\n\n\ncreate oce.ctd objects from dataframes\nctd_load &lt;- function(data, other_params = NULL) {\n  \n  # create csv into ctd object\n  test_ctd &lt;-\n    as.ctd(\n      salinity    = data$sea_water_salinity,\n      temperature = data$sea_water_temperature,\n      pressure    = data$sea_water_pressure,\n      station     = data$station\n    )\n  \n  # add additional columns to ctd object\n  if (!is.null(other_params)) {\n    for (param_name in other_params) {\n      test_ctd &lt;-\n        oceSetData(\n          object = test_ctd,\n          name   = param_name,\n          value  = data[[param_name]]\n        )\n    }\n  }\n  print(glue(\"{data$station[1]}:\\t{length(test_ctd@data$scan)} scans\"))\n\n\n  return(test_ctd)\n}\n\n# Define other parameters to add\nother_params &lt;- c(\n  \"cruise_id\", \"station\", \"time\", \"time_elapsed\", \n  \"latitude\", \"longitude\", \"sea_water_electrical_conductivity\", \n  \"CDOM\", \"dissolved_oxygen\",\"oxygen_saturation\", \"chlorophyll_concentration\", \n  \"chlorophyll_fluorescence\", \"photosynthetically_available_radiation\", \n  \"beam_attenuation\",\"beam_transmission\", \"depth\", \"sea_water_sigma_t\",\n  \"descent_rate\", \"sound_velocity\",\"altimeter\"\n)\n\n# Split data by station and create data list\nctd_FK &lt;- cruise_df %&gt;%\n  split(.$station) %&gt;%\n  map(~ ctd_load(.x, other_params = other_params)) # ~ is a lambda(x)\n\n\n1:  2127 scans\n10: 19 scans\n12: 4418 scans\n16: 1624 scans\n17: 1431 scans\n18: 2084 scans\n19: 6 scans\n21: 2731 scans\n22.5:   8062 scans\n23: 3173 scans\n24: 2417 scans\n3:  4410 scans\n31: 4324 scans\n34: 2245 scans\n39: 48 scans\n42: 3289 scans\n49: 100 scans\n5:  2709 scans\n50: 19 scans\n53: 520 scans\n55: 79 scans\n56: 197 scans\n58: 1929 scans\n6:  5448 scans\n6.5:    5127 scans\n60: 1839 scans\n69: 1790 scans\n7:  18 scans\n9:  3563 scans\n9.5:    7055 scans\nCAL1:   3466 scans\nCAL5:   6954 scans\nCH2:    1832 scans\nNANCY:  8895 scans\n\n\n\n\nplotting scans for each cast in the first list\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # 1 is selecting only the first sublist\n  # print(i)\n  print(glue(\"=== station: {cast@metadata$station[1]}\"))\n  print(glue(\"# scans: {length(cast@data$scan)}\"))\n  plotScan(cast)\n}\n\n\n=== station: 1\n# scans: 2127\n\n\n\n\n\n\n\n\n\n=== station: 10\n# scans: 19\n\n\n\n\n\n\n\n\n\n=== station: 12\n# scans: 4418\n\n\n\n\n\n\n\n\n\n=== station: 16\n# scans: 1624\n\n\n\n\n\n\n\n\n\n=== station: 17\n# scans: 1431\n\n\n\n\n\n\n\n\n\n=== station: 18\n# scans: 2084\n\n\n\n\n\n\n\n\n\n=== station: 19\n# scans: 6\n\n\n\n\n\n\n\n\n\n=== station: 21\n# scans: 2731\n\n\n\n\n\n\n\n\n\n=== station: 22.5\n# scans: 8062\n\n\n\n\n\n\n\n\n\n=== station: 23\n# scans: 3173\n\n\n\n\n\n\n\n\n\n=== station: 24\n# scans: 2417\n\n\n\n\n\n\n\n\n\n=== station: 3\n# scans: 4410\n\n\n\n\n\n\n\n\n\n=== station: 31\n# scans: 4324\n\n\n\n\n\n\n\n\n\n=== station: 34\n# scans: 2245\n\n\n\n\n\n\n\n\n\n=== station: 39\n# scans: 48\n\n\n\n\n\n\n\n\n\n=== station: 42\n# scans: 3289\n\n\n\n\n\n\n\n\n\n=== station: 49\n# scans: 100\n\n\n\n\n\n\n\n\n\n=== station: 5\n# scans: 2709\n\n\n\n\n\n\n\n\n\n=== station: 50\n# scans: 19\n\n\n\n\n\n\n\n\n\n=== station: 53\n# scans: 520\n\n\n\n\n\n\n\n\n\n=== station: 55\n# scans: 79\n\n\n\n\n\n\n\n\n\n=== station: 56\n# scans: 197\n\n\n\n\n\n\n\n\n\n=== station: 58\n# scans: 1929\n\n\n\n\n\n\n\n\n\n=== station: 6\n# scans: 5448\n\n\n\n\n\n\n\n\n\n=== station: 6.5\n# scans: 5127\n\n\n\n\n\n\n\n\n\n=== station: 60\n# scans: 1839\n\n\n\n\n\n\n\n\n\n=== station: 69\n# scans: 1790\n\n\n\n\n\n\n\n\n\n=== station: 7\n# scans: 18\n\n\n\n\n\n\n\n\n\n=== station: 9\n# scans: 3563\n\n\n\n\n\n\n\n\n\n=== station: 9.5\n# scans: 7055\n\n\n\n\n\n\n\n\n\n=== station: CAL1\n# scans: 3466\n\n\n\n\n\n\n\n\n\n=== station: CAL5\n# scans: 6954\n\n\n\n\n\n\n\n\n\n=== station: CH2\n# scans: 1832\n\n\n\n\n\n\n\n\n\n=== station: NANCY\n# scans: 8895\n\n\n\n\n\n\n\n\n\n\n\nplotting each cast in the first list\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # 1 is selecting only the first sublist\n  tryCatch({\n    plot(ctdDecimate(ctdTrim(cast)))\n  }, error = function(e){\n    print(e)\n  })\n}\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2127' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4418' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1624' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1431' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2084' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 6' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2731' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 8062' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3173' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2417' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4410' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4324' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2245' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 48' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3289' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 100' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2709' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 197' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1929' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 5448' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 5127' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1839' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1790' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3563' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 7055' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3466' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 6954' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1832' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 8895' in coercion to 'logical(1)'&gt;\n\n\n\n\nplotting other physical parameters for each cast\n# Loop through each CTD cast\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # Assuming each sublist contains only one relevant CTD object\n  tryCatch({\n    # Extract metadata for station name and cruise ID\n    station_name &lt;- cast@metadata$station[1]\n    cruise_id &lt;- cast@data$cruise_id[1]\n\n    # Generate a title with station name and cruise ID\n    overall_title &lt;- glue::glue(\"Station: {station_name}, Cruise ID: {cruise_id}\")\n\n    # Set margins: increase the outer margin for the title\n    par(oma = c(0, 0, 3, 0))  # Top outer margin increased for title\n\n    # Plotting function with specific parameters\n    oce::plot(\n      x = ctdDecimate(ctdTrim(cast)),\n      which = c(\n        \"sea_water_electrical_conductivity\",\n        \"descent_rate\", \"sound_velocity\",\n        \"sea_water_sigma_t\",\"altimeter\"\n      ),\n      main = \"\"  # No main title for individual subplots\n    )\n\n    # Place a single overall title at the top of the plot frame\n    mtext(overall_title, side = 3, line = 1, outer = TRUE, cex = 1.5)\n\n    # Reset outer margins to default\n    par(oma = c(0, 0, 0, 0))\n\n  }, error = function(e) {\n    print(e$message)  # Print any errors that occur during plotting\n  })\n}\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"unknown xtype value (\\\"5.780971\\\")\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n\n\nplotting other nutrient parameters for each cast\n# Loop through each CTD cast\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # Assuming each sublist contains only one relevant CTD object\n  tryCatch({\n    # Extract metadata for station name and cruise ID\n    station_name &lt;- cast@metadata$station[1]\n    cruise_id &lt;- cast@data$cruise_id[1]\n\n    # Generate a title with station name and cruise ID\n    overall_title &lt;- glue::glue(\"Station: {station_name}, Cruise ID: {cruise_id}\")\n\n    # Set margins: increase the outer margin for the title\n    par(oma = c(0, 0, 3, 0))  # Top outer margin increased for title\n\n    # Plotting function with specific parameters\n    oce::plot(\n      x = ctdDecimate(ctdTrim(cast)),\n      which = c(\n        \"CDOM\", \"dissolved_oxygen\",\n        \"oxygen_saturation\",\n        \"chlorophyll_concentration\", \"chlorophyll_fluorescence\"\n      ),\n      main = \"\"  # No main title for individual subplots\n    )\n\n    # Place a single overall title at the top of the plot frame\n    mtext(overall_title, side = 3, line = 1, outer = TRUE, cex = 1.5)\n\n    # Reset outer margins to default\n    par(oma = c(0, 0, 0, 0))\n\n  }, error = function(e) {\n    print(e$message)  # Print any errors that occur during plotting\n  })\n}\n\n\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"plot.new has not been called yet\"\n[1] \"plot.new has not been called yet\"\n[1] \"plot.new has not been called yet\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n\n\n\n\nplotting other optical parameters for each cast\n# Loop through each CTD cast\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # Assuming each sublist contains only one relevant CTD object\n  tryCatch({\n    # Extract metadata for station name and cruise ID\n    station_name &lt;- cast@metadata$station[1]\n    cruise_id &lt;- cast@data$cruise_id[1]\n\n    # Generate a title with station name and cruise ID\n    overall_title &lt;- glue::glue(\"Station: {station_name}, Cruise ID: {cruise_id}\")\n\n    # Set margins: increase the outer margin for the title\n    par(oma = c(0, 0, 3, 0))  # Top outer margin increased for title\n\n    # Plotting function with specific parameters\n    oce::plot(\n      x = ctdDecimate(ctdTrim(cast)),\n      which = c(\n        \"photosynthetically_available_radiation\",\n        \"beam_attenuation\",\"beam_transmission\"\n      ),\n      main = \"\"  # No main title for individual subplots\n    )\n\n    # Place a single overall title at the top of the plot frame\n    mtext(overall_title, side = 3, line = 1, outer = TRUE, cex = 1.5)\n\n    # Reset outer margins to default\n    par(oma = c(0, 0, 0, 0))\n\n  }, error = function(e) {\n    print(e$message)  # Print any errors that occur during plotting\n  })\n}\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"unknown xtype value (\\\"0.37876\\\")\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n\n\nloop through every cast, clean, & save\ncombined_df &lt;- data.frame()\nfor (i in seq(ctd_FK)){\n  tryCatch({\n    cast &lt;- ctd_FK[[i]]  # 1 is selecting only the first sublist\n    \n    # print(class(cast))\n    # clean cast \n    trimmed_cast &lt;- ctdTrim(cast)\n    decimated_cast &lt;- ctdDecimate(trimmed_cast, p = 0.5)  # binned to 0.5 m\n    \n    # convert to df\n    cast_df &lt;- as.data.frame(decimated_cast@data)\n    \n    # Add metadata\n    # assumes station ID and cruise ID the same for all & just uses 1st one\n    cast_df &lt;- mutate(\n      cast_df,\n      station = cast@data$station[1],\n      cruise_id = cast@data$cruise_id[1]\n    )\n  \n    # drop NA rows left by cleaning\n    cast_df &lt;- subset(cast_df, !is.na(scan))\n    \n    # Append the data to the combined dataframe\n    combined_df &lt;- rbind(combined_df, cast_df)\n  }, error = function(e){\n    print(glue(\"error in cast {cast@metadata$station[1]}\"))\n    print(e)\n  })\n}\n# Save to CSV\nfile_path &lt;- here(glue(\"data/cleaned/{cruise_id}.csv\"))\nwrite.csv(combined_df, file_path, row.names = FALSE)"
  },
  {
    "objectID": "cruise_report/cruise_reports/WS1004.html",
    "href": "cruise_report/cruise_reports/WS1004.html",
    "title": "WS1004",
    "section": "",
    "text": "WS1004\n\n\nsetup\nif (!nzchar(system.file(package = \"librarian\"))) {\n  install.packages(\"librarian\")\n}\n\nlibrarian::shelf(\n  quiet = TRUE,\n  readr, here, fs, ggplot2, glue, \"jiho/castr\", dplyr, oce, patchwork, purrr, tidyr\n)\n\n\n\n\nCode\nsource(here(\"R/cruise_load.R\"))\ncruise_df &lt;- cruise_load(params$cruise_id)\n\n\n\n\nplot depth & pressure vs time elapsed\ntryCatch({\n  plots &lt;- list()\n  \n  for (station_name in unique(cruise_df$station)) {\n    subset_df &lt;- filter(cruise_df, station == station_name)\n    plots[[station_name]] &lt;- ggplot(subset_df, aes(x = time_elapsed)) +\n      geom_point(aes(y = depth), color = \"blue\") +  # Plot depth in blue\n      geom_line(aes(y = sea_water_pressure), color = \"red\") +  # Plot sea water pressure in red\n      ggtitle(glue(\"{station_name}\")) +\n      theme(\n        axis.title.x = element_blank(),\n        axis.title.y = element_blank(),\n        axis.text.x = element_blank(),\n        axis.text.y = element_blank(),\n        axis.ticks.x = element_blank(),\n        axis.ticks.y = element_blank()\n      )  # Remove individual axis titles and text\n  }\n  \n  # drop nulls\n  plots &lt;- purrr::compact(plots)\n  \n  # Combine all plots into a grid\n  combined_plot &lt;- wrap_plots(plots) + \n    plot_layout(ncol = 4) +  # Adjust ncol to set number of columns in the grid\n    plot_annotation(\n      title = \"Depth (blue) and Pressure (red)\",\n      subtitle = \"Each panel represents a different station\",\n      caption = \"Time Elapsed (x-axis) vs Depth & Pressure (y-axis)\"\n    ) +\n    theme(\n      plot.tag = element_text(size = 12, face = \"bold\"),\n      plot.tag.position = \"topleft\",\n      axis.title.x = element_text(margin = margin(t = 10)),\n      axis.title.y = element_text(margin = margin(r = 10))\n    )\n  \n  print(combined_plot)\n}, error = function(er){\n  print(er)\n});\n\n\n`geom_line()`: Each group consists of only one observation.\n Do you need to adjust the group aesthetic?\n\n\n\n\n\n\n\n\n\n\n\nplot across all stations\np &lt;- ggplot(cruise_df, aes(x = time, y = depth, fill = station)) +\n  geom_col() +  # This creates the bars\n  # geom_text(aes(label = station), vjust = -0.3) +  # This adds labels to each bar, adjust vjust for position\n  labs(x = \"Time\", y = \"Depth\", title = \"Depth over Time by Station\") +  # Set labels and title\n  theme_minimal()  # Use a minimal theme\nprint(p)\n\n\n\n\n\n\n\n\n\n\n\ncreate oce.ctd objects from dataframes\nctd_load &lt;- function(data, other_params = NULL) {\n  \n  # create csv into ctd object\n  test_ctd &lt;-\n    as.ctd(\n      salinity    = data$sea_water_salinity,\n      temperature = data$sea_water_temperature,\n      pressure    = data$sea_water_pressure,\n      station     = data$station\n    )\n  \n  # add additional columns to ctd object\n  if (!is.null(other_params)) {\n    for (param_name in other_params) {\n      test_ctd &lt;-\n        oceSetData(\n          object = test_ctd,\n          name   = param_name,\n          value  = data[[param_name]]\n        )\n    }\n  }\n  print(glue(\"{data$station[1]}:\\t{length(test_ctd@data$scan)} scans\"))\n\n\n  return(test_ctd)\n}\n\n# Define other parameters to add\nother_params &lt;- c(\n  \"cruise_id\", \"station\", \"time\", \"time_elapsed\", \n  \"latitude\", \"longitude\", \"sea_water_electrical_conductivity\", \n  \"CDOM\", \"dissolved_oxygen\",\"oxygen_saturation\", \"chlorophyll_concentration\", \n  \"chlorophyll_fluorescence\", \"photosynthetically_available_radiation\", \n  \"beam_attenuation\",\"beam_transmission\", \"depth\", \"sea_water_sigma_t\",\n  \"descent_rate\", \"sound_velocity\",\"altimeter\"\n)\n\n# Split data by station and create data list\nctd_FK &lt;- cruise_df %&gt;%\n  split(.$station) %&gt;%\n  map(~ ctd_load(.x, other_params = other_params)) # ~ is a lambda(x)\n\n\n1:  6581 scans\n10: 4302 scans\n12: 7041 scans\n16: 187 scans\n17: 2231 scans\n18: 3483 scans\n19: 255 scans\n21: 3472 scans\n21.5:   1569 scans\n22.5:   17710 scans\n23: 4118 scans\n24: 2876 scans\n3:  10594 scans\n31: 3718 scans\n34: 2213 scans\n39: 2548 scans\n42: 3613 scans\n45: 3787 scans\n49: 2974 scans\n5:  3823 scans\n50: 2372 scans\n53: 1027 scans\n54: 155 scans\n56: 1 scans\n58: 1486 scans\n6:  7595 scans\n6.5:    6463 scans\n60: 747 scans\n68: 2274 scans\n69: 2464 scans\n7:  3183 scans\n9:  7683 scans\n9.5:    9404 scans\nCAL1:   2 scans\nCAL5:   2688 scans\nCH2:    1182 scans\nCH5:    3414 scans\n\n\n\n\nplotting scans for each cast in the first list\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # 1 is selecting only the first sublist\n  # print(i)\n  print(glue(\"=== station: {cast@metadata$station[1]}\"))\n  print(glue(\"# scans: {length(cast@data$scan)}\"))\n  plotScan(cast)\n}\n\n\n=== station: 1\n# scans: 6581\n\n\n\n\n\n\n\n\n\n=== station: 10\n# scans: 4302\n\n\n\n\n\n\n\n\n\n=== station: 12\n# scans: 7041\n\n\n\n\n\n\n\n\n\n=== station: 16\n# scans: 187\n\n\n\n\n\n\n\n\n\n=== station: 17\n# scans: 2231\n\n\n\n\n\n\n\n\n\n=== station: 18\n# scans: 3483\n\n\n\n\n\n\n\n\n\n=== station: 19\n# scans: 255\n\n\n\n\n\n\n\n\n\n=== station: 21\n# scans: 3472\n\n\n\n\n\n\n\n\n\n=== station: 21.5\n# scans: 1569\n\n\n\n\n\n\n\n\n\n=== station: 22.5\n# scans: 17710\n\n\n\n\n\n\n\n\n\n=== station: 23\n# scans: 4118\n\n\n\n\n\n\n\n\n\n=== station: 24\n# scans: 2876\n\n\n\n\n\n\n\n\n\n=== station: 3\n# scans: 10594\n\n\n\n\n\n\n\n\n\n=== station: 31\n# scans: 3718\n\n\n\n\n\n\n\n\n\n=== station: 34\n# scans: 2213\n\n\n\n\n\n\n\n\n\n=== station: 39\n# scans: 2548\n\n\n\n\n\n\n\n\n\n=== station: 42\n# scans: 3613\n\n\n\n\n\n\n\n\n\n=== station: 45\n# scans: 3787\n\n\n\n\n\n\n\n\n\n=== station: 49\n# scans: 2974\n\n\n\n\n\n\n\n\n\n=== station: 5\n# scans: 3823\n\n\n\n\n\n\n\n\n\n=== station: 50\n# scans: 2372\n\n\n\n\n\n\n\n\n\n=== station: 53\n# scans: 1027\n\n\n\n\n\n\n\n\n\n=== station: 54\n# scans: 155\n\n\n\n\n\n\n\n\n\n=== station: 56\n# scans: 1\n\n\n\n\n\n\n\n\n\n=== station: 58\n# scans: 1486\n\n\n\n\n\n\n\n\n\n=== station: 6\n# scans: 7595\n\n\n\n\n\n\n\n\n\n=== station: 6.5\n# scans: 6463\n\n\n\n\n\n\n\n\n\n=== station: 60\n# scans: 747\n\n\n\n\n\n\n\n\n\n=== station: 68\n# scans: 2274\n\n\n\n\n\n\n\n\n\n=== station: 69\n# scans: 2464\n\n\n\n\n\n\n\n\n\n=== station: 7\n# scans: 3183\n\n\n\n\n\n\n\n\n\n=== station: 9\n# scans: 7683\n\n\n\n\n\n\n\n\n\n=== station: 9.5\n# scans: 9404\n\n\n\n\n\n\n\n\n\n=== station: CAL1\n# scans: 2\n\n\n\n\n\n\n\n\n\n=== station: CAL5\n# scans: 2688\n\n\n\n\n\n\n\n\n\n=== station: CH2\n# scans: 1182\n\n\n\n\n\n\n\n\n\n=== station: CH5\n# scans: 3414\n\n\n\n\n\n\n\n\n\n\n\nplotting each cast in the first list\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # 1 is selecting only the first sublist\n  tryCatch({\n    plot(ctdDecimate(ctdTrim(cast)))\n  }, error = function(e){\n    print(e)\n  })\n}\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 6581' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4302' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 7041' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 187' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2231' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3483' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 255' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3472' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1569' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 17710' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4118' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2876' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 10594' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3718' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2213' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2548' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3613' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3787' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2974' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3823' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2372' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1027' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1486' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 7595' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 6463' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 747' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2274' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2464' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3183' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 7683' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 9404' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2688' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1182' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3414' in coercion to 'logical(1)'&gt;\n\n\n\n\nplotting other physical parameters for each cast\n# Loop through each CTD cast\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # Assuming each sublist contains only one relevant CTD object\n  tryCatch({\n    # Extract metadata for station name and cruise ID\n    station_name &lt;- cast@metadata$station[1]\n    cruise_id &lt;- cast@data$cruise_id[1]\n\n    # Generate a title with station name and cruise ID\n    overall_title &lt;- glue::glue(\"Station: {station_name}, Cruise ID: {cruise_id}\")\n\n    # Set margins: increase the outer margin for the title\n    par(oma = c(0, 0, 3, 0))  # Top outer margin increased for title\n\n    # Plotting function with specific parameters\n    oce::plot(\n      x = ctdDecimate(ctdTrim(cast)),\n      which = c(\n        \"sea_water_electrical_conductivity\",\n        \"descent_rate\", \"sound_velocity\",\n        \"sea_water_sigma_t\",\"altimeter\"\n      ),\n      main = \"\"  # No main title for individual subplots\n    )\n\n    # Place a single overall title at the top of the plot frame\n    mtext(overall_title, side = 3, line = 1, outer = TRUE, cex = 1.5)\n\n    # Reset outer margins to default\n    par(oma = c(0, 0, 0, 0))\n\n  }, error = function(e) {\n    print(e$message)  # Print any errors that occur during plotting\n  })\n}\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n[1] \"unknown xtype value (\\\"4.530787\\\")\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n\n\nplotting other nutrient parameters for each cast\n# Loop through each CTD cast\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # Assuming each sublist contains only one relevant CTD object\n  tryCatch({\n    # Extract metadata for station name and cruise ID\n    station_name &lt;- cast@metadata$station[1]\n    cruise_id &lt;- cast@data$cruise_id[1]\n\n    # Generate a title with station name and cruise ID\n    overall_title &lt;- glue::glue(\"Station: {station_name}, Cruise ID: {cruise_id}\")\n\n    # Set margins: increase the outer margin for the title\n    par(oma = c(0, 0, 3, 0))  # Top outer margin increased for title\n\n    # Plotting function with specific parameters\n    oce::plot(\n      x = ctdDecimate(ctdTrim(cast)),\n      which = c(\n        \"CDOM\", \"dissolved_oxygen\",\n        \"oxygen_saturation\",\n        \"chlorophyll_concentration\", \"chlorophyll_fluorescence\"\n      ),\n      main = \"\"  # No main title for individual subplots\n    )\n\n    # Place a single overall title at the top of the plot frame\n    mtext(overall_title, side = 3, line = 1, outer = TRUE, cex = 1.5)\n\n    # Reset outer margins to default\n    par(oma = c(0, 0, 0, 0))\n\n  }, error = function(e) {\n    print(e$message)  # Print any errors that occur during plotting\n  })\n}\n\n\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"plot.new has not been called yet\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n\n\n\n\nplotting other optical parameters for each cast\n# Loop through each CTD cast\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # Assuming each sublist contains only one relevant CTD object\n  tryCatch({\n    # Extract metadata for station name and cruise ID\n    station_name &lt;- cast@metadata$station[1]\n    cruise_id &lt;- cast@data$cruise_id[1]\n\n    # Generate a title with station name and cruise ID\n    overall_title &lt;- glue::glue(\"Station: {station_name}, Cruise ID: {cruise_id}\")\n\n    # Set margins: increase the outer margin for the title\n    par(oma = c(0, 0, 3, 0))  # Top outer margin increased for title\n\n    # Plotting function with specific parameters\n    oce::plot(\n      x = ctdDecimate(ctdTrim(cast)),\n      which = c(\n        \"photosynthetically_available_radiation\",\n        \"beam_attenuation\",\"beam_transmission\"\n      ),\n      main = \"\"  # No main title for individual subplots\n    )\n\n    # Place a single overall title at the top of the plot frame\n    mtext(overall_title, side = 3, line = 1, outer = TRUE, cex = 1.5)\n\n    # Reset outer margins to default\n    par(oma = c(0, 0, 0, 0))\n\n  }, error = function(e) {\n    print(e$message)  # Print any errors that occur during plotting\n  })\n}\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n[1] \"unknown xtype value (\\\"0.85895\\\")\"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nloop through every cast, clean, & save\ncombined_df &lt;- data.frame()\nfor (i in seq(ctd_FK)){\n  tryCatch({\n    cast &lt;- ctd_FK[[i]]  # 1 is selecting only the first sublist\n    \n    # print(class(cast))\n    # clean cast \n    trimmed_cast &lt;- ctdTrim(cast)\n    decimated_cast &lt;- ctdDecimate(trimmed_cast, p = 0.5)  # binned to 0.5 m\n    \n    # convert to df\n    cast_df &lt;- as.data.frame(decimated_cast@data)\n    \n    # Add metadata\n    # assumes station ID and cruise ID the same for all & just uses 1st one\n    cast_df &lt;- mutate(\n      cast_df,\n      station = cast@data$station[1],\n      cruise_id = cast@data$cruise_id[1]\n    )\n  \n    # drop NA rows left by cleaning\n    cast_df &lt;- subset(cast_df, !is.na(scan))\n    \n    # Append the data to the combined dataframe\n    combined_df &lt;- rbind(combined_df, cast_df)\n  }, error = function(e){\n    print(glue(\"error in cast {cast@metadata$station[1]}\"))\n    print(e)\n  })\n}\n# Save to CSV\nfile_path &lt;- here(glue(\"data/cleaned/{cruise_id}.csv\"))\nwrite.csv(combined_df, file_path, row.names = FALSE)"
  },
  {
    "objectID": "cruise_report/cruise_reports/WS1015.html",
    "href": "cruise_report/cruise_reports/WS1015.html",
    "title": "WS1015",
    "section": "",
    "text": "WS1015\n\n\nsetup\nif (!nzchar(system.file(package = \"librarian\"))) {\n  install.packages(\"librarian\")\n}\n\nlibrarian::shelf(\n  quiet = TRUE,\n  readr, here, fs, ggplot2, glue, \"jiho/castr\", dplyr, oce, patchwork, purrr, tidyr\n)\n\n\n\n\nCode\nsource(here(\"R/cruise_load.R\"))\ncruise_df &lt;- cruise_load(params$cruise_id)\n\n\nWarning: One or more parsing issues, call `problems()` on your data frame for details,\ne.g.:\n  dat &lt;- vroom(...)\n  problems(dat)\n\n\n\n\nplot depth & pressure vs time elapsed\ntryCatch({\n  plots &lt;- list()\n  \n  for (station_name in unique(cruise_df$station)) {\n    subset_df &lt;- filter(cruise_df, station == station_name)\n    plots[[station_name]] &lt;- ggplot(subset_df, aes(x = time_elapsed)) +\n      geom_point(aes(y = depth), color = \"blue\") +  # Plot depth in blue\n      geom_line(aes(y = sea_water_pressure), color = \"red\") +  # Plot sea water pressure in red\n      ggtitle(glue(\"{station_name}\")) +\n      theme(\n        axis.title.x = element_blank(),\n        axis.title.y = element_blank(),\n        axis.text.x = element_blank(),\n        axis.text.y = element_blank(),\n        axis.ticks.x = element_blank(),\n        axis.ticks.y = element_blank()\n      )  # Remove individual axis titles and text\n  }\n  \n  # drop nulls\n  plots &lt;- purrr::compact(plots)\n  \n  # Combine all plots into a grid\n  combined_plot &lt;- wrap_plots(plots) + \n    plot_layout(ncol = 4) +  # Adjust ncol to set number of columns in the grid\n    plot_annotation(\n      title = \"Depth (blue) and Pressure (red)\",\n      subtitle = \"Each panel represents a different station\",\n      caption = \"Time Elapsed (x-axis) vs Depth & Pressure (y-axis)\"\n    ) +\n    theme(\n      plot.tag = element_text(size = 12, face = \"bold\"),\n      plot.tag.position = \"topleft\",\n      axis.title.x = element_text(margin = margin(t = 10)),\n      axis.title.y = element_text(margin = margin(r = 10))\n    )\n  \n  print(combined_plot)\n}, error = function(er){\n  print(er)\n});\n\n\n\n\n\n\n\n\n\n\n\nplot across all stations\np &lt;- ggplot(cruise_df, aes(x = time, y = depth, fill = station)) +\n  geom_col() +  # This creates the bars\n  # geom_text(aes(label = station), vjust = -0.3) +  # This adds labels to each bar, adjust vjust for position\n  labs(x = \"Time\", y = \"Depth\", title = \"Depth over Time by Station\") +  # Set labels and title\n  theme_minimal()  # Use a minimal theme\nprint(p)\n\n\n\n\n\n\n\n\n\n\n\ncreate oce.ctd objects from dataframes\nctd_load &lt;- function(data, other_params = NULL) {\n  \n  # create csv into ctd object\n  test_ctd &lt;-\n    as.ctd(\n      salinity    = data$sea_water_salinity,\n      temperature = data$sea_water_temperature,\n      pressure    = data$sea_water_pressure,\n      station     = data$station\n    )\n  \n  # add additional columns to ctd object\n  if (!is.null(other_params)) {\n    for (param_name in other_params) {\n      test_ctd &lt;-\n        oceSetData(\n          object = test_ctd,\n          name   = param_name,\n          value  = data[[param_name]]\n        )\n    }\n  }\n  print(glue(\"{data$station[1]}:\\t{length(test_ctd@data$scan)} scans\"))\n\n\n  return(test_ctd)\n}\n\n# Define other parameters to add\nother_params &lt;- c(\n  \"cruise_id\", \"station\", \"time\", \"time_elapsed\", \n  \"latitude\", \"longitude\", \"sea_water_electrical_conductivity\", \n  \"CDOM\", \"dissolved_oxygen\",\"oxygen_saturation\", \"chlorophyll_concentration\", \n  \"chlorophyll_fluorescence\", \"photosynthetically_available_radiation\", \n  \"beam_attenuation\",\"beam_transmission\", \"depth\", \"sea_water_sigma_t\",\n  \"descent_rate\", \"sound_velocity\",\"altimeter\"\n)\n\n# Split data by station and create data list\nctd_FK &lt;- cruise_df %&gt;%\n  split(.$station) %&gt;%\n  map(~ ctd_load(.x, other_params = other_params)) # ~ is a lambda(x)\n\n\n1:  5369 scans\n10: 1998 scans\n11: 1886 scans\n12: 2960 scans\n13: 1628 scans\n15: 4617 scans\n15.5:   7497 scans\n16: 2304 scans\n17: 2897 scans\n18: 2380 scans\n19: 31 scans\n1B: 197 scans\n20: 1116 scans\n21: 3994 scans\n21.5:   6540 scans\n22: 1917 scans\n22.5:   6711 scans\n23: 797 scans\n24: 706 scans\n3:  6512 scans\n31: 3241 scans\n32: 2364 scans\n34: 2374 scans\n39: 2161 scans\n4:  37 scans\n41: 2731 scans\n42: 2783 scans\n45: 2915 scans\n49: 2591 scans\n5:  37 scans\n50: 918 scans\n53: 51 scans\n54: 750 scans\n56: 431 scans\n58: 914 scans\n59: 925 scans\n6:  3301 scans\n6.5:    6410 scans\n60: 549 scans\n68: 2590 scans\n69: 2707 scans\n7:  2499 scans\n8:  2763 scans\n9.5:    6010 scans\nCAL1:   105 scans\nCAL3:   1018 scans\nCAL4:   2181 scans\nCAL5:   1614 scans\nCH2:    1358 scans\nCH3:    1849 scans\nCH4:    2109 scans\nCH5:    4380 scans\n\n\n\n\nplotting scans for each cast in the first list\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # 1 is selecting only the first sublist\n  # print(i)\n  print(glue(\"=== station: {cast@metadata$station[1]}\"))\n  print(glue(\"# scans: {length(cast@data$scan)}\"))\n  plotScan(cast)\n}\n\n\n=== station: 1\n# scans: 5369\n\n\n\n\n\n\n\n\n\n=== station: 10\n# scans: 1998\n\n\n\n\n\n\n\n\n\n=== station: 11\n# scans: 1886\n\n\n\n\n\n\n\n\n\n=== station: 12\n# scans: 2960\n\n\n\n\n\n\n\n\n\n=== station: 13\n# scans: 1628\n\n\n\n\n\n\n\n\n\n=== station: 15\n# scans: 4617\n\n\n\n\n\n\n\n\n\n=== station: 15.5\n# scans: 7497\n\n\n\n\n\n\n\n\n\n=== station: 16\n# scans: 2304\n\n\n\n\n\n\n\n\n\n=== station: 17\n# scans: 2897\n\n\n\n\n\n\n\n\n\n=== station: 18\n# scans: 2380\n\n\n\n\n\n\n\n\n\n=== station: 19\n# scans: 31\n\n\n\n\n\n\n\n\n\n=== station: 1B\n# scans: 197\n\n\n\n\n\n\n\n\n\n=== station: 20\n# scans: 1116\n\n\n\n\n\n\n\n\n\n=== station: 21\n# scans: 3994\n\n\n\n\n\n\n\n\n\n=== station: 21.5\n# scans: 6540\n\n\n\n\n\n\n\n\n\n=== station: 22\n# scans: 1917\n\n\n\n\n\n\n\n\n\n=== station: 22.5\n# scans: 6711\n\n\n\n\n\n\n\n\n\n=== station: 23\n# scans: 797\n\n\n\n\n\n\n\n\n\n=== station: 24\n# scans: 706\n\n\n\n\n\n\n\n\n\n=== station: 3\n# scans: 6512\n\n\n\n\n\n\n\n\n\n=== station: 31\n# scans: 3241\n\n\n\n\n\n\n\n\n\n=== station: 32\n# scans: 2364\n\n\n\n\n\n\n\n\n\n=== station: 34\n# scans: 2374\n\n\n\n\n\n\n\n\n\n=== station: 39\n# scans: 2161\n\n\n\n\n\n\n\n\n\n=== station: 4\n# scans: 37\n\n\n\n\n\n\n\n\n\n=== station: 41\n# scans: 2731\n\n\n\n\n\n\n\n\n\n=== station: 42\n# scans: 2783\n\n\n\n\n\n\n\n\n\n=== station: 45\n# scans: 2915\n\n\n\n\n\n\n\n\n\n=== station: 49\n# scans: 2591\n\n\n\n\n\n\n\n\n\n=== station: 5\n# scans: 37\n\n\n\n\n\n\n\n\n\n=== station: 50\n# scans: 918\n\n\n\n\n\n\n\n\n\n=== station: 53\n# scans: 51\n\n\n\n\n\n\n\n\n\n=== station: 54\n# scans: 750\n\n\n\n\n\n\n\n\n\n=== station: 56\n# scans: 431\n\n\n\n\n\n\n\n\n\n=== station: 58\n# scans: 914\n\n\n\n\n\n\n\n\n\n=== station: 59\n# scans: 925\n\n\n\n\n\n\n\n\n\n=== station: 6\n# scans: 3301\n\n\n\n\n\n\n\n\n\n=== station: 6.5\n# scans: 6410\n\n\n\n\n\n\n\n\n\n=== station: 60\n# scans: 549\n\n\n\n\n\n\n\n\n\n=== station: 68\n# scans: 2590\n\n\n\n\n\n\n\n\n\n=== station: 69\n# scans: 2707\n\n\n\n\n\n\n\n\n\n=== station: 7\n# scans: 2499\n\n\n\n\n\n\n\n\n\n=== station: 8\n# scans: 2763\n\n\n\n\n\n\n\n\n\n=== station: 9.5\n# scans: 6010\n\n\n\n\n\n\n\n\n\n=== station: CAL1\n# scans: 105\n\n\n\n\n\n\n\n\n\n=== station: CAL3\n# scans: 1018\n\n\n\n\n\n\n\n\n\n=== station: CAL4\n# scans: 2181\n\n\n\n\n\n\n\n\n\n=== station: CAL5\n# scans: 1614\n\n\n\n\n\n\n\n\n\n=== station: CH2\n# scans: 1358\n\n\n\n\n\n\n\n\n\n=== station: CH3\n# scans: 1849\n\n\n\n\n\n\n\n\n\n=== station: CH4\n# scans: 2109\n\n\n\n\n\n\n\n\n\n=== station: CH5\n# scans: 4380\n\n\n\n\n\n\n\n\n\n\n\nplotting each cast in the first list\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # 1 is selecting only the first sublist\n  tryCatch({\n    plot(ctdDecimate(ctdTrim(cast)))\n  }, error = function(e){\n    print(e)\n  })\n}\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 5369' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1998' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1886' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2960' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1628' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4617' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 7497' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2304' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2897' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2380' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 31' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 197' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1116' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3994' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 6540' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1917' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 6711' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 797' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 706' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 6512' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3241' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2364' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2374' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2161' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 37' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2731' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2783' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2915' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2591' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 918' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 51' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 750' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 431' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 914' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 925' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3301' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 6410' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 549' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2590' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2707' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2499' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2763' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 6010' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 105' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1018' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2181' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1614' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1358' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1849' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2109' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4380' in coercion to 'logical(1)'&gt;\n\n\n\n\nplotting other physical parameters for each cast\n# Loop through each CTD cast\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # Assuming each sublist contains only one relevant CTD object\n  tryCatch({\n    # Extract metadata for station name and cruise ID\n    station_name &lt;- cast@metadata$station[1]\n    cruise_id &lt;- cast@data$cruise_id[1]\n\n    # Generate a title with station name and cruise ID\n    overall_title &lt;- glue::glue(\"Station: {station_name}, Cruise ID: {cruise_id}\")\n\n    # Set margins: increase the outer margin for the title\n    par(oma = c(0, 0, 3, 0))  # Top outer margin increased for title\n\n    # Plotting function with specific parameters\n    oce::plot(\n      x = ctdDecimate(ctdTrim(cast)),\n      which = c(\n        \"sea_water_electrical_conductivity\",\n        \"descent_rate\", \"sound_velocity\",\n        \"sea_water_sigma_t\",\"altimeter\"\n      ),\n      main = \"\"  # No main title for individual subplots\n    )\n\n    # Place a single overall title at the top of the plot frame\n    mtext(overall_title, side = 3, line = 1, outer = TRUE, cex = 1.5)\n\n    # Reset outer margins to default\n    par(oma = c(0, 0, 0, 0))\n\n  }, error = function(e) {\n    print(e$message)  # Print any errors that occur during plotting\n  })\n}\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n\n\nplotting other nutrient parameters for each cast\n# Loop through each CTD cast\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # Assuming each sublist contains only one relevant CTD object\n  tryCatch({\n    # Extract metadata for station name and cruise ID\n    station_name &lt;- cast@metadata$station[1]\n    cruise_id &lt;- cast@data$cruise_id[1]\n\n    # Generate a title with station name and cruise ID\n    overall_title &lt;- glue::glue(\"Station: {station_name}, Cruise ID: {cruise_id}\")\n\n    # Set margins: increase the outer margin for the title\n    par(oma = c(0, 0, 3, 0))  # Top outer margin increased for title\n\n    # Plotting function with specific parameters\n    oce::plot(\n      x = ctdDecimate(ctdTrim(cast)),\n      which = c(\n        \"CDOM\", \"dissolved_oxygen\",\n        \"oxygen_saturation\",\n        \"chlorophyll_concentration\", \"chlorophyll_fluorescence\"\n      ),\n      main = \"\"  # No main title for individual subplots\n    )\n\n    # Place a single overall title at the top of the plot frame\n    mtext(overall_title, side = 3, line = 1, outer = TRUE, cex = 1.5)\n\n    # Reset outer margins to default\n    par(oma = c(0, 0, 0, 0))\n\n  }, error = function(e) {\n    print(e$message)  # Print any errors that occur during plotting\n  })\n}\n\n\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n\n\n\n\nplotting other optical parameters for each cast\n# Loop through each CTD cast\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # Assuming each sublist contains only one relevant CTD object\n  tryCatch({\n    # Extract metadata for station name and cruise ID\n    station_name &lt;- cast@metadata$station[1]\n    cruise_id &lt;- cast@data$cruise_id[1]\n\n    # Generate a title with station name and cruise ID\n    overall_title &lt;- glue::glue(\"Station: {station_name}, Cruise ID: {cruise_id}\")\n\n    # Set margins: increase the outer margin for the title\n    par(oma = c(0, 0, 3, 0))  # Top outer margin increased for title\n\n    # Plotting function with specific parameters\n    oce::plot(\n      x = ctdDecimate(ctdTrim(cast)),\n      which = c(\n        \"photosynthetically_available_radiation\",\n        \"beam_attenuation\",\"beam_transmission\"\n      ),\n      main = \"\"  # No main title for individual subplots\n    )\n\n    # Place a single overall title at the top of the plot frame\n    mtext(overall_title, side = 3, line = 1, outer = TRUE, cex = 1.5)\n\n    # Reset outer margins to default\n    par(oma = c(0, 0, 0, 0))\n\n  }, error = function(e) {\n    print(e$message)  # Print any errors that occur during plotting\n  })\n}\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n[1] \"need finite 'xlim' values\"\n\n\n\n\nloop through every cast, clean, & save\ncombined_df &lt;- data.frame()\nfor (i in seq(ctd_FK)){\n  tryCatch({\n    cast &lt;- ctd_FK[[i]]  # 1 is selecting only the first sublist\n    \n    # print(class(cast))\n    # clean cast \n    trimmed_cast &lt;- ctdTrim(cast)\n    decimated_cast &lt;- ctdDecimate(trimmed_cast, p = 0.5)  # binned to 0.5 m\n    \n    # convert to df\n    cast_df &lt;- as.data.frame(decimated_cast@data)\n    \n    # Add metadata\n    # assumes station ID and cruise ID the same for all & just uses 1st one\n    cast_df &lt;- mutate(\n      cast_df,\n      station = cast@data$station[1],\n      cruise_id = cast@data$cruise_id[1]\n    )\n  \n    # drop NA rows left by cleaning\n    cast_df &lt;- subset(cast_df, !is.na(scan))\n    \n    # Append the data to the combined dataframe\n    combined_df &lt;- rbind(combined_df, cast_df)\n  }, error = function(e){\n    print(glue(\"error in cast {cast@metadata$station[1]}\"))\n    print(e)\n  })\n}\n# Save to CSV\nfile_path &lt;- here(glue(\"data/cleaned/{cruise_id}.csv\"))\nwrite.csv(combined_df, file_path, row.names = FALSE)"
  },
  {
    "objectID": "cruise_report/cruise_reports/WS1102.html",
    "href": "cruise_report/cruise_reports/WS1102.html",
    "title": "WS1102",
    "section": "",
    "text": "WS1102\n\n\nsetup\nif (!nzchar(system.file(package = \"librarian\"))) {\n  install.packages(\"librarian\")\n}\n\nlibrarian::shelf(\n  quiet = TRUE,\n  readr, here, fs, ggplot2, glue, \"jiho/castr\", dplyr, oce, patchwork, purrr, tidyr\n)\n\n\n\n\nCode\nsource(here(\"R/cruise_load.R\"))\ncruise_df &lt;- cruise_load(params$cruise_id)\n\n\n\n\nplot depth & pressure vs time elapsed\ntryCatch({\n  plots &lt;- list()\n  \n  for (station_name in unique(cruise_df$station)) {\n    subset_df &lt;- filter(cruise_df, station == station_name)\n    plots[[station_name]] &lt;- ggplot(subset_df, aes(x = time_elapsed)) +\n      geom_point(aes(y = depth), color = \"blue\") +  # Plot depth in blue\n      geom_line(aes(y = sea_water_pressure), color = \"red\") +  # Plot sea water pressure in red\n      ggtitle(glue(\"{station_name}\")) +\n      theme(\n        axis.title.x = element_blank(),\n        axis.title.y = element_blank(),\n        axis.text.x = element_blank(),\n        axis.text.y = element_blank(),\n        axis.ticks.x = element_blank(),\n        axis.ticks.y = element_blank()\n      )  # Remove individual axis titles and text\n  }\n  \n  # drop nulls\n  plots &lt;- purrr::compact(plots)\n  \n  # Combine all plots into a grid\n  combined_plot &lt;- wrap_plots(plots) + \n    plot_layout(ncol = 4) +  # Adjust ncol to set number of columns in the grid\n    plot_annotation(\n      title = \"Depth (blue) and Pressure (red)\",\n      subtitle = \"Each panel represents a different station\",\n      caption = \"Time Elapsed (x-axis) vs Depth & Pressure (y-axis)\"\n    ) +\n    theme(\n      plot.tag = element_text(size = 12, face = \"bold\"),\n      plot.tag.position = \"topleft\",\n      axis.title.x = element_text(margin = margin(t = 10)),\n      axis.title.y = element_text(margin = margin(r = 10))\n    )\n  \n  print(combined_plot)\n}, error = function(er){\n  print(er)\n});\n\n\n\n\n\n\n\n\n\n\n\nplot across all stations\np &lt;- ggplot(cruise_df, aes(x = time, y = depth, fill = station)) +\n  geom_col() +  # This creates the bars\n  # geom_text(aes(label = station), vjust = -0.3) +  # This adds labels to each bar, adjust vjust for position\n  labs(x = \"Time\", y = \"Depth\", title = \"Depth over Time by Station\") +  # Set labels and title\n  theme_minimal()  # Use a minimal theme\nprint(p)\n\n\n\n\n\n\n\n\n\n\n\ncreate oce.ctd objects from dataframes\nctd_load &lt;- function(data, other_params = NULL) {\n  \n  # create csv into ctd object\n  test_ctd &lt;-\n    as.ctd(\n      salinity    = data$sea_water_salinity,\n      temperature = data$sea_water_temperature,\n      pressure    = data$sea_water_pressure,\n      station     = data$station\n    )\n  \n  # add additional columns to ctd object\n  if (!is.null(other_params)) {\n    for (param_name in other_params) {\n      test_ctd &lt;-\n        oceSetData(\n          object = test_ctd,\n          name   = param_name,\n          value  = data[[param_name]]\n        )\n    }\n  }\n  print(glue(\"{data$station[1]}:\\t{length(test_ctd@data$scan)} scans\"))\n\n\n  return(test_ctd)\n}\n\n# Define other parameters to add\nother_params &lt;- c(\n  \"cruise_id\", \"station\", \"time\", \"time_elapsed\", \n  \"latitude\", \"longitude\", \"sea_water_electrical_conductivity\", \n  \"CDOM\", \"dissolved_oxygen\",\"oxygen_saturation\", \"chlorophyll_concentration\", \n  \"chlorophyll_fluorescence\", \"photosynthetically_available_radiation\", \n  \"beam_attenuation\",\"beam_transmission\", \"depth\", \"sea_water_sigma_t\",\n  \"descent_rate\", \"sound_velocity\",\"altimeter\"\n)\n\n# Split data by station and create data list\nctd_FK &lt;- cruise_df %&gt;%\n  split(.$station) %&gt;%\n  map(~ ctd_load(.x, other_params = other_params)) # ~ is a lambda(x)\n\n\n1:  3269 scans\n16: 1622 scans\n17: 3069 scans\n18: 2063 scans\n19: 738 scans\n20: 1260 scans\n21.5:   5507 scans\n22.5:   4914 scans\n23: 1831 scans\n24: 3167 scans\n25.5:   13047 scans\n28: 1874 scans\n29.5:   2666 scans\n3:  7964 scans\n31: 2054 scans\n34: 1769 scans\n39: 2308 scans\n42: 1729 scans\n49: 1637 scans\n50: 1646 scans\n53: 1766 scans\n54: 611 scans\n56: 902 scans\n57: 605 scans\n59: 1528 scans\n6.5:    5481 scans\n60: 679 scans\n68: 1554 scans\n69: 1132 scans\n7:  1107 scans\n9:  2737 scans\n9.5:    10626 scans\nBLOOM:  7720 scans\nDT.9:   3518 scans\n\n\n\n\nplotting scans for each cast in the first list\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # 1 is selecting only the first sublist\n  # print(i)\n  print(glue(\"=== station: {cast@metadata$station[1]}\"))\n  print(glue(\"# scans: {length(cast@data$scan)}\"))\n  plotScan(cast)\n}\n\n\n=== station: 1\n# scans: 3269\n\n\n\n\n\n\n\n\n\n=== station: 16\n# scans: 1622\n\n\n\n\n\n\n\n\n\n=== station: 17\n# scans: 3069\n\n\n\n\n\n\n\n\n\n=== station: 18\n# scans: 2063\n\n\n\n\n\n\n\n\n\n=== station: 19\n# scans: 738\n\n\n\n\n\n\n\n\n\n=== station: 20\n# scans: 1260\n\n\n\n\n\n\n\n\n\n=== station: 21.5\n# scans: 5507\n\n\n\n\n\n\n\n\n\n=== station: 22.5\n# scans: 4914\n\n\n\n\n\n\n\n\n\n=== station: 23\n# scans: 1831\n\n\n\n\n\n\n\n\n\n=== station: 24\n# scans: 3167\n\n\n\n\n\n\n\n\n\n=== station: 25.5\n# scans: 13047\n\n\n\n\n\n\n\n\n\n=== station: 28\n# scans: 1874\n\n\n\n\n\n\n\n\n\n=== station: 29.5\n# scans: 2666\n\n\n\n\n\n\n\n\n\n=== station: 3\n# scans: 7964\n\n\n\n\n\n\n\n\n\n=== station: 31\n# scans: 2054\n\n\n\n\n\n\n\n\n\n=== station: 34\n# scans: 1769\n\n\n\n\n\n\n\n\n\n=== station: 39\n# scans: 2308\n\n\n\n\n\n\n\n\n\n=== station: 42\n# scans: 1729\n\n\n\n\n\n\n\n\n\n=== station: 49\n# scans: 1637\n\n\n\n\n\n\n\n\n\n=== station: 50\n# scans: 1646\n\n\n\n\n\n\n\n\n\n=== station: 53\n# scans: 1766\n\n\n\n\n\n\n\n\n\n=== station: 54\n# scans: 611\n\n\n\n\n\n\n\n\n\n=== station: 56\n# scans: 902\n\n\n\n\n\n\n\n\n\n=== station: 57\n# scans: 605\n\n\n\n\n\n\n\n\n\n=== station: 59\n# scans: 1528\n\n\n\n\n\n\n\n\n\n=== station: 6.5\n# scans: 5481\n\n\n\n\n\n\n\n\n\n=== station: 60\n# scans: 679\n\n\n\n\n\n\n\n\n\n=== station: 68\n# scans: 1554\n\n\n\n\n\n\n\n\n\n=== station: 69\n# scans: 1132\n\n\n\n\n\n\n\n\n\n=== station: 7\n# scans: 1107\n\n\n\n\n\n\n\n\n\n=== station: 9\n# scans: 2737\n\n\n\n\n\n\n\n\n\n=== station: 9.5\n# scans: 10626\n\n\n\n\n\n\n\n\n\n=== station: BLOOM\n# scans: 7720\n\n\n\n\n\n\n\n\n\n=== station: DT.9\n# scans: 3518\n\n\n\n\n\n\n\n\n\n\n\nplotting each cast in the first list\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # 1 is selecting only the first sublist\n  tryCatch({\n    plot(ctdDecimate(ctdTrim(cast)))\n  }, error = function(e){\n    print(e)\n  })\n}\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3269' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1622' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3069' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2063' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 738' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1260' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 5507' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4914' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1831' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3167' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 13047' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1874' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2666' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 7964' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2054' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1769' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2308' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1729' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1637' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1646' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1766' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 611' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 902' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 605' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1528' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 5481' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 679' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1554' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1132' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1107' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2737' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 10626' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 7720' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3518' in coercion to 'logical(1)'&gt;\n\n\n\n\nplotting other physical parameters for each cast\n# Loop through each CTD cast\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # Assuming each sublist contains only one relevant CTD object\n  tryCatch({\n    # Extract metadata for station name and cruise ID\n    station_name &lt;- cast@metadata$station[1]\n    cruise_id &lt;- cast@data$cruise_id[1]\n\n    # Generate a title with station name and cruise ID\n    overall_title &lt;- glue::glue(\"Station: {station_name}, Cruise ID: {cruise_id}\")\n\n    # Set margins: increase the outer margin for the title\n    par(oma = c(0, 0, 3, 0))  # Top outer margin increased for title\n\n    # Plotting function with specific parameters\n    oce::plot(\n      x = ctdDecimate(ctdTrim(cast)),\n      which = c(\n        \"sea_water_electrical_conductivity\",\n        \"descent_rate\", \"sound_velocity\",\n        \"sea_water_sigma_t\",\"altimeter\"\n      ),\n      main = \"\"  # No main title for individual subplots\n    )\n\n    # Place a single overall title at the top of the plot frame\n    mtext(overall_title, side = 3, line = 1, outer = TRUE, cex = 1.5)\n\n    # Reset outer margins to default\n    par(oma = c(0, 0, 0, 0))\n\n  }, error = function(e) {\n    print(e$message)  # Print any errors that occur during plotting\n  })\n}\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n\n\nplotting other nutrient parameters for each cast\n# Loop through each CTD cast\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # Assuming each sublist contains only one relevant CTD object\n  tryCatch({\n    # Extract metadata for station name and cruise ID\n    station_name &lt;- cast@metadata$station[1]\n    cruise_id &lt;- cast@data$cruise_id[1]\n\n    # Generate a title with station name and cruise ID\n    overall_title &lt;- glue::glue(\"Station: {station_name}, Cruise ID: {cruise_id}\")\n\n    # Set margins: increase the outer margin for the title\n    par(oma = c(0, 0, 3, 0))  # Top outer margin increased for title\n\n    # Plotting function with specific parameters\n    oce::plot(\n      x = ctdDecimate(ctdTrim(cast)),\n      which = c(\n        \"CDOM\", \"dissolved_oxygen\",\n        \"oxygen_saturation\",\n        \"chlorophyll_concentration\", \"chlorophyll_fluorescence\"\n      ),\n      main = \"\"  # No main title for individual subplots\n    )\n\n    # Place a single overall title at the top of the plot frame\n    mtext(overall_title, side = 3, line = 1, outer = TRUE, cex = 1.5)\n\n    # Reset outer margins to default\n    par(oma = c(0, 0, 0, 0))\n\n  }, error = function(e) {\n    print(e$message)  # Print any errors that occur during plotting\n  })\n}\n\n\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n\n\n\n\nplotting other optical parameters for each cast\n# Loop through each CTD cast\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # Assuming each sublist contains only one relevant CTD object\n  tryCatch({\n    # Extract metadata for station name and cruise ID\n    station_name &lt;- cast@metadata$station[1]\n    cruise_id &lt;- cast@data$cruise_id[1]\n\n    # Generate a title with station name and cruise ID\n    overall_title &lt;- glue::glue(\"Station: {station_name}, Cruise ID: {cruise_id}\")\n\n    # Set margins: increase the outer margin for the title\n    par(oma = c(0, 0, 3, 0))  # Top outer margin increased for title\n\n    # Plotting function with specific parameters\n    oce::plot(\n      x = ctdDecimate(ctdTrim(cast)),\n      which = c(\n        \"photosynthetically_available_radiation\",\n        \"beam_attenuation\",\"beam_transmission\"\n      ),\n      main = \"\"  # No main title for individual subplots\n    )\n\n    # Place a single overall title at the top of the plot frame\n    mtext(overall_title, side = 3, line = 1, outer = TRUE, cex = 1.5)\n\n    # Reset outer margins to default\n    par(oma = c(0, 0, 0, 0))\n\n  }, error = function(e) {\n    print(e$message)  # Print any errors that occur during plotting\n  })\n}\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nloop through every cast, clean, & save\ncombined_df &lt;- data.frame()\nfor (i in seq(ctd_FK)){\n  tryCatch({\n    cast &lt;- ctd_FK[[i]]  # 1 is selecting only the first sublist\n    \n    # print(class(cast))\n    # clean cast \n    trimmed_cast &lt;- ctdTrim(cast)\n    decimated_cast &lt;- ctdDecimate(trimmed_cast, p = 0.5)  # binned to 0.5 m\n    \n    # convert to df\n    cast_df &lt;- as.data.frame(decimated_cast@data)\n    \n    # Add metadata\n    # assumes station ID and cruise ID the same for all & just uses 1st one\n    cast_df &lt;- mutate(\n      cast_df,\n      station = cast@data$station[1],\n      cruise_id = cast@data$cruise_id[1]\n    )\n  \n    # drop NA rows left by cleaning\n    cast_df &lt;- subset(cast_df, !is.na(scan))\n    \n    # Append the data to the combined dataframe\n    combined_df &lt;- rbind(combined_df, cast_df)\n  }, error = function(e){\n    print(glue(\"error in cast {cast@metadata$station[1]}\"))\n    print(e)\n  })\n}\n# Save to CSV\nfile_path &lt;- here(glue(\"data/cleaned/{cruise_id}.csv\"))\nwrite.csv(combined_df, file_path, row.names = FALSE)"
  },
  {
    "objectID": "cruise_report/cruise_reports/WS1113.html",
    "href": "cruise_report/cruise_reports/WS1113.html",
    "title": "WS1113",
    "section": "",
    "text": "WS1113\n\n\nsetup\nif (!nzchar(system.file(package = \"librarian\"))) {\n  install.packages(\"librarian\")\n}\n\nlibrarian::shelf(\n  quiet = TRUE,\n  readr, here, fs, ggplot2, glue, \"jiho/castr\", dplyr, oce, patchwork, purrr, tidyr\n)\n\n\n\n\nCode\nsource(here(\"R/cruise_load.R\"))\ncruise_df &lt;- cruise_load(params$cruise_id)\n\n\n\n\nplot depth & pressure vs time elapsed\ntryCatch({\n  plots &lt;- list()\n  \n  for (station_name in unique(cruise_df$station)) {\n    subset_df &lt;- filter(cruise_df, station == station_name)\n    plots[[station_name]] &lt;- ggplot(subset_df, aes(x = time_elapsed)) +\n      geom_point(aes(y = depth), color = \"blue\") +  # Plot depth in blue\n      geom_line(aes(y = sea_water_pressure), color = \"red\") +  # Plot sea water pressure in red\n      ggtitle(glue(\"{station_name}\")) +\n      theme(\n        axis.title.x = element_blank(),\n        axis.title.y = element_blank(),\n        axis.text.x = element_blank(),\n        axis.text.y = element_blank(),\n        axis.ticks.x = element_blank(),\n        axis.ticks.y = element_blank()\n      )  # Remove individual axis titles and text\n  }\n  \n  # drop nulls\n  plots &lt;- purrr::compact(plots)\n  \n  # Combine all plots into a grid\n  combined_plot &lt;- wrap_plots(plots) + \n    plot_layout(ncol = 4) +  # Adjust ncol to set number of columns in the grid\n    plot_annotation(\n      title = \"Depth (blue) and Pressure (red)\",\n      subtitle = \"Each panel represents a different station\",\n      caption = \"Time Elapsed (x-axis) vs Depth & Pressure (y-axis)\"\n    ) +\n    theme(\n      plot.tag = element_text(size = 12, face = \"bold\"),\n      plot.tag.position = \"topleft\",\n      axis.title.x = element_text(margin = margin(t = 10)),\n      axis.title.y = element_text(margin = margin(r = 10))\n    )\n  \n  print(combined_plot)\n}, error = function(er){\n  print(er)\n});\n\n\n\n\n\n\n\n\n\n\n\nplot across all stations\np &lt;- ggplot(cruise_df, aes(x = time, y = depth, fill = station)) +\n  geom_col() +  # This creates the bars\n  # geom_text(aes(label = station), vjust = -0.3) +  # This adds labels to each bar, adjust vjust for position\n  labs(x = \"Time\", y = \"Depth\", title = \"Depth over Time by Station\") +  # Set labels and title\n  theme_minimal()  # Use a minimal theme\nprint(p)\n\n\n\n\n\n\n\n\n\n\n\ncreate oce.ctd objects from dataframes\nctd_load &lt;- function(data, other_params = NULL) {\n  \n  # create csv into ctd object\n  test_ctd &lt;-\n    as.ctd(\n      salinity    = data$sea_water_salinity,\n      temperature = data$sea_water_temperature,\n      pressure    = data$sea_water_pressure,\n      station     = data$station\n    )\n  \n  # add additional columns to ctd object\n  if (!is.null(other_params)) {\n    for (param_name in other_params) {\n      test_ctd &lt;-\n        oceSetData(\n          object = test_ctd,\n          name   = param_name,\n          value  = data[[param_name]]\n        )\n    }\n  }\n  print(glue(\"{data$station[1]}:\\t{length(test_ctd@data$scan)} scans\"))\n\n\n  return(test_ctd)\n}\n\n# Define other parameters to add\nother_params &lt;- c(\n  \"cruise_id\", \"station\", \"time\", \"time_elapsed\", \n  \"latitude\", \"longitude\", \"sea_water_electrical_conductivity\", \n  \"CDOM\", \"dissolved_oxygen\",\"oxygen_saturation\", \"chlorophyll_concentration\", \n  \"chlorophyll_fluorescence\", \"photosynthetically_available_radiation\", \n  \"beam_attenuation\",\"beam_transmission\", \"depth\", \"sea_water_sigma_t\",\n  \"descent_rate\", \"sound_velocity\",\"altimeter\"\n)\n\n# Split data by station and create data list\nctd_FK &lt;- cruise_df %&gt;%\n  split(.$station) %&gt;%\n  map(~ ctd_load(.x, other_params = other_params)) # ~ is a lambda(x)\n\n\n1:  1567 scans\n10: 1166 scans\n12: 2039 scans\n16: 2257 scans\n17: 1748 scans\n18: 7165 scans\n19: 1271 scans\n20: 1845 scans\n21.5:   7697 scans\n22.5:   7738 scans\n23: 1399 scans\n24: 2769 scans\n25.5:   7436 scans\n28: 2071 scans\n29: 3624 scans\n3:  7386 scans\n30: 2103 scans\n31: 1913 scans\n34: 2120 scans\n39: 477 scans\n42: 998 scans\n49: 966 scans\n5:  3321 scans\n50: 727 scans\n53: 382 scans\n54: 1218 scans\n56: 1182 scans\n58: 2793 scans\n6:  2258 scans\n6.5:    4275 scans\n60: 1728 scans\n68: 825 scans\n69: 562 scans\n7:  496 scans\n9:  3095 scans\n9.5:    7422 scans\nMR1:    5231 scans\nMR2:    15913 scans\nMR3:    6635 scans\nMR4:    3224 scans\nMR5:    7415 scans\nMR6:    9503 scans\nMR7:    8485 scans\n\n\n\n\nplotting scans for each cast in the first list\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # 1 is selecting only the first sublist\n  # print(i)\n  print(glue(\"=== station: {cast@metadata$station[1]}\"))\n  print(glue(\"# scans: {length(cast@data$scan)}\"))\n  plotScan(cast)\n}\n\n\n=== station: 1\n# scans: 1567\n\n\n\n\n\n\n\n\n\n=== station: 10\n# scans: 1166\n\n\n\n\n\n\n\n\n\n=== station: 12\n# scans: 2039\n\n\n\n\n\n\n\n\n\n=== station: 16\n# scans: 2257\n\n\n\n\n\n\n\n\n\n=== station: 17\n# scans: 1748\n\n\n\n\n\n\n\n\n\n=== station: 18\n# scans: 7165\n\n\n\n\n\n\n\n\n\n=== station: 19\n# scans: 1271\n\n\n\n\n\n\n\n\n\n=== station: 20\n# scans: 1845\n\n\n\n\n\n\n\n\n\n=== station: 21.5\n# scans: 7697\n\n\n\n\n\n\n\n\n\n=== station: 22.5\n# scans: 7738\n\n\n\n\n\n\n\n\n\n=== station: 23\n# scans: 1399\n\n\n\n\n\n\n\n\n\n=== station: 24\n# scans: 2769\n\n\n\n\n\n\n\n\n\n=== station: 25.5\n# scans: 7436\n\n\n\n\n\n\n\n\n\n=== station: 28\n# scans: 2071\n\n\n\n\n\n\n\n\n\n=== station: 29\n# scans: 3624\n\n\n\n\n\n\n\n\n\n=== station: 3\n# scans: 7386\n\n\n\n\n\n\n\n\n\n=== station: 30\n# scans: 2103\n\n\n\n\n\n\n\n\n\n=== station: 31\n# scans: 1913\n\n\n\n\n\n\n\n\n\n=== station: 34\n# scans: 2120\n\n\n\n\n\n\n\n\n\n=== station: 39\n# scans: 477\n\n\n\n\n\n\n\n\n\n=== station: 42\n# scans: 998\n\n\n\n\n\n\n\n\n\n=== station: 49\n# scans: 966\n\n\n\n\n\n\n\n\n\n=== station: 5\n# scans: 3321\n\n\n\n\n\n\n\n\n\n=== station: 50\n# scans: 727\n\n\n\n\n\n\n\n\n\n=== station: 53\n# scans: 382\n\n\n\n\n\n\n\n\n\n=== station: 54\n# scans: 1218\n\n\n\n\n\n\n\n\n\n=== station: 56\n# scans: 1182\n\n\n\n\n\n\n\n\n\n=== station: 58\n# scans: 2793\n\n\n\n\n\n\n\n\n\n=== station: 6\n# scans: 2258\n\n\n\n\n\n\n\n\n\n=== station: 6.5\n# scans: 4275\n\n\n\n\n\n\n\n\n\n=== station: 60\n# scans: 1728\n\n\n\n\n\n\n\n\n\n=== station: 68\n# scans: 825\n\n\n\n\n\n\n\n\n\n=== station: 69\n# scans: 562\n\n\n\n\n\n\n\n\n\n=== station: 7\n# scans: 496\n\n\n\n\n\n\n\n\n\n=== station: 9\n# scans: 3095\n\n\n\n\n\n\n\n\n\n=== station: 9.5\n# scans: 7422\n\n\n\n\n\n\n\n\n\n=== station: MR1\n# scans: 5231\n\n\n\n\n\n\n\n\n\n=== station: MR2\n# scans: 15913\n\n\n\n\n\n\n\n\n\n=== station: MR3\n# scans: 6635\n\n\n\n\n\n\n\n\n\n=== station: MR4\n# scans: 3224\n\n\n\n\n\n\n\n\n\n=== station: MR5\n# scans: 7415\n\n\n\n\n\n\n\n\n\n=== station: MR6\n# scans: 9503\n\n\n\n\n\n\n\n\n\n=== station: MR7\n# scans: 8485\n\n\n\n\n\n\n\n\n\n\n\nplotting each cast in the first list\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # 1 is selecting only the first sublist\n  tryCatch({\n    plot(ctdDecimate(ctdTrim(cast)))\n  }, error = function(e){\n    print(e)\n  })\n}\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1567' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1166' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2039' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2257' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1748' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 7165' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1271' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1845' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 7697' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 7738' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1399' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2769' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 7436' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2071' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3624' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 7386' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2103' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1913' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2120' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 477' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 998' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3321' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 727' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2793' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2258' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4275' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1728' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 825' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 562' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 496' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3095' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 7422' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 5231' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 15913' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 6635' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3224' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 7415' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 9503' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 8485' in coercion to 'logical(1)'&gt;\n\n\n\n\nplotting other physical parameters for each cast\n# Loop through each CTD cast\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # Assuming each sublist contains only one relevant CTD object\n  tryCatch({\n    # Extract metadata for station name and cruise ID\n    station_name &lt;- cast@metadata$station[1]\n    cruise_id &lt;- cast@data$cruise_id[1]\n\n    # Generate a title with station name and cruise ID\n    overall_title &lt;- glue::glue(\"Station: {station_name}, Cruise ID: {cruise_id}\")\n\n    # Set margins: increase the outer margin for the title\n    par(oma = c(0, 0, 3, 0))  # Top outer margin increased for title\n\n    # Plotting function with specific parameters\n    oce::plot(\n      x = ctdDecimate(ctdTrim(cast)),\n      which = c(\n        \"sea_water_electrical_conductivity\",\n        \"descent_rate\", \"sound_velocity\",\n        \"sea_water_sigma_t\",\"altimeter\"\n      ),\n      main = \"\"  # No main title for individual subplots\n    )\n\n    # Place a single overall title at the top of the plot frame\n    mtext(overall_title, side = 3, line = 1, outer = TRUE, cex = 1.5)\n\n    # Reset outer margins to default\n    par(oma = c(0, 0, 0, 0))\n\n  }, error = function(e) {\n    print(e$message)  # Print any errors that occur during plotting\n  })\n}\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n\n\nplotting other nutrient parameters for each cast\n# Loop through each CTD cast\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # Assuming each sublist contains only one relevant CTD object\n  tryCatch({\n    # Extract metadata for station name and cruise ID\n    station_name &lt;- cast@metadata$station[1]\n    cruise_id &lt;- cast@data$cruise_id[1]\n\n    # Generate a title with station name and cruise ID\n    overall_title &lt;- glue::glue(\"Station: {station_name}, Cruise ID: {cruise_id}\")\n\n    # Set margins: increase the outer margin for the title\n    par(oma = c(0, 0, 3, 0))  # Top outer margin increased for title\n\n    # Plotting function with specific parameters\n    oce::plot(\n      x = ctdDecimate(ctdTrim(cast)),\n      which = c(\n        \"CDOM\", \"dissolved_oxygen\",\n        \"oxygen_saturation\",\n        \"chlorophyll_concentration\", \"chlorophyll_fluorescence\"\n      ),\n      main = \"\"  # No main title for individual subplots\n    )\n\n    # Place a single overall title at the top of the plot frame\n    mtext(overall_title, side = 3, line = 1, outer = TRUE, cex = 1.5)\n\n    # Reset outer margins to default\n    par(oma = c(0, 0, 0, 0))\n\n  }, error = function(e) {\n    print(e$message)  # Print any errors that occur during plotting\n  })\n}\n\n\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"plot.new has not been called yet\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n\n\n\n\nplotting other optical parameters for each cast\n# Loop through each CTD cast\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # Assuming each sublist contains only one relevant CTD object\n  tryCatch({\n    # Extract metadata for station name and cruise ID\n    station_name &lt;- cast@metadata$station[1]\n    cruise_id &lt;- cast@data$cruise_id[1]\n\n    # Generate a title with station name and cruise ID\n    overall_title &lt;- glue::glue(\"Station: {station_name}, Cruise ID: {cruise_id}\")\n\n    # Set margins: increase the outer margin for the title\n    par(oma = c(0, 0, 3, 0))  # Top outer margin increased for title\n\n    # Plotting function with specific parameters\n    oce::plot(\n      x = ctdDecimate(ctdTrim(cast)),\n      which = c(\n        \"photosynthetically_available_radiation\",\n        \"beam_attenuation\",\"beam_transmission\"\n      ),\n      main = \"\"  # No main title for individual subplots\n    )\n\n    # Place a single overall title at the top of the plot frame\n    mtext(overall_title, side = 3, line = 1, outer = TRUE, cex = 1.5)\n\n    # Reset outer margins to default\n    par(oma = c(0, 0, 0, 0))\n\n  }, error = function(e) {\n    print(e$message)  # Print any errors that occur during plotting\n  })\n}\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n\n\nloop through every cast, clean, & save\ncombined_df &lt;- data.frame()\nfor (i in seq(ctd_FK)){\n  tryCatch({\n    cast &lt;- ctd_FK[[i]]  # 1 is selecting only the first sublist\n    \n    # print(class(cast))\n    # clean cast \n    trimmed_cast &lt;- ctdTrim(cast)\n    decimated_cast &lt;- ctdDecimate(trimmed_cast, p = 0.5)  # binned to 0.5 m\n    \n    # convert to df\n    cast_df &lt;- as.data.frame(decimated_cast@data)\n    \n    # Add metadata\n    # assumes station ID and cruise ID the same for all & just uses 1st one\n    cast_df &lt;- mutate(\n      cast_df,\n      station = cast@data$station[1],\n      cruise_id = cast@data$cruise_id[1]\n    )\n  \n    # drop NA rows left by cleaning\n    cast_df &lt;- subset(cast_df, !is.na(scan))\n    \n    # Append the data to the combined dataframe\n    combined_df &lt;- rbind(combined_df, cast_df)\n  }, error = function(e){\n    print(glue(\"error in cast {cast@metadata$station[1]}\"))\n    print(e)\n  })\n}\n# Save to CSV\nfile_path &lt;- here(glue(\"data/cleaned/{cruise_id}.csv\"))\nwrite.csv(combined_df, file_path, row.names = FALSE)"
  },
  {
    "objectID": "cruise_report/cruise_reports/WS1202.html",
    "href": "cruise_report/cruise_reports/WS1202.html",
    "title": "WS1202",
    "section": "",
    "text": "WS1202\n\n\nsetup\nif (!nzchar(system.file(package = \"librarian\"))) {\n  install.packages(\"librarian\")\n}\n\nlibrarian::shelf(\n  quiet = TRUE,\n  readr, here, fs, ggplot2, glue, \"jiho/castr\", dplyr, oce, patchwork, purrr, tidyr\n)\n\n\n\n\nCode\nsource(here(\"R/cruise_load.R\"))\ncruise_df &lt;- cruise_load(params$cruise_id)\n\n\n\n\nplot depth & pressure vs time elapsed\ntryCatch({\n  plots &lt;- list()\n  \n  for (station_name in unique(cruise_df$station)) {\n    subset_df &lt;- filter(cruise_df, station == station_name)\n    plots[[station_name]] &lt;- ggplot(subset_df, aes(x = time_elapsed)) +\n      geom_point(aes(y = depth), color = \"blue\") +  # Plot depth in blue\n      geom_line(aes(y = sea_water_pressure), color = \"red\") +  # Plot sea water pressure in red\n      ggtitle(glue(\"{station_name}\")) +\n      theme(\n        axis.title.x = element_blank(),\n        axis.title.y = element_blank(),\n        axis.text.x = element_blank(),\n        axis.text.y = element_blank(),\n        axis.ticks.x = element_blank(),\n        axis.ticks.y = element_blank()\n      )  # Remove individual axis titles and text\n  }\n  \n  # drop nulls\n  plots &lt;- purrr::compact(plots)\n  \n  # Combine all plots into a grid\n  combined_plot &lt;- wrap_plots(plots) + \n    plot_layout(ncol = 4) +  # Adjust ncol to set number of columns in the grid\n    plot_annotation(\n      title = \"Depth (blue) and Pressure (red)\",\n      subtitle = \"Each panel represents a different station\",\n      caption = \"Time Elapsed (x-axis) vs Depth & Pressure (y-axis)\"\n    ) +\n    theme(\n      plot.tag = element_text(size = 12, face = \"bold\"),\n      plot.tag.position = \"topleft\",\n      axis.title.x = element_text(margin = margin(t = 10)),\n      axis.title.y = element_text(margin = margin(r = 10))\n    )\n  \n  print(combined_plot)\n}, error = function(er){\n  print(er)\n});\n\n\n\n\n\n\n\n\n\n\n\nplot across all stations\np &lt;- ggplot(cruise_df, aes(x = time, y = depth, fill = station)) +\n  geom_col() +  # This creates the bars\n  # geom_text(aes(label = station), vjust = -0.3) +  # This adds labels to each bar, adjust vjust for position\n  labs(x = \"Time\", y = \"Depth\", title = \"Depth over Time by Station\") +  # Set labels and title\n  theme_minimal()  # Use a minimal theme\nprint(p)\n\n\n\n\n\n\n\n\n\n\n\ncreate oce.ctd objects from dataframes\nctd_load &lt;- function(data, other_params = NULL) {\n  \n  # create csv into ctd object\n  test_ctd &lt;-\n    as.ctd(\n      salinity    = data$sea_water_salinity,\n      temperature = data$sea_water_temperature,\n      pressure    = data$sea_water_pressure,\n      station     = data$station\n    )\n  \n  # add additional columns to ctd object\n  if (!is.null(other_params)) {\n    for (param_name in other_params) {\n      test_ctd &lt;-\n        oceSetData(\n          object = test_ctd,\n          name   = param_name,\n          value  = data[[param_name]]\n        )\n    }\n  }\n  print(glue(\"{data$station[1]}:\\t{length(test_ctd@data$scan)} scans\"))\n\n\n  return(test_ctd)\n}\n\n# Define other parameters to add\nother_params &lt;- c(\n  \"cruise_id\", \"station\", \"time\", \"time_elapsed\", \n  \"latitude\", \"longitude\", \"sea_water_electrical_conductivity\", \n  \"CDOM\", \"dissolved_oxygen\",\"oxygen_saturation\", \"chlorophyll_concentration\", \n  \"chlorophyll_fluorescence\", \"photosynthetically_available_radiation\", \n  \"beam_attenuation\",\"beam_transmission\", \"depth\", \"sea_water_sigma_t\",\n  \"descent_rate\", \"sound_velocity\",\"altimeter\"\n)\n\n# Split data by station and create data list\nctd_FK &lt;- cruise_df %&gt;%\n  split(.$station) %&gt;%\n  map(~ ctd_load(.x, other_params = other_params)) # ~ is a lambda(x)\n\n\n1:  832 scans\n10: 381 scans\n12: 2160 scans\n16: 1259 scans\n17: 1281 scans\n18: 1504 scans\n19: 770 scans\n20: 1140 scans\n21.5:   5818 scans\n22.5:   7181 scans\n23: 1259 scans\n24: 1206 scans\n25.5:   10745 scans\n28: 2290 scans\n29: 2862 scans\n3:  4302 scans\n30: 2224 scans\n31: 1477 scans\n34: 405 scans\n39: 171 scans\n4:  1241 scans\n49: 670 scans\n5:  1012 scans\n50: 784 scans\n53: 749 scans\n54: 525 scans\n56: 853 scans\n58: 1266 scans\n6:  1312 scans\n6.5:    5401 scans\n60: 1480 scans\n68: 701 scans\n69: 436 scans\n7:  521 scans\n9:  2272 scans\n9.5:    6358 scans\n\n\n\n\nplotting scans for each cast in the first list\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # 1 is selecting only the first sublist\n  # print(i)\n  print(glue(\"=== station: {cast@metadata$station[1]}\"))\n  print(glue(\"# scans: {length(cast@data$scan)}\"))\n  plotScan(cast)\n}\n\n\n=== station: 1\n# scans: 832\n\n\n\n\n\n\n\n\n\n=== station: 10\n# scans: 381\n\n\n\n\n\n\n\n\n\n=== station: 12\n# scans: 2160\n\n\n\n\n\n\n\n\n\n=== station: 16\n# scans: 1259\n\n\n\n\n\n\n\n\n\n=== station: 17\n# scans: 1281\n\n\n\n\n\n\n\n\n\n=== station: 18\n# scans: 1504\n\n\n\n\n\n\n\n\n\n=== station: 19\n# scans: 770\n\n\n\n\n\n\n\n\n\n=== station: 20\n# scans: 1140\n\n\n\n\n\n\n\n\n\n=== station: 21.5\n# scans: 5818\n\n\n\n\n\n\n\n\n\n=== station: 22.5\n# scans: 7181\n\n\n\n\n\n\n\n\n\n=== station: 23\n# scans: 1259\n\n\n\n\n\n\n\n\n\n=== station: 24\n# scans: 1206\n\n\n\n\n\n\n\n\n\n=== station: 25.5\n# scans: 10745\n\n\n\n\n\n\n\n\n\n=== station: 28\n# scans: 2290\n\n\n\n\n\n\n\n\n\n=== station: 29\n# scans: 2862\n\n\n\n\n\n\n\n\n\n=== station: 3\n# scans: 4302\n\n\n\n\n\n\n\n\n\n=== station: 30\n# scans: 2224\n\n\n\n\n\n\n\n\n\n=== station: 31\n# scans: 1477\n\n\n\n\n\n\n\n\n\n=== station: 34\n# scans: 405\n\n\n\n\n\n\n\n\n\n=== station: 39\n# scans: 171\n\n\n\n\n\n\n\n\n\n=== station: 4\n# scans: 1241\n\n\n\n\n\n\n\n\n\n=== station: 49\n# scans: 670\n\n\n\n\n\n\n\n\n\n=== station: 5\n# scans: 1012\n\n\n\n\n\n\n\n\n\n=== station: 50\n# scans: 784\n\n\n\n\n\n\n\n\n\n=== station: 53\n# scans: 749\n\n\n\n\n\n\n\n\n\n=== station: 54\n# scans: 525\n\n\n\n\n\n\n\n\n\n=== station: 56\n# scans: 853\n\n\n\n\n\n\n\n\n\n=== station: 58\n# scans: 1266\n\n\n\n\n\n\n\n\n\n=== station: 6\n# scans: 1312\n\n\n\n\n\n\n\n\n\n=== station: 6.5\n# scans: 5401\n\n\n\n\n\n\n\n\n\n=== station: 60\n# scans: 1480\n\n\n\n\n\n\n\n\n\n=== station: 68\n# scans: 701\n\n\n\n\n\n\n\n\n\n=== station: 69\n# scans: 436\n\n\n\n\n\n\n\n\n\n=== station: 7\n# scans: 521\n\n\n\n\n\n\n\n\n\n=== station: 9\n# scans: 2272\n\n\n\n\n\n\n\n\n\n=== station: 9.5\n# scans: 6358\n\n\n\n\n\n\n\n\n\n\n\nplotting each cast in the first list\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # 1 is selecting only the first sublist\n  tryCatch({\n    plot(ctdDecimate(ctdTrim(cast)))\n  }, error = function(e){\n    print(e)\n  })\n}\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 832' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 381' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2160' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1259' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1281' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1504' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 770' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1140' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 5818' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 7181' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1259' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1206' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 10745' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2290' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2862' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4302' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2224' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1477' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 405' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1241' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 670' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1012' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 784' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 749' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 525' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 853' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1266' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1312' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 5401' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1480' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 701' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 436' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 521' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2272' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 6358' in coercion to 'logical(1)'&gt;\n\n\n\n\nplotting other physical parameters for each cast\n# Loop through each CTD cast\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # Assuming each sublist contains only one relevant CTD object\n  tryCatch({\n    # Extract metadata for station name and cruise ID\n    station_name &lt;- cast@metadata$station[1]\n    cruise_id &lt;- cast@data$cruise_id[1]\n\n    # Generate a title with station name and cruise ID\n    overall_title &lt;- glue::glue(\"Station: {station_name}, Cruise ID: {cruise_id}\")\n\n    # Set margins: increase the outer margin for the title\n    par(oma = c(0, 0, 3, 0))  # Top outer margin increased for title\n\n    # Plotting function with specific parameters\n    oce::plot(\n      x = ctdDecimate(ctdTrim(cast)),\n      which = c(\n        \"sea_water_electrical_conductivity\",\n        \"descent_rate\", \"sound_velocity\",\n        \"sea_water_sigma_t\",\"altimeter\"\n      ),\n      main = \"\"  # No main title for individual subplots\n    )\n\n    # Place a single overall title at the top of the plot frame\n    mtext(overall_title, side = 3, line = 1, outer = TRUE, cex = 1.5)\n\n    # Reset outer margins to default\n    par(oma = c(0, 0, 0, 0))\n\n  }, error = function(e) {\n    print(e$message)  # Print any errors that occur during plotting\n  })\n}\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n\n\nplotting other nutrient parameters for each cast\n# Loop through each CTD cast\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # Assuming each sublist contains only one relevant CTD object\n  tryCatch({\n    # Extract metadata for station name and cruise ID\n    station_name &lt;- cast@metadata$station[1]\n    cruise_id &lt;- cast@data$cruise_id[1]\n\n    # Generate a title with station name and cruise ID\n    overall_title &lt;- glue::glue(\"Station: {station_name}, Cruise ID: {cruise_id}\")\n\n    # Set margins: increase the outer margin for the title\n    par(oma = c(0, 0, 3, 0))  # Top outer margin increased for title\n\n    # Plotting function with specific parameters\n    oce::plot(\n      x = ctdDecimate(ctdTrim(cast)),\n      which = c(\n        \"CDOM\", \"dissolved_oxygen\",\n        \"oxygen_saturation\",\n        \"chlorophyll_concentration\", \"chlorophyll_fluorescence\"\n      ),\n      main = \"\"  # No main title for individual subplots\n    )\n\n    # Place a single overall title at the top of the plot frame\n    mtext(overall_title, side = 3, line = 1, outer = TRUE, cex = 1.5)\n\n    # Reset outer margins to default\n    par(oma = c(0, 0, 0, 0))\n\n  }, error = function(e) {\n    print(e$message)  # Print any errors that occur during plotting\n  })\n}\n\n\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n\n\n\n\nplotting other optical parameters for each cast\n# Loop through each CTD cast\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # Assuming each sublist contains only one relevant CTD object\n  tryCatch({\n    # Extract metadata for station name and cruise ID\n    station_name &lt;- cast@metadata$station[1]\n    cruise_id &lt;- cast@data$cruise_id[1]\n\n    # Generate a title with station name and cruise ID\n    overall_title &lt;- glue::glue(\"Station: {station_name}, Cruise ID: {cruise_id}\")\n\n    # Set margins: increase the outer margin for the title\n    par(oma = c(0, 0, 3, 0))  # Top outer margin increased for title\n\n    # Plotting function with specific parameters\n    oce::plot(\n      x = ctdDecimate(ctdTrim(cast)),\n      which = c(\n        \"photosynthetically_available_radiation\",\n        \"beam_attenuation\",\"beam_transmission\"\n      ),\n      main = \"\"  # No main title for individual subplots\n    )\n\n    # Place a single overall title at the top of the plot frame\n    mtext(overall_title, side = 3, line = 1, outer = TRUE, cex = 1.5)\n\n    # Reset outer margins to default\n    par(oma = c(0, 0, 0, 0))\n\n  }, error = function(e) {\n    print(e$message)  # Print any errors that occur during plotting\n  })\n}\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n[1] \"need finite 'xlim' values\"\n\n\n\n\nloop through every cast, clean, & save\ncombined_df &lt;- data.frame()\nfor (i in seq(ctd_FK)){\n  tryCatch({\n    cast &lt;- ctd_FK[[i]]  # 1 is selecting only the first sublist\n    \n    # print(class(cast))\n    # clean cast \n    trimmed_cast &lt;- ctdTrim(cast)\n    decimated_cast &lt;- ctdDecimate(trimmed_cast, p = 0.5)  # binned to 0.5 m\n    \n    # convert to df\n    cast_df &lt;- as.data.frame(decimated_cast@data)\n    \n    # Add metadata\n    # assumes station ID and cruise ID the same for all & just uses 1st one\n    cast_df &lt;- mutate(\n      cast_df,\n      station = cast@data$station[1],\n      cruise_id = cast@data$cruise_id[1]\n    )\n  \n    # drop NA rows left by cleaning\n    cast_df &lt;- subset(cast_df, !is.na(scan))\n    \n    # Append the data to the combined dataframe\n    combined_df &lt;- rbind(combined_df, cast_df)\n  }, error = function(e){\n    print(glue(\"error in cast {cast@metadata$station[1]}\"))\n    print(e)\n  })\n}\n# Save to CSV\nfile_path &lt;- here(glue(\"data/cleaned/{cruise_id}.csv\"))\nwrite.csv(combined_df, file_path, row.names = FALSE)"
  },
  {
    "objectID": "cruise_report/cruise_reports/WS1212.html",
    "href": "cruise_report/cruise_reports/WS1212.html",
    "title": "WS1212",
    "section": "",
    "text": "WS1212\n\n\nsetup\nif (!nzchar(system.file(package = \"librarian\"))) {\n  install.packages(\"librarian\")\n}\n\nlibrarian::shelf(\n  quiet = TRUE,\n  readr, here, fs, ggplot2, glue, \"jiho/castr\", dplyr, oce, patchwork, purrr, tidyr\n)\n\n\n\n\nCode\nsource(here(\"R/cruise_load.R\"))\ncruise_df &lt;- cruise_load(params$cruise_id)\n\n\n\n\nplot depth & pressure vs time elapsed\ntryCatch({\n  plots &lt;- list()\n  \n  for (station_name in unique(cruise_df$station)) {\n    subset_df &lt;- filter(cruise_df, station == station_name)\n    plots[[station_name]] &lt;- ggplot(subset_df, aes(x = time_elapsed)) +\n      geom_point(aes(y = depth), color = \"blue\") +  # Plot depth in blue\n      geom_line(aes(y = sea_water_pressure), color = \"red\") +  # Plot sea water pressure in red\n      ggtitle(glue(\"{station_name}\")) +\n      theme(\n        axis.title.x = element_blank(),\n        axis.title.y = element_blank(),\n        axis.text.x = element_blank(),\n        axis.text.y = element_blank(),\n        axis.ticks.x = element_blank(),\n        axis.ticks.y = element_blank()\n      )  # Remove individual axis titles and text\n  }\n  \n  # drop nulls\n  plots &lt;- purrr::compact(plots)\n  \n  # Combine all plots into a grid\n  combined_plot &lt;- wrap_plots(plots) + \n    plot_layout(ncol = 4) +  # Adjust ncol to set number of columns in the grid\n    plot_annotation(\n      title = \"Depth (blue) and Pressure (red)\",\n      subtitle = \"Each panel represents a different station\",\n      caption = \"Time Elapsed (x-axis) vs Depth & Pressure (y-axis)\"\n    ) +\n    theme(\n      plot.tag = element_text(size = 12, face = \"bold\"),\n      plot.tag.position = \"topleft\",\n      axis.title.x = element_text(margin = margin(t = 10)),\n      axis.title.y = element_text(margin = margin(r = 10))\n    )\n  \n  print(combined_plot)\n}, error = function(er){\n  print(er)\n});\n\n\n\n\n\n\n\n\n\n\n\nplot across all stations\np &lt;- ggplot(cruise_df, aes(x = time, y = depth, fill = station)) +\n  geom_col() +  # This creates the bars\n  # geom_text(aes(label = station), vjust = -0.3) +  # This adds labels to each bar, adjust vjust for position\n  labs(x = \"Time\", y = \"Depth\", title = \"Depth over Time by Station\") +  # Set labels and title\n  theme_minimal()  # Use a minimal theme\nprint(p)\n\n\n\n\n\n\n\n\n\n\n\ncreate oce.ctd objects from dataframes\nctd_load &lt;- function(data, other_params = NULL) {\n  \n  # create csv into ctd object\n  test_ctd &lt;-\n    as.ctd(\n      salinity    = data$sea_water_salinity,\n      temperature = data$sea_water_temperature,\n      pressure    = data$sea_water_pressure,\n      station     = data$station\n    )\n  \n  # add additional columns to ctd object\n  if (!is.null(other_params)) {\n    for (param_name in other_params) {\n      test_ctd &lt;-\n        oceSetData(\n          object = test_ctd,\n          name   = param_name,\n          value  = data[[param_name]]\n        )\n    }\n  }\n  print(glue(\"{data$station[1]}:\\t{length(test_ctd@data$scan)} scans\"))\n\n\n  return(test_ctd)\n}\n\n# Define other parameters to add\nother_params &lt;- c(\n  \"cruise_id\", \"station\", \"time\", \"time_elapsed\", \n  \"latitude\", \"longitude\", \"sea_water_electrical_conductivity\", \n  \"CDOM\", \"dissolved_oxygen\",\"oxygen_saturation\", \"chlorophyll_concentration\", \n  \"chlorophyll_fluorescence\", \"photosynthetically_available_radiation\", \n  \"beam_attenuation\",\"beam_transmission\", \"depth\", \"sea_water_sigma_t\",\n  \"descent_rate\", \"sound_velocity\",\"altimeter\"\n)\n\n# Split data by station and create data list\nctd_FK &lt;- cruise_df %&gt;%\n  split(.$station) %&gt;%\n  map(~ ctd_load(.x, other_params = other_params)) # ~ is a lambda(x)\n\n\n1:  960 scans\n10: 630 scans\n12: 1794 scans\n16: 571 scans\n17: 1249 scans\n18: 2035 scans\n19: 431 scans\n20: 1761 scans\n21.5:   7173 scans\n22.5:   8273 scans\n23: 761 scans\n24: 1055 scans\n25.5:   11266 scans\n28: 3163 scans\n29: 3615 scans\n3:  3867 scans\n30: 1911 scans\n31: 1269 scans\n34: 814 scans\n39: 2375 scans\n49: 562 scans\n5:  599 scans\n50: 641 scans\n53: 583 scans\n54: 518 scans\n56: 588 scans\n58: 1340 scans\n6:  1882 scans\n6.5:    3105 scans\n60: 936 scans\n68: 1446 scans\n69: 590 scans\n7:  781 scans\n9:  3401 scans\n9.5:    6323 scans\n\n\n\n\nplotting scans for each cast in the first list\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # 1 is selecting only the first sublist\n  # print(i)\n  print(glue(\"=== station: {cast@metadata$station[1]}\"))\n  print(glue(\"# scans: {length(cast@data$scan)}\"))\n  plotScan(cast)\n}\n\n\n=== station: 1\n# scans: 960\n\n\n\n\n\n\n\n\n\n=== station: 10\n# scans: 630\n\n\n\n\n\n\n\n\n\n=== station: 12\n# scans: 1794\n\n\n\n\n\n\n\n\n\n=== station: 16\n# scans: 571\n\n\n\n\n\n\n\n\n\n=== station: 17\n# scans: 1249\n\n\n\n\n\n\n\n\n\n=== station: 18\n# scans: 2035\n\n\n\n\n\n\n\n\n\n=== station: 19\n# scans: 431\n\n\n\n\n\n\n\n\n\n=== station: 20\n# scans: 1761\n\n\n\n\n\n\n\n\n\n=== station: 21.5\n# scans: 7173\n\n\n\n\n\n\n\n\n\n=== station: 22.5\n# scans: 8273\n\n\n\n\n\n\n\n\n\n=== station: 23\n# scans: 761\n\n\n\n\n\n\n\n\n\n=== station: 24\n# scans: 1055\n\n\n\n\n\n\n\n\n\n=== station: 25.5\n# scans: 11266\n\n\n\n\n\n\n\n\n\n=== station: 28\n# scans: 3163\n\n\n\n\n\n\n\n\n\n=== station: 29\n# scans: 3615\n\n\n\n\n\n\n\n\n\n=== station: 3\n# scans: 3867\n\n\n\n\n\n\n\n\n\n=== station: 30\n# scans: 1911\n\n\n\n\n\n\n\n\n\n=== station: 31\n# scans: 1269\n\n\n\n\n\n\n\n\n\n=== station: 34\n# scans: 814\n\n\n\n\n\n\n\n\n\n=== station: 39\n# scans: 2375\n\n\n\n\n\n\n\n\n\n=== station: 49\n# scans: 562\n\n\n\n\n\n\n\n\n\n=== station: 5\n# scans: 599\n\n\n\n\n\n\n\n\n\n=== station: 50\n# scans: 641\n\n\n\n\n\n\n\n\n\n=== station: 53\n# scans: 583\n\n\n\n\n\n\n\n\n\n=== station: 54\n# scans: 518\n\n\n\n\n\n\n\n\n\n=== station: 56\n# scans: 588\n\n\n\n\n\n\n\n\n\n=== station: 58\n# scans: 1340\n\n\n\n\n\n\n\n\n\n=== station: 6\n# scans: 1882\n\n\n\n\n\n\n\n\n\n=== station: 6.5\n# scans: 3105\n\n\n\n\n\n\n\n\n\n=== station: 60\n# scans: 936\n\n\n\n\n\n\n\n\n\n=== station: 68\n# scans: 1446\n\n\n\n\n\n\n\n\n\n=== station: 69\n# scans: 590\n\n\n\n\n\n\n\n\n\n=== station: 7\n# scans: 781\n\n\n\n\n\n\n\n\n\n=== station: 9\n# scans: 3401\n\n\n\n\n\n\n\n\n\n=== station: 9.5\n# scans: 6323\n\n\n\n\n\n\n\n\n\n\n\nplotting each cast in the first list\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # 1 is selecting only the first sublist\n  tryCatch({\n    plot(ctdDecimate(ctdTrim(cast)))\n  }, error = function(e){\n    print(e)\n  })\n}\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 960' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 630' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1794' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 571' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1249' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2035' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 431' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1761' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 7173' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 8273' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 761' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1055' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 11266' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3163' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3615' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3867' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1911' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1269' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 814' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2375' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 562' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 599' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 641' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 583' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 518' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 588' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1340' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1882' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3105' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 936' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1446' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 590' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 781' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3401' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 6323' in coercion to 'logical(1)'&gt;\n\n\n\n\nplotting other physical parameters for each cast\n# Loop through each CTD cast\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # Assuming each sublist contains only one relevant CTD object\n  tryCatch({\n    # Extract metadata for station name and cruise ID\n    station_name &lt;- cast@metadata$station[1]\n    cruise_id &lt;- cast@data$cruise_id[1]\n\n    # Generate a title with station name and cruise ID\n    overall_title &lt;- glue::glue(\"Station: {station_name}, Cruise ID: {cruise_id}\")\n\n    # Set margins: increase the outer margin for the title\n    par(oma = c(0, 0, 3, 0))  # Top outer margin increased for title\n\n    # Plotting function with specific parameters\n    oce::plot(\n      x = ctdDecimate(ctdTrim(cast)),\n      which = c(\n        \"sea_water_electrical_conductivity\",\n        \"descent_rate\", \"sound_velocity\",\n        \"sea_water_sigma_t\",\"altimeter\"\n      ),\n      main = \"\"  # No main title for individual subplots\n    )\n\n    # Place a single overall title at the top of the plot frame\n    mtext(overall_title, side = 3, line = 1, outer = TRUE, cex = 1.5)\n\n    # Reset outer margins to default\n    par(oma = c(0, 0, 0, 0))\n\n  }, error = function(e) {\n    print(e$message)  # Print any errors that occur during plotting\n  })\n}\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n\n\nplotting other nutrient parameters for each cast\n# Loop through each CTD cast\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # Assuming each sublist contains only one relevant CTD object\n  tryCatch({\n    # Extract metadata for station name and cruise ID\n    station_name &lt;- cast@metadata$station[1]\n    cruise_id &lt;- cast@data$cruise_id[1]\n\n    # Generate a title with station name and cruise ID\n    overall_title &lt;- glue::glue(\"Station: {station_name}, Cruise ID: {cruise_id}\")\n\n    # Set margins: increase the outer margin for the title\n    par(oma = c(0, 0, 3, 0))  # Top outer margin increased for title\n\n    # Plotting function with specific parameters\n    oce::plot(\n      x = ctdDecimate(ctdTrim(cast)),\n      which = c(\n        \"CDOM\", \"dissolved_oxygen\",\n        \"oxygen_saturation\",\n        \"chlorophyll_concentration\", \"chlorophyll_fluorescence\"\n      ),\n      main = \"\"  # No main title for individual subplots\n    )\n\n    # Place a single overall title at the top of the plot frame\n    mtext(overall_title, side = 3, line = 1, outer = TRUE, cex = 1.5)\n\n    # Reset outer margins to default\n    par(oma = c(0, 0, 0, 0))\n\n  }, error = function(e) {\n    print(e$message)  # Print any errors that occur during plotting\n  })\n}\n\n\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n\n\n\n\nplotting other optical parameters for each cast\n# Loop through each CTD cast\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # Assuming each sublist contains only one relevant CTD object\n  tryCatch({\n    # Extract metadata for station name and cruise ID\n    station_name &lt;- cast@metadata$station[1]\n    cruise_id &lt;- cast@data$cruise_id[1]\n\n    # Generate a title with station name and cruise ID\n    overall_title &lt;- glue::glue(\"Station: {station_name}, Cruise ID: {cruise_id}\")\n\n    # Set margins: increase the outer margin for the title\n    par(oma = c(0, 0, 3, 0))  # Top outer margin increased for title\n\n    # Plotting function with specific parameters\n    oce::plot(\n      x = ctdDecimate(ctdTrim(cast)),\n      which = c(\n        \"photosynthetically_available_radiation\",\n        \"beam_attenuation\",\"beam_transmission\"\n      ),\n      main = \"\"  # No main title for individual subplots\n    )\n\n    # Place a single overall title at the top of the plot frame\n    mtext(overall_title, side = 3, line = 1, outer = TRUE, cex = 1.5)\n\n    # Reset outer margins to default\n    par(oma = c(0, 0, 0, 0))\n\n  }, error = function(e) {\n    print(e$message)  # Print any errors that occur during plotting\n  })\n}\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nloop through every cast, clean, & save\ncombined_df &lt;- data.frame()\nfor (i in seq(ctd_FK)){\n  tryCatch({\n    cast &lt;- ctd_FK[[i]]  # 1 is selecting only the first sublist\n    \n    # print(class(cast))\n    # clean cast \n    trimmed_cast &lt;- ctdTrim(cast)\n    decimated_cast &lt;- ctdDecimate(trimmed_cast, p = 0.5)  # binned to 0.5 m\n    \n    # convert to df\n    cast_df &lt;- as.data.frame(decimated_cast@data)\n    \n    # Add metadata\n    # assumes station ID and cruise ID the same for all & just uses 1st one\n    cast_df &lt;- mutate(\n      cast_df,\n      station = cast@data$station[1],\n      cruise_id = cast@data$cruise_id[1]\n    )\n  \n    # drop NA rows left by cleaning\n    cast_df &lt;- subset(cast_df, !is.na(scan))\n    \n    # Append the data to the combined dataframe\n    combined_df &lt;- rbind(combined_df, cast_df)\n  }, error = function(e){\n    print(glue(\"error in cast {cast@metadata$station[1]}\"))\n    print(e)\n  })\n}\n# Save to CSV\nfile_path &lt;- here(glue(\"data/cleaned/{cruise_id}.csv\"))\nwrite.csv(combined_df, file_path, row.names = FALSE)"
  },
  {
    "objectID": "cruise_report/cruise_reports/WS15103.html",
    "href": "cruise_report/cruise_reports/WS15103.html",
    "title": "WS15103",
    "section": "",
    "text": "WS15103\n\n\nsetup\nif (!nzchar(system.file(package = \"librarian\"))) {\n  install.packages(\"librarian\")\n}\n\nlibrarian::shelf(\n  quiet = TRUE,\n  readr, here, fs, ggplot2, glue, \"jiho/castr\", dplyr, oce, patchwork, purrr, tidyr\n)\n\n\n\n\nCode\nsource(here(\"R/cruise_load.R\"))\ncruise_df &lt;- cruise_load(params$cruise_id)\n\n\n\n\nplot depth & pressure vs time elapsed\ntryCatch({\n  plots &lt;- list()\n  \n  for (station_name in unique(cruise_df$station)) {\n    subset_df &lt;- filter(cruise_df, station == station_name)\n    plots[[station_name]] &lt;- ggplot(subset_df, aes(x = time_elapsed)) +\n      geom_point(aes(y = depth), color = \"blue\") +  # Plot depth in blue\n      geom_line(aes(y = sea_water_pressure), color = \"red\") +  # Plot sea water pressure in red\n      ggtitle(glue(\"{station_name}\")) +\n      theme(\n        axis.title.x = element_blank(),\n        axis.title.y = element_blank(),\n        axis.text.x = element_blank(),\n        axis.text.y = element_blank(),\n        axis.ticks.x = element_blank(),\n        axis.ticks.y = element_blank()\n      )  # Remove individual axis titles and text\n  }\n  \n  # drop nulls\n  plots &lt;- purrr::compact(plots)\n  \n  # Combine all plots into a grid\n  combined_plot &lt;- wrap_plots(plots) + \n    plot_layout(ncol = 4) +  # Adjust ncol to set number of columns in the grid\n    plot_annotation(\n      title = \"Depth (blue) and Pressure (red)\",\n      subtitle = \"Each panel represents a different station\",\n      caption = \"Time Elapsed (x-axis) vs Depth & Pressure (y-axis)\"\n    ) +\n    theme(\n      plot.tag = element_text(size = 12, face = \"bold\"),\n      plot.tag.position = \"topleft\",\n      axis.title.x = element_text(margin = margin(t = 10)),\n      axis.title.y = element_text(margin = margin(r = 10))\n    )\n  \n  print(combined_plot)\n}, error = function(er){\n  print(er)\n});\n\n\n\n\n\n\n\n\n\n\n\nplot across all stations\np &lt;- ggplot(cruise_df, aes(x = time, y = depth, fill = station)) +\n  geom_col() +  # This creates the bars\n  # geom_text(aes(label = station), vjust = -0.3) +  # This adds labels to each bar, adjust vjust for position\n  labs(x = \"Time\", y = \"Depth\", title = \"Depth over Time by Station\") +  # Set labels and title\n  theme_minimal()  # Use a minimal theme\nprint(p)\n\n\n\n\n\n\n\n\n\n\n\ncreate oce.ctd objects from dataframes\nctd_load &lt;- function(data, other_params = NULL) {\n  \n  # create csv into ctd object\n  test_ctd &lt;-\n    as.ctd(\n      salinity    = data$sea_water_salinity,\n      temperature = data$sea_water_temperature,\n      pressure    = data$sea_water_pressure,\n      station     = data$station\n    )\n  \n  # add additional columns to ctd object\n  if (!is.null(other_params)) {\n    for (param_name in other_params) {\n      test_ctd &lt;-\n        oceSetData(\n          object = test_ctd,\n          name   = param_name,\n          value  = data[[param_name]]\n        )\n    }\n  }\n  print(glue(\"{data$station[1]}:\\t{length(test_ctd@data$scan)} scans\"))\n\n\n  return(test_ctd)\n}\n\n# Define other parameters to add\nother_params &lt;- c(\n  \"cruise_id\", \"station\", \"time\", \"time_elapsed\", \n  \"latitude\", \"longitude\", \"sea_water_electrical_conductivity\", \n  \"CDOM\", \"dissolved_oxygen\",\"oxygen_saturation\", \"chlorophyll_concentration\", \n  \"chlorophyll_fluorescence\", \"photosynthetically_available_radiation\", \n  \"beam_attenuation\",\"beam_transmission\", \"depth\", \"sea_water_sigma_t\",\n  \"descent_rate\", \"sound_velocity\",\"altimeter\"\n)\n\n# Split data by station and create data list\nctd_FK &lt;- cruise_df %&gt;%\n  split(.$station) %&gt;%\n  map(~ ctd_load(.x, other_params = other_params)) # ~ is a lambda(x)\n\n\n16: 20 scans\n18: 3362 scans\n21LK:   4572 scans\n3:  6814 scans\n30: 3091 scans\n31: 2003 scans\n33: 3125 scans\n41: 159 scans\n45: 140 scans\n48: 1167 scans\n51: 147 scans\n53: 24 scans\n54: 177 scans\n54B:    148 scans\n55: 307 scans\n55B:    36 scans\n56: 852 scans\n56B:    3 scans\n57: 687 scans\n57.1:   1012 scans\n57.1B:  225 scans\n57.2:   1437 scans\n57.2B:  1707 scans\n57.3:   2359 scans\n57.3B:  1504 scans\n57B:    97 scans\n58: 2037 scans\n59: 1427 scans\n60: 1579 scans\n61: 1650 scans\n62: 1378 scans\n63: 1352 scans\n64: 67 scans\n65: 74 scans\n66: 1315 scans\n67: 1059 scans\n68: 1812 scans\n69: 1469 scans\n7:  1971 scans\n70: 811 scans\n8:  4401 scans\n9.5:    7321 scans\nMR: 1866 scans\nMRB:    1437 scans\nWS: 2458 scans\n\n\n\n\nplotting scans for each cast in the first list\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # 1 is selecting only the first sublist\n  # print(i)\n  print(glue(\"=== station: {cast@metadata$station[1]}\"))\n  print(glue(\"# scans: {length(cast@data$scan)}\"))\n  plotScan(cast)\n}\n\n\n=== station: 16\n# scans: 20\n\n\n\n\n\n\n\n\n\n=== station: 18\n# scans: 3362\n\n\n\n\n\n\n\n\n\n=== station: 21LK\n# scans: 4572\n\n\n\n\n\n\n\n\n\n=== station: 3\n# scans: 6814\n\n\n\n\n\n\n\n\n\n=== station: 30\n# scans: 3091\n\n\n\n\n\n\n\n\n\n=== station: 31\n# scans: 2003\n\n\n\n\n\n\n\n\n\n=== station: 33\n# scans: 3125\n\n\n\n\n\n\n\n\n\n=== station: 41\n# scans: 159\n\n\n\n\n\n\n\n\n\n=== station: 45\n# scans: 140\n\n\n\n\n\n\n\n\n\n=== station: 48\n# scans: 1167\n\n\n\n\n\n\n\n\n\n=== station: 51\n# scans: 147\n\n\n\n\n\n\n\n\n\n=== station: 53\n# scans: 24\n\n\n\n\n\n\n\n\n\n=== station: 54\n# scans: 177\n\n\n\n\n\n\n\n\n\n=== station: 54B\n# scans: 148\n\n\n\n\n\n\n\n\n\n=== station: 55\n# scans: 307\n\n\n\n\n\n\n\n\n\n=== station: 55B\n# scans: 36\n\n\n\n\n\n\n\n\n\n=== station: 56\n# scans: 852\n\n\n\n\n\n\n\n\n\n=== station: 56B\n# scans: 3\n\n\n\n\n\n\n\n\n\n=== station: 57\n# scans: 687\n\n\n\n\n\n\n\n\n\n=== station: 57.1\n# scans: 1012\n\n\n\n\n\n\n\n\n\n=== station: 57.1B\n# scans: 225\n\n\n\n\n\n\n\n\n\n=== station: 57.2\n# scans: 1437\n\n\n\n\n\n\n\n\n\n=== station: 57.2B\n# scans: 1707\n\n\n\n\n\n\n\n\n\n=== station: 57.3\n# scans: 2359\n\n\n\n\n\n\n\n\n\n=== station: 57.3B\n# scans: 1504\n\n\n\n\n\n\n\n\n\n=== station: 57B\n# scans: 97\n\n\n\n\n\n\n\n\n\n=== station: 58\n# scans: 2037\n\n\n\n\n\n\n\n\n\n=== station: 59\n# scans: 1427\n\n\n\n\n\n\n\n\n\n=== station: 60\n# scans: 1579\n\n\n\n\n\n\n\n\n\n=== station: 61\n# scans: 1650\n\n\n\n\n\n\n\n\n\n=== station: 62\n# scans: 1378\n\n\n\n\n\n\n\n\n\n=== station: 63\n# scans: 1352\n\n\n\n\n\n\n\n\n\n=== station: 64\n# scans: 67\n\n\n\n\n\n\n\n\n\n=== station: 65\n# scans: 74\n\n\n\n\n\n\n\n\n\n=== station: 66\n# scans: 1315\n\n\n\n\n\n\n\n\n\n=== station: 67\n# scans: 1059\n\n\n\n\n\n\n\n\n\n=== station: 68\n# scans: 1812\n\n\n\n\n\n\n\n\n\n=== station: 69\n# scans: 1469\n\n\n\n\n\n\n\n\n\n=== station: 7\n# scans: 1971\n\n\n\n\n\n\n\n\n\n=== station: 70\n# scans: 811\n\n\n\n\n\n\n\n\n\n=== station: 8\n# scans: 4401\n\n\n\n\n\n\n\n\n\n=== station: 9.5\n# scans: 7321\n\n\n\n\n\n\n\n\n\n=== station: MR\n# scans: 1866\n\n\n\n\n\n\n\n\n\n=== station: MRB\n# scans: 1437\n\n\n\n\n\n\n\n\n\n=== station: WS\n# scans: 2458\n\n\n\n\n\n\n\n\n\n\n\nplotting each cast in the first list\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # 1 is selecting only the first sublist\n  tryCatch({\n    plot(ctdDecimate(ctdTrim(cast)))\n  }, error = function(e){\n    print(e)\n  })\n}\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3362' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4572' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 6814' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3091' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2003' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3125' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 159' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 140' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 852' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 687' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1012' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1437' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1707' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2359' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1504' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2037' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1427' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1579' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1650' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1378' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1352' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1315' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1059' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1812' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1469' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1971' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 811' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4401' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 7321' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1866' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1437' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2458' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n\n\nplotting other physical parameters for each cast\n# Loop through each CTD cast\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # Assuming each sublist contains only one relevant CTD object\n  tryCatch({\n    # Extract metadata for station name and cruise ID\n    station_name &lt;- cast@metadata$station[1]\n    cruise_id &lt;- cast@data$cruise_id[1]\n\n    # Generate a title with station name and cruise ID\n    overall_title &lt;- glue::glue(\"Station: {station_name}, Cruise ID: {cruise_id}\")\n\n    # Set margins: increase the outer margin for the title\n    par(oma = c(0, 0, 3, 0))  # Top outer margin increased for title\n\n    # Plotting function with specific parameters\n    oce::plot(\n      x = ctdDecimate(ctdTrim(cast)),\n      which = c(\n        \"sea_water_electrical_conductivity\",\n        \"descent_rate\", \"sound_velocity\",\n        \"sea_water_sigma_t\",\"altimeter\"\n      ),\n      main = \"\"  # No main title for individual subplots\n    )\n\n    # Place a single overall title at the top of the plot frame\n    mtext(overall_title, side = 3, line = 1, outer = TRUE, cex = 1.5)\n\n    # Reset outer margins to default\n    par(oma = c(0, 0, 0, 0))\n\n  }, error = function(e) {\n    print(e$message)  # Print any errors that occur during plotting\n  })\n}\n\n\n\n\n\n\n\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n\n\nplotting other nutrient parameters for each cast\n# Loop through each CTD cast\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # Assuming each sublist contains only one relevant CTD object\n  tryCatch({\n    # Extract metadata for station name and cruise ID\n    station_name &lt;- cast@metadata$station[1]\n    cruise_id &lt;- cast@data$cruise_id[1]\n\n    # Generate a title with station name and cruise ID\n    overall_title &lt;- glue::glue(\"Station: {station_name}, Cruise ID: {cruise_id}\")\n\n    # Set margins: increase the outer margin for the title\n    par(oma = c(0, 0, 3, 0))  # Top outer margin increased for title\n\n    # Plotting function with specific parameters\n    oce::plot(\n      x = ctdDecimate(ctdTrim(cast)),\n      which = c(\n        \"CDOM\", \"dissolved_oxygen\",\n        \"oxygen_saturation\",\n        \"chlorophyll_concentration\", \"chlorophyll_fluorescence\"\n      ),\n      main = \"\"  # No main title for individual subplots\n    )\n\n    # Place a single overall title at the top of the plot frame\n    mtext(overall_title, side = 3, line = 1, outer = TRUE, cex = 1.5)\n\n    # Reset outer margins to default\n    par(oma = c(0, 0, 0, 0))\n\n  }, error = function(e) {\n    print(e$message)  # Print any errors that occur during plotting\n  })\n}\n\n\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"plot.new has not been called yet\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"plot.new has not been called yet\"\n[1] \"plot.new has not been called yet\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"plot.new has not been called yet\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n\n\n\n\nplotting other optical parameters for each cast\n# Loop through each CTD cast\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # Assuming each sublist contains only one relevant CTD object\n  tryCatch({\n    # Extract metadata for station name and cruise ID\n    station_name &lt;- cast@metadata$station[1]\n    cruise_id &lt;- cast@data$cruise_id[1]\n\n    # Generate a title with station name and cruise ID\n    overall_title &lt;- glue::glue(\"Station: {station_name}, Cruise ID: {cruise_id}\")\n\n    # Set margins: increase the outer margin for the title\n    par(oma = c(0, 0, 3, 0))  # Top outer margin increased for title\n\n    # Plotting function with specific parameters\n    oce::plot(\n      x = ctdDecimate(ctdTrim(cast)),\n      which = c(\n        \"photosynthetically_available_radiation\",\n        \"beam_attenuation\",\"beam_transmission\"\n      ),\n      main = \"\"  # No main title for individual subplots\n    )\n\n    # Place a single overall title at the top of the plot frame\n    mtext(overall_title, side = 3, line = 1, outer = TRUE, cex = 1.5)\n\n    # Reset outer margins to default\n    par(oma = c(0, 0, 0, 0))\n\n  }, error = function(e) {\n    print(e$message)  # Print any errors that occur during plotting\n  })\n}\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"plot.new has not been called yet\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"plot.new has not been called yet\"\n[1] \"plot.new has not been called yet\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"plot.new has not been called yet\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n\n\nloop through every cast, clean, & save\ncombined_df &lt;- data.frame()\nfor (i in seq(ctd_FK)){\n  tryCatch({\n    cast &lt;- ctd_FK[[i]]  # 1 is selecting only the first sublist\n    \n    # print(class(cast))\n    # clean cast \n    trimmed_cast &lt;- ctdTrim(cast)\n    decimated_cast &lt;- ctdDecimate(trimmed_cast, p = 0.5)  # binned to 0.5 m\n    \n    # convert to df\n    cast_df &lt;- as.data.frame(decimated_cast@data)\n    \n    # Add metadata\n    # assumes station ID and cruise ID the same for all & just uses 1st one\n    cast_df &lt;- mutate(\n      cast_df,\n      station = cast@data$station[1],\n      cruise_id = cast@data$cruise_id[1]\n    )\n  \n    # drop NA rows left by cleaning\n    cast_df &lt;- subset(cast_df, !is.na(scan))\n    \n    # Append the data to the combined dataframe\n    combined_df &lt;- rbind(combined_df, cast_df)\n  }, error = function(e){\n    print(glue(\"error in cast {cast@metadata$station[1]}\"))\n    print(e)\n  })\n}\n# Save to CSV\nfile_path &lt;- here(glue(\"data/cleaned/{cruise_id}.csv\"))\nwrite.csv(combined_df, file_path, row.names = FALSE)"
  },
  {
    "objectID": "cruise_report/cruise_reports/WS15208.html",
    "href": "cruise_report/cruise_reports/WS15208.html",
    "title": "WS15208",
    "section": "",
    "text": "WS15208\n\n\nsetup\nif (!nzchar(system.file(package = \"librarian\"))) {\n  install.packages(\"librarian\")\n}\n\nlibrarian::shelf(\n  quiet = TRUE,\n  readr, here, fs, ggplot2, glue, \"jiho/castr\", dplyr, oce, patchwork, purrr, tidyr\n)\n\n\n\n\nCode\nsource(here(\"R/cruise_load.R\"))\ncruise_df &lt;- cruise_load(params$cruise_id)\n\n\n\n\nplot depth & pressure vs time elapsed\ntryCatch({\n  plots &lt;- list()\n  \n  for (station_name in unique(cruise_df$station)) {\n    subset_df &lt;- filter(cruise_df, station == station_name)\n    plots[[station_name]] &lt;- ggplot(subset_df, aes(x = time_elapsed)) +\n      geom_point(aes(y = depth), color = \"blue\") +  # Plot depth in blue\n      geom_line(aes(y = sea_water_pressure), color = \"red\") +  # Plot sea water pressure in red\n      ggtitle(glue(\"{station_name}\")) +\n      theme(\n        axis.title.x = element_blank(),\n        axis.title.y = element_blank(),\n        axis.text.x = element_blank(),\n        axis.text.y = element_blank(),\n        axis.ticks.x = element_blank(),\n        axis.ticks.y = element_blank()\n      )  # Remove individual axis titles and text\n  }\n  \n  # drop nulls\n  plots &lt;- purrr::compact(plots)\n  \n  # Combine all plots into a grid\n  combined_plot &lt;- wrap_plots(plots) + \n    plot_layout(ncol = 4) +  # Adjust ncol to set number of columns in the grid\n    plot_annotation(\n      title = \"Depth (blue) and Pressure (red)\",\n      subtitle = \"Each panel represents a different station\",\n      caption = \"Time Elapsed (x-axis) vs Depth & Pressure (y-axis)\"\n    ) +\n    theme(\n      plot.tag = element_text(size = 12, face = \"bold\"),\n      plot.tag.position = \"topleft\",\n      axis.title.x = element_text(margin = margin(t = 10)),\n      axis.title.y = element_text(margin = margin(r = 10))\n    )\n  \n  print(combined_plot)\n}, error = function(er){\n  print(er)\n});\n\n\n&lt;error/rlang_error&gt;\nError in `geom_point()`:\n! Problem while computing aesthetics.\n Error occurred in the 1st layer.\nCaused by error:\n! object 'time_elapsed' not found\n---\nBacktrace:\n     \n  1. base::tryCatch(...)\n  2.  base (local) tryCatchList(expr, classes, parentenv, handlers)\n  3.    base (local) tryCatchOne(expr, names, parentenv, handlers[[1L]])\n  4.      base (local) doTryCatch(return(expr), name, parentenv, handler)\n  5. base::print(combined_plot)\n  6. patchwork:::print.patchwork(combined_plot)\n  7.   patchwork:::build_patchwork(plot, plot$layout$guides %||% \"auto\")\n  8.     base::lapply(x$plots, plot_table, guides = guides)\n  9.       patchwork (local) FUN(X[[i]], ...)\n 10.       patchwork:::plot_table.ggplot(X[[i]], ...)\n 11.         ggplot2::ggplotGrob(x)\n 12.           ggplot2::ggplot_gtable(ggplot_build(x))\n 13.            ggplot2:::attach_plot_env(data$plot$plot_env)\n 14.              base::options(ggplot2_plot_env = env)\n 15.           ggplot2::ggplot_build(x)\n 16.           ggplot2:::ggplot_build.ggplot(x)\n 17.             ggplot2:::by_layer(...)\n 18.               rlang::try_fetch(...)\n 19.                base::tryCatch(...)\n 20.                 base (local) tryCatchList(expr, classes, parentenv, handlers)\n 21.                   base (local) tryCatchOne(expr, names, parentenv, handlers[[1L]])\n 22.                     base (local) doTryCatch(return(expr), name, parentenv, handler)\n 23.                base::withCallingHandlers(...)\n 24.               ggplot2 (local) f(l = layers[[i]], d = data[[i]])\n 25.                 l$compute_aesthetics(d, plot)\n 26.                   ggplot2 (local) compute_aesthetics(..., self = self)\n 27.                     base::lapply(aesthetics, eval_tidy, data = data, env = env)\n 28.                       rlang (local) FUN(X[[i]], ...)\n\n\n\n\nplot across all stations\np &lt;- ggplot(cruise_df, aes(x = time, y = depth, fill = station)) +\n  geom_col() +  # This creates the bars\n  # geom_text(aes(label = station), vjust = -0.3) +  # This adds labels to each bar, adjust vjust for position\n  labs(x = \"Time\", y = \"Depth\", title = \"Depth over Time by Station\") +  # Set labels and title\n  theme_minimal()  # Use a minimal theme\nprint(p)\n\n\n\n\n\n\n\n\n\n\n\ncreate oce.ctd objects from dataframes\nctd_load &lt;- function(data, other_params = NULL) {\n  \n  # create csv into ctd object\n  test_ctd &lt;-\n    as.ctd(\n      salinity    = data$sea_water_salinity,\n      temperature = data$sea_water_temperature,\n      pressure    = data$sea_water_pressure,\n      station     = data$station\n    )\n  \n  # add additional columns to ctd object\n  if (!is.null(other_params)) {\n    for (param_name in other_params) {\n      test_ctd &lt;-\n        oceSetData(\n          object = test_ctd,\n          name   = param_name,\n          value  = data[[param_name]]\n        )\n    }\n  }\n  print(glue(\"{data$station[1]}:\\t{length(test_ctd@data$scan)} scans\"))\n\n\n  return(test_ctd)\n}\n\n# Define other parameters to add\nother_params &lt;- c(\n  \"cruise_id\", \"station\", \"time\", \"time_elapsed\", \n  \"latitude\", \"longitude\", \"sea_water_electrical_conductivity\", \n  \"CDOM\", \"dissolved_oxygen\",\"oxygen_saturation\", \"chlorophyll_concentration\", \n  \"chlorophyll_fluorescence\", \"photosynthetically_available_radiation\", \n  \"beam_attenuation\",\"beam_transmission\", \"depth\", \"sea_water_sigma_t\",\n  \"descent_rate\", \"sound_velocity\",\"altimeter\"\n)\n\n# Split data by station and create data list\nctd_FK &lt;- cruise_df %&gt;%\n  split(.$station) %&gt;%\n  map(~ ctd_load(.x, other_params = other_params)) # ~ is a lambda(x)\n\n\n10: 1783 scans\n12: 2403 scans\n15: 4028 scans\n15.5:   13409 scans\n15.5SURFACE:    443 scans\n16: 825 scans\n18: 3829 scans\n2:  3895 scans\n21.5:   8472 scans\n21/LK:  2914 scans\n22: 3826 scans\n30: 2376 scans\n30B:    1899 scans\n31: 2430 scans\n33: 1341 scans\n41: 1156 scans\n45: 931 scans\n49: 28 scans\n51: 475 scans\n53: 926 scans\n54: 1484 scans\n54B:    97 scans\n55: 2394 scans\n55B:    21 scans\n56: 1349 scans\n56B:    2268 scans\n57: 2151 scans\n57.1:   1482 scans\n57.1B:  1439 scans\n57.2:   2030 scans\n57.2B:  2177 scans\n57.3:   2014 scans\n57.3B:  2387 scans\n57B:    922 scans\n58: 1568 scans\n59: 1836 scans\n6:  2434 scans\n60: 1617 scans\n62: 952 scans\n64: 1603 scans\n65: 4110 scans\n65A:    1542 scans\n68: 1571 scans\n7:  1389 scans\n9:  4182 scans\n9.5:    8605 scans\n9.6:    9783 scans\n9.7:    8709 scans\n9.8:    12744 scans\nMR: 2230 scans\nWS: 4073 scans\n\n\n\n\nplotting scans for each cast in the first list\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # 1 is selecting only the first sublist\n  # print(i)\n  print(glue(\"=== station: {cast@metadata$station[1]}\"))\n  print(glue(\"# scans: {length(cast@data$scan)}\"))\n  plotScan(cast)\n}\n\n\n=== station: 10\n# scans: 1783\n\n\n\n\n\n\n\n\n\n=== station: 12\n# scans: 2403\n\n\n\n\n\n\n\n\n\n=== station: 15\n# scans: 4028\n\n\n\n\n\n\n\n\n\n=== station: 15.5\n# scans: 13409\n\n\n\n\n\n\n\n\n\n=== station: 15.5SURFACE\n# scans: 443\n\n\n\n\n\n\n\n\n\n=== station: 16\n# scans: 825\n\n\n\n\n\n\n\n\n\n=== station: 18\n# scans: 3829\n\n\n\n\n\n\n\n\n\n=== station: 2\n# scans: 3895\n\n\n\n\n\n\n\n\n\n=== station: 21.5\n# scans: 8472\n\n\n\n\n\n\n\n\n\n=== station: 21/LK\n# scans: 2914\n\n\n\n\n\n\n\n\n\n=== station: 22\n# scans: 3826\n\n\n\n\n\n\n\n\n\n=== station: 30\n# scans: 2376\n\n\n\n\n\n\n\n\n\n=== station: 30B\n# scans: 1899\n\n\n\n\n\n\n\n\n\n=== station: 31\n# scans: 2430\n\n\n\n\n\n\n\n\n\n=== station: 33\n# scans: 1341\n\n\n\n\n\n\n\n\n\n=== station: 41\n# scans: 1156\n\n\n\n\n\n\n\n\n\n=== station: 45\n# scans: 931\n\n\n\n\n\n\n\n\n\n=== station: 49\n# scans: 28\n\n\n\n\n\n\n\n\n\n=== station: 51\n# scans: 475\n\n\n\n\n\n\n\n\n\n=== station: 53\n# scans: 926\n\n\n\n\n\n\n\n\n\n=== station: 54\n# scans: 1484\n\n\n\n\n\n\n\n\n\n=== station: 54B\n# scans: 97\n\n\n\n\n\n\n\n\n\n=== station: 55\n# scans: 2394\n\n\n\n\n\n\n\n\n\n=== station: 55B\n# scans: 21\n\n\n\n\n\n\n\n\n\n=== station: 56\n# scans: 1349\n\n\n\n\n\n\n\n\n\n=== station: 56B\n# scans: 2268\n\n\n\n\n\n\n\n\n\n=== station: 57\n# scans: 2151\n\n\n\n\n\n\n\n\n\n=== station: 57.1\n# scans: 1482\n\n\n\n\n\n\n\n\n\n=== station: 57.1B\n# scans: 1439\n\n\n\n\n\n\n\n\n\n=== station: 57.2\n# scans: 2030\n\n\n\n\n\n\n\n\n\n=== station: 57.2B\n# scans: 2177\n\n\n\n\n\n\n\n\n\n=== station: 57.3\n# scans: 2014\n\n\n\n\n\n\n\n\n\n=== station: 57.3B\n# scans: 2387\n\n\n\n\n\n\n\n\n\n=== station: 57B\n# scans: 922\n\n\n\n\n\n\n\n\n\n=== station: 58\n# scans: 1568\n\n\n\n\n\n\n\n\n\n=== station: 59\n# scans: 1836\n\n\n\n\n\n\n\n\n\n=== station: 6\n# scans: 2434\n\n\n\n\n\n\n\n\n\n=== station: 60\n# scans: 1617\n\n\n\n\n\n\n\n\n\n=== station: 62\n# scans: 952\n\n\n\n\n\n\n\n\n\n=== station: 64\n# scans: 1603\n\n\n\n\n\n\n\n\n\n=== station: 65\n# scans: 4110\n\n\n\n\n\n\n\n\n\n=== station: 65A\n# scans: 1542\n\n\n\n\n\n\n\n\n\n=== station: 68\n# scans: 1571\n\n\n\n\n\n\n\n\n\n=== station: 7\n# scans: 1389\n\n\n\n\n\n\n\n\n\n=== station: 9\n# scans: 4182\n\n\n\n\n\n\n\n\n\n=== station: 9.5\n# scans: 8605\n\n\n\n\n\n\n\n\n\n=== station: 9.6\n# scans: 9783\n\n\n\n\n\n\n\n\n\n=== station: 9.7\n# scans: 8709\n\n\n\n\n\n\n\n\n\n=== station: 9.8\n# scans: 12744\n\n\n\n\n\n\n\n\n\n=== station: MR\n# scans: 2230\n\n\n\n\n\n\n\n\n\n=== station: WS\n# scans: 4073\n\n\n\n\n\n\n\n\n\n\n\nplotting each cast in the first list\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # 1 is selecting only the first sublist\n  tryCatch({\n    plot(ctdDecimate(ctdTrim(cast)))\n  }, error = function(e){\n    print(e)\n  })\n}\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1783' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2403' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4028' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 13409' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 825' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3829' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3895' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 8472' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2914' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3826' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2376' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1899' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2430' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1341' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1156' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 931' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 926' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1484' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2394' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1349' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2268' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2151' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1482' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1439' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2030' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2177' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2014' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2387' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 922' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1568' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1836' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2434' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1617' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 952' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1603' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4110' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1542' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1389' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4182' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 8605' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 9783' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 8709' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 12744' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2230' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4073' in coercion to 'logical(1)'&gt;\n\n\n\n\nplotting other physical parameters for each cast\n# Loop through each CTD cast\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # Assuming each sublist contains only one relevant CTD object\n  tryCatch({\n    # Extract metadata for station name and cruise ID\n    station_name &lt;- cast@metadata$station[1]\n    cruise_id &lt;- cast@data$cruise_id[1]\n\n    # Generate a title with station name and cruise ID\n    overall_title &lt;- glue::glue(\"Station: {station_name}, Cruise ID: {cruise_id}\")\n\n    # Set margins: increase the outer margin for the title\n    par(oma = c(0, 0, 3, 0))  # Top outer margin increased for title\n\n    # Plotting function with specific parameters\n    oce::plot(\n      x = ctdDecimate(ctdTrim(cast)),\n      which = c(\n        \"sea_water_electrical_conductivity\",\n        \"descent_rate\", \"sound_velocity\",\n        \"sea_water_sigma_t\",\"altimeter\"\n      ),\n      main = \"\"  # No main title for individual subplots\n    )\n\n    # Place a single overall title at the top of the plot frame\n    mtext(overall_title, side = 3, line = 1, outer = TRUE, cex = 1.5)\n\n    # Reset outer margins to default\n    par(oma = c(0, 0, 0, 0))\n\n  }, error = function(e) {\n    print(e$message)  # Print any errors that occur during plotting\n  })\n}\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n\n\nplotting other nutrient parameters for each cast\n# Loop through each CTD cast\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # Assuming each sublist contains only one relevant CTD object\n  tryCatch({\n    # Extract metadata for station name and cruise ID\n    station_name &lt;- cast@metadata$station[1]\n    cruise_id &lt;- cast@data$cruise_id[1]\n\n    # Generate a title with station name and cruise ID\n    overall_title &lt;- glue::glue(\"Station: {station_name}, Cruise ID: {cruise_id}\")\n\n    # Set margins: increase the outer margin for the title\n    par(oma = c(0, 0, 3, 0))  # Top outer margin increased for title\n\n    # Plotting function with specific parameters\n    oce::plot(\n      x = ctdDecimate(ctdTrim(cast)),\n      which = c(\n        \"CDOM\", \"dissolved_oxygen\",\n        \"oxygen_saturation\",\n        \"chlorophyll_concentration\", \"chlorophyll_fluorescence\"\n      ),\n      main = \"\"  # No main title for individual subplots\n    )\n\n    # Place a single overall title at the top of the plot frame\n    mtext(overall_title, side = 3, line = 1, outer = TRUE, cex = 1.5)\n\n    # Reset outer margins to default\n    par(oma = c(0, 0, 0, 0))\n\n  }, error = function(e) {\n    print(e$message)  # Print any errors that occur during plotting\n  })\n}\n\n\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"plot.new has not been called yet\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n\n\n\n\nplotting other optical parameters for each cast\n# Loop through each CTD cast\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # Assuming each sublist contains only one relevant CTD object\n  tryCatch({\n    # Extract metadata for station name and cruise ID\n    station_name &lt;- cast@metadata$station[1]\n    cruise_id &lt;- cast@data$cruise_id[1]\n\n    # Generate a title with station name and cruise ID\n    overall_title &lt;- glue::glue(\"Station: {station_name}, Cruise ID: {cruise_id}\")\n\n    # Set margins: increase the outer margin for the title\n    par(oma = c(0, 0, 3, 0))  # Top outer margin increased for title\n\n    # Plotting function with specific parameters\n    oce::plot(\n      x = ctdDecimate(ctdTrim(cast)),\n      which = c(\n        \"photosynthetically_available_radiation\",\n        \"beam_attenuation\",\"beam_transmission\"\n      ),\n      main = \"\"  # No main title for individual subplots\n    )\n\n    # Place a single overall title at the top of the plot frame\n    mtext(overall_title, side = 3, line = 1, outer = TRUE, cex = 1.5)\n\n    # Reset outer margins to default\n    par(oma = c(0, 0, 0, 0))\n\n  }, error = function(e) {\n    print(e$message)  # Print any errors that occur during plotting\n  })\n}\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n\n\nloop through every cast, clean, & save\ncombined_df &lt;- data.frame()\nfor (i in seq(ctd_FK)){\n  tryCatch({\n    cast &lt;- ctd_FK[[i]]  # 1 is selecting only the first sublist\n    \n    # print(class(cast))\n    # clean cast \n    trimmed_cast &lt;- ctdTrim(cast)\n    decimated_cast &lt;- ctdDecimate(trimmed_cast, p = 0.5)  # binned to 0.5 m\n    \n    # convert to df\n    cast_df &lt;- as.data.frame(decimated_cast@data)\n    \n    # Add metadata\n    # assumes station ID and cruise ID the same for all & just uses 1st one\n    cast_df &lt;- mutate(\n      cast_df,\n      station = cast@data$station[1],\n      cruise_id = cast@data$cruise_id[1]\n    )\n  \n    # drop NA rows left by cleaning\n    cast_df &lt;- subset(cast_df, !is.na(scan))\n    \n    # Append the data to the combined dataframe\n    combined_df &lt;- rbind(combined_df, cast_df)\n  }, error = function(e){\n    print(glue(\"error in cast {cast@metadata$station[1]}\"))\n    print(e)\n  })\n}\n# Save to CSV\nfile_path &lt;- here(glue(\"data/cleaned/{cruise_id}.csv\"))\nwrite.csv(combined_df, file_path, row.names = FALSE)"
  },
  {
    "objectID": "cruise_report/cruise_reports/WS15320.html",
    "href": "cruise_report/cruise_reports/WS15320.html",
    "title": "WS15320",
    "section": "",
    "text": "WS15320\n\n\nsetup\nif (!nzchar(system.file(package = \"librarian\"))) {\n  install.packages(\"librarian\")\n}\n\nlibrarian::shelf(\n  quiet = TRUE,\n  readr, here, fs, ggplot2, glue, \"jiho/castr\", dplyr, oce, patchwork, purrr, tidyr\n)\n\n\n\n\nCode\nsource(here(\"R/cruise_load.R\"))\ncruise_df &lt;- cruise_load(params$cruise_id)\n\n\n\n\nplot depth & pressure vs time elapsed\ntryCatch({\n  plots &lt;- list()\n  \n  for (station_name in unique(cruise_df$station)) {\n    subset_df &lt;- filter(cruise_df, station == station_name)\n    plots[[station_name]] &lt;- ggplot(subset_df, aes(x = time_elapsed)) +\n      geom_point(aes(y = depth), color = \"blue\") +  # Plot depth in blue\n      geom_line(aes(y = sea_water_pressure), color = \"red\") +  # Plot sea water pressure in red\n      ggtitle(glue(\"{station_name}\")) +\n      theme(\n        axis.title.x = element_blank(),\n        axis.title.y = element_blank(),\n        axis.text.x = element_blank(),\n        axis.text.y = element_blank(),\n        axis.ticks.x = element_blank(),\n        axis.ticks.y = element_blank()\n      )  # Remove individual axis titles and text\n  }\n  \n  # drop nulls\n  plots &lt;- purrr::compact(plots)\n  \n  # Combine all plots into a grid\n  combined_plot &lt;- wrap_plots(plots) + \n    plot_layout(ncol = 4) +  # Adjust ncol to set number of columns in the grid\n    plot_annotation(\n      title = \"Depth (blue) and Pressure (red)\",\n      subtitle = \"Each panel represents a different station\",\n      caption = \"Time Elapsed (x-axis) vs Depth & Pressure (y-axis)\"\n    ) +\n    theme(\n      plot.tag = element_text(size = 12, face = \"bold\"),\n      plot.tag.position = \"topleft\",\n      axis.title.x = element_text(margin = margin(t = 10)),\n      axis.title.y = element_text(margin = margin(r = 10))\n    )\n  \n  print(combined_plot)\n}, error = function(er){\n  print(er)\n});\n\n\n&lt;error/rlang_error&gt;\nError in `geom_point()`:\n! Problem while computing aesthetics.\n Error occurred in the 1st layer.\nCaused by error:\n! object 'time_elapsed' not found\n---\nBacktrace:\n     \n  1. base::tryCatch(...)\n  2.  base (local) tryCatchList(expr, classes, parentenv, handlers)\n  3.    base (local) tryCatchOne(expr, names, parentenv, handlers[[1L]])\n  4.      base (local) doTryCatch(return(expr), name, parentenv, handler)\n  5. base::print(combined_plot)\n  6. patchwork:::print.patchwork(combined_plot)\n  7.   patchwork:::build_patchwork(plot, plot$layout$guides %||% \"auto\")\n  8.     base::lapply(x$plots, plot_table, guides = guides)\n  9.       patchwork (local) FUN(X[[i]], ...)\n 10.       patchwork:::plot_table.ggplot(X[[i]], ...)\n 11.         ggplot2::ggplotGrob(x)\n 12.           ggplot2::ggplot_gtable(ggplot_build(x))\n 13.            ggplot2:::attach_plot_env(data$plot$plot_env)\n 14.              base::options(ggplot2_plot_env = env)\n 15.           ggplot2::ggplot_build(x)\n 16.           ggplot2:::ggplot_build.ggplot(x)\n 17.             ggplot2:::by_layer(...)\n 18.               rlang::try_fetch(...)\n 19.                base::tryCatch(...)\n 20.                 base (local) tryCatchList(expr, classes, parentenv, handlers)\n 21.                   base (local) tryCatchOne(expr, names, parentenv, handlers[[1L]])\n 22.                     base (local) doTryCatch(return(expr), name, parentenv, handler)\n 23.                base::withCallingHandlers(...)\n 24.               ggplot2 (local) f(l = layers[[i]], d = data[[i]])\n 25.                 l$compute_aesthetics(d, plot)\n 26.                   ggplot2 (local) compute_aesthetics(..., self = self)\n 27.                     base::lapply(aesthetics, eval_tidy, data = data, env = env)\n 28.                       rlang (local) FUN(X[[i]], ...)\n\n\n\n\nplot across all stations\np &lt;- ggplot(cruise_df, aes(x = time, y = depth, fill = station)) +\n  geom_col() +  # This creates the bars\n  # geom_text(aes(label = station), vjust = -0.3) +  # This adds labels to each bar, adjust vjust for position\n  labs(x = \"Time\", y = \"Depth\", title = \"Depth over Time by Station\") +  # Set labels and title\n  theme_minimal()  # Use a minimal theme\nprint(p)\n\n\n\n\n\n\n\n\n\n\n\ncreate oce.ctd objects from dataframes\nctd_load &lt;- function(data, other_params = NULL) {\n  \n  # create csv into ctd object\n  test_ctd &lt;-\n    as.ctd(\n      salinity    = data$sea_water_salinity,\n      temperature = data$sea_water_temperature,\n      pressure    = data$sea_water_pressure,\n      station     = data$station\n    )\n  \n  # add additional columns to ctd object\n  if (!is.null(other_params)) {\n    for (param_name in other_params) {\n      test_ctd &lt;-\n        oceSetData(\n          object = test_ctd,\n          name   = param_name,\n          value  = data[[param_name]]\n        )\n    }\n  }\n  print(glue(\"{data$station[1]}:\\t{length(test_ctd@data$scan)} scans\"))\n\n\n  return(test_ctd)\n}\n\n# Define other parameters to add\nother_params &lt;- c(\n  \"cruise_id\", \"station\", \"time\", \"time_elapsed\", \n  \"latitude\", \"longitude\", \"sea_water_electrical_conductivity\", \n  \"CDOM\", \"dissolved_oxygen\",\"oxygen_saturation\", \"chlorophyll_concentration\", \n  \"chlorophyll_fluorescence\", \"photosynthetically_available_radiation\", \n  \"beam_attenuation\",\"beam_transmission\", \"depth\", \"sea_water_sigma_t\",\n  \"descent_rate\", \"sound_velocity\",\"altimeter\"\n)\n\n# Split data by station and create data list\nctd_FK &lt;- cruise_df %&gt;%\n  split(.$station) %&gt;%\n  map(~ ctd_load(.x, other_params = other_params)) # ~ is a lambda(x)\n\n\n10: 1356 scans\n12: 2905 scans\n16: 1949 scans\n18: 3794 scans\n2:  3256 scans\n21/LK:  2750 scans\n30: 4457 scans\n31: 2769 scans\n33: 2198 scans\n41: 1180 scans\n45: 1996 scans\n49: 668 scans\n51: 1439 scans\n53: 1862 scans\n54: 1357 scans\n54B:    26 scans\n55: 772 scans\n55B:    1 scans\n56: 1775 scans\n56B:    76 scans\n57: 1298 scans\n57.1:   1493 scans\n57.1B:  1187 scans\n57.2:   2109 scans\n57.2B:  1676 scans\n57.3:   1985 scans\n57.3B:  2505 scans\n57B:    949 scans\n58: 2040 scans\n60: 1139 scans\n64: 15 scans\n65: 14 scans\n68: 1767 scans\n9.5:    7813 scans\nMR: 3019 scans\nWS: 2699 scans\n\n\n\n\nplotting scans for each cast in the first list\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # 1 is selecting only the first sublist\n  # print(i)\n  print(glue(\"=== station: {cast@metadata$station[1]}\"))\n  print(glue(\"# scans: {length(cast@data$scan)}\"))\n  plotScan(cast)\n}\n\n\n=== station: 10\n# scans: 1356\n\n\n\n\n\n\n\n\n\n=== station: 12\n# scans: 2905\n\n\n\n\n\n\n\n\n\n=== station: 16\n# scans: 1949\n\n\n\n\n\n\n\n\n\n=== station: 18\n# scans: 3794\n\n\n\n\n\n\n\n\n\n=== station: 2\n# scans: 3256\n\n\n\n\n\n\n\n\n\n=== station: 21/LK\n# scans: 2750\n\n\n\n\n\n\n\n\n\n=== station: 30\n# scans: 4457\n\n\n\n\n\n\n\n\n\n=== station: 31\n# scans: 2769\n\n\n\n\n\n\n\n\n\n=== station: 33\n# scans: 2198\n\n\n\n\n\n\n\n\n\n=== station: 41\n# scans: 1180\n\n\n\n\n\n\n\n\n\n=== station: 45\n# scans: 1996\n\n\n\n\n\n\n\n\n\n=== station: 49\n# scans: 668\n\n\n\n\n\n\n\n\n\n=== station: 51\n# scans: 1439\n\n\n\n\n\n\n\n\n\n=== station: 53\n# scans: 1862\n\n\n\n\n\n\n\n\n\n=== station: 54\n# scans: 1357\n\n\n\n\n\n\n\n\n\n=== station: 54B\n# scans: 26\n\n\n\n\n\n\n\n\n\n=== station: 55\n# scans: 772\n\n\n\n\n\n\n\n\n\n=== station: 55B\n# scans: 1\n\n\n\n\n\n\n\n\n\n=== station: 56\n# scans: 1775\n\n\n\n\n\n\n\n\n\n=== station: 56B\n# scans: 76\n\n\n\n\n\n\n\n\n\n=== station: 57\n# scans: 1298\n\n\n\n\n\n\n\n\n\n=== station: 57.1\n# scans: 1493\n\n\n\n\n\n\n\n\n\n=== station: 57.1B\n# scans: 1187\n\n\n\n\n\n\n\n\n\n=== station: 57.2\n# scans: 2109\n\n\n\n\n\n\n\n\n\n=== station: 57.2B\n# scans: 1676\n\n\n\n\n\n\n\n\n\n=== station: 57.3\n# scans: 1985\n\n\n\n\n\n\n\n\n\n=== station: 57.3B\n# scans: 2505\n\n\n\n\n\n\n\n\n\n=== station: 57B\n# scans: 949\n\n\n\n\n\n\n\n\n\n=== station: 58\n# scans: 2040\n\n\n\n\n\n\n\n\n\n=== station: 60\n# scans: 1139\n\n\n\n\n\n\n\n\n\n=== station: 64\n# scans: 15\n\n\n\n\n\n\n\n\n\n=== station: 65\n# scans: 14\n\n\n\n\n\n\n\n\n\n=== station: 68\n# scans: 1767\n\n\n\n\n\n\n\n\n\n=== station: 9.5\n# scans: 7813\n\n\n\n\n\n\n\n\n\n=== station: MR\n# scans: 3019\n\n\n\n\n\n\n\n\n\n=== station: WS\n# scans: 2699\n\n\n\n\n\n\n\n\n\n\n\nplotting each cast in the first list\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # 1 is selecting only the first sublist\n  tryCatch({\n    plot(ctdDecimate(ctdTrim(cast)))\n  }, error = function(e){\n    print(e)\n  })\n}\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1356' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2905' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1949' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3794' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3256' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2750' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4457' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2769' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2198' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1180' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1996' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 668' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1439' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1862' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 26' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 772' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1775' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1298' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1493' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1187' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2109' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1676' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1985' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2505' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 949' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2040' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1139' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 15' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1767' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 7813' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3019' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2699' in coercion to 'logical(1)'&gt;\n\n\n\n\nplotting other physical parameters for each cast\n# Loop through each CTD cast\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # Assuming each sublist contains only one relevant CTD object\n  tryCatch({\n    # Extract metadata for station name and cruise ID\n    station_name &lt;- cast@metadata$station[1]\n    cruise_id &lt;- cast@data$cruise_id[1]\n\n    # Generate a title with station name and cruise ID\n    overall_title &lt;- glue::glue(\"Station: {station_name}, Cruise ID: {cruise_id}\")\n\n    # Set margins: increase the outer margin for the title\n    par(oma = c(0, 0, 3, 0))  # Top outer margin increased for title\n\n    # Plotting function with specific parameters\n    oce::plot(\n      x = ctdDecimate(ctdTrim(cast)),\n      which = c(\n        \"sea_water_electrical_conductivity\",\n        \"descent_rate\", \"sound_velocity\",\n        \"sea_water_sigma_t\",\"altimeter\"\n      ),\n      main = \"\"  # No main title for individual subplots\n    )\n\n    # Place a single overall title at the top of the plot frame\n    mtext(overall_title, side = 3, line = 1, outer = TRUE, cex = 1.5)\n\n    # Reset outer margins to default\n    par(oma = c(0, 0, 0, 0))\n\n  }, error = function(e) {\n    print(e$message)  # Print any errors that occur during plotting\n  })\n}\n\n\n\n\n\n\n\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n[1] \"unknown xtype value (\\\"5.301254\\\")\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n\n\nplotting other nutrient parameters for each cast\n# Loop through each CTD cast\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # Assuming each sublist contains only one relevant CTD object\n  tryCatch({\n    # Extract metadata for station name and cruise ID\n    station_name &lt;- cast@metadata$station[1]\n    cruise_id &lt;- cast@data$cruise_id[1]\n\n    # Generate a title with station name and cruise ID\n    overall_title &lt;- glue::glue(\"Station: {station_name}, Cruise ID: {cruise_id}\")\n\n    # Set margins: increase the outer margin for the title\n    par(oma = c(0, 0, 3, 0))  # Top outer margin increased for title\n\n    # Plotting function with specific parameters\n    oce::plot(\n      x = ctdDecimate(ctdTrim(cast)),\n      which = c(\n        \"CDOM\", \"dissolved_oxygen\",\n        \"oxygen_saturation\",\n        \"chlorophyll_concentration\", \"chlorophyll_fluorescence\"\n      ),\n      main = \"\"  # No main title for individual subplots\n    )\n\n    # Place a single overall title at the top of the plot frame\n    mtext(overall_title, side = 3, line = 1, outer = TRUE, cex = 1.5)\n\n    # Reset outer margins to default\n    par(oma = c(0, 0, 0, 0))\n\n  }, error = function(e) {\n    print(e$message)  # Print any errors that occur during plotting\n  })\n}\n\n\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"plot.new has not been called yet\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"plot.new has not been called yet\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n\n\n\n\nplotting other optical parameters for each cast\n# Loop through each CTD cast\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # Assuming each sublist contains only one relevant CTD object\n  tryCatch({\n    # Extract metadata for station name and cruise ID\n    station_name &lt;- cast@metadata$station[1]\n    cruise_id &lt;- cast@data$cruise_id[1]\n\n    # Generate a title with station name and cruise ID\n    overall_title &lt;- glue::glue(\"Station: {station_name}, Cruise ID: {cruise_id}\")\n\n    # Set margins: increase the outer margin for the title\n    par(oma = c(0, 0, 3, 0))  # Top outer margin increased for title\n\n    # Plotting function with specific parameters\n    oce::plot(\n      x = ctdDecimate(ctdTrim(cast)),\n      which = c(\n        \"photosynthetically_available_radiation\",\n        \"beam_attenuation\",\"beam_transmission\"\n      ),\n      main = \"\"  # No main title for individual subplots\n    )\n\n    # Place a single overall title at the top of the plot frame\n    mtext(overall_title, side = 3, line = 1, outer = TRUE, cex = 1.5)\n\n    # Reset outer margins to default\n    par(oma = c(0, 0, 0, 0))\n\n  }, error = function(e) {\n    print(e$message)  # Print any errors that occur during plotting\n  })\n}\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"unknown xtype value (\\\"0.39348\\\")\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n\n\nloop through every cast, clean, & save\ncombined_df &lt;- data.frame()\nfor (i in seq(ctd_FK)){\n  tryCatch({\n    cast &lt;- ctd_FK[[i]]  # 1 is selecting only the first sublist\n    \n    # print(class(cast))\n    # clean cast \n    trimmed_cast &lt;- ctdTrim(cast)\n    decimated_cast &lt;- ctdDecimate(trimmed_cast, p = 0.5)  # binned to 0.5 m\n    \n    # convert to df\n    cast_df &lt;- as.data.frame(decimated_cast@data)\n    \n    # Add metadata\n    # assumes station ID and cruise ID the same for all & just uses 1st one\n    cast_df &lt;- mutate(\n      cast_df,\n      station = cast@data$station[1],\n      cruise_id = cast@data$cruise_id[1]\n    )\n  \n    # drop NA rows left by cleaning\n    cast_df &lt;- subset(cast_df, !is.na(scan))\n    \n    # Append the data to the combined dataframe\n    combined_df &lt;- rbind(combined_df, cast_df)\n  }, error = function(e){\n    print(glue(\"error in cast {cast@metadata$station[1]}\"))\n    print(e)\n  })\n}\n# Save to CSV\nfile_path &lt;- here(glue(\"data/cleaned/{cruise_id}.csv\"))\nwrite.csv(combined_df, file_path, row.names = FALSE)"
  },
  {
    "objectID": "cruise_report/cruise_reports/WS16074.html",
    "href": "cruise_report/cruise_reports/WS16074.html",
    "title": "WS16074",
    "section": "",
    "text": "WS16074\n\n\nsetup\nif (!nzchar(system.file(package = \"librarian\"))) {\n  install.packages(\"librarian\")\n}\n\nlibrarian::shelf(\n  quiet = TRUE,\n  readr, here, fs, ggplot2, glue, \"jiho/castr\", dplyr, oce, patchwork, purrr, tidyr\n)\n\n\n\n\nCode\nsource(here(\"R/cruise_load.R\"))\ncruise_df &lt;- cruise_load(params$cruise_id)\n\n\n\n\nplot depth & pressure vs time elapsed\ntryCatch({\n  plots &lt;- list()\n  \n  for (station_name in unique(cruise_df$station)) {\n    subset_df &lt;- filter(cruise_df, station == station_name)\n    plots[[station_name]] &lt;- ggplot(subset_df, aes(x = time_elapsed)) +\n      geom_point(aes(y = depth), color = \"blue\") +  # Plot depth in blue\n      geom_line(aes(y = sea_water_pressure), color = \"red\") +  # Plot sea water pressure in red\n      ggtitle(glue(\"{station_name}\")) +\n      theme(\n        axis.title.x = element_blank(),\n        axis.title.y = element_blank(),\n        axis.text.x = element_blank(),\n        axis.text.y = element_blank(),\n        axis.ticks.x = element_blank(),\n        axis.ticks.y = element_blank()\n      )  # Remove individual axis titles and text\n  }\n  \n  # drop nulls\n  plots &lt;- purrr::compact(plots)\n  \n  # Combine all plots into a grid\n  combined_plot &lt;- wrap_plots(plots) + \n    plot_layout(ncol = 4) +  # Adjust ncol to set number of columns in the grid\n    plot_annotation(\n      title = \"Depth (blue) and Pressure (red)\",\n      subtitle = \"Each panel represents a different station\",\n      caption = \"Time Elapsed (x-axis) vs Depth & Pressure (y-axis)\"\n    ) +\n    theme(\n      plot.tag = element_text(size = 12, face = \"bold\"),\n      plot.tag.position = \"topleft\",\n      axis.title.x = element_text(margin = margin(t = 10)),\n      axis.title.y = element_text(margin = margin(r = 10))\n    )\n  \n  print(combined_plot)\n}, error = function(er){\n  print(er)\n});\n\n\n&lt;error/rlang_error&gt;\nError in `geom_point()`:\n! Problem while computing aesthetics.\n Error occurred in the 1st layer.\nCaused by error:\n! object 'time_elapsed' not found\n---\nBacktrace:\n     \n  1. base::tryCatch(...)\n  2.  base (local) tryCatchList(expr, classes, parentenv, handlers)\n  3.    base (local) tryCatchOne(expr, names, parentenv, handlers[[1L]])\n  4.      base (local) doTryCatch(return(expr), name, parentenv, handler)\n  5. base::print(combined_plot)\n  6. patchwork:::print.patchwork(combined_plot)\n  7.   patchwork:::build_patchwork(plot, plot$layout$guides %||% \"auto\")\n  8.     base::lapply(x$plots, plot_table, guides = guides)\n  9.       patchwork (local) FUN(X[[i]], ...)\n 10.       patchwork:::plot_table.ggplot(X[[i]], ...)\n 11.         ggplot2::ggplotGrob(x)\n 12.           ggplot2::ggplot_gtable(ggplot_build(x))\n 13.            ggplot2:::attach_plot_env(data$plot$plot_env)\n 14.              base::options(ggplot2_plot_env = env)\n 15.           ggplot2::ggplot_build(x)\n 16.           ggplot2:::ggplot_build.ggplot(x)\n 17.             ggplot2:::by_layer(...)\n 18.               rlang::try_fetch(...)\n 19.                base::tryCatch(...)\n 20.                 base (local) tryCatchList(expr, classes, parentenv, handlers)\n 21.                   base (local) tryCatchOne(expr, names, parentenv, handlers[[1L]])\n 22.                     base (local) doTryCatch(return(expr), name, parentenv, handler)\n 23.                base::withCallingHandlers(...)\n 24.               ggplot2 (local) f(l = layers[[i]], d = data[[i]])\n 25.                 l$compute_aesthetics(d, plot)\n 26.                   ggplot2 (local) compute_aesthetics(..., self = self)\n 27.                     base::lapply(aesthetics, eval_tidy, data = data, env = env)\n 28.                       rlang (local) FUN(X[[i]], ...)\n\n\n\n\nplot across all stations\np &lt;- ggplot(cruise_df, aes(x = time, y = depth, fill = station)) +\n  geom_col() +  # This creates the bars\n  # geom_text(aes(label = station), vjust = -0.3) +  # This adds labels to each bar, adjust vjust for position\n  labs(x = \"Time\", y = \"Depth\", title = \"Depth over Time by Station\") +  # Set labels and title\n  theme_minimal()  # Use a minimal theme\nprint(p)\n\n\n\n\n\n\n\n\n\n\n\ncreate oce.ctd objects from dataframes\nctd_load &lt;- function(data, other_params = NULL) {\n  \n  # create csv into ctd object\n  test_ctd &lt;-\n    as.ctd(\n      salinity    = data$sea_water_salinity,\n      temperature = data$sea_water_temperature,\n      pressure    = data$sea_water_pressure,\n      station     = data$station\n    )\n  \n  # add additional columns to ctd object\n  if (!is.null(other_params)) {\n    for (param_name in other_params) {\n      test_ctd &lt;-\n        oceSetData(\n          object = test_ctd,\n          name   = param_name,\n          value  = data[[param_name]]\n        )\n    }\n  }\n  print(glue(\"{data$station[1]}:\\t{length(test_ctd@data$scan)} scans\"))\n\n\n  return(test_ctd)\n}\n\n# Define other parameters to add\nother_params &lt;- c(\n  \"cruise_id\", \"station\", \"time\", \"time_elapsed\", \n  \"latitude\", \"longitude\", \"sea_water_electrical_conductivity\", \n  \"CDOM\", \"dissolved_oxygen\",\"oxygen_saturation\", \"chlorophyll_concentration\", \n  \"chlorophyll_fluorescence\", \"photosynthetically_available_radiation\", \n  \"beam_attenuation\",\"beam_transmission\", \"depth\", \"sea_water_sigma_t\",\n  \"descent_rate\", \"sound_velocity\",\"altimeter\"\n)\n\n# Split data by station and create data list\nctd_FK &lt;- cruise_df %&gt;%\n  split(.$station) %&gt;%\n  map(~ ctd_load(.x, other_params = other_params)) # ~ is a lambda(x)\n\n\n10: 1737 scans\n12: 1747 scans\n16: 1179 scans\n18: 3305 scans\n2:  1784 scans\n21/LK:  4419 scans\n30: 2836 scans\n31: 1696 scans\n33: 957 scans\n41: 454 scans\n45: 851 scans\n49: 460 scans\n51: 903 scans\n53: 19 scans\n54: 1485 scans\n54B:    52 scans\n55: 97 scans\n55B:    15 scans\n56: 52 scans\n56B:    4 scans\n57: 1030 scans\n57.1:   1465 scans\n57.1B:  2643 scans\n57.2:   1486 scans\n57.2B:  2121 scans\n57.3:   2764 scans\n57.3B:  2089 scans\n57B:    1184 scans\n58: 1218 scans\n59: 1160 scans\n60: 65 scans\n62: 35 scans\n64: 22 scans\n65: 393 scans\n68: 39 scans\n7:  74 scans\n9:  2583 scans\nMR: 3790 scans\nWS: 3206 scans\n\n\n\n\nplotting scans for each cast in the first list\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # 1 is selecting only the first sublist\n  # print(i)\n  print(glue(\"=== station: {cast@metadata$station[1]}\"))\n  print(glue(\"# scans: {length(cast@data$scan)}\"))\n  plotScan(cast)\n}\n\n\n=== station: 10\n# scans: 1737\n\n\n\n\n\n\n\n\n\n=== station: 12\n# scans: 1747\n\n\n\n\n\n\n\n\n\n=== station: 16\n# scans: 1179\n\n\n\n\n\n\n\n\n\n=== station: 18\n# scans: 3305\n\n\n\n\n\n\n\n\n\n=== station: 2\n# scans: 1784\n\n\n\n\n\n\n\n\n\n=== station: 21/LK\n# scans: 4419\n\n\n\n\n\n\n\n\n\n=== station: 30\n# scans: 2836\n\n\n\n\n\n\n\n\n\n=== station: 31\n# scans: 1696\n\n\n\n\n\n\n\n\n\n=== station: 33\n# scans: 957\n\n\n\n\n\n\n\n\n\n=== station: 41\n# scans: 454\n\n\n\n\n\n\n\n\n\n=== station: 45\n# scans: 851\n\n\n\n\n\n\n\n\n\n=== station: 49\n# scans: 460\n\n\n\n\n\n\n\n\n\n=== station: 51\n# scans: 903\n\n\n\n\n\n\n\n\n\n=== station: 53\n# scans: 19\n\n\n\n\n\n\n\n\n\n=== station: 54\n# scans: 1485\n\n\n\n\n\n\n\n\n\n=== station: 54B\n# scans: 52\n\n\n\n\n\n\n\n\n\n=== station: 55\n# scans: 97\n\n\n\n\n\n\n\n\n\n=== station: 55B\n# scans: 15\n\n\n\n\n\n\n\n\n\n=== station: 56\n# scans: 52\n\n\n\n\n\n\n\n\n\n=== station: 56B\n# scans: 4\n\n\n\n\n\n\n\n\n\n=== station: 57\n# scans: 1030\n\n\n\n\n\n\n\n\n\n=== station: 57.1\n# scans: 1465\n\n\n\n\n\n\n\n\n\n=== station: 57.1B\n# scans: 2643\n\n\n\n\n\n\n\n\n\n=== station: 57.2\n# scans: 1486\n\n\n\n\n\n\n\n\n\n=== station: 57.2B\n# scans: 2121\n\n\n\n\n\n\n\n\n\n=== station: 57.3\n# scans: 2764\n\n\n\n\n\n\n\n\n\n=== station: 57.3B\n# scans: 2089\n\n\n\n\n\n\n\n\n\n=== station: 57B\n# scans: 1184\n\n\n\n\n\n\n\n\n\n=== station: 58\n# scans: 1218\n\n\n\n\n\n\n\n\n\n=== station: 59\n# scans: 1160\n\n\n\n\n\n\n\n\n\n=== station: 60\n# scans: 65\n\n\n\n\n\n\n\n\n\n=== station: 62\n# scans: 35\n\n\n\n\n\n\n\n\n\n=== station: 64\n# scans: 22\n\n\n\n\n\n\n\n\n\n=== station: 65\n# scans: 393\n\n\n\n\n\n\n\n\n\n=== station: 68\n# scans: 39\n\n\n\n\n\n\n\n\n\n=== station: 7\n# scans: 74\n\n\n\n\n\n\n\n\n\n=== station: 9\n# scans: 2583\n\n\n\n\n\n\n\n\n\n=== station: MR\n# scans: 3790\n\n\n\n\n\n\n\n\n\n=== station: WS\n# scans: 3206\n\n\n\n\n\n\n\n\n\n\n\nplotting each cast in the first list\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # 1 is selecting only the first sublist\n  tryCatch({\n    plot(ctdDecimate(ctdTrim(cast)))\n  }, error = function(e){\n    print(e)\n  })\n}\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1737' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1747' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1179' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3305' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1784' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4419' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2836' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1696' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 957' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 851' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 460' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 903' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1485' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 52' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 97' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 15' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1030' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1465' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2643' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1486' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2121' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2764' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2089' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1184' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1218' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1160' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 65' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 35' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 22' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 393' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2583' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3790' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3206' in coercion to 'logical(1)'&gt;\n\n\n\n\nplotting other physical parameters for each cast\n# Loop through each CTD cast\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # Assuming each sublist contains only one relevant CTD object\n  tryCatch({\n    # Extract metadata for station name and cruise ID\n    station_name &lt;- cast@metadata$station[1]\n    cruise_id &lt;- cast@data$cruise_id[1]\n\n    # Generate a title with station name and cruise ID\n    overall_title &lt;- glue::glue(\"Station: {station_name}, Cruise ID: {cruise_id}\")\n\n    # Set margins: increase the outer margin for the title\n    par(oma = c(0, 0, 3, 0))  # Top outer margin increased for title\n\n    # Plotting function with specific parameters\n    oce::plot(\n      x = ctdDecimate(ctdTrim(cast)),\n      which = c(\n        \"sea_water_electrical_conductivity\",\n        \"descent_rate\", \"sound_velocity\",\n        \"sea_water_sigma_t\",\"altimeter\"\n      ),\n      main = \"\"  # No main title for individual subplots\n    )\n\n    # Place a single overall title at the top of the plot frame\n    mtext(overall_title, side = 3, line = 1, outer = TRUE, cex = 1.5)\n\n    # Reset outer margins to default\n    par(oma = c(0, 0, 0, 0))\n\n  }, error = function(e) {\n    print(e$message)  # Print any errors that occur during plotting\n  })\n}\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n\n\nplotting other nutrient parameters for each cast\n# Loop through each CTD cast\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # Assuming each sublist contains only one relevant CTD object\n  tryCatch({\n    # Extract metadata for station name and cruise ID\n    station_name &lt;- cast@metadata$station[1]\n    cruise_id &lt;- cast@data$cruise_id[1]\n\n    # Generate a title with station name and cruise ID\n    overall_title &lt;- glue::glue(\"Station: {station_name}, Cruise ID: {cruise_id}\")\n\n    # Set margins: increase the outer margin for the title\n    par(oma = c(0, 0, 3, 0))  # Top outer margin increased for title\n\n    # Plotting function with specific parameters\n    oce::plot(\n      x = ctdDecimate(ctdTrim(cast)),\n      which = c(\n        \"CDOM\", \"dissolved_oxygen\",\n        \"oxygen_saturation\",\n        \"chlorophyll_concentration\", \"chlorophyll_fluorescence\"\n      ),\n      main = \"\"  # No main title for individual subplots\n    )\n\n    # Place a single overall title at the top of the plot frame\n    mtext(overall_title, side = 3, line = 1, outer = TRUE, cex = 1.5)\n\n    # Reset outer margins to default\n    par(oma = c(0, 0, 0, 0))\n\n  }, error = function(e) {\n    print(e$message)  # Print any errors that occur during plotting\n  })\n}\n\n\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"plot.new has not been called yet\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"plot.new has not been called yet\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n\n\n\n\nplotting other optical parameters for each cast\n# Loop through each CTD cast\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # Assuming each sublist contains only one relevant CTD object\n  tryCatch({\n    # Extract metadata for station name and cruise ID\n    station_name &lt;- cast@metadata$station[1]\n    cruise_id &lt;- cast@data$cruise_id[1]\n\n    # Generate a title with station name and cruise ID\n    overall_title &lt;- glue::glue(\"Station: {station_name}, Cruise ID: {cruise_id}\")\n\n    # Set margins: increase the outer margin for the title\n    par(oma = c(0, 0, 3, 0))  # Top outer margin increased for title\n\n    # Plotting function with specific parameters\n    oce::plot(\n      x = ctdDecimate(ctdTrim(cast)),\n      which = c(\n        \"photosynthetically_available_radiation\",\n        \"beam_attenuation\",\"beam_transmission\"\n      ),\n      main = \"\"  # No main title for individual subplots\n    )\n\n    # Place a single overall title at the top of the plot frame\n    mtext(overall_title, side = 3, line = 1, outer = TRUE, cex = 1.5)\n\n    # Reset outer margins to default\n    par(oma = c(0, 0, 0, 0))\n\n  }, error = function(e) {\n    print(e$message)  # Print any errors that occur during plotting\n  })\n}\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n\n\nloop through every cast, clean, & save\ncombined_df &lt;- data.frame()\nfor (i in seq(ctd_FK)){\n  tryCatch({\n    cast &lt;- ctd_FK[[i]]  # 1 is selecting only the first sublist\n    \n    # print(class(cast))\n    # clean cast \n    trimmed_cast &lt;- ctdTrim(cast)\n    decimated_cast &lt;- ctdDecimate(trimmed_cast, p = 0.5)  # binned to 0.5 m\n    \n    # convert to df\n    cast_df &lt;- as.data.frame(decimated_cast@data)\n    \n    # Add metadata\n    # assumes station ID and cruise ID the same for all & just uses 1st one\n    cast_df &lt;- mutate(\n      cast_df,\n      station = cast@data$station[1],\n      cruise_id = cast@data$cruise_id[1]\n    )\n  \n    # drop NA rows left by cleaning\n    cast_df &lt;- subset(cast_df, !is.na(scan))\n    \n    # Append the data to the combined dataframe\n    combined_df &lt;- rbind(combined_df, cast_df)\n  }, error = function(e){\n    print(glue(\"error in cast {cast@metadata$station[1]}\"))\n    print(e)\n  })\n}\n# Save to CSV\nfile_path &lt;- here(glue(\"data/cleaned/{cruise_id}.csv\"))\nwrite.csv(combined_df, file_path, row.names = FALSE)"
  },
  {
    "objectID": "cruise_report/cruise_reports/WS16263.html",
    "href": "cruise_report/cruise_reports/WS16263.html",
    "title": "WS16263",
    "section": "",
    "text": "WS16263\n\n\nsetup\nif (!nzchar(system.file(package = \"librarian\"))) {\n  install.packages(\"librarian\")\n}\n\nlibrarian::shelf(\n  quiet = TRUE,\n  readr, here, fs, ggplot2, glue, \"jiho/castr\", dplyr, oce, patchwork, purrr, tidyr\n)\n\n\n\n\nCode\nsource(here(\"R/cruise_load.R\"))\ncruise_df &lt;- cruise_load(params$cruise_id)\n\n\n\n\nplot depth & pressure vs time elapsed\ntryCatch({\n  plots &lt;- list()\n  \n  for (station_name in unique(cruise_df$station)) {\n    subset_df &lt;- filter(cruise_df, station == station_name)\n    plots[[station_name]] &lt;- ggplot(subset_df, aes(x = time_elapsed)) +\n      geom_point(aes(y = depth), color = \"blue\") +  # Plot depth in blue\n      geom_line(aes(y = sea_water_pressure), color = \"red\") +  # Plot sea water pressure in red\n      ggtitle(glue(\"{station_name}\")) +\n      theme(\n        axis.title.x = element_blank(),\n        axis.title.y = element_blank(),\n        axis.text.x = element_blank(),\n        axis.text.y = element_blank(),\n        axis.ticks.x = element_blank(),\n        axis.ticks.y = element_blank()\n      )  # Remove individual axis titles and text\n  }\n  \n  # drop nulls\n  plots &lt;- purrr::compact(plots)\n  \n  # Combine all plots into a grid\n  combined_plot &lt;- wrap_plots(plots) + \n    plot_layout(ncol = 4) +  # Adjust ncol to set number of columns in the grid\n    plot_annotation(\n      title = \"Depth (blue) and Pressure (red)\",\n      subtitle = \"Each panel represents a different station\",\n      caption = \"Time Elapsed (x-axis) vs Depth & Pressure (y-axis)\"\n    ) +\n    theme(\n      plot.tag = element_text(size = 12, face = \"bold\"),\n      plot.tag.position = \"topleft\",\n      axis.title.x = element_text(margin = margin(t = 10)),\n      axis.title.y = element_text(margin = margin(r = 10))\n    )\n  \n  print(combined_plot)\n}, error = function(er){\n  print(er)\n});\n\n\n&lt;error/rlang_error&gt;\nError in `geom_point()`:\n! Problem while computing aesthetics.\n Error occurred in the 1st layer.\nCaused by error:\n! object 'time_elapsed' not found\n---\nBacktrace:\n     \n  1. base::tryCatch(...)\n  2.  base (local) tryCatchList(expr, classes, parentenv, handlers)\n  3.    base (local) tryCatchOne(expr, names, parentenv, handlers[[1L]])\n  4.      base (local) doTryCatch(return(expr), name, parentenv, handler)\n  5. base::print(combined_plot)\n  6. patchwork:::print.patchwork(combined_plot)\n  7.   patchwork:::build_patchwork(plot, plot$layout$guides %||% \"auto\")\n  8.     base::lapply(x$plots, plot_table, guides = guides)\n  9.       patchwork (local) FUN(X[[i]], ...)\n 10.       patchwork:::plot_table.ggplot(X[[i]], ...)\n 11.         ggplot2::ggplotGrob(x)\n 12.           ggplot2::ggplot_gtable(ggplot_build(x))\n 13.            ggplot2:::attach_plot_env(data$plot$plot_env)\n 14.              base::options(ggplot2_plot_env = env)\n 15.           ggplot2::ggplot_build(x)\n 16.           ggplot2:::ggplot_build.ggplot(x)\n 17.             ggplot2:::by_layer(...)\n 18.               rlang::try_fetch(...)\n 19.                base::tryCatch(...)\n 20.                 base (local) tryCatchList(expr, classes, parentenv, handlers)\n 21.                   base (local) tryCatchOne(expr, names, parentenv, handlers[[1L]])\n 22.                     base (local) doTryCatch(return(expr), name, parentenv, handler)\n 23.                base::withCallingHandlers(...)\n 24.               ggplot2 (local) f(l = layers[[i]], d = data[[i]])\n 25.                 l$compute_aesthetics(d, plot)\n 26.                   ggplot2 (local) compute_aesthetics(..., self = self)\n 27.                     base::lapply(aesthetics, eval_tidy, data = data, env = env)\n 28.                       rlang (local) FUN(X[[i]], ...)\n\n\n\n\nplot across all stations\np &lt;- ggplot(cruise_df, aes(x = time, y = depth, fill = station)) +\n  geom_col() +  # This creates the bars\n  # geom_text(aes(label = station), vjust = -0.3) +  # This adds labels to each bar, adjust vjust for position\n  labs(x = \"Time\", y = \"Depth\", title = \"Depth over Time by Station\") +  # Set labels and title\n  theme_minimal()  # Use a minimal theme\nprint(p)\n\n\n\n\n\n\n\n\n\n\n\ncreate oce.ctd objects from dataframes\nctd_load &lt;- function(data, other_params = NULL) {\n  \n  # create csv into ctd object\n  test_ctd &lt;-\n    as.ctd(\n      salinity    = data$sea_water_salinity,\n      temperature = data$sea_water_temperature,\n      pressure    = data$sea_water_pressure,\n      station     = data$station\n    )\n  \n  # add additional columns to ctd object\n  if (!is.null(other_params)) {\n    for (param_name in other_params) {\n      test_ctd &lt;-\n        oceSetData(\n          object = test_ctd,\n          name   = param_name,\n          value  = data[[param_name]]\n        )\n    }\n  }\n  print(glue(\"{data$station[1]}:\\t{length(test_ctd@data$scan)} scans\"))\n\n\n  return(test_ctd)\n}\n\n# Define other parameters to add\nother_params &lt;- c(\n  \"cruise_id\", \"station\", \"time\", \"time_elapsed\", \n  \"latitude\", \"longitude\", \"sea_water_electrical_conductivity\", \n  \"CDOM\", \"dissolved_oxygen\",\"oxygen_saturation\", \"chlorophyll_concentration\", \n  \"chlorophyll_fluorescence\", \"photosynthetically_available_radiation\", \n  \"beam_attenuation\",\"beam_transmission\", \"depth\", \"sea_water_sigma_t\",\n  \"descent_rate\", \"sound_velocity\",\"altimeter\"\n)\n\n# Split data by station and create data list\nctd_FK &lt;- cruise_df %&gt;%\n  split(.$station) %&gt;%\n  map(~ ctd_load(.x, other_params = other_params)) # ~ is a lambda(x)\n\n\n1:  4836 scans\n10: 1695 scans\n12: 2855 scans\n16: 1963 scans\n18: 2560 scans\n21/LK:  3270 scans\n30: 2901 scans\n31: 2493 scans\n33: 1601 scans\n41: 878 scans\n45: 1574 scans\n49: 113 scans\n51: 888 scans\n53: 11 scans\n54: 207 scans\n54B:    139 scans\n55: 82 scans\n55B:    29 scans\n56B:    178 scans\n57: 107 scans\n57.1B:  1805 scans\n57.2:   2104 scans\n57.2B:  1991 scans\n57.3:   2896 scans\n57.3B:  2190 scans\n57B:    205 scans\n58: 4623 scans\n59: 1629 scans\n60: 3117 scans\n62: 1059 scans\n64: 185 scans\n65: 1 scans\n68: 481 scans\n7:  853 scans\n9:  4327 scans\n9.5:    6607 scans\nDECK:   25 scans\nDECK2:  123 scans\nMR: 1414 scans\nWS: 2434 scans\nWSB:    168 scans\n\n\n\n\nplotting scans for each cast in the first list\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # 1 is selecting only the first sublist\n  # print(i)\n  print(glue(\"=== station: {cast@metadata$station[1]}\"))\n  print(glue(\"# scans: {length(cast@data$scan)}\"))\n  plotScan(cast)\n}\n\n\n=== station: 1\n# scans: 4836\n\n\n\n\n\n\n\n\n\n=== station: 10\n# scans: 1695\n\n\n\n\n\n\n\n\n\n=== station: 12\n# scans: 2855\n\n\n\n\n\n\n\n\n\n=== station: 16\n# scans: 1963\n\n\n\n\n\n\n\n\n\n=== station: 18\n# scans: 2560\n\n\n\n\n\n\n\n\n\n=== station: 21/LK\n# scans: 3270\n\n\n\n\n\n\n\n\n\n=== station: 30\n# scans: 2901\n\n\n\n\n\n\n\n\n\n=== station: 31\n# scans: 2493\n\n\n\n\n\n\n\n\n\n=== station: 33\n# scans: 1601\n\n\n\n\n\n\n\n\n\n=== station: 41\n# scans: 878\n\n\n\n\n\n\n\n\n\n=== station: 45\n# scans: 1574\n\n\n\n\n\n\n\n\n\n=== station: 49\n# scans: 113\n\n\n\n\n\n\n\n\n\n=== station: 51\n# scans: 888\n\n\n\n\n\n\n\n\n\n=== station: 53\n# scans: 11\n\n\n\n\n\n\n\n\n\n=== station: 54\n# scans: 207\n\n\n\n\n\n\n\n\n\n=== station: 54B\n# scans: 139\n\n\n\n\n\n\n\n\n\n=== station: 55\n# scans: 82\n\n\n\n\n\n\n\n\n\n=== station: 55B\n# scans: 29\n\n\n\n\n\n\n\n\n\n=== station: 56B\n# scans: 178\n\n\n\n\n\n\n\n\n\n=== station: 57\n# scans: 107\n\n\n\n\n\n\n\n\n\n=== station: 57.1B\n# scans: 1805\n\n\n\n\n\n\n\n\n\n=== station: 57.2\n# scans: 2104\n\n\n\n\n\n\n\n\n\n=== station: 57.2B\n# scans: 1991\n\n\n\n\n\n\n\n\n\n=== station: 57.3\n# scans: 2896\n\n\n\n\n\n\n\n\n\n=== station: 57.3B\n# scans: 2190\n\n\n\n\n\n\n\n\n\n=== station: 57B\n# scans: 205\n\n\n\n\n\n\n\n\n\n=== station: 58\n# scans: 4623\n\n\n\n\n\n\n\n\n\n=== station: 59\n# scans: 1629\n\n\n\n\n\n\n\n\n\n=== station: 60\n# scans: 3117\n\n\n\n\n\n\n\n\n\n=== station: 62\n# scans: 1059\n\n\n\n\n\n\n\n\n\n=== station: 64\n# scans: 185\n\n\n\n\n\n\n\n\n\n=== station: 65\n# scans: 1\n\n\n\n\n\n\n\n\n\n=== station: 68\n# scans: 481\n\n\n\n\n\n\n\n\n\n=== station: 7\n# scans: 853\n\n\n\n\n\n\n\n\n\n=== station: 9\n# scans: 4327\n\n\n\n\n\n\n\n\n\n=== station: 9.5\n# scans: 6607\n\n\n\n\n\n\n\n\n\n=== station: DECK\n# scans: 25\n\n\n\n\n\n\n\n\n\n=== station: DECK2\n# scans: 123\n\n\n\n\n\n\n\n\n\n=== station: MR\n# scans: 1414\n\n\n\n\n\n\n\n\n\n=== station: WS\n# scans: 2434\n\n\n\n\n\n\n\n\n\n=== station: WSB\n# scans: 168\n\n\n\n\n\n\n\n\n\n\n\nplotting each cast in the first list\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # 1 is selecting only the first sublist\n  tryCatch({\n    plot(ctdDecimate(ctdTrim(cast)))\n  }, error = function(e){\n    print(e)\n  })\n}\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4836' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1695' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2855' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1963' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2560' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3270' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2901' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2493' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1601' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 878' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1574' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 113' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 888' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1805' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2104' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1991' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2896' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2190' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4623' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1629' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3117' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1059' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 853' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4327' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 6607' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1414' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2434' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 168' in coercion to 'logical(1)'&gt;\n\n\n\n\nplotting other physical parameters for each cast\n# Loop through each CTD cast\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # Assuming each sublist contains only one relevant CTD object\n  tryCatch({\n    # Extract metadata for station name and cruise ID\n    station_name &lt;- cast@metadata$station[1]\n    cruise_id &lt;- cast@data$cruise_id[1]\n\n    # Generate a title with station name and cruise ID\n    overall_title &lt;- glue::glue(\"Station: {station_name}, Cruise ID: {cruise_id}\")\n\n    # Set margins: increase the outer margin for the title\n    par(oma = c(0, 0, 3, 0))  # Top outer margin increased for title\n\n    # Plotting function with specific parameters\n    oce::plot(\n      x = ctdDecimate(ctdTrim(cast)),\n      which = c(\n        \"sea_water_electrical_conductivity\",\n        \"descent_rate\", \"sound_velocity\",\n        \"sea_water_sigma_t\",\"altimeter\"\n      ),\n      main = \"\"  # No main title for individual subplots\n    )\n\n    # Place a single overall title at the top of the plot frame\n    mtext(overall_title, side = 3, line = 1, outer = TRUE, cex = 1.5)\n\n    # Reset outer margins to default\n    par(oma = c(0, 0, 0, 0))\n\n  }, error = function(e) {\n    print(e$message)  # Print any errors that occur during plotting\n  })\n}\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n[1] \"unknown xtype value (\\\"6.156019\\\")\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"missing value where TRUE/FALSE needed\"\n[1] \"missing value where TRUE/FALSE needed\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n\n\nplotting other nutrient parameters for each cast\n# Loop through each CTD cast\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # Assuming each sublist contains only one relevant CTD object\n  tryCatch({\n    # Extract metadata for station name and cruise ID\n    station_name &lt;- cast@metadata$station[1]\n    cruise_id &lt;- cast@data$cruise_id[1]\n\n    # Generate a title with station name and cruise ID\n    overall_title &lt;- glue::glue(\"Station: {station_name}, Cruise ID: {cruise_id}\")\n\n    # Set margins: increase the outer margin for the title\n    par(oma = c(0, 0, 3, 0))  # Top outer margin increased for title\n\n    # Plotting function with specific parameters\n    oce::plot(\n      x = ctdDecimate(ctdTrim(cast)),\n      which = c(\n        \"CDOM\", \"dissolved_oxygen\",\n        \"oxygen_saturation\",\n        \"chlorophyll_concentration\", \"chlorophyll_fluorescence\"\n      ),\n      main = \"\"  # No main title for individual subplots\n    )\n\n    # Place a single overall title at the top of the plot frame\n    mtext(overall_title, side = 3, line = 1, outer = TRUE, cex = 1.5)\n\n    # Reset outer margins to default\n    par(oma = c(0, 0, 0, 0))\n\n  }, error = function(e) {\n    print(e$message)  # Print any errors that occur during plotting\n  })\n}\n\n\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"plot.new has not been called yet\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"plot.new has not been called yet\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"plot.new has not been called yet\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n\n\n\n\nplotting other optical parameters for each cast\n# Loop through each CTD cast\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # Assuming each sublist contains only one relevant CTD object\n  tryCatch({\n    # Extract metadata for station name and cruise ID\n    station_name &lt;- cast@metadata$station[1]\n    cruise_id &lt;- cast@data$cruise_id[1]\n\n    # Generate a title with station name and cruise ID\n    overall_title &lt;- glue::glue(\"Station: {station_name}, Cruise ID: {cruise_id}\")\n\n    # Set margins: increase the outer margin for the title\n    par(oma = c(0, 0, 3, 0))  # Top outer margin increased for title\n\n    # Plotting function with specific parameters\n    oce::plot(\n      x = ctdDecimate(ctdTrim(cast)),\n      which = c(\n        \"photosynthetically_available_radiation\",\n        \"beam_attenuation\",\"beam_transmission\"\n      ),\n      main = \"\"  # No main title for individual subplots\n    )\n\n    # Place a single overall title at the top of the plot frame\n    mtext(overall_title, side = 3, line = 1, outer = TRUE, cex = 1.5)\n\n    # Reset outer margins to default\n    par(oma = c(0, 0, 0, 0))\n\n  }, error = function(e) {\n    print(e$message)  # Print any errors that occur during plotting\n  })\n}\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"need finite 'xlim' values\"\n[1] \"unknown xtype value (\\\"1e-12\\\")\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"missing value where TRUE/FALSE needed\"\n[1] \"missing value where TRUE/FALSE needed\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n\n\nloop through every cast, clean, & save\ncombined_df &lt;- data.frame()\nfor (i in seq(ctd_FK)){\n  tryCatch({\n    cast &lt;- ctd_FK[[i]]  # 1 is selecting only the first sublist\n    \n    # print(class(cast))\n    # clean cast \n    trimmed_cast &lt;- ctdTrim(cast)\n    decimated_cast &lt;- ctdDecimate(trimmed_cast, p = 0.5)  # binned to 0.5 m\n    \n    # convert to df\n    cast_df &lt;- as.data.frame(decimated_cast@data)\n    \n    # Add metadata\n    # assumes station ID and cruise ID the same for all & just uses 1st one\n    cast_df &lt;- mutate(\n      cast_df,\n      station = cast@data$station[1],\n      cruise_id = cast@data$cruise_id[1]\n    )\n  \n    # drop NA rows left by cleaning\n    cast_df &lt;- subset(cast_df, !is.na(scan))\n    \n    # Append the data to the combined dataframe\n    combined_df &lt;- rbind(combined_df, cast_df)\n  }, error = function(e){\n    print(glue(\"error in cast {cast@metadata$station[1]}\"))\n    print(e)\n  })\n}\n# Save to CSV\nfile_path &lt;- here(glue(\"data/cleaned/{cruise_id}.csv\"))\nwrite.csv(combined_df, file_path, row.names = FALSE)"
  },
  {
    "objectID": "cruise_report/cruise_reports/WS17030.html",
    "href": "cruise_report/cruise_reports/WS17030.html",
    "title": "WS17030",
    "section": "",
    "text": "WS17030\n\n\nsetup\nif (!nzchar(system.file(package = \"librarian\"))) {\n  install.packages(\"librarian\")\n}\n\nlibrarian::shelf(\n  quiet = TRUE,\n  readr, here, fs, ggplot2, glue, \"jiho/castr\", dplyr, oce, patchwork, purrr, tidyr\n)\n\n\n\n\nCode\nsource(here(\"R/cruise_load.R\"))\ncruise_df &lt;- cruise_load(params$cruise_id)\n\n\n\n\nplot depth & pressure vs time elapsed\ntryCatch({\n  plots &lt;- list()\n  \n  for (station_name in unique(cruise_df$station)) {\n    subset_df &lt;- filter(cruise_df, station == station_name)\n    plots[[station_name]] &lt;- ggplot(subset_df, aes(x = time_elapsed)) +\n      geom_point(aes(y = depth), color = \"blue\") +  # Plot depth in blue\n      geom_line(aes(y = sea_water_pressure), color = \"red\") +  # Plot sea water pressure in red\n      ggtitle(glue(\"{station_name}\")) +\n      theme(\n        axis.title.x = element_blank(),\n        axis.title.y = element_blank(),\n        axis.text.x = element_blank(),\n        axis.text.y = element_blank(),\n        axis.ticks.x = element_blank(),\n        axis.ticks.y = element_blank()\n      )  # Remove individual axis titles and text\n  }\n  \n  # drop nulls\n  plots &lt;- purrr::compact(plots)\n  \n  # Combine all plots into a grid\n  combined_plot &lt;- wrap_plots(plots) + \n    plot_layout(ncol = 4) +  # Adjust ncol to set number of columns in the grid\n    plot_annotation(\n      title = \"Depth (blue) and Pressure (red)\",\n      subtitle = \"Each panel represents a different station\",\n      caption = \"Time Elapsed (x-axis) vs Depth & Pressure (y-axis)\"\n    ) +\n    theme(\n      plot.tag = element_text(size = 12, face = \"bold\"),\n      plot.tag.position = \"topleft\",\n      axis.title.x = element_text(margin = margin(t = 10)),\n      axis.title.y = element_text(margin = margin(r = 10))\n    )\n  \n  print(combined_plot)\n}, error = function(er){\n  print(er)\n});\n\n\n&lt;error/rlang_error&gt;\nError in `geom_point()`:\n! Problem while computing aesthetics.\n Error occurred in the 1st layer.\nCaused by error:\n! object 'time_elapsed' not found\n---\nBacktrace:\n     \n  1. base::tryCatch(...)\n  2.  base (local) tryCatchList(expr, classes, parentenv, handlers)\n  3.    base (local) tryCatchOne(expr, names, parentenv, handlers[[1L]])\n  4.      base (local) doTryCatch(return(expr), name, parentenv, handler)\n  5. base::print(combined_plot)\n  6. patchwork:::print.patchwork(combined_plot)\n  7.   patchwork:::build_patchwork(plot, plot$layout$guides %||% \"auto\")\n  8.     base::lapply(x$plots, plot_table, guides = guides)\n  9.       patchwork (local) FUN(X[[i]], ...)\n 10.       patchwork:::plot_table.ggplot(X[[i]], ...)\n 11.         ggplot2::ggplotGrob(x)\n 12.           ggplot2::ggplot_gtable(ggplot_build(x))\n 13.            ggplot2:::attach_plot_env(data$plot$plot_env)\n 14.              base::options(ggplot2_plot_env = env)\n 15.           ggplot2::ggplot_build(x)\n 16.           ggplot2:::ggplot_build.ggplot(x)\n 17.             ggplot2:::by_layer(...)\n 18.               rlang::try_fetch(...)\n 19.                base::tryCatch(...)\n 20.                 base (local) tryCatchList(expr, classes, parentenv, handlers)\n 21.                   base (local) tryCatchOne(expr, names, parentenv, handlers[[1L]])\n 22.                     base (local) doTryCatch(return(expr), name, parentenv, handler)\n 23.                base::withCallingHandlers(...)\n 24.               ggplot2 (local) f(l = layers[[i]], d = data[[i]])\n 25.                 l$compute_aesthetics(d, plot)\n 26.                   ggplot2 (local) compute_aesthetics(..., self = self)\n 27.                     base::lapply(aesthetics, eval_tidy, data = data, env = env)\n 28.                       rlang (local) FUN(X[[i]], ...)\n\n\n\n\nplot across all stations\np &lt;- ggplot(cruise_df, aes(x = time, y = depth, fill = station)) +\n  geom_col() +  # This creates the bars\n  # geom_text(aes(label = station), vjust = -0.3) +  # This adds labels to each bar, adjust vjust for position\n  labs(x = \"Time\", y = \"Depth\", title = \"Depth over Time by Station\") +  # Set labels and title\n  theme_minimal()  # Use a minimal theme\nprint(p)\n\n\n\n\n\n\n\n\n\n\n\ncreate oce.ctd objects from dataframes\nctd_load &lt;- function(data, other_params = NULL) {\n  \n  # create csv into ctd object\n  test_ctd &lt;-\n    as.ctd(\n      salinity    = data$sea_water_salinity,\n      temperature = data$sea_water_temperature,\n      pressure    = data$sea_water_pressure,\n      station     = data$station\n    )\n  \n  # add additional columns to ctd object\n  if (!is.null(other_params)) {\n    for (param_name in other_params) {\n      test_ctd &lt;-\n        oceSetData(\n          object = test_ctd,\n          name   = param_name,\n          value  = data[[param_name]]\n        )\n    }\n  }\n  print(glue(\"{data$station[1]}:\\t{length(test_ctd@data$scan)} scans\"))\n\n\n  return(test_ctd)\n}\n\n# Define other parameters to add\nother_params &lt;- c(\n  \"cruise_id\", \"station\", \"time\", \"time_elapsed\", \n  \"latitude\", \"longitude\", \"sea_water_electrical_conductivity\", \n  \"CDOM\", \"dissolved_oxygen\",\"oxygen_saturation\", \"chlorophyll_concentration\", \n  \"chlorophyll_fluorescence\", \"photosynthetically_available_radiation\", \n  \"beam_attenuation\",\"beam_transmission\", \"depth\", \"sea_water_sigma_t\",\n  \"descent_rate\", \"sound_velocity\",\"altimeter\"\n)\n\n# Split data by station and create data list\nctd_FK &lt;- cruise_df %&gt;%\n  split(.$station) %&gt;%\n  map(~ ctd_load(.x, other_params = other_params)) # ~ is a lambda(x)\n\n\n10: 1371 scans\n12: 4943 scans\n16: 1732 scans\n18: 3093 scans\n2:  2543 scans\n21/LK:  7438 scans\n30: 4536 scans\n31: 2100 scans\n33: 1172 scans\n41: 1632 scans\n45: 1339 scans\n49: 704 scans\n51: 947 scans\n53: 92 scans\n54: 5 scans\n54B:    357 scans\n55: 2 scans\n55B:    43 scans\n56: 4 scans\n56B:    28 scans\n57: 4466 scans\n57.1B:  936 scans\n57.2:   2837 scans\n57.2B:  1965 scans\n57.3:   1878 scans\n57B:    249 scans\n58: 2408 scans\n59: 1333 scans\n60: 1654 scans\n62: 93 scans\n65: 71 scans\n68: 1111 scans\n7:  1517 scans\n9:  3392 scans\n9.5:    8235 scans\nMR: 3832 scans\nWS: 3564 scans\n\n\n\n\nplotting scans for each cast in the first list\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # 1 is selecting only the first sublist\n  # print(i)\n  print(glue(\"=== station: {cast@metadata$station[1]}\"))\n  print(glue(\"# scans: {length(cast@data$scan)}\"))\n  plotScan(cast)\n}\n\n\n=== station: 10\n# scans: 1371\n\n\n\n\n\n\n\n\n\n=== station: 12\n# scans: 4943\n\n\n\n\n\n\n\n\n\n=== station: 16\n# scans: 1732\n\n\n\n\n\n\n\n\n\n=== station: 18\n# scans: 3093\n\n\n\n\n\n\n\n\n\n=== station: 2\n# scans: 2543\n\n\n\n\n\n\n\n\n\n=== station: 21/LK\n# scans: 7438\n\n\n\n\n\n\n\n\n\n=== station: 30\n# scans: 4536\n\n\n\n\n\n\n\n\n\n=== station: 31\n# scans: 2100\n\n\n\n\n\n\n\n\n\n=== station: 33\n# scans: 1172\n\n\n\n\n\n\n\n\n\n=== station: 41\n# scans: 1632\n\n\n\n\n\n\n\n\n\n=== station: 45\n# scans: 1339\n\n\n\n\n\n\n\n\n\n=== station: 49\n# scans: 704\n\n\n\n\n\n\n\n\n\n=== station: 51\n# scans: 947\n\n\n\n\n\n\n\n\n\n=== station: 53\n# scans: 92\n\n\n\n\n\n\n\n\n\n=== station: 54\n# scans: 5\n\n\n\n\n\n\n\n\n\n=== station: 54B\n# scans: 357\n\n\n\n\n\n\n\n\n\n=== station: 55\n# scans: 2\n\n\n\n\n\n\n\n\n\n=== station: 55B\n# scans: 43\n\n\n\n\n\n\n\n\n\n=== station: 56\n# scans: 4\n\n\n\n\n\n\n\n\n\n=== station: 56B\n# scans: 28\n\n\n\n\n\n\n\n\n\n=== station: 57\n# scans: 4466\n\n\n\n\n\n\n\n\n\n=== station: 57.1B\n# scans: 936\n\n\n\n\n\n\n\n\n\n=== station: 57.2\n# scans: 2837\n\n\n\n\n\n\n\n\n\n=== station: 57.2B\n# scans: 1965\n\n\n\n\n\n\n\n\n\n=== station: 57.3\n# scans: 1878\n\n\n\n\n\n\n\n\n\n=== station: 57B\n# scans: 249\n\n\n\n\n\n\n\n\n\n=== station: 58\n# scans: 2408\n\n\n\n\n\n\n\n\n\n=== station: 59\n# scans: 1333\n\n\n\n\n\n\n\n\n\n=== station: 60\n# scans: 1654\n\n\n\n\n\n\n\n\n\n=== station: 62\n# scans: 93\n\n\n\n\n\n\n\n\n\n=== station: 65\n# scans: 71\n\n\n\n\n\n\n\n\n\n=== station: 68\n# scans: 1111\n\n\n\n\n\n\n\n\n\n=== station: 7\n# scans: 1517\n\n\n\n\n\n\n\n\n\n=== station: 9\n# scans: 3392\n\n\n\n\n\n\n\n\n\n=== station: 9.5\n# scans: 8235\n\n\n\n\n\n\n\n\n\n=== station: MR\n# scans: 3832\n\n\n\n\n\n\n\n\n\n=== station: WS\n# scans: 3564\n\n\n\n\n\n\n\n\n\n\n\nplotting each cast in the first list\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # 1 is selecting only the first sublist\n  tryCatch({\n    plot(ctdDecimate(ctdTrim(cast)))\n  }, error = function(e){\n    print(e)\n  })\n}\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1371' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4943' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1732' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3093' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2543' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 7438' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4536' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2100' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1172' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1632' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1339' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 704' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 947' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4466' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 936' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2837' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1965' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1878' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2408' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1333' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1654' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1111' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1517' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3392' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 8235' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3832' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3564' in coercion to 'logical(1)'&gt;\n\n\n\n\nplotting other physical parameters for each cast\n# Loop through each CTD cast\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # Assuming each sublist contains only one relevant CTD object\n  tryCatch({\n    # Extract metadata for station name and cruise ID\n    station_name &lt;- cast@metadata$station[1]\n    cruise_id &lt;- cast@data$cruise_id[1]\n\n    # Generate a title with station name and cruise ID\n    overall_title &lt;- glue::glue(\"Station: {station_name}, Cruise ID: {cruise_id}\")\n\n    # Set margins: increase the outer margin for the title\n    par(oma = c(0, 0, 3, 0))  # Top outer margin increased for title\n\n    # Plotting function with specific parameters\n    oce::plot(\n      x = ctdDecimate(ctdTrim(cast)),\n      which = c(\n        \"sea_water_electrical_conductivity\",\n        \"descent_rate\", \"sound_velocity\",\n        \"sea_water_sigma_t\",\"altimeter\"\n      ),\n      main = \"\"  # No main title for individual subplots\n    )\n\n    # Place a single overall title at the top of the plot frame\n    mtext(overall_title, side = 3, line = 1, outer = TRUE, cex = 1.5)\n\n    # Reset outer margins to default\n    par(oma = c(0, 0, 0, 0))\n\n  }, error = function(e) {\n    print(e$message)  # Print any errors that occur during plotting\n  })\n}\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n\n\nplotting other nutrient parameters for each cast\n# Loop through each CTD cast\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # Assuming each sublist contains only one relevant CTD object\n  tryCatch({\n    # Extract metadata for station name and cruise ID\n    station_name &lt;- cast@metadata$station[1]\n    cruise_id &lt;- cast@data$cruise_id[1]\n\n    # Generate a title with station name and cruise ID\n    overall_title &lt;- glue::glue(\"Station: {station_name}, Cruise ID: {cruise_id}\")\n\n    # Set margins: increase the outer margin for the title\n    par(oma = c(0, 0, 3, 0))  # Top outer margin increased for title\n\n    # Plotting function with specific parameters\n    oce::plot(\n      x = ctdDecimate(ctdTrim(cast)),\n      which = c(\n        \"CDOM\", \"dissolved_oxygen\",\n        \"oxygen_saturation\",\n        \"chlorophyll_concentration\", \"chlorophyll_fluorescence\"\n      ),\n      main = \"\"  # No main title for individual subplots\n    )\n\n    # Place a single overall title at the top of the plot frame\n    mtext(overall_title, side = 3, line = 1, outer = TRUE, cex = 1.5)\n\n    # Reset outer margins to default\n    par(oma = c(0, 0, 0, 0))\n\n  }, error = function(e) {\n    print(e$message)  # Print any errors that occur during plotting\n  })\n}\n\n\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"plot.new has not been called yet\"\n[1] \"plot.new has not been called yet\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"plot.new has not been called yet\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n\n\n\n\nplotting other optical parameters for each cast\n# Loop through each CTD cast\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # Assuming each sublist contains only one relevant CTD object\n  tryCatch({\n    # Extract metadata for station name and cruise ID\n    station_name &lt;- cast@metadata$station[1]\n    cruise_id &lt;- cast@data$cruise_id[1]\n\n    # Generate a title with station name and cruise ID\n    overall_title &lt;- glue::glue(\"Station: {station_name}, Cruise ID: {cruise_id}\")\n\n    # Set margins: increase the outer margin for the title\n    par(oma = c(0, 0, 3, 0))  # Top outer margin increased for title\n\n    # Plotting function with specific parameters\n    oce::plot(\n      x = ctdDecimate(ctdTrim(cast)),\n      which = c(\n        \"photosynthetically_available_radiation\",\n        \"beam_attenuation\",\"beam_transmission\"\n      ),\n      main = \"\"  # No main title for individual subplots\n    )\n\n    # Place a single overall title at the top of the plot frame\n    mtext(overall_title, side = 3, line = 1, outer = TRUE, cex = 1.5)\n\n    # Reset outer margins to default\n    par(oma = c(0, 0, 0, 0))\n\n  }, error = function(e) {\n    print(e$message)  # Print any errors that occur during plotting\n  })\n}\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n\n\nloop through every cast, clean, & save\ncombined_df &lt;- data.frame()\nfor (i in seq(ctd_FK)){\n  tryCatch({\n    cast &lt;- ctd_FK[[i]]  # 1 is selecting only the first sublist\n    \n    # print(class(cast))\n    # clean cast \n    trimmed_cast &lt;- ctdTrim(cast)\n    decimated_cast &lt;- ctdDecimate(trimmed_cast, p = 0.5)  # binned to 0.5 m\n    \n    # convert to df\n    cast_df &lt;- as.data.frame(decimated_cast@data)\n    \n    # Add metadata\n    # assumes station ID and cruise ID the same for all & just uses 1st one\n    cast_df &lt;- mutate(\n      cast_df,\n      station = cast@data$station[1],\n      cruise_id = cast@data$cruise_id[1]\n    )\n  \n    # drop NA rows left by cleaning\n    cast_df &lt;- subset(cast_df, !is.na(scan))\n    \n    # Append the data to the combined dataframe\n    combined_df &lt;- rbind(combined_df, cast_df)\n  }, error = function(e){\n    print(glue(\"error in cast {cast@metadata$station[1]}\"))\n    print(e)\n  })\n}\n# Save to CSV\nfile_path &lt;- here(glue(\"data/cleaned/{cruise_id}.csv\"))\nwrite.csv(combined_df, file_path, row.names = FALSE)"
  },
  {
    "objectID": "cruise_report/cruise_reports/WS17170.html",
    "href": "cruise_report/cruise_reports/WS17170.html",
    "title": "WS17170",
    "section": "",
    "text": "WS17170\n\n\nsetup\nif (!nzchar(system.file(package = \"librarian\"))) {\n  install.packages(\"librarian\")\n}\n\nlibrarian::shelf(\n  quiet = TRUE,\n  readr, here, fs, ggplot2, glue, \"jiho/castr\", dplyr, oce, patchwork, purrr, tidyr\n)\n\n\n\n\nCode\nsource(here(\"R/cruise_load.R\"))\ncruise_df &lt;- cruise_load(params$cruise_id)\n\n\n\n\nplot depth & pressure vs time elapsed\ntryCatch({\n  plots &lt;- list()\n  \n  for (station_name in unique(cruise_df$station)) {\n    subset_df &lt;- filter(cruise_df, station == station_name)\n    plots[[station_name]] &lt;- ggplot(subset_df, aes(x = time_elapsed)) +\n      geom_point(aes(y = depth), color = \"blue\") +  # Plot depth in blue\n      geom_line(aes(y = sea_water_pressure), color = \"red\") +  # Plot sea water pressure in red\n      ggtitle(glue(\"{station_name}\")) +\n      theme(\n        axis.title.x = element_blank(),\n        axis.title.y = element_blank(),\n        axis.text.x = element_blank(),\n        axis.text.y = element_blank(),\n        axis.ticks.x = element_blank(),\n        axis.ticks.y = element_blank()\n      )  # Remove individual axis titles and text\n  }\n  \n  # drop nulls\n  plots &lt;- purrr::compact(plots)\n  \n  # Combine all plots into a grid\n  combined_plot &lt;- wrap_plots(plots) + \n    plot_layout(ncol = 4) +  # Adjust ncol to set number of columns in the grid\n    plot_annotation(\n      title = \"Depth (blue) and Pressure (red)\",\n      subtitle = \"Each panel represents a different station\",\n      caption = \"Time Elapsed (x-axis) vs Depth & Pressure (y-axis)\"\n    ) +\n    theme(\n      plot.tag = element_text(size = 12, face = \"bold\"),\n      plot.tag.position = \"topleft\",\n      axis.title.x = element_text(margin = margin(t = 10)),\n      axis.title.y = element_text(margin = margin(r = 10))\n    )\n  \n  print(combined_plot)\n}, error = function(er){\n  print(er)\n});\n\n\n&lt;error/rlang_error&gt;\nError in `geom_point()`:\n! Problem while computing aesthetics.\n Error occurred in the 1st layer.\nCaused by error:\n! object 'time_elapsed' not found\n---\nBacktrace:\n     \n  1. base::tryCatch(...)\n  2.  base (local) tryCatchList(expr, classes, parentenv, handlers)\n  3.    base (local) tryCatchOne(expr, names, parentenv, handlers[[1L]])\n  4.      base (local) doTryCatch(return(expr), name, parentenv, handler)\n  5. base::print(combined_plot)\n  6. patchwork:::print.patchwork(combined_plot)\n  7.   patchwork:::build_patchwork(plot, plot$layout$guides %||% \"auto\")\n  8.     base::lapply(x$plots, plot_table, guides = guides)\n  9.       patchwork (local) FUN(X[[i]], ...)\n 10.       patchwork:::plot_table.ggplot(X[[i]], ...)\n 11.         ggplot2::ggplotGrob(x)\n 12.           ggplot2::ggplot_gtable(ggplot_build(x))\n 13.            ggplot2:::attach_plot_env(data$plot$plot_env)\n 14.              base::options(ggplot2_plot_env = env)\n 15.           ggplot2::ggplot_build(x)\n 16.           ggplot2:::ggplot_build.ggplot(x)\n 17.             ggplot2:::by_layer(...)\n 18.               rlang::try_fetch(...)\n 19.                base::tryCatch(...)\n 20.                 base (local) tryCatchList(expr, classes, parentenv, handlers)\n 21.                   base (local) tryCatchOne(expr, names, parentenv, handlers[[1L]])\n 22.                     base (local) doTryCatch(return(expr), name, parentenv, handler)\n 23.                base::withCallingHandlers(...)\n 24.               ggplot2 (local) f(l = layers[[i]], d = data[[i]])\n 25.                 l$compute_aesthetics(d, plot)\n 26.                   ggplot2 (local) compute_aesthetics(..., self = self)\n 27.                     base::lapply(aesthetics, eval_tidy, data = data, env = env)\n 28.                       rlang (local) FUN(X[[i]], ...)\n\n\n\n\nplot across all stations\np &lt;- ggplot(cruise_df, aes(x = time, y = depth, fill = station)) +\n  geom_col() +  # This creates the bars\n  # geom_text(aes(label = station), vjust = -0.3) +  # This adds labels to each bar, adjust vjust for position\n  labs(x = \"Time\", y = \"Depth\", title = \"Depth over Time by Station\") +  # Set labels and title\n  theme_minimal()  # Use a minimal theme\nprint(p)\n\n\n\n\n\n\n\n\n\n\n\ncreate oce.ctd objects from dataframes\nctd_load &lt;- function(data, other_params = NULL) {\n  \n  # create csv into ctd object\n  test_ctd &lt;-\n    as.ctd(\n      salinity    = data$sea_water_salinity,\n      temperature = data$sea_water_temperature,\n      pressure    = data$sea_water_pressure,\n      station     = data$station\n    )\n  \n  # add additional columns to ctd object\n  if (!is.null(other_params)) {\n    for (param_name in other_params) {\n      test_ctd &lt;-\n        oceSetData(\n          object = test_ctd,\n          name   = param_name,\n          value  = data[[param_name]]\n        )\n    }\n  }\n  print(glue(\"{data$station[1]}:\\t{length(test_ctd@data$scan)} scans\"))\n\n\n  return(test_ctd)\n}\n\n# Define other parameters to add\nother_params &lt;- c(\n  \"cruise_id\", \"station\", \"time\", \"time_elapsed\", \n  \"latitude\", \"longitude\", \"sea_water_electrical_conductivity\", \n  \"CDOM\", \"dissolved_oxygen\",\"oxygen_saturation\", \"chlorophyll_concentration\", \n  \"chlorophyll_fluorescence\", \"photosynthetically_available_radiation\", \n  \"beam_attenuation\",\"beam_transmission\", \"depth\", \"sea_water_sigma_t\",\n  \"descent_rate\", \"sound_velocity\",\"altimeter\"\n)\n\n# Split data by station and create data list\nctd_FK &lt;- cruise_df %&gt;%\n  split(.$station) %&gt;%\n  map(~ ctd_load(.x, other_params = other_params)) # ~ is a lambda(x)\n\n\n10: 862 scans\n16: 222 scans\n21/LK:  3375 scans\n30: 2734 scans\n31: 3215 scans\n33: 1721 scans\n41: 37 scans\n45: 1504 scans\n49: 54 scans\n51: 1496 scans\n53: 615 scans\n55: 1057 scans\n56: 23 scans\n56B:    245 scans\n57: 993 scans\n57.1:   1231 scans\n57.1B:  1195 scans\n57.2:   1086 scans\n57.2B:  1139 scans\n57.3:   1103 scans\n57.3B:  973 scans\n57B:    348 scans\n58: 2649 scans\n59: 2036 scans\n60: 1083 scans\n62: 186 scans\n64: 773 scans\n65: 26 scans\n68: 717 scans\n7:  1087 scans\nMR: 2718 scans\nWS: 2632 scans\n\n\n\n\nplotting scans for each cast in the first list\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # 1 is selecting only the first sublist\n  # print(i)\n  print(glue(\"=== station: {cast@metadata$station[1]}\"))\n  print(glue(\"# scans: {length(cast@data$scan)}\"))\n  plotScan(cast)\n}\n\n\n=== station: 10\n# scans: 862\n\n\n\n\n\n\n\n\n\n=== station: 16\n# scans: 222\n\n\n\n\n\n\n\n\n\n=== station: 21/LK\n# scans: 3375\n\n\n\n\n\n\n\n\n\n=== station: 30\n# scans: 2734\n\n\n\n\n\n\n\n\n\n=== station: 31\n# scans: 3215\n\n\n\n\n\n\n\n\n\n=== station: 33\n# scans: 1721\n\n\n\n\n\n\n\n\n\n=== station: 41\n# scans: 37\n\n\n\n\n\n\n\n\n\n=== station: 45\n# scans: 1504\n\n\n\n\n\n\n\n\n\n=== station: 49\n# scans: 54\n\n\n\n\n\n\n\n\n\n=== station: 51\n# scans: 1496\n\n\n\n\n\n\n\n\n\n=== station: 53\n# scans: 615\n\n\n\n\n\n\n\n\n\n=== station: 55\n# scans: 1057\n\n\n\n\n\n\n\n\n\n=== station: 56\n# scans: 23\n\n\n\n\n\n\n\n\n\n=== station: 56B\n# scans: 245\n\n\n\n\n\n\n\n\n\n=== station: 57\n# scans: 993\n\n\n\n\n\n\n\n\n\n=== station: 57.1\n# scans: 1231\n\n\n\n\n\n\n\n\n\n=== station: 57.1B\n# scans: 1195\n\n\n\n\n\n\n\n\n\n=== station: 57.2\n# scans: 1086\n\n\n\n\n\n\n\n\n\n=== station: 57.2B\n# scans: 1139\n\n\n\n\n\n\n\n\n\n=== station: 57.3\n# scans: 1103\n\n\n\n\n\n\n\n\n\n=== station: 57.3B\n# scans: 973\n\n\n\n\n\n\n\n\n\n=== station: 57B\n# scans: 348\n\n\n\n\n\n\n\n\n\n=== station: 58\n# scans: 2649\n\n\n\n\n\n\n\n\n\n=== station: 59\n# scans: 2036\n\n\n\n\n\n\n\n\n\n=== station: 60\n# scans: 1083\n\n\n\n\n\n\n\n\n\n=== station: 62\n# scans: 186\n\n\n\n\n\n\n\n\n\n=== station: 64\n# scans: 773\n\n\n\n\n\n\n\n\n\n=== station: 65\n# scans: 26\n\n\n\n\n\n\n\n\n\n=== station: 68\n# scans: 717\n\n\n\n\n\n\n\n\n\n=== station: 7\n# scans: 1087\n\n\n\n\n\n\n\n\n\n=== station: MR\n# scans: 2718\n\n\n\n\n\n\n\n\n\n=== station: WS\n# scans: 2632\n\n\n\n\n\n\n\n\n\n\n\nplotting each cast in the first list\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # 1 is selecting only the first sublist\n  tryCatch({\n    plot(ctdDecimate(ctdTrim(cast)))\n  }, error = function(e){\n    print(e)\n  })\n}\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 862' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 222' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3375' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2734' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3215' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1721' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 37' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1504' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 54' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1496' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 615' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 993' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1231' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1195' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1086' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1139' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1103' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 973' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 348' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2649' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2036' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1083' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 26' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 717' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1087' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2718' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2632' in coercion to 'logical(1)'&gt;\n\n\n\n\nplotting other physical parameters for each cast\n# Loop through each CTD cast\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # Assuming each sublist contains only one relevant CTD object\n  tryCatch({\n    # Extract metadata for station name and cruise ID\n    station_name &lt;- cast@metadata$station[1]\n    cruise_id &lt;- cast@data$cruise_id[1]\n\n    # Generate a title with station name and cruise ID\n    overall_title &lt;- glue::glue(\"Station: {station_name}, Cruise ID: {cruise_id}\")\n\n    # Set margins: increase the outer margin for the title\n    par(oma = c(0, 0, 3, 0))  # Top outer margin increased for title\n\n    # Plotting function with specific parameters\n    oce::plot(\n      x = ctdDecimate(ctdTrim(cast)),\n      which = c(\n        \"sea_water_electrical_conductivity\",\n        \"descent_rate\", \"sound_velocity\",\n        \"sea_water_sigma_t\",\"altimeter\"\n      ),\n      main = \"\"  # No main title for individual subplots\n    )\n\n    # Place a single overall title at the top of the plot frame\n    mtext(overall_title, side = 3, line = 1, outer = TRUE, cex = 1.5)\n\n    # Reset outer margins to default\n    par(oma = c(0, 0, 0, 0))\n\n  }, error = function(e) {\n    print(e$message)  # Print any errors that occur during plotting\n  })\n}\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n\n\nplotting other nutrient parameters for each cast\n# Loop through each CTD cast\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # Assuming each sublist contains only one relevant CTD object\n  tryCatch({\n    # Extract metadata for station name and cruise ID\n    station_name &lt;- cast@metadata$station[1]\n    cruise_id &lt;- cast@data$cruise_id[1]\n\n    # Generate a title with station name and cruise ID\n    overall_title &lt;- glue::glue(\"Station: {station_name}, Cruise ID: {cruise_id}\")\n\n    # Set margins: increase the outer margin for the title\n    par(oma = c(0, 0, 3, 0))  # Top outer margin increased for title\n\n    # Plotting function with specific parameters\n    oce::plot(\n      x = ctdDecimate(ctdTrim(cast)),\n      which = c(\n        \"CDOM\", \"dissolved_oxygen\",\n        \"oxygen_saturation\",\n        \"chlorophyll_concentration\", \"chlorophyll_fluorescence\"\n      ),\n      main = \"\"  # No main title for individual subplots\n    )\n\n    # Place a single overall title at the top of the plot frame\n    mtext(overall_title, side = 3, line = 1, outer = TRUE, cex = 1.5)\n\n    # Reset outer margins to default\n    par(oma = c(0, 0, 0, 0))\n\n  }, error = function(e) {\n    print(e$message)  # Print any errors that occur during plotting\n  })\n}\n\n\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n\n\n\n\nplotting other optical parameters for each cast\n# Loop through each CTD cast\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # Assuming each sublist contains only one relevant CTD object\n  tryCatch({\n    # Extract metadata for station name and cruise ID\n    station_name &lt;- cast@metadata$station[1]\n    cruise_id &lt;- cast@data$cruise_id[1]\n\n    # Generate a title with station name and cruise ID\n    overall_title &lt;- glue::glue(\"Station: {station_name}, Cruise ID: {cruise_id}\")\n\n    # Set margins: increase the outer margin for the title\n    par(oma = c(0, 0, 3, 0))  # Top outer margin increased for title\n\n    # Plotting function with specific parameters\n    oce::plot(\n      x = ctdDecimate(ctdTrim(cast)),\n      which = c(\n        \"photosynthetically_available_radiation\",\n        \"beam_attenuation\",\"beam_transmission\"\n      ),\n      main = \"\"  # No main title for individual subplots\n    )\n\n    # Place a single overall title at the top of the plot frame\n    mtext(overall_title, side = 3, line = 1, outer = TRUE, cex = 1.5)\n\n    # Reset outer margins to default\n    par(oma = c(0, 0, 0, 0))\n\n  }, error = function(e) {\n    print(e$message)  # Print any errors that occur during plotting\n  })\n}\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n\n\nloop through every cast, clean, & save\ncombined_df &lt;- data.frame()\nfor (i in seq(ctd_FK)){\n  tryCatch({\n    cast &lt;- ctd_FK[[i]]  # 1 is selecting only the first sublist\n    \n    # print(class(cast))\n    # clean cast \n    trimmed_cast &lt;- ctdTrim(cast)\n    decimated_cast &lt;- ctdDecimate(trimmed_cast, p = 0.5)  # binned to 0.5 m\n    \n    # convert to df\n    cast_df &lt;- as.data.frame(decimated_cast@data)\n    \n    # Add metadata\n    # assumes station ID and cruise ID the same for all & just uses 1st one\n    cast_df &lt;- mutate(\n      cast_df,\n      station = cast@data$station[1],\n      cruise_id = cast@data$cruise_id[1]\n    )\n  \n    # drop NA rows left by cleaning\n    cast_df &lt;- subset(cast_df, !is.na(scan))\n    \n    # Append the data to the combined dataframe\n    combined_df &lt;- rbind(combined_df, cast_df)\n  }, error = function(e){\n    print(glue(\"error in cast {cast@metadata$station[1]}\"))\n    print(e)\n  })\n}\n# Save to CSV\nfile_path &lt;- here(glue(\"data/cleaned/{cruise_id}.csv\"))\nwrite.csv(combined_df, file_path, row.names = FALSE)"
  },
  {
    "objectID": "cruise_report/cruise_reports/WS17282.html",
    "href": "cruise_report/cruise_reports/WS17282.html",
    "title": "WS17282",
    "section": "",
    "text": "WS17282\n\n\nsetup\nif (!nzchar(system.file(package = \"librarian\"))) {\n  install.packages(\"librarian\")\n}\n\nlibrarian::shelf(\n  quiet = TRUE,\n  readr, here, fs, ggplot2, glue, \"jiho/castr\", dplyr, oce, patchwork, purrr, tidyr\n)\n\n\n\n\nCode\nsource(here(\"R/cruise_load.R\"))\ncruise_df &lt;- cruise_load(params$cruise_id)\n\n\nWarning: One or more parsing issues, call `problems()` on your data frame for details,\ne.g.:\n  dat &lt;- vroom(...)\n  problems(dat)\n\n\n\n\nplot depth & pressure vs time elapsed\ntryCatch({\n  plots &lt;- list()\n  \n  for (station_name in unique(cruise_df$station)) {\n    subset_df &lt;- filter(cruise_df, station == station_name)\n    plots[[station_name]] &lt;- ggplot(subset_df, aes(x = time_elapsed)) +\n      geom_point(aes(y = depth), color = \"blue\") +  # Plot depth in blue\n      geom_line(aes(y = sea_water_pressure), color = \"red\") +  # Plot sea water pressure in red\n      ggtitle(glue(\"{station_name}\")) +\n      theme(\n        axis.title.x = element_blank(),\n        axis.title.y = element_blank(),\n        axis.text.x = element_blank(),\n        axis.text.y = element_blank(),\n        axis.ticks.x = element_blank(),\n        axis.ticks.y = element_blank()\n      )  # Remove individual axis titles and text\n  }\n  \n  # drop nulls\n  plots &lt;- purrr::compact(plots)\n  \n  # Combine all plots into a grid\n  combined_plot &lt;- wrap_plots(plots) + \n    plot_layout(ncol = 4) +  # Adjust ncol to set number of columns in the grid\n    plot_annotation(\n      title = \"Depth (blue) and Pressure (red)\",\n      subtitle = \"Each panel represents a different station\",\n      caption = \"Time Elapsed (x-axis) vs Depth & Pressure (y-axis)\"\n    ) +\n    theme(\n      plot.tag = element_text(size = 12, face = \"bold\"),\n      plot.tag.position = \"topleft\",\n      axis.title.x = element_text(margin = margin(t = 10)),\n      axis.title.y = element_text(margin = margin(r = 10))\n    )\n  \n  print(combined_plot)\n}, error = function(er){\n  print(er)\n});\n\n\n&lt;error/rlang_error&gt;\nError in `geom_point()`:\n! Problem while computing aesthetics.\n Error occurred in the 1st layer.\nCaused by error:\n! object 'time_elapsed' not found\n---\nBacktrace:\n     \n  1. base::tryCatch(...)\n  2.  base (local) tryCatchList(expr, classes, parentenv, handlers)\n  3.    base (local) tryCatchOne(expr, names, parentenv, handlers[[1L]])\n  4.      base (local) doTryCatch(return(expr), name, parentenv, handler)\n  5. base::print(combined_plot)\n  6. patchwork:::print.patchwork(combined_plot)\n  7.   patchwork:::build_patchwork(plot, plot$layout$guides %||% \"auto\")\n  8.     base::lapply(x$plots, plot_table, guides = guides)\n  9.       patchwork (local) FUN(X[[i]], ...)\n 10.       patchwork:::plot_table.ggplot(X[[i]], ...)\n 11.         ggplot2::ggplotGrob(x)\n 12.           ggplot2::ggplot_gtable(ggplot_build(x))\n 13.            ggplot2:::attach_plot_env(data$plot$plot_env)\n 14.              base::options(ggplot2_plot_env = env)\n 15.           ggplot2::ggplot_build(x)\n 16.           ggplot2:::ggplot_build.ggplot(x)\n 17.             ggplot2:::by_layer(...)\n 18.               rlang::try_fetch(...)\n 19.                base::tryCatch(...)\n 20.                 base (local) tryCatchList(expr, classes, parentenv, handlers)\n 21.                   base (local) tryCatchOne(expr, names, parentenv, handlers[[1L]])\n 22.                     base (local) doTryCatch(return(expr), name, parentenv, handler)\n 23.                base::withCallingHandlers(...)\n 24.               ggplot2 (local) f(l = layers[[i]], d = data[[i]])\n 25.                 l$compute_aesthetics(d, plot)\n 26.                   ggplot2 (local) compute_aesthetics(..., self = self)\n 27.                     base::lapply(aesthetics, eval_tidy, data = data, env = env)\n 28.                       rlang (local) FUN(X[[i]], ...)\n\n\n\n\nplot across all stations\np &lt;- ggplot(cruise_df, aes(x = time, y = depth, fill = station)) +\n  geom_col() +  # This creates the bars\n  # geom_text(aes(label = station), vjust = -0.3) +  # This adds labels to each bar, adjust vjust for position\n  labs(x = \"Time\", y = \"Depth\", title = \"Depth over Time by Station\") +  # Set labels and title\n  theme_minimal()  # Use a minimal theme\nprint(p)\n\n\n\n\n\n\n\n\n\n\n\ncreate oce.ctd objects from dataframes\nctd_load &lt;- function(data, other_params = NULL) {\n  \n  # create csv into ctd object\n  test_ctd &lt;-\n    as.ctd(\n      salinity    = data$sea_water_salinity,\n      temperature = data$sea_water_temperature,\n      pressure    = data$sea_water_pressure,\n      station     = data$station\n    )\n  \n  # add additional columns to ctd object\n  if (!is.null(other_params)) {\n    for (param_name in other_params) {\n      test_ctd &lt;-\n        oceSetData(\n          object = test_ctd,\n          name   = param_name,\n          value  = data[[param_name]]\n        )\n    }\n  }\n  print(glue(\"{data$station[1]}:\\t{length(test_ctd@data$scan)} scans\"))\n\n\n  return(test_ctd)\n}\n\n# Define other parameters to add\nother_params &lt;- c(\n  \"cruise_id\", \"station\", \"time\", \"time_elapsed\", \n  \"latitude\", \"longitude\", \"sea_water_electrical_conductivity\", \n  \"CDOM\", \"dissolved_oxygen\",\"oxygen_saturation\", \"chlorophyll_concentration\", \n  \"chlorophyll_fluorescence\", \"photosynthetically_available_radiation\", \n  \"beam_attenuation\",\"beam_transmission\", \"depth\", \"sea_water_sigma_t\",\n  \"descent_rate\", \"sound_velocity\",\"altimeter\"\n)\n\n# Split data by station and create data list\nctd_FK &lt;- cruise_df %&gt;%\n  split(.$station) %&gt;%\n  map(~ ctd_load(.x, other_params = other_params)) # ~ is a lambda(x)\n\n\n1:  1755 scans\n10: 1362 scans\n11: 2933 scans\n12: 9813 scans\n13: 1778 scans\n14: 1890 scans\n15: 3059 scans\n15.5:   6654 scans\n16: 4118 scans\n17: 3437 scans\n18: 4434 scans\n19: 456 scans\n2:  1774 scans\n20: 1378 scans\n21.5:   8836 scans\n21/LK:  5419 scans\n22: 2002 scans\n22.5:   8683 scans\n23: 1122 scans\n24: 1295 scans\n3:  4900 scans\n30: 1614 scans\n30.5:   2186 scans\n31: 983 scans\n32: 1436 scans\n33: 1437 scans\n34: 711 scans\n39: 1242 scans\n41: 1519 scans\n42: 2091 scans\n45: 1524 scans\n47: 1025 scans\n49: 383 scans\n5:  1197 scans\n50: 817 scans\n51: 749 scans\n53: 3 scans\n54: 259 scans\n55: 497 scans\n56: 772 scans\n57: 1168 scans\n57.1:   1866 scans\n57.2:   779 scans\n57.3:   1174 scans\n58: 1554 scans\n59: 2477 scans\n6:  3324 scans\n6.5:    5446 scans\n60: 2325 scans\n61: 1992 scans\n62: 1738 scans\n63: 1353 scans\n64: 2722 scans\n65: 1736 scans\n66: 1600 scans\n67: 1272 scans\n68: 6 scans\n69: 1443 scans\n7:  1159 scans\n70: 1907 scans\n8:  1287 scans\n9:  4059 scans\n9.5:    6707 scans\nDECK_TST:   101 scans\nEK_IN:  7 scans\nEK_OFF: 3020 scans\nMR: 6846 scans\nUK_IN:  1020 scans\nUK_OFF: 2542 scans\nWS: 2308 scans\n\n\n\n\nplotting scans for each cast in the first list\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # 1 is selecting only the first sublist\n  # print(i)\n  print(glue(\"=== station: {cast@metadata$station[1]}\"))\n  print(glue(\"# scans: {length(cast@data$scan)}\"))\n  plotScan(cast)\n}\n\n\n=== station: 1\n# scans: 1755\n\n\n\n\n\n\n\n\n\n=== station: 10\n# scans: 1362\n\n\n\n\n\n\n\n\n\n=== station: 11\n# scans: 2933\n\n\n\n\n\n\n\n\n\n=== station: 12\n# scans: 9813\n\n\n\n\n\n\n\n\n\n=== station: 13\n# scans: 1778\n\n\n\n\n\n\n\n\n\n=== station: 14\n# scans: 1890\n\n\n\n\n\n\n\n\n\n=== station: 15\n# scans: 3059\n\n\n\n\n\n\n\n\n\n=== station: 15.5\n# scans: 6654\n\n\n\n\n\n\n\n\n\n=== station: 16\n# scans: 4118\n\n\n\n\n\n\n\n\n\n=== station: 17\n# scans: 3437\n\n\n\n\n\n\n\n\n\n=== station: 18\n# scans: 4434\n\n\n\n\n\n\n\n\n\n=== station: 19\n# scans: 456\n\n\n\n\n\n\n\n\n\n=== station: 2\n# scans: 1774\n\n\n\n\n\n\n\n\n\n=== station: 20\n# scans: 1378\n\n\n\n\n\n\n\n\n\n=== station: 21.5\n# scans: 8836\n\n\n\n\n\n\n\n\n\n=== station: 21/LK\n# scans: 5419\n\n\n\n\n\n\n\n\n\n=== station: 22\n# scans: 2002\n\n\n\n\n\n\n\n\n\n=== station: 22.5\n# scans: 8683\n\n\n\n\n\n\n\n\n\n=== station: 23\n# scans: 1122\n\n\n\n\n\n\n\n\n\n=== station: 24\n# scans: 1295\n\n\n\n\n\n\n\n\n\n=== station: 3\n# scans: 4900\n\n\n\n\n\n\n\n\n\n=== station: 30\n# scans: 1614\n\n\n\n\n\n\n\n\n\n=== station: 30.5\n# scans: 2186\n\n\n\n\n\n\n\n\n\n=== station: 31\n# scans: 983\n\n\n\n\n\n\n\n\n\n=== station: 32\n# scans: 1436\n\n\n\n\n\n\n\n\n\n=== station: 33\n# scans: 1437\n\n\n\n\n\n\n\n\n\n=== station: 34\n# scans: 711\n\n\n\n\n\n\n\n\n\n=== station: 39\n# scans: 1242\n\n\n\n\n\n\n\n\n\n=== station: 41\n# scans: 1519\n\n\n\n\n\n\n\n\n\n=== station: 42\n# scans: 2091\n\n\n\n\n\n\n\n\n\n=== station: 45\n# scans: 1524\n\n\n\n\n\n\n\n\n\n=== station: 47\n# scans: 1025\n\n\n\n\n\n\n\n\n\n=== station: 49\n# scans: 383\n\n\n\n\n\n\n\n\n\n=== station: 5\n# scans: 1197\n\n\n\n\n\n\n\n\n\n=== station: 50\n# scans: 817\n\n\n\n\n\n\n\n\n\n=== station: 51\n# scans: 749\n\n\n\n\n\n\n\n\n\n=== station: 53\n# scans: 3\n\n\n\n\n\n\n\n\n\n=== station: 54\n# scans: 259\n\n\n\n\n\n\n\n\n\n=== station: 55\n# scans: 497\n\n\n\n\n\n\n\n\n\n=== station: 56\n# scans: 772\n\n\n\n\n\n\n\n\n\n=== station: 57\n# scans: 1168\n\n\n\n\n\n\n\n\n\n=== station: 57.1\n# scans: 1866\n\n\n\n\n\n\n\n\n\n=== station: 57.2\n# scans: 779\n\n\n\n\n\n\n\n\n\n=== station: 57.3\n# scans: 1174\n\n\n\n\n\n\n\n\n\n=== station: 58\n# scans: 1554\n\n\n\n\n\n\n\n\n\n=== station: 59\n# scans: 2477\n\n\n\n\n\n\n\n\n\n=== station: 6\n# scans: 3324\n\n\n\n\n\n\n\n\n\n=== station: 6.5\n# scans: 5446\n\n\n\n\n\n\n\n\n\n=== station: 60\n# scans: 2325\n\n\n\n\n\n\n\n\n\n=== station: 61\n# scans: 1992\n\n\n\n\n\n\n\n\n\n=== station: 62\n# scans: 1738\n\n\n\n\n\n\n\n\n\n=== station: 63\n# scans: 1353\n\n\n\n\n\n\n\n\n\n=== station: 64\n# scans: 2722\n\n\n\n\n\n\n\n\n\n=== station: 65\n# scans: 1736\n\n\n\n\n\n\n\n\n\n=== station: 66\n# scans: 1600\n\n\n\n\n\n\n\n\n\n=== station: 67\n# scans: 1272\n\n\n\n\n\n\n\n\n\n=== station: 68\n# scans: 6\n\n\n\n\n\n\n\n\n\n=== station: 69\n# scans: 1443\n\n\n\n\n\n\n\n\n\n=== station: 7\n# scans: 1159\n\n\n\n\n\n\n\n\n\n=== station: 70\n# scans: 1907\n\n\n\n\n\n\n\n\n\n=== station: 8\n# scans: 1287\n\n\n\n\n\n\n\n\n\n=== station: 9\n# scans: 4059\n\n\n\n\n\n\n\n\n\n=== station: 9.5\n# scans: 6707\n\n\n\n\n\n\n\n\n\n=== station: DECK_TST\n# scans: 101\n\n\n\n\n\n\n\n\n\n=== station: EK_IN\n# scans: 7\n\n\n\n\n\n\n\n\n\n=== station: EK_OFF\n# scans: 3020\n\n\n\n\n\n\n\n\n\n=== station: MR\n# scans: 6846\n\n\n\n\n\n\n\n\n\n=== station: UK_IN\n# scans: 1020\n\n\n\n\n\n\n\n\n\n=== station: UK_OFF\n# scans: 2542\n\n\n\n\n\n\n\n\n\n=== station: WS\n# scans: 2308\n\n\n\n\n\n\n\n\n\n\n\nplotting each cast in the first list\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # 1 is selecting only the first sublist\n  tryCatch({\n    plot(ctdDecimate(ctdTrim(cast)))\n  }, error = function(e){\n    print(e)\n  })\n}\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1755' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1362' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2933' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 9813' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1778' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1890' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3059' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 6654' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4118' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3437' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4434' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 456' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1774' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1378' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 8836' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 5419' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2002' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 8683' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1122' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1295' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4900' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1614' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2186' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 983' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1436' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1437' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 711' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1242' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1519' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2091' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1524' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1025' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 383' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1197' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 817' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 749' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 259' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 497' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 772' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1168' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1866' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 779' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1174' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1554' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2477' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3324' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 5446' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2325' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1992' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1738' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1353' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2722' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1736' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1600' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1272' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1443' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1159' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1907' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1287' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4059' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 6707' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3020' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 6846' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1020' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2542' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2308' in coercion to 'logical(1)'&gt;\n\n\n\n\nplotting other physical parameters for each cast\n# Loop through each CTD cast\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # Assuming each sublist contains only one relevant CTD object\n  tryCatch({\n    # Extract metadata for station name and cruise ID\n    station_name &lt;- cast@metadata$station[1]\n    cruise_id &lt;- cast@data$cruise_id[1]\n\n    # Generate a title with station name and cruise ID\n    overall_title &lt;- glue::glue(\"Station: {station_name}, Cruise ID: {cruise_id}\")\n\n    # Set margins: increase the outer margin for the title\n    par(oma = c(0, 0, 3, 0))  # Top outer margin increased for title\n\n    # Plotting function with specific parameters\n    oce::plot(\n      x = ctdDecimate(ctdTrim(cast)),\n      which = c(\n        \"sea_water_electrical_conductivity\",\n        \"descent_rate\", \"sound_velocity\",\n        \"sea_water_sigma_t\",\"altimeter\"\n      ),\n      main = \"\"  # No main title for individual subplots\n    )\n\n    # Place a single overall title at the top of the plot frame\n    mtext(overall_title, side = 3, line = 1, outer = TRUE, cex = 1.5)\n\n    # Reset outer margins to default\n    par(oma = c(0, 0, 0, 0))\n\n  }, error = function(e) {\n    print(e$message)  # Print any errors that occur during plotting\n  })\n}\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"missing value where TRUE/FALSE needed\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"missing value where TRUE/FALSE needed\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n\n\nplotting other nutrient parameters for each cast\n# Loop through each CTD cast\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # Assuming each sublist contains only one relevant CTD object\n  tryCatch({\n    # Extract metadata for station name and cruise ID\n    station_name &lt;- cast@metadata$station[1]\n    cruise_id &lt;- cast@data$cruise_id[1]\n\n    # Generate a title with station name and cruise ID\n    overall_title &lt;- glue::glue(\"Station: {station_name}, Cruise ID: {cruise_id}\")\n\n    # Set margins: increase the outer margin for the title\n    par(oma = c(0, 0, 3, 0))  # Top outer margin increased for title\n\n    # Plotting function with specific parameters\n    oce::plot(\n      x = ctdDecimate(ctdTrim(cast)),\n      which = c(\n        \"CDOM\", \"dissolved_oxygen\",\n        \"oxygen_saturation\",\n        \"chlorophyll_concentration\", \"chlorophyll_fluorescence\"\n      ),\n      main = \"\"  # No main title for individual subplots\n    )\n\n    # Place a single overall title at the top of the plot frame\n    mtext(overall_title, side = 3, line = 1, outer = TRUE, cex = 1.5)\n\n    # Reset outer margins to default\n    par(oma = c(0, 0, 0, 0))\n\n  }, error = function(e) {\n    print(e$message)  # Print any errors that occur during plotting\n  })\n}\n\n\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"plot.new has not been called yet\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n\n\n\n\nplotting other optical parameters for each cast\n# Loop through each CTD cast\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # Assuming each sublist contains only one relevant CTD object\n  tryCatch({\n    # Extract metadata for station name and cruise ID\n    station_name &lt;- cast@metadata$station[1]\n    cruise_id &lt;- cast@data$cruise_id[1]\n\n    # Generate a title with station name and cruise ID\n    overall_title &lt;- glue::glue(\"Station: {station_name}, Cruise ID: {cruise_id}\")\n\n    # Set margins: increase the outer margin for the title\n    par(oma = c(0, 0, 3, 0))  # Top outer margin increased for title\n\n    # Plotting function with specific parameters\n    oce::plot(\n      x = ctdDecimate(ctdTrim(cast)),\n      which = c(\n        \"photosynthetically_available_radiation\",\n        \"beam_attenuation\",\"beam_transmission\"\n      ),\n      main = \"\"  # No main title for individual subplots\n    )\n\n    # Place a single overall title at the top of the plot frame\n    mtext(overall_title, side = 3, line = 1, outer = TRUE, cex = 1.5)\n\n    # Reset outer margins to default\n    par(oma = c(0, 0, 0, 0))\n\n  }, error = function(e) {\n    print(e$message)  # Print any errors that occur during plotting\n  })\n}\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n[1] \"missing value where TRUE/FALSE needed\"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n[1] \"missing value where TRUE/FALSE needed\"\n\n\n\n\n\n\n\n\n\n[1] \"need finite 'xlim' values\"\n\n\n\n\nloop through every cast, clean, & save\ncombined_df &lt;- data.frame()\nfor (i in seq(ctd_FK)){\n  tryCatch({\n    cast &lt;- ctd_FK[[i]]  # 1 is selecting only the first sublist\n    \n    # print(class(cast))\n    # clean cast \n    trimmed_cast &lt;- ctdTrim(cast)\n    decimated_cast &lt;- ctdDecimate(trimmed_cast, p = 0.5)  # binned to 0.5 m\n    \n    # convert to df\n    cast_df &lt;- as.data.frame(decimated_cast@data)\n    \n    # Add metadata\n    # assumes station ID and cruise ID the same for all & just uses 1st one\n    cast_df &lt;- mutate(\n      cast_df,\n      station = cast@data$station[1],\n      cruise_id = cast@data$cruise_id[1]\n    )\n  \n    # drop NA rows left by cleaning\n    cast_df &lt;- subset(cast_df, !is.na(scan))\n    \n    # Append the data to the combined dataframe\n    combined_df &lt;- rbind(combined_df, cast_df)\n  }, error = function(e){\n    print(glue(\"error in cast {cast@metadata$station[1]}\"))\n    print(e)\n  })\n}\n# Save to CSV\nfile_path &lt;- here(glue(\"data/cleaned/{cruise_id}.csv\"))\nwrite.csv(combined_df, file_path, row.names = FALSE)"
  },
  {
    "objectID": "cruise_report/cruise_reports/WS18120.html",
    "href": "cruise_report/cruise_reports/WS18120.html",
    "title": "WS18120",
    "section": "",
    "text": "WS18120\n\n\nsetup\nif (!nzchar(system.file(package = \"librarian\"))) {\n  install.packages(\"librarian\")\n}\n\nlibrarian::shelf(\n  quiet = TRUE,\n  readr, here, fs, ggplot2, glue, \"jiho/castr\", dplyr, oce, patchwork, purrr, tidyr\n)\n\n\n\n\nCode\nsource(here(\"R/cruise_load.R\"))\ncruise_df &lt;- cruise_load(params$cruise_id)\n\n\nWarning: One or more parsing issues, call `problems()` on your data frame for details,\ne.g.:\n  dat &lt;- vroom(...)\n  problems(dat)\n\n\n\n\nplot depth & pressure vs time elapsed\ntryCatch({\n  plots &lt;- list()\n  \n  for (station_name in unique(cruise_df$station)) {\n    subset_df &lt;- filter(cruise_df, station == station_name)\n    plots[[station_name]] &lt;- ggplot(subset_df, aes(x = time_elapsed)) +\n      geom_point(aes(y = depth), color = \"blue\") +  # Plot depth in blue\n      geom_line(aes(y = sea_water_pressure), color = \"red\") +  # Plot sea water pressure in red\n      ggtitle(glue(\"{station_name}\")) +\n      theme(\n        axis.title.x = element_blank(),\n        axis.title.y = element_blank(),\n        axis.text.x = element_blank(),\n        axis.text.y = element_blank(),\n        axis.ticks.x = element_blank(),\n        axis.ticks.y = element_blank()\n      )  # Remove individual axis titles and text\n  }\n  \n  # drop nulls\n  plots &lt;- purrr::compact(plots)\n  \n  # Combine all plots into a grid\n  combined_plot &lt;- wrap_plots(plots) + \n    plot_layout(ncol = 4) +  # Adjust ncol to set number of columns in the grid\n    plot_annotation(\n      title = \"Depth (blue) and Pressure (red)\",\n      subtitle = \"Each panel represents a different station\",\n      caption = \"Time Elapsed (x-axis) vs Depth & Pressure (y-axis)\"\n    ) +\n    theme(\n      plot.tag = element_text(size = 12, face = \"bold\"),\n      plot.tag.position = \"topleft\",\n      axis.title.x = element_text(margin = margin(t = 10)),\n      axis.title.y = element_text(margin = margin(r = 10))\n    )\n  \n  print(combined_plot)\n}, error = function(er){\n  print(er)\n});\n\n\n&lt;error/rlang_error&gt;\nError in `geom_point()`:\n! Problem while computing aesthetics.\n Error occurred in the 1st layer.\nCaused by error:\n! object 'time_elapsed' not found\n---\nBacktrace:\n     \n  1. base::tryCatch(...)\n  2.  base (local) tryCatchList(expr, classes, parentenv, handlers)\n  3.    base (local) tryCatchOne(expr, names, parentenv, handlers[[1L]])\n  4.      base (local) doTryCatch(return(expr), name, parentenv, handler)\n  5. base::print(combined_plot)\n  6. patchwork:::print.patchwork(combined_plot)\n  7.   patchwork:::build_patchwork(plot, plot$layout$guides %||% \"auto\")\n  8.     base::lapply(x$plots, plot_table, guides = guides)\n  9.       patchwork (local) FUN(X[[i]], ...)\n 10.       patchwork:::plot_table.ggplot(X[[i]], ...)\n 11.         ggplot2::ggplotGrob(x)\n 12.           ggplot2::ggplot_gtable(ggplot_build(x))\n 13.            ggplot2:::attach_plot_env(data$plot$plot_env)\n 14.              base::options(ggplot2_plot_env = env)\n 15.           ggplot2::ggplot_build(x)\n 16.           ggplot2:::ggplot_build.ggplot(x)\n 17.             ggplot2:::by_layer(...)\n 18.               rlang::try_fetch(...)\n 19.                base::tryCatch(...)\n 20.                 base (local) tryCatchList(expr, classes, parentenv, handlers)\n 21.                   base (local) tryCatchOne(expr, names, parentenv, handlers[[1L]])\n 22.                     base (local) doTryCatch(return(expr), name, parentenv, handler)\n 23.                base::withCallingHandlers(...)\n 24.               ggplot2 (local) f(l = layers[[i]], d = data[[i]])\n 25.                 l$compute_aesthetics(d, plot)\n 26.                   ggplot2 (local) compute_aesthetics(..., self = self)\n 27.                     base::lapply(aesthetics, eval_tidy, data = data, env = env)\n 28.                       rlang (local) FUN(X[[i]], ...)\n\n\n\n\nplot across all stations\np &lt;- ggplot(cruise_df, aes(x = time, y = depth, fill = station)) +\n  geom_col() +  # This creates the bars\n  # geom_text(aes(label = station), vjust = -0.3) +  # This adds labels to each bar, adjust vjust for position\n  labs(x = \"Time\", y = \"Depth\", title = \"Depth over Time by Station\") +  # Set labels and title\n  theme_minimal()  # Use a minimal theme\nprint(p)\n\n\n\n\n\n\n\n\n\n\n\ncreate oce.ctd objects from dataframes\nctd_load &lt;- function(data, other_params = NULL) {\n  \n  # create csv into ctd object\n  test_ctd &lt;-\n    as.ctd(\n      salinity    = data$sea_water_salinity,\n      temperature = data$sea_water_temperature,\n      pressure    = data$sea_water_pressure,\n      station     = data$station\n    )\n  \n  # add additional columns to ctd object\n  if (!is.null(other_params)) {\n    for (param_name in other_params) {\n      test_ctd &lt;-\n        oceSetData(\n          object = test_ctd,\n          name   = param_name,\n          value  = data[[param_name]]\n        )\n    }\n  }\n  print(glue(\"{data$station[1]}:\\t{length(test_ctd@data$scan)} scans\"))\n\n\n  return(test_ctd)\n}\n\n# Define other parameters to add\nother_params &lt;- c(\n  \"cruise_id\", \"station\", \"time\", \"time_elapsed\", \n  \"latitude\", \"longitude\", \"sea_water_electrical_conductivity\", \n  \"CDOM\", \"dissolved_oxygen\",\"oxygen_saturation\", \"chlorophyll_concentration\", \n  \"chlorophyll_fluorescence\", \"photosynthetically_available_radiation\", \n  \"beam_attenuation\",\"beam_transmission\", \"depth\", \"sea_water_sigma_t\",\n  \"descent_rate\", \"sound_velocity\",\"altimeter\"\n)\n\n# Split data by station and create data list\nctd_FK &lt;- cruise_df %&gt;%\n  split(.$station) %&gt;%\n  map(~ ctd_load(.x, other_params = other_params)) # ~ is a lambda(x)\n\n\n10: 1247 scans\n12: 4017 scans\n16: 858 scans\n18: 4870 scans\n2:  10334 scans\n21/LK:  4896 scans\n30: 4347 scans\n33: 1908 scans\n41: 1743 scans\n45: 3065 scans\n49: 24 scans\n51: 120 scans\n53: 22 scans\n54: 264 scans\n55: 39 scans\n56: 2347 scans\n57: 1116 scans\n57.1:   41 scans\n57.2:   439 scans\n59: 1950 scans\n62: 1814 scans\n65: 69 scans\n68: 3 scans\n7:  467 scans\n9:  5451 scans\nMR: 8247 scans\nWS: 3768 scans\n\n\n\n\nplotting scans for each cast in the first list\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # 1 is selecting only the first sublist\n  # print(i)\n  print(glue(\"=== station: {cast@metadata$station[1]}\"))\n  print(glue(\"# scans: {length(cast@data$scan)}\"))\n  plotScan(cast)\n}\n\n\n=== station: 10\n# scans: 1247\n\n\n\n\n\n\n\n\n\n=== station: 12\n# scans: 4017\n\n\n\n\n\n\n\n\n\n=== station: 16\n# scans: 858\n\n\n\n\n\n\n\n\n\n=== station: 18\n# scans: 4870\n\n\n\n\n\n\n\n\n\n=== station: 2\n# scans: 10334\n\n\n\n\n\n\n\n\n\n=== station: 21/LK\n# scans: 4896\n\n\n\n\n\n\n\n\n\n=== station: 30\n# scans: 4347\n\n\n\n\n\n\n\n\n\n=== station: 33\n# scans: 1908\n\n\n\n\n\n\n\n\n\n=== station: 41\n# scans: 1743\n\n\n\n\n\n\n\n\n\n=== station: 45\n# scans: 3065\n\n\n\n\n\n\n\n\n\n=== station: 49\n# scans: 24\n\n\n\n\n\n\n\n\n\n=== station: 51\n# scans: 120\n\n\n\n\n\n\n\n\n\n=== station: 53\n# scans: 22\n\n\n\n\n\n\n\n\n\n=== station: 54\n# scans: 264\n\n\n\n\n\n\n\n\n\n=== station: 55\n# scans: 39\n\n\n\n\n\n\n\n\n\n=== station: 56\n# scans: 2347\n\n\n\n\n\n\n\n\n\n=== station: 57\n# scans: 1116\n\n\n\n\n\n\n\n\n\n=== station: 57.1\n# scans: 41\n\n\n\n\n\n\n\n\n\n=== station: 57.2\n# scans: 439\n\n\n\n\n\n\n\n\n\n=== station: 59\n# scans: 1950\n\n\n\n\n\n\n\n\n\n=== station: 62\n# scans: 1814\n\n\n\n\n\n\n\n\n\n=== station: 65\n# scans: 69\n\n\n\n\n\n\n\n\n\n=== station: 68\n# scans: 3\n\n\n\n\n\n\n\n\n\n=== station: 7\n# scans: 467\n\n\n\n\n\n\n\n\n\n=== station: 9\n# scans: 5451\n\n\n\n\n\n\n\n\n\n=== station: MR\n# scans: 8247\n\n\n\n\n\n\n\n\n\n=== station: WS\n# scans: 3768\n\n\n\n\n\n\n\n\n\n\n\nplotting each cast in the first list\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # 1 is selecting only the first sublist\n  tryCatch({\n    plot(ctdDecimate(ctdTrim(cast)))\n  }, error = function(e){\n    print(e)\n  })\n}\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1247' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4017' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 858' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4870' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 10334' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4896' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4347' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1908' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1743' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3065' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 24' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 264' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 39' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1116' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 41' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 439' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1950' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1814' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 467' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 5451' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 8247' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3768' in coercion to 'logical(1)'&gt;\n\n\n\n\nplotting other physical parameters for each cast\n# Loop through each CTD cast\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # Assuming each sublist contains only one relevant CTD object\n  tryCatch({\n    # Extract metadata for station name and cruise ID\n    station_name &lt;- cast@metadata$station[1]\n    cruise_id &lt;- cast@data$cruise_id[1]\n\n    # Generate a title with station name and cruise ID\n    overall_title &lt;- glue::glue(\"Station: {station_name}, Cruise ID: {cruise_id}\")\n\n    # Set margins: increase the outer margin for the title\n    par(oma = c(0, 0, 3, 0))  # Top outer margin increased for title\n\n    # Plotting function with specific parameters\n    oce::plot(\n      x = ctdDecimate(ctdTrim(cast)),\n      which = c(\n        \"sea_water_electrical_conductivity\",\n        \"descent_rate\", \"sound_velocity\",\n        \"sea_water_sigma_t\",\"altimeter\"\n      ),\n      main = \"\"  # No main title for individual subplots\n    )\n\n    # Place a single overall title at the top of the plot frame\n    mtext(overall_title, side = 3, line = 1, outer = TRUE, cex = 1.5)\n\n    # Reset outer margins to default\n    par(oma = c(0, 0, 0, 0))\n\n  }, error = function(e) {\n    print(e$message)  # Print any errors that occur during plotting\n  })\n}\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"unknown xtype value (\\\"5.419775\\\")\"\n\n\n\n\nplotting other nutrient parameters for each cast\n# Loop through each CTD cast\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # Assuming each sublist contains only one relevant CTD object\n  tryCatch({\n    # Extract metadata for station name and cruise ID\n    station_name &lt;- cast@metadata$station[1]\n    cruise_id &lt;- cast@data$cruise_id[1]\n\n    # Generate a title with station name and cruise ID\n    overall_title &lt;- glue::glue(\"Station: {station_name}, Cruise ID: {cruise_id}\")\n\n    # Set margins: increase the outer margin for the title\n    par(oma = c(0, 0, 3, 0))  # Top outer margin increased for title\n\n    # Plotting function with specific parameters\n    oce::plot(\n      x = ctdDecimate(ctdTrim(cast)),\n      which = c(\n        \"CDOM\", \"dissolved_oxygen\",\n        \"oxygen_saturation\",\n        \"chlorophyll_concentration\", \"chlorophyll_fluorescence\"\n      ),\n      main = \"\"  # No main title for individual subplots\n    )\n\n    # Place a single overall title at the top of the plot frame\n    mtext(overall_title, side = 3, line = 1, outer = TRUE, cex = 1.5)\n\n    # Reset outer margins to default\n    par(oma = c(0, 0, 0, 0))\n\n  }, error = function(e) {\n    print(e$message)  # Print any errors that occur during plotting\n  })\n}\n\n\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"plot.new has not been called yet\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"plot.new has not been called yet\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n\n\n\n\nplotting other optical parameters for each cast\n# Loop through each CTD cast\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # Assuming each sublist contains only one relevant CTD object\n  tryCatch({\n    # Extract metadata for station name and cruise ID\n    station_name &lt;- cast@metadata$station[1]\n    cruise_id &lt;- cast@data$cruise_id[1]\n\n    # Generate a title with station name and cruise ID\n    overall_title &lt;- glue::glue(\"Station: {station_name}, Cruise ID: {cruise_id}\")\n\n    # Set margins: increase the outer margin for the title\n    par(oma = c(0, 0, 3, 0))  # Top outer margin increased for title\n\n    # Plotting function with specific parameters\n    oce::plot(\n      x = ctdDecimate(ctdTrim(cast)),\n      which = c(\n        \"photosynthetically_available_radiation\",\n        \"beam_attenuation\",\"beam_transmission\"\n      ),\n      main = \"\"  # No main title for individual subplots\n    )\n\n    # Place a single overall title at the top of the plot frame\n    mtext(overall_title, side = 3, line = 1, outer = TRUE, cex = 1.5)\n\n    # Reset outer margins to default\n    par(oma = c(0, 0, 0, 0))\n\n  }, error = function(e) {\n    print(e$message)  # Print any errors that occur during plotting\n  })\n}\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"unknown xtype value (\\\"0.102\\\")\"\n\n\n\n\nloop through every cast, clean, & save\ncombined_df &lt;- data.frame()\nfor (i in seq(ctd_FK)){\n  tryCatch({\n    cast &lt;- ctd_FK[[i]]  # 1 is selecting only the first sublist\n    \n    # print(class(cast))\n    # clean cast \n    trimmed_cast &lt;- ctdTrim(cast)\n    decimated_cast &lt;- ctdDecimate(trimmed_cast, p = 0.5)  # binned to 0.5 m\n    \n    # convert to df\n    cast_df &lt;- as.data.frame(decimated_cast@data)\n    \n    # Add metadata\n    # assumes station ID and cruise ID the same for all & just uses 1st one\n    cast_df &lt;- mutate(\n      cast_df,\n      station = cast@data$station[1],\n      cruise_id = cast@data$cruise_id[1]\n    )\n  \n    # drop NA rows left by cleaning\n    cast_df &lt;- subset(cast_df, !is.na(scan))\n    \n    # Append the data to the combined dataframe\n    combined_df &lt;- rbind(combined_df, cast_df)\n  }, error = function(e){\n    print(glue(\"error in cast {cast@metadata$station[1]}\"))\n    print(e)\n  })\n}\n# Save to CSV\nfile_path &lt;- here(glue(\"data/cleaned/{cruise_id}.csv\"))\nwrite.csv(combined_df, file_path, row.names = FALSE)"
  },
  {
    "objectID": "cruise_report/cruise_reports/WS18285.html",
    "href": "cruise_report/cruise_reports/WS18285.html",
    "title": "WS18285",
    "section": "",
    "text": "WS18285\n\n\nsetup\nif (!nzchar(system.file(package = \"librarian\"))) {\n  install.packages(\"librarian\")\n}\n\nlibrarian::shelf(\n  quiet = TRUE,\n  readr, here, fs, ggplot2, glue, \"jiho/castr\", dplyr, oce, patchwork, purrr, tidyr\n)\n\n\n\n\nCode\nsource(here(\"R/cruise_load.R\"))\ncruise_df &lt;- cruise_load(params$cruise_id)\n\n\n\n\nplot depth & pressure vs time elapsed\ntryCatch({\n  plots &lt;- list()\n  \n  for (station_name in unique(cruise_df$station)) {\n    subset_df &lt;- filter(cruise_df, station == station_name)\n    plots[[station_name]] &lt;- ggplot(subset_df, aes(x = time_elapsed)) +\n      geom_point(aes(y = depth), color = \"blue\") +  # Plot depth in blue\n      geom_line(aes(y = sea_water_pressure), color = \"red\") +  # Plot sea water pressure in red\n      ggtitle(glue(\"{station_name}\")) +\n      theme(\n        axis.title.x = element_blank(),\n        axis.title.y = element_blank(),\n        axis.text.x = element_blank(),\n        axis.text.y = element_blank(),\n        axis.ticks.x = element_blank(),\n        axis.ticks.y = element_blank()\n      )  # Remove individual axis titles and text\n  }\n  \n  # drop nulls\n  plots &lt;- purrr::compact(plots)\n  \n  # Combine all plots into a grid\n  combined_plot &lt;- wrap_plots(plots) + \n    plot_layout(ncol = 4) +  # Adjust ncol to set number of columns in the grid\n    plot_annotation(\n      title = \"Depth (blue) and Pressure (red)\",\n      subtitle = \"Each panel represents a different station\",\n      caption = \"Time Elapsed (x-axis) vs Depth & Pressure (y-axis)\"\n    ) +\n    theme(\n      plot.tag = element_text(size = 12, face = \"bold\"),\n      plot.tag.position = \"topleft\",\n      axis.title.x = element_text(margin = margin(t = 10)),\n      axis.title.y = element_text(margin = margin(r = 10))\n    )\n  \n  print(combined_plot)\n}, error = function(er){\n  print(er)\n});\n\n\n&lt;error/rlang_error&gt;\nError in `geom_point()`:\n! Problem while computing aesthetics.\n Error occurred in the 1st layer.\nCaused by error:\n! object 'time_elapsed' not found\n---\nBacktrace:\n     \n  1. base::tryCatch(...)\n  2.  base (local) tryCatchList(expr, classes, parentenv, handlers)\n  3.    base (local) tryCatchOne(expr, names, parentenv, handlers[[1L]])\n  4.      base (local) doTryCatch(return(expr), name, parentenv, handler)\n  5. base::print(combined_plot)\n  6. patchwork:::print.patchwork(combined_plot)\n  7.   patchwork:::build_patchwork(plot, plot$layout$guides %||% \"auto\")\n  8.     base::lapply(x$plots, plot_table, guides = guides)\n  9.       patchwork (local) FUN(X[[i]], ...)\n 10.       patchwork:::plot_table.ggplot(X[[i]], ...)\n 11.         ggplot2::ggplotGrob(x)\n 12.           ggplot2::ggplot_gtable(ggplot_build(x))\n 13.            ggplot2:::attach_plot_env(data$plot$plot_env)\n 14.              base::options(ggplot2_plot_env = env)\n 15.           ggplot2::ggplot_build(x)\n 16.           ggplot2:::ggplot_build.ggplot(x)\n 17.             ggplot2:::by_layer(...)\n 18.               rlang::try_fetch(...)\n 19.                base::tryCatch(...)\n 20.                 base (local) tryCatchList(expr, classes, parentenv, handlers)\n 21.                   base (local) tryCatchOne(expr, names, parentenv, handlers[[1L]])\n 22.                     base (local) doTryCatch(return(expr), name, parentenv, handler)\n 23.                base::withCallingHandlers(...)\n 24.               ggplot2 (local) f(l = layers[[i]], d = data[[i]])\n 25.                 l$compute_aesthetics(d, plot)\n 26.                   ggplot2 (local) compute_aesthetics(..., self = self)\n 27.                     base::lapply(aesthetics, eval_tidy, data = data, env = env)\n 28.                       rlang (local) FUN(X[[i]], ...)\n\n\n\n\nplot across all stations\np &lt;- ggplot(cruise_df, aes(x = time, y = depth, fill = station)) +\n  geom_col() +  # This creates the bars\n  # geom_text(aes(label = station), vjust = -0.3) +  # This adds labels to each bar, adjust vjust for position\n  labs(x = \"Time\", y = \"Depth\", title = \"Depth over Time by Station\") +  # Set labels and title\n  theme_minimal()  # Use a minimal theme\nprint(p)\n\n\n\n\n\n\n\n\n\n\n\ncreate oce.ctd objects from dataframes\nctd_load &lt;- function(data, other_params = NULL) {\n  \n  # create csv into ctd object\n  test_ctd &lt;-\n    as.ctd(\n      salinity    = data$sea_water_salinity,\n      temperature = data$sea_water_temperature,\n      pressure    = data$sea_water_pressure,\n      station     = data$station\n    )\n  \n  # add additional columns to ctd object\n  if (!is.null(other_params)) {\n    for (param_name in other_params) {\n      test_ctd &lt;-\n        oceSetData(\n          object = test_ctd,\n          name   = param_name,\n          value  = data[[param_name]]\n        )\n    }\n  }\n  print(glue(\"{data$station[1]}:\\t{length(test_ctd@data$scan)} scans\"))\n\n\n  return(test_ctd)\n}\n\n# Define other parameters to add\nother_params &lt;- c(\n  \"cruise_id\", \"station\", \"time\", \"time_elapsed\", \n  \"latitude\", \"longitude\", \"sea_water_electrical_conductivity\", \n  \"CDOM\", \"dissolved_oxygen\",\"oxygen_saturation\", \"chlorophyll_concentration\", \n  \"chlorophyll_fluorescence\", \"photosynthetically_available_radiation\", \n  \"beam_attenuation\",\"beam_transmission\", \"depth\", \"sea_water_sigma_t\",\n  \"descent_rate\", \"sound_velocity\",\"altimeter\"\n)\n\n# Split data by station and create data list\nctd_FK &lt;- cruise_df %&gt;%\n  split(.$station) %&gt;%\n  map(~ ctd_load(.x, other_params = other_params)) # ~ is a lambda(x)\n\n\n16: 21 scans\n18: 5116 scans\n2:  4471 scans\n21.5:   9558 scans\n21.5V2: 6909 scans\n21/LK:  3933 scans\n24: 3634 scans\n30: 4431 scans\n31: 2399 scans\n33: 3431 scans\n45: 2385 scans\n51: 1978 scans\n54: 74 scans\n57: 4089 scans\n57.2:   3148 scans\n57.3:   2605 scans\n58: 3012 scans\n59: 2271 scans\n60: 1707 scans\n68: 2 scans\n9:  5319 scans\nCAL1:   2260 scans\nCAL2:   3972 scans\nCAL3:   3474 scans\nCAL4:   3000 scans\nCAL5:   4840 scans\nCW1:    2165 scans\nCW2:    3127 scans\nCW3:    3744 scans\nCW4:    3147 scans\nDECKTST:    49 scans\nDECKTST2:   3 scans\nGP1:    2397 scans\nGP2:    2746 scans\nGP3:    3784 scans\nGP4:    3020 scans\nGP5:    6003 scans\nJUNKPILE:   2137 scans\nKW1:    2914 scans\nKW2:    2863 scans\nKW4:    4403 scans\nMR: 5390 scans\nREAL24: 3449 scans\nREDTIDE:    5113 scans\nRP1:    4046 scans\nRP2:    3482 scans\nRP3:    3283 scans\nRP4:    3238 scans\nTB1:    3721 scans\nTB2:    2970 scans\nTB3:    4057 scans\nTB4:    4678 scans\nTB5:    5853 scans\nTB6:    1405 scans\nTB7:    3105 scans\nTB8:    2513 scans\nTB9:    4441 scans\nWS: 2743 scans\nZ03_027:    3050 scans\nZ03_076:    3415 scans\nZ03_116:    4962 scans\nZ03_146:    4495 scans\nZ03_198:    2757 scans\nZ04_067:    6554 scans\nZ04_068:    3417 scans\nZ04_093:    2325 scans\nZ04_099:    4617 scans\nZ04_110:    2991 scans\nZ04_610:    3186 scans\n\n\n\n\nplotting scans for each cast in the first list\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # 1 is selecting only the first sublist\n  # print(i)\n  print(glue(\"=== station: {cast@metadata$station[1]}\"))\n  print(glue(\"# scans: {length(cast@data$scan)}\"))\n  plotScan(cast)\n}\n\n\n=== station: 16\n# scans: 21\n\n\n\n\n\n\n\n\n\n=== station: 18\n# scans: 5116\n\n\n\n\n\n\n\n\n\n=== station: 2\n# scans: 4471\n\n\n\n\n\n\n\n\n\n=== station: 21.5\n# scans: 9558\n\n\n\n\n\n\n\n\n\n=== station: 21.5V2\n# scans: 6909\n\n\n\n\n\n\n\n\n\n=== station: 21/LK\n# scans: 3933\n\n\n\n\n\n\n\n\n\n=== station: 24\n# scans: 3634\n\n\n\n\n\n\n\n\n\n=== station: 30\n# scans: 4431\n\n\n\n\n\n\n\n\n\n=== station: 31\n# scans: 2399\n\n\n\n\n\n\n\n\n\n=== station: 33\n# scans: 3431\n\n\n\n\n\n\n\n\n\n=== station: 45\n# scans: 2385\n\n\n\n\n\n\n\n\n\n=== station: 51\n# scans: 1978\n\n\n\n\n\n\n\n\n\n=== station: 54\n# scans: 74\n\n\n\n\n\n\n\n\n\n=== station: 57\n# scans: 4089\n\n\n\n\n\n\n\n\n\n=== station: 57.2\n# scans: 3148\n\n\n\n\n\n\n\n\n\n=== station: 57.3\n# scans: 2605\n\n\n\n\n\n\n\n\n\n=== station: 58\n# scans: 3012\n\n\n\n\n\n\n\n\n\n=== station: 59\n# scans: 2271\n\n\n\n\n\n\n\n\n\n=== station: 60\n# scans: 1707\n\n\n\n\n\n\n\n\n\n=== station: 68\n# scans: 2\n\n\n\n\n\n\n\n\n\n=== station: 9\n# scans: 5319\n\n\n\n\n\n\n\n\n\n=== station: CAL1\n# scans: 2260\n\n\n\n\n\n\n\n\n\n=== station: CAL2\n# scans: 3972\n\n\n\n\n\n\n\n\n\n=== station: CAL3\n# scans: 3474\n\n\n\n\n\n\n\n\n\n=== station: CAL4\n# scans: 3000\n\n\n\n\n\n\n\n\n\n=== station: CAL5\n# scans: 4840\n\n\n\n\n\n\n\n\n\n=== station: CW1\n# scans: 2165\n\n\n\n\n\n\n\n\n\n=== station: CW2\n# scans: 3127\n\n\n\n\n\n\n\n\n\n=== station: CW3\n# scans: 3744\n\n\n\n\n\n\n\n\n\n=== station: CW4\n# scans: 3147\n\n\n\n\n\n\n\n\n\n=== station: DECKTST\n# scans: 49\n\n\n\n\n\n\n\n\n\n=== station: DECKTST2\n# scans: 3\n\n\n\n\n\n\n\n\n\n=== station: GP1\n# scans: 2397\n\n\n\n\n\n\n\n\n\n=== station: GP2\n# scans: 2746\n\n\n\n\n\n\n\n\n\n=== station: GP3\n# scans: 3784\n\n\n\n\n\n\n\n\n\n=== station: GP4\n# scans: 3020\n\n\n\n\n\n\n\n\n\n=== station: GP5\n# scans: 6003\n\n\n\n\n\n\n\n\n\n=== station: JUNKPILE\n# scans: 2137\n\n\n\n\n\n\n\n\n\n=== station: KW1\n# scans: 2914\n\n\n\n\n\n\n\n\n\n=== station: KW2\n# scans: 2863\n\n\n\n\n\n\n\n\n\n=== station: KW4\n# scans: 4403\n\n\n\n\n\n\n\n\n\n=== station: MR\n# scans: 5390\n\n\n\n\n\n\n\n\n\n=== station: REAL24\n# scans: 3449\n\n\n\n\n\n\n\n\n\n=== station: REDTIDE\n# scans: 5113\n\n\n\n\n\n\n\n\n\n=== station: RP1\n# scans: 4046\n\n\n\n\n\n\n\n\n\n=== station: RP2\n# scans: 3482\n\n\n\n\n\n\n\n\n\n=== station: RP3\n# scans: 3283\n\n\n\n\n\n\n\n\n\n=== station: RP4\n# scans: 3238\n\n\n\n\n\n\n\n\n\n=== station: TB1\n# scans: 3721\n\n\n\n\n\n\n\n\n\n=== station: TB2\n# scans: 2970\n\n\n\n\n\n\n\n\n\n=== station: TB3\n# scans: 4057\n\n\n\n\n\n\n\n\n\n=== station: TB4\n# scans: 4678\n\n\n\n\n\n\n\n\n\n=== station: TB5\n# scans: 5853\n\n\n\n\n\n\n\n\n\n=== station: TB6\n# scans: 1405\n\n\n\n\n\n\n\n\n\n=== station: TB7\n# scans: 3105\n\n\n\n\n\n\n\n\n\n=== station: TB8\n# scans: 2513\n\n\n\n\n\n\n\n\n\n=== station: TB9\n# scans: 4441\n\n\n\n\n\n\n\n\n\n=== station: WS\n# scans: 2743\n\n\n\n\n\n\n\n\n\n=== station: Z03_027\n# scans: 3050\n\n\n\n\n\n\n\n\n\n=== station: Z03_076\n# scans: 3415\n\n\n\n\n\n\n\n\n\n=== station: Z03_116\n# scans: 4962\n\n\n\n\n\n\n\n\n\n=== station: Z03_146\n# scans: 4495\n\n\n\n\n\n\n\n\n\n=== station: Z03_198\n# scans: 2757\n\n\n\n\n\n\n\n\n\n=== station: Z04_067\n# scans: 6554\n\n\n\n\n\n\n\n\n\n=== station: Z04_068\n# scans: 3417\n\n\n\n\n\n\n\n\n\n=== station: Z04_093\n# scans: 2325\n\n\n\n\n\n\n\n\n\n=== station: Z04_099\n# scans: 4617\n\n\n\n\n\n\n\n\n\n=== station: Z04_110\n# scans: 2991\n\n\n\n\n\n\n\n\n\n=== station: Z04_610\n# scans: 3186\n\n\n\n\n\n\n\n\n\n\n\nplotting each cast in the first list\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # 1 is selecting only the first sublist\n  tryCatch({\n    plot(ctdDecimate(ctdTrim(cast)))\n  }, error = function(e){\n    print(e)\n  })\n}\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 21' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 5116' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4471' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 9558' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 6909' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3933' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3634' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4431' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2399' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3431' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2385' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1978' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4089' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3148' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2605' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3012' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2271' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1707' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 5319' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2260' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3972' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3474' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3000' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4840' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2165' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3127' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3744' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3147' in coercion to 'logical(1)'&gt;\n&lt;simpleError in h(simpleError(msg, call)): error in evaluating the argument 'x' in selecting a method for function 'plot': missing value where TRUE/FALSE needed&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2397' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2746' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3784' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3020' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 6003' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2137' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2914' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2863' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4403' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 5390' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3449' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 5113' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4046' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3482' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3283' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3238' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3721' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2970' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4057' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4678' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 5853' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1405' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3105' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2513' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4441' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2743' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3050' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3415' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4962' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4495' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2757' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 6554' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3417' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2325' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4617' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2991' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3186' in coercion to 'logical(1)'&gt;\n\n\n\n\nplotting other physical parameters for each cast\n# Loop through each CTD cast\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # Assuming each sublist contains only one relevant CTD object\n  tryCatch({\n    # Extract metadata for station name and cruise ID\n    station_name &lt;- cast@metadata$station[1]\n    cruise_id &lt;- cast@data$cruise_id[1]\n\n    # Generate a title with station name and cruise ID\n    overall_title &lt;- glue::glue(\"Station: {station_name}, Cruise ID: {cruise_id}\")\n\n    # Set margins: increase the outer margin for the title\n    par(oma = c(0, 0, 3, 0))  # Top outer margin increased for title\n\n    # Plotting function with specific parameters\n    oce::plot(\n      x = ctdDecimate(ctdTrim(cast)),\n      which = c(\n        \"sea_water_electrical_conductivity\",\n        \"descent_rate\", \"sound_velocity\",\n        \"sea_water_sigma_t\",\"altimeter\"\n      ),\n      main = \"\"  # No main title for individual subplots\n    )\n\n    # Place a single overall title at the top of the plot frame\n    mtext(overall_title, side = 3, line = 1, outer = TRUE, cex = 1.5)\n\n    # Reset outer margins to default\n    par(oma = c(0, 0, 0, 0))\n\n  }, error = function(e) {\n    print(e$message)  # Print any errors that occur during plotting\n  })\n}\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"error in evaluating the argument 'x' in selecting a method for function 'plot': missing value where TRUE/FALSE needed\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n\n\nplotting other nutrient parameters for each cast\n# Loop through each CTD cast\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # Assuming each sublist contains only one relevant CTD object\n  tryCatch({\n    # Extract metadata for station name and cruise ID\n    station_name &lt;- cast@metadata$station[1]\n    cruise_id &lt;- cast@data$cruise_id[1]\n\n    # Generate a title with station name and cruise ID\n    overall_title &lt;- glue::glue(\"Station: {station_name}, Cruise ID: {cruise_id}\")\n\n    # Set margins: increase the outer margin for the title\n    par(oma = c(0, 0, 3, 0))  # Top outer margin increased for title\n\n    # Plotting function with specific parameters\n    oce::plot(\n      x = ctdDecimate(ctdTrim(cast)),\n      which = c(\n        \"CDOM\", \"dissolved_oxygen\",\n        \"oxygen_saturation\",\n        \"chlorophyll_concentration\", \"chlorophyll_fluorescence\"\n      ),\n      main = \"\"  # No main title for individual subplots\n    )\n\n    # Place a single overall title at the top of the plot frame\n    mtext(overall_title, side = 3, line = 1, outer = TRUE, cex = 1.5)\n\n    # Reset outer margins to default\n    par(oma = c(0, 0, 0, 0))\n\n  }, error = function(e) {\n    print(e$message)  # Print any errors that occur during plotting\n  })\n}\n\n\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"plot.new has not been called yet\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"plot.new has not been called yet\"\n[1] \"error in evaluating the argument 'x' in selecting a method for function 'plot': missing value where TRUE/FALSE needed\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n\n\n\n\nplotting other optical parameters for each cast\n# Loop through each CTD cast\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # Assuming each sublist contains only one relevant CTD object\n  tryCatch({\n    # Extract metadata for station name and cruise ID\n    station_name &lt;- cast@metadata$station[1]\n    cruise_id &lt;- cast@data$cruise_id[1]\n\n    # Generate a title with station name and cruise ID\n    overall_title &lt;- glue::glue(\"Station: {station_name}, Cruise ID: {cruise_id}\")\n\n    # Set margins: increase the outer margin for the title\n    par(oma = c(0, 0, 3, 0))  # Top outer margin increased for title\n\n    # Plotting function with specific parameters\n    oce::plot(\n      x = ctdDecimate(ctdTrim(cast)),\n      which = c(\n        \"photosynthetically_available_radiation\",\n        \"beam_attenuation\",\"beam_transmission\"\n      ),\n      main = \"\"  # No main title for individual subplots\n    )\n\n    # Place a single overall title at the top of the plot frame\n    mtext(overall_title, side = 3, line = 1, outer = TRUE, cex = 1.5)\n\n    # Reset outer margins to default\n    par(oma = c(0, 0, 0, 0))\n\n  }, error = function(e) {\n    print(e$message)  # Print any errors that occur during plotting\n  })\n}\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"error in evaluating the argument 'x' in selecting a method for function 'plot': missing value where TRUE/FALSE needed\"\n\n\n\n\nloop through every cast, clean, & save\ncombined_df &lt;- data.frame()\nfor (i in seq(ctd_FK)){\n  tryCatch({\n    cast &lt;- ctd_FK[[i]]  # 1 is selecting only the first sublist\n    \n    # print(class(cast))\n    # clean cast \n    trimmed_cast &lt;- ctdTrim(cast)\n    decimated_cast &lt;- ctdDecimate(trimmed_cast, p = 0.5)  # binned to 0.5 m\n    \n    # convert to df\n    cast_df &lt;- as.data.frame(decimated_cast@data)\n    \n    # Add metadata\n    # assumes station ID and cruise ID the same for all & just uses 1st one\n    cast_df &lt;- mutate(\n      cast_df,\n      station = cast@data$station[1],\n      cruise_id = cast@data$cruise_id[1]\n    )\n  \n    # drop NA rows left by cleaning\n    cast_df &lt;- subset(cast_df, !is.na(scan))\n    \n    # Append the data to the combined dataframe\n    combined_df &lt;- rbind(combined_df, cast_df)\n  }, error = function(e){\n    print(glue(\"error in cast {cast@metadata$station[1]}\"))\n    print(e)\n  })\n}\n\n\nerror in cast DECKTST2\n&lt;simpleError in if (nbad &gt; 0) {    if (replace == \"reference\") {        x[bad] &lt;- x.reference[bad]    }    else {        x[bad] &lt;- rep(NA, nbad)    }}: missing value where TRUE/FALSE needed&gt;\n\n\nloop through every cast, clean, & save\n# Save to CSV\nfile_path &lt;- here(glue(\"data/cleaned/{cruise_id}.csv\"))\nwrite.csv(combined_df, file_path, row.names = FALSE)"
  },
  {
    "objectID": "cruise_report/cruise_reports/WS19028.html",
    "href": "cruise_report/cruise_reports/WS19028.html",
    "title": "WS19028",
    "section": "",
    "text": "WS19028\n\n\nsetup\nif (!nzchar(system.file(package = \"librarian\"))) {\n  install.packages(\"librarian\")\n}\n\nlibrarian::shelf(\n  quiet = TRUE,\n  readr, here, fs, ggplot2, glue, \"jiho/castr\", dplyr, oce, patchwork, purrr, tidyr\n)\n\n\n\n\nCode\nsource(here(\"R/cruise_load.R\"))\ncruise_df &lt;- cruise_load(params$cruise_id)\n\n\n\n\nplot depth & pressure vs time elapsed\ntryCatch({\n  plots &lt;- list()\n  \n  for (station_name in unique(cruise_df$station)) {\n    subset_df &lt;- filter(cruise_df, station == station_name)\n    plots[[station_name]] &lt;- ggplot(subset_df, aes(x = time_elapsed)) +\n      geom_point(aes(y = depth), color = \"blue\") +  # Plot depth in blue\n      geom_line(aes(y = sea_water_pressure), color = \"red\") +  # Plot sea water pressure in red\n      ggtitle(glue(\"{station_name}\")) +\n      theme(\n        axis.title.x = element_blank(),\n        axis.title.y = element_blank(),\n        axis.text.x = element_blank(),\n        axis.text.y = element_blank(),\n        axis.ticks.x = element_blank(),\n        axis.ticks.y = element_blank()\n      )  # Remove individual axis titles and text\n  }\n  \n  # drop nulls\n  plots &lt;- purrr::compact(plots)\n  \n  # Combine all plots into a grid\n  combined_plot &lt;- wrap_plots(plots) + \n    plot_layout(ncol = 4) +  # Adjust ncol to set number of columns in the grid\n    plot_annotation(\n      title = \"Depth (blue) and Pressure (red)\",\n      subtitle = \"Each panel represents a different station\",\n      caption = \"Time Elapsed (x-axis) vs Depth & Pressure (y-axis)\"\n    ) +\n    theme(\n      plot.tag = element_text(size = 12, face = \"bold\"),\n      plot.tag.position = \"topleft\",\n      axis.title.x = element_text(margin = margin(t = 10)),\n      axis.title.y = element_text(margin = margin(r = 10))\n    )\n  \n  print(combined_plot)\n}, error = function(er){\n  print(er)\n});\n\n\n&lt;error/rlang_error&gt;\nError in `geom_point()`:\n! Problem while computing aesthetics.\n Error occurred in the 1st layer.\nCaused by error:\n! object 'time_elapsed' not found\n---\nBacktrace:\n     \n  1. base::tryCatch(...)\n  2.  base (local) tryCatchList(expr, classes, parentenv, handlers)\n  3.    base (local) tryCatchOne(expr, names, parentenv, handlers[[1L]])\n  4.      base (local) doTryCatch(return(expr), name, parentenv, handler)\n  5. base::print(combined_plot)\n  6. patchwork:::print.patchwork(combined_plot)\n  7.   patchwork:::build_patchwork(plot, plot$layout$guides %||% \"auto\")\n  8.     base::lapply(x$plots, plot_table, guides = guides)\n  9.       patchwork (local) FUN(X[[i]], ...)\n 10.       patchwork:::plot_table.ggplot(X[[i]], ...)\n 11.         ggplot2::ggplotGrob(x)\n 12.           ggplot2::ggplot_gtable(ggplot_build(x))\n 13.            ggplot2:::attach_plot_env(data$plot$plot_env)\n 14.              base::options(ggplot2_plot_env = env)\n 15.           ggplot2::ggplot_build(x)\n 16.           ggplot2:::ggplot_build.ggplot(x)\n 17.             ggplot2:::by_layer(...)\n 18.               rlang::try_fetch(...)\n 19.                base::tryCatch(...)\n 20.                 base (local) tryCatchList(expr, classes, parentenv, handlers)\n 21.                   base (local) tryCatchOne(expr, names, parentenv, handlers[[1L]])\n 22.                     base (local) doTryCatch(return(expr), name, parentenv, handler)\n 23.                base::withCallingHandlers(...)\n 24.               ggplot2 (local) f(l = layers[[i]], d = data[[i]])\n 25.                 l$compute_aesthetics(d, plot)\n 26.                   ggplot2 (local) compute_aesthetics(..., self = self)\n 27.                     base::lapply(aesthetics, eval_tidy, data = data, env = env)\n 28.                       rlang (local) FUN(X[[i]], ...)\n\n\n\n\nplot across all stations\np &lt;- ggplot(cruise_df, aes(x = time, y = depth, fill = station)) +\n  geom_col() +  # This creates the bars\n  # geom_text(aes(label = station), vjust = -0.3) +  # This adds labels to each bar, adjust vjust for position\n  labs(x = \"Time\", y = \"Depth\", title = \"Depth over Time by Station\") +  # Set labels and title\n  theme_minimal()  # Use a minimal theme\nprint(p)\n\n\n\n\n\n\n\n\n\n\n\ncreate oce.ctd objects from dataframes\nctd_load &lt;- function(data, other_params = NULL) {\n  \n  # create csv into ctd object\n  test_ctd &lt;-\n    as.ctd(\n      salinity    = data$sea_water_salinity,\n      temperature = data$sea_water_temperature,\n      pressure    = data$sea_water_pressure,\n      station     = data$station\n    )\n  \n  # add additional columns to ctd object\n  if (!is.null(other_params)) {\n    for (param_name in other_params) {\n      test_ctd &lt;-\n        oceSetData(\n          object = test_ctd,\n          name   = param_name,\n          value  = data[[param_name]]\n        )\n    }\n  }\n  print(glue(\"{data$station[1]}:\\t{length(test_ctd@data$scan)} scans\"))\n\n\n  return(test_ctd)\n}\n\n# Define other parameters to add\nother_params &lt;- c(\n  \"cruise_id\", \"station\", \"time\", \"time_elapsed\", \n  \"latitude\", \"longitude\", \"sea_water_electrical_conductivity\", \n  \"CDOM\", \"dissolved_oxygen\",\"oxygen_saturation\", \"chlorophyll_concentration\", \n  \"chlorophyll_fluorescence\", \"photosynthetically_available_radiation\", \n  \"beam_attenuation\",\"beam_transmission\", \"depth\", \"sea_water_sigma_t\",\n  \"descent_rate\", \"sound_velocity\",\"altimeter\"\n)\n\n# Split data by station and create data list\nctd_FK &lt;- cruise_df %&gt;%\n  split(.$station) %&gt;%\n  map(~ ctd_load(.x, other_params = other_params)) # ~ is a lambda(x)\n\n\n21/LK:  5988 scans\n30: 3575 scans\n31: 2766 scans\n33: 2545 scans\n41: 1445 scans\n45: 1911 scans\n49: 3 scans\n51: 1 scans\n53: 53 scans\n54: 355 scans\n55: 60 scans\n56: 62 scans\n57: 280 scans\n57.1:   1586 scans\n57.2:   2211 scans\n57.3:   2453 scans\n58: 1898 scans\n60: 1353 scans\n64: 300 scans\nCAL1:   89 scans\nCAL2:   2079 scans\nCAL3:   1889 scans\nCAL4:   1543 scans\nCAL5:   3592 scans\nGP1:    2343 scans\nGP2:    2314 scans\nGP3:    1745 scans\nGP4:    2543 scans\nGP5:    3812 scans\nKW4:    3664 scans\nMR: 4800 scans\nRP1:    1046 scans\nRP2:    1344 scans\nRP3:    2337 scans\nRP4:    3536 scans\nV1: 2734 scans\nV2: 3299 scans\nV4: 3231 scans\nV6: 3176 scans\nWS: 6333 scans\n\n\n\n\nplotting scans for each cast in the first list\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # 1 is selecting only the first sublist\n  # print(i)\n  print(glue(\"=== station: {cast@metadata$station[1]}\"))\n  print(glue(\"# scans: {length(cast@data$scan)}\"))\n  plotScan(cast)\n}\n\n\n=== station: 21/LK\n# scans: 5988\n\n\n\n\n\n\n\n\n\n=== station: 30\n# scans: 3575\n\n\n\n\n\n\n\n\n\n=== station: 31\n# scans: 2766\n\n\n\n\n\n\n\n\n\n=== station: 33\n# scans: 2545\n\n\n\n\n\n\n\n\n\n=== station: 41\n# scans: 1445\n\n\n\n\n\n\n\n\n\n=== station: 45\n# scans: 1911\n\n\n\n\n\n\n\n\n\n=== station: 49\n# scans: 3\n\n\n\n\n\n\n\n\n\n=== station: 51\n# scans: 1\n\n\n\n\n\n\n\n\n\n=== station: 53\n# scans: 53\n\n\n\n\n\n\n\n\n\n=== station: 54\n# scans: 355\n\n\n\n\n\n\n\n\n\n=== station: 55\n# scans: 60\n\n\n\n\n\n\n\n\n\n=== station: 56\n# scans: 62\n\n\n\n\n\n\n\n\n\n=== station: 57\n# scans: 280\n\n\n\n\n\n\n\n\n\n=== station: 57.1\n# scans: 1586\n\n\n\n\n\n\n\n\n\n=== station: 57.2\n# scans: 2211\n\n\n\n\n\n\n\n\n\n=== station: 57.3\n# scans: 2453\n\n\n\n\n\n\n\n\n\n=== station: 58\n# scans: 1898\n\n\n\n\n\n\n\n\n\n=== station: 60\n# scans: 1353\n\n\n\n\n\n\n\n\n\n=== station: 64\n# scans: 300\n\n\n\n\n\n\n\n\n\n=== station: CAL1\n# scans: 89\n\n\n\n\n\n\n\n\n\n=== station: CAL2\n# scans: 2079\n\n\n\n\n\n\n\n\n\n=== station: CAL3\n# scans: 1889\n\n\n\n\n\n\n\n\n\n=== station: CAL4\n# scans: 1543\n\n\n\n\n\n\n\n\n\n=== station: CAL5\n# scans: 3592\n\n\n\n\n\n\n\n\n\n=== station: GP1\n# scans: 2343\n\n\n\n\n\n\n\n\n\n=== station: GP2\n# scans: 2314\n\n\n\n\n\n\n\n\n\n=== station: GP3\n# scans: 1745\n\n\n\n\n\n\n\n\n\n=== station: GP4\n# scans: 2543\n\n\n\n\n\n\n\n\n\n=== station: GP5\n# scans: 3812\n\n\n\n\n\n\n\n\n\n=== station: KW4\n# scans: 3664\n\n\n\n\n\n\n\n\n\n=== station: MR\n# scans: 4800\n\n\n\n\n\n\n\n\n\n=== station: RP1\n# scans: 1046\n\n\n\n\n\n\n\n\n\n=== station: RP2\n# scans: 1344\n\n\n\n\n\n\n\n\n\n=== station: RP3\n# scans: 2337\n\n\n\n\n\n\n\n\n\n=== station: RP4\n# scans: 3536\n\n\n\n\n\n\n\n\n\n=== station: V1\n# scans: 2734\n\n\n\n\n\n\n\n\n\n=== station: V2\n# scans: 3299\n\n\n\n\n\n\n\n\n\n=== station: V4\n# scans: 3231\n\n\n\n\n\n\n\n\n\n=== station: V6\n# scans: 3176\n\n\n\n\n\n\n\n\n\n=== station: WS\n# scans: 6333\n\n\n\n\n\n\n\n\n\n\n\nplotting each cast in the first list\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # 1 is selecting only the first sublist\n  tryCatch({\n    plot(ctdDecimate(ctdTrim(cast)))\n  }, error = function(e){\n    print(e)\n  })\n}\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 5988' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3575' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2766' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2545' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1911' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 60' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1586' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2211' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2453' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1898' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1353' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 89' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2079' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1889' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1543' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3592' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2343' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2314' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1745' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2543' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3812' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3664' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4800' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1046' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1344' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2337' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3536' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2734' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3299' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3231' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3176' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 6333' in coercion to 'logical(1)'&gt;\n\n\n\n\nplotting other physical parameters for each cast\n# Loop through each CTD cast\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # Assuming each sublist contains only one relevant CTD object\n  tryCatch({\n    # Extract metadata for station name and cruise ID\n    station_name &lt;- cast@metadata$station[1]\n    cruise_id &lt;- cast@data$cruise_id[1]\n\n    # Generate a title with station name and cruise ID\n    overall_title &lt;- glue::glue(\"Station: {station_name}, Cruise ID: {cruise_id}\")\n\n    # Set margins: increase the outer margin for the title\n    par(oma = c(0, 0, 3, 0))  # Top outer margin increased for title\n\n    # Plotting function with specific parameters\n    oce::plot(\n      x = ctdDecimate(ctdTrim(cast)),\n      which = c(\n        \"sea_water_electrical_conductivity\",\n        \"descent_rate\", \"sound_velocity\",\n        \"sea_water_sigma_t\",\"altimeter\"\n      ),\n      main = \"\"  # No main title for individual subplots\n    )\n\n    # Place a single overall title at the top of the plot frame\n    mtext(overall_title, side = 3, line = 1, outer = TRUE, cex = 1.5)\n\n    # Reset outer margins to default\n    par(oma = c(0, 0, 0, 0))\n\n  }, error = function(e) {\n    print(e$message)  # Print any errors that occur during plotting\n  })\n}\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"unknown xtype value (\\\"4.531207\\\")\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n\n\nplotting other nutrient parameters for each cast\n# Loop through each CTD cast\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # Assuming each sublist contains only one relevant CTD object\n  tryCatch({\n    # Extract metadata for station name and cruise ID\n    station_name &lt;- cast@metadata$station[1]\n    cruise_id &lt;- cast@data$cruise_id[1]\n\n    # Generate a title with station name and cruise ID\n    overall_title &lt;- glue::glue(\"Station: {station_name}, Cruise ID: {cruise_id}\")\n\n    # Set margins: increase the outer margin for the title\n    par(oma = c(0, 0, 3, 0))  # Top outer margin increased for title\n\n    # Plotting function with specific parameters\n    oce::plot(\n      x = ctdDecimate(ctdTrim(cast)),\n      which = c(\n        \"CDOM\", \"dissolved_oxygen\",\n        \"oxygen_saturation\",\n        \"chlorophyll_concentration\", \"chlorophyll_fluorescence\"\n      ),\n      main = \"\"  # No main title for individual subplots\n    )\n\n    # Place a single overall title at the top of the plot frame\n    mtext(overall_title, side = 3, line = 1, outer = TRUE, cex = 1.5)\n\n    # Reset outer margins to default\n    par(oma = c(0, 0, 0, 0))\n\n  }, error = function(e) {\n    print(e$message)  # Print any errors that occur during plotting\n  })\n}\n\n\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"plot.new has not been called yet\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"plot.new has not been called yet\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n\n\n\n\nplotting other optical parameters for each cast\n# Loop through each CTD cast\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # Assuming each sublist contains only one relevant CTD object\n  tryCatch({\n    # Extract metadata for station name and cruise ID\n    station_name &lt;- cast@metadata$station[1]\n    cruise_id &lt;- cast@data$cruise_id[1]\n\n    # Generate a title with station name and cruise ID\n    overall_title &lt;- glue::glue(\"Station: {station_name}, Cruise ID: {cruise_id}\")\n\n    # Set margins: increase the outer margin for the title\n    par(oma = c(0, 0, 3, 0))  # Top outer margin increased for title\n\n    # Plotting function with specific parameters\n    oce::plot(\n      x = ctdDecimate(ctdTrim(cast)),\n      which = c(\n        \"photosynthetically_available_radiation\",\n        \"beam_attenuation\",\"beam_transmission\"\n      ),\n      main = \"\"  # No main title for individual subplots\n    )\n\n    # Place a single overall title at the top of the plot frame\n    mtext(overall_title, side = 3, line = 1, outer = TRUE, cex = 1.5)\n\n    # Reset outer margins to default\n    par(oma = c(0, 0, 0, 0))\n\n  }, error = function(e) {\n    print(e$message)  # Print any errors that occur during plotting\n  })\n}\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"unknown xtype value (\\\"481.93\\\")\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n\n\nloop through every cast, clean, & save\ncombined_df &lt;- data.frame()\nfor (i in seq(ctd_FK)){\n  tryCatch({\n    cast &lt;- ctd_FK[[i]]  # 1 is selecting only the first sublist\n    \n    # print(class(cast))\n    # clean cast \n    trimmed_cast &lt;- ctdTrim(cast)\n    decimated_cast &lt;- ctdDecimate(trimmed_cast, p = 0.5)  # binned to 0.5 m\n    \n    # convert to df\n    cast_df &lt;- as.data.frame(decimated_cast@data)\n    \n    # Add metadata\n    # assumes station ID and cruise ID the same for all & just uses 1st one\n    cast_df &lt;- mutate(\n      cast_df,\n      station = cast@data$station[1],\n      cruise_id = cast@data$cruise_id[1]\n    )\n  \n    # drop NA rows left by cleaning\n    cast_df &lt;- subset(cast_df, !is.na(scan))\n    \n    # Append the data to the combined dataframe\n    combined_df &lt;- rbind(combined_df, cast_df)\n  }, error = function(e){\n    print(glue(\"error in cast {cast@metadata$station[1]}\"))\n    print(e)\n  })\n}\n# Save to CSV\nfile_path &lt;- here(glue(\"data/cleaned/{cruise_id}.csv\"))\nwrite.csv(combined_df, file_path, row.names = FALSE)"
  },
  {
    "objectID": "cruise_report/cruise_reports/WS19210.html",
    "href": "cruise_report/cruise_reports/WS19210.html",
    "title": "WS19210",
    "section": "",
    "text": "WS19210\n\n\nsetup\nif (!nzchar(system.file(package = \"librarian\"))) {\n  install.packages(\"librarian\")\n}\n\nlibrarian::shelf(\n  quiet = TRUE,\n  readr, here, fs, ggplot2, glue, \"jiho/castr\", dplyr, oce, patchwork, purrr, tidyr\n)\n\n\n\n\nCode\nsource(here(\"R/cruise_load.R\"))\ncruise_df &lt;- cruise_load(params$cruise_id)\n\n\n\n\nplot depth & pressure vs time elapsed\ntryCatch({\n  plots &lt;- list()\n  \n  for (station_name in unique(cruise_df$station)) {\n    subset_df &lt;- filter(cruise_df, station == station_name)\n    plots[[station_name]] &lt;- ggplot(subset_df, aes(x = time_elapsed)) +\n      geom_point(aes(y = depth), color = \"blue\") +  # Plot depth in blue\n      geom_line(aes(y = sea_water_pressure), color = \"red\") +  # Plot sea water pressure in red\n      ggtitle(glue(\"{station_name}\")) +\n      theme(\n        axis.title.x = element_blank(),\n        axis.title.y = element_blank(),\n        axis.text.x = element_blank(),\n        axis.text.y = element_blank(),\n        axis.ticks.x = element_blank(),\n        axis.ticks.y = element_blank()\n      )  # Remove individual axis titles and text\n  }\n  \n  # drop nulls\n  plots &lt;- purrr::compact(plots)\n  \n  # Combine all plots into a grid\n  combined_plot &lt;- wrap_plots(plots) + \n    plot_layout(ncol = 4) +  # Adjust ncol to set number of columns in the grid\n    plot_annotation(\n      title = \"Depth (blue) and Pressure (red)\",\n      subtitle = \"Each panel represents a different station\",\n      caption = \"Time Elapsed (x-axis) vs Depth & Pressure (y-axis)\"\n    ) +\n    theme(\n      plot.tag = element_text(size = 12, face = \"bold\"),\n      plot.tag.position = \"topleft\",\n      axis.title.x = element_text(margin = margin(t = 10)),\n      axis.title.y = element_text(margin = margin(r = 10))\n    )\n  \n  print(combined_plot)\n}, error = function(er){\n  print(er)\n});\n\n\n&lt;error/rlang_error&gt;\nError in `geom_point()`:\n! Problem while computing aesthetics.\n Error occurred in the 1st layer.\nCaused by error:\n! object 'time_elapsed' not found\n---\nBacktrace:\n     \n  1. base::tryCatch(...)\n  2.  base (local) tryCatchList(expr, classes, parentenv, handlers)\n  3.    base (local) tryCatchOne(expr, names, parentenv, handlers[[1L]])\n  4.      base (local) doTryCatch(return(expr), name, parentenv, handler)\n  5. base::print(combined_plot)\n  6. patchwork:::print.patchwork(combined_plot)\n  7.   patchwork:::build_patchwork(plot, plot$layout$guides %||% \"auto\")\n  8.     base::lapply(x$plots, plot_table, guides = guides)\n  9.       patchwork (local) FUN(X[[i]], ...)\n 10.       patchwork:::plot_table.ggplot(X[[i]], ...)\n 11.         ggplot2::ggplotGrob(x)\n 12.           ggplot2::ggplot_gtable(ggplot_build(x))\n 13.            ggplot2:::attach_plot_env(data$plot$plot_env)\n 14.              base::options(ggplot2_plot_env = env)\n 15.           ggplot2::ggplot_build(x)\n 16.           ggplot2:::ggplot_build.ggplot(x)\n 17.             ggplot2:::by_layer(...)\n 18.               rlang::try_fetch(...)\n 19.                base::tryCatch(...)\n 20.                 base (local) tryCatchList(expr, classes, parentenv, handlers)\n 21.                   base (local) tryCatchOne(expr, names, parentenv, handlers[[1L]])\n 22.                     base (local) doTryCatch(return(expr), name, parentenv, handler)\n 23.                base::withCallingHandlers(...)\n 24.               ggplot2 (local) f(l = layers[[i]], d = data[[i]])\n 25.                 l$compute_aesthetics(d, plot)\n 26.                   ggplot2 (local) compute_aesthetics(..., self = self)\n 27.                     base::lapply(aesthetics, eval_tidy, data = data, env = env)\n 28.                       rlang (local) FUN(X[[i]], ...)\n\n\n\n\nplot across all stations\np &lt;- ggplot(cruise_df, aes(x = time, y = depth, fill = station)) +\n  geom_col() +  # This creates the bars\n  # geom_text(aes(label = station), vjust = -0.3) +  # This adds labels to each bar, adjust vjust for position\n  labs(x = \"Time\", y = \"Depth\", title = \"Depth over Time by Station\") +  # Set labels and title\n  theme_minimal()  # Use a minimal theme\nprint(p)\n\n\n\n\n\n\n\n\n\n\n\ncreate oce.ctd objects from dataframes\nctd_load &lt;- function(data, other_params = NULL) {\n  \n  # create csv into ctd object\n  test_ctd &lt;-\n    as.ctd(\n      salinity    = data$sea_water_salinity,\n      temperature = data$sea_water_temperature,\n      pressure    = data$sea_water_pressure,\n      station     = data$station\n    )\n  \n  # add additional columns to ctd object\n  if (!is.null(other_params)) {\n    for (param_name in other_params) {\n      test_ctd &lt;-\n        oceSetData(\n          object = test_ctd,\n          name   = param_name,\n          value  = data[[param_name]]\n        )\n    }\n  }\n  print(glue(\"{data$station[1]}:\\t{length(test_ctd@data$scan)} scans\"))\n\n\n  return(test_ctd)\n}\n\n# Define other parameters to add\nother_params &lt;- c(\n  \"cruise_id\", \"station\", \"time\", \"time_elapsed\", \n  \"latitude\", \"longitude\", \"sea_water_electrical_conductivity\", \n  \"CDOM\", \"dissolved_oxygen\",\"oxygen_saturation\", \"chlorophyll_concentration\", \n  \"chlorophyll_fluorescence\", \"photosynthetically_available_radiation\", \n  \"beam_attenuation\",\"beam_transmission\", \"depth\", \"sea_water_sigma_t\",\n  \"descent_rate\", \"sound_velocity\",\"altimeter\"\n)\n\n# Split data by station and create data list\nctd_FK &lt;- cruise_df %&gt;%\n  split(.$station) %&gt;%\n  map(~ ctd_load(.x, other_params = other_params)) # ~ is a lambda(x)\n\n\n10: 1805 scans\n12: 3731 scans\n16: 1501 scans\n18: 2418 scans\n2:  2813 scans\n21/LK:  4047 scans\n30: 3158 scans\n31: 1791 scans\n33: 2059 scans\n41: 2225 scans\n45: 2503 scans\n51: 1892 scans\n54: 398 scans\n55: 51 scans\n56: 1968 scans\n57: 2110 scans\n57.1:   1647 scans\n57.2:   2312 scans\n57.3:   2181 scans\n58: 1770 scans\n60: 3075 scans\n65: 1943 scans\n68: 1682 scans\n7:  2035 scans\n9:  2933 scans\n9.5:    12423 scans\nCAL1:   140 scans\nCAL2:   2061 scans\nCAL3:   2488 scans\nCAL4:   3034 scans\nCAL5:   2650 scans\nGP1:    1236 scans\nGP2:    3050 scans\nGP2SURF:    963 scans\nGP3:    1067 scans\nGP4:    3363 scans\nGP5:    3686 scans\nKW1:    2164 scans\nKW2:    2942 scans\nKW4:    3049 scans\nMR: 3888 scans\nRP1:    2483 scans\nRP2:    2632 scans\nRP3:    2575 scans\nRP4:    3347 scans\nWS: 2989 scans\n\n\n\n\nplotting scans for each cast in the first list\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # 1 is selecting only the first sublist\n  # print(i)\n  print(glue(\"=== station: {cast@metadata$station[1]}\"))\n  print(glue(\"# scans: {length(cast@data$scan)}\"))\n  plotScan(cast)\n}\n\n\n=== station: 10\n# scans: 1805\n\n\n\n\n\n\n\n\n\n=== station: 12\n# scans: 3731\n\n\n\n\n\n\n\n\n\n=== station: 16\n# scans: 1501\n\n\n\n\n\n\n\n\n\n=== station: 18\n# scans: 2418\n\n\n\n\n\n\n\n\n\n=== station: 2\n# scans: 2813\n\n\n\n\n\n\n\n\n\n=== station: 21/LK\n# scans: 4047\n\n\n\n\n\n\n\n\n\n=== station: 30\n# scans: 3158\n\n\n\n\n\n\n\n\n\n=== station: 31\n# scans: 1791\n\n\n\n\n\n\n\n\n\n=== station: 33\n# scans: 2059\n\n\n\n\n\n\n\n\n\n=== station: 41\n# scans: 2225\n\n\n\n\n\n\n\n\n\n=== station: 45\n# scans: 2503\n\n\n\n\n\n\n\n\n\n=== station: 51\n# scans: 1892\n\n\n\n\n\n\n\n\n\n=== station: 54\n# scans: 398\n\n\n\n\n\n\n\n\n\n=== station: 55\n# scans: 51\n\n\n\n\n\n\n\n\n\n=== station: 56\n# scans: 1968\n\n\n\n\n\n\n\n\n\n=== station: 57\n# scans: 2110\n\n\n\n\n\n\n\n\n\n=== station: 57.1\n# scans: 1647\n\n\n\n\n\n\n\n\n\n=== station: 57.2\n# scans: 2312\n\n\n\n\n\n\n\n\n\n=== station: 57.3\n# scans: 2181\n\n\n\n\n\n\n\n\n\n=== station: 58\n# scans: 1770\n\n\n\n\n\n\n\n\n\n=== station: 60\n# scans: 3075\n\n\n\n\n\n\n\n\n\n=== station: 65\n# scans: 1943\n\n\n\n\n\n\n\n\n\n=== station: 68\n# scans: 1682\n\n\n\n\n\n\n\n\n\n=== station: 7\n# scans: 2035\n\n\n\n\n\n\n\n\n\n=== station: 9\n# scans: 2933\n\n\n\n\n\n\n\n\n\n=== station: 9.5\n# scans: 12423\n\n\n\n\n\n\n\n\n\n=== station: CAL1\n# scans: 140\n\n\n\n\n\n\n\n\n\n=== station: CAL2\n# scans: 2061\n\n\n\n\n\n\n\n\n\n=== station: CAL3\n# scans: 2488\n\n\n\n\n\n\n\n\n\n=== station: CAL4\n# scans: 3034\n\n\n\n\n\n\n\n\n\n=== station: CAL5\n# scans: 2650\n\n\n\n\n\n\n\n\n\n=== station: GP1\n# scans: 1236\n\n\n\n\n\n\n\n\n\n=== station: GP2\n# scans: 3050\n\n\n\n\n\n\n\n\n\n=== station: GP2SURF\n# scans: 963\n\n\n\n\n\n\n\n\n\n=== station: GP3\n# scans: 1067\n\n\n\n\n\n\n\n\n\n=== station: GP4\n# scans: 3363\n\n\n\n\n\n\n\n\n\n=== station: GP5\n# scans: 3686\n\n\n\n\n\n\n\n\n\n=== station: KW1\n# scans: 2164\n\n\n\n\n\n\n\n\n\n=== station: KW2\n# scans: 2942\n\n\n\n\n\n\n\n\n\n=== station: KW4\n# scans: 3049\n\n\n\n\n\n\n\n\n\n=== station: MR\n# scans: 3888\n\n\n\n\n\n\n\n\n\n=== station: RP1\n# scans: 2483\n\n\n\n\n\n\n\n\n\n=== station: RP2\n# scans: 2632\n\n\n\n\n\n\n\n\n\n=== station: RP3\n# scans: 2575\n\n\n\n\n\n\n\n\n\n=== station: RP4\n# scans: 3347\n\n\n\n\n\n\n\n\n\n=== station: WS\n# scans: 2989\n\n\n\n\n\n\n\n\n\n\n\nplotting each cast in the first list\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # 1 is selecting only the first sublist\n  tryCatch({\n    plot(ctdDecimate(ctdTrim(cast)))\n  }, error = function(e){\n    print(e)\n  })\n}\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1805' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3731' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1501' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2418' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2813' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4047' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3158' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1791' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2059' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2225' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2503' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1892' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 398' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 51' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1968' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2110' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1647' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2312' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2181' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1770' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3075' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1682' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2035' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2933' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 12423' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 140' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2061' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2488' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3034' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2650' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1236' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3050' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 963' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1067' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3363' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3686' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2164' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2942' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3049' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3888' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2483' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2632' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2575' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3347' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2989' in coercion to 'logical(1)'&gt;\n\n\n\n\nplotting other physical parameters for each cast\n# Loop through each CTD cast\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # Assuming each sublist contains only one relevant CTD object\n  tryCatch({\n    # Extract metadata for station name and cruise ID\n    station_name &lt;- cast@metadata$station[1]\n    cruise_id &lt;- cast@data$cruise_id[1]\n\n    # Generate a title with station name and cruise ID\n    overall_title &lt;- glue::glue(\"Station: {station_name}, Cruise ID: {cruise_id}\")\n\n    # Set margins: increase the outer margin for the title\n    par(oma = c(0, 0, 3, 0))  # Top outer margin increased for title\n\n    # Plotting function with specific parameters\n    oce::plot(\n      x = ctdDecimate(ctdTrim(cast)),\n      which = c(\n        \"sea_water_electrical_conductivity\",\n        \"descent_rate\", \"sound_velocity\",\n        \"sea_water_sigma_t\",\"altimeter\"\n      ),\n      main = \"\"  # No main title for individual subplots\n    )\n\n    # Place a single overall title at the top of the plot frame\n    mtext(overall_title, side = 3, line = 1, outer = TRUE, cex = 1.5)\n\n    # Reset outer margins to default\n    par(oma = c(0, 0, 0, 0))\n\n  }, error = function(e) {\n    print(e$message)  # Print any errors that occur during plotting\n  })\n}\n\n\n\n\n\n\n\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n\n\nplotting other nutrient parameters for each cast\n# Loop through each CTD cast\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # Assuming each sublist contains only one relevant CTD object\n  tryCatch({\n    # Extract metadata for station name and cruise ID\n    station_name &lt;- cast@metadata$station[1]\n    cruise_id &lt;- cast@data$cruise_id[1]\n\n    # Generate a title with station name and cruise ID\n    overall_title &lt;- glue::glue(\"Station: {station_name}, Cruise ID: {cruise_id}\")\n\n    # Set margins: increase the outer margin for the title\n    par(oma = c(0, 0, 3, 0))  # Top outer margin increased for title\n\n    # Plotting function with specific parameters\n    oce::plot(\n      x = ctdDecimate(ctdTrim(cast)),\n      which = c(\n        \"CDOM\", \"dissolved_oxygen\",\n        \"oxygen_saturation\",\n        \"chlorophyll_concentration\", \"chlorophyll_fluorescence\"\n      ),\n      main = \"\"  # No main title for individual subplots\n    )\n\n    # Place a single overall title at the top of the plot frame\n    mtext(overall_title, side = 3, line = 1, outer = TRUE, cex = 1.5)\n\n    # Reset outer margins to default\n    par(oma = c(0, 0, 0, 0))\n\n  }, error = function(e) {\n    print(e$message)  # Print any errors that occur during plotting\n  })\n}\n\n\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"plot.new has not been called yet\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n\n\n\n\nplotting other optical parameters for each cast\n# Loop through each CTD cast\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # Assuming each sublist contains only one relevant CTD object\n  tryCatch({\n    # Extract metadata for station name and cruise ID\n    station_name &lt;- cast@metadata$station[1]\n    cruise_id &lt;- cast@data$cruise_id[1]\n\n    # Generate a title with station name and cruise ID\n    overall_title &lt;- glue::glue(\"Station: {station_name}, Cruise ID: {cruise_id}\")\n\n    # Set margins: increase the outer margin for the title\n    par(oma = c(0, 0, 3, 0))  # Top outer margin increased for title\n\n    # Plotting function with specific parameters\n    oce::plot(\n      x = ctdDecimate(ctdTrim(cast)),\n      which = c(\n        \"photosynthetically_available_radiation\",\n        \"beam_attenuation\",\"beam_transmission\"\n      ),\n      main = \"\"  # No main title for individual subplots\n    )\n\n    # Place a single overall title at the top of the plot frame\n    mtext(overall_title, side = 3, line = 1, outer = TRUE, cex = 1.5)\n\n    # Reset outer margins to default\n    par(oma = c(0, 0, 0, 0))\n\n  }, error = function(e) {\n    print(e$message)  # Print any errors that occur during plotting\n  })\n}\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nloop through every cast, clean, & save\ncombined_df &lt;- data.frame()\nfor (i in seq(ctd_FK)){\n  tryCatch({\n    cast &lt;- ctd_FK[[i]]  # 1 is selecting only the first sublist\n    \n    # print(class(cast))\n    # clean cast \n    trimmed_cast &lt;- ctdTrim(cast)\n    decimated_cast &lt;- ctdDecimate(trimmed_cast, p = 0.5)  # binned to 0.5 m\n    \n    # convert to df\n    cast_df &lt;- as.data.frame(decimated_cast@data)\n    \n    # Add metadata\n    # assumes station ID and cruise ID the same for all & just uses 1st one\n    cast_df &lt;- mutate(\n      cast_df,\n      station = cast@data$station[1],\n      cruise_id = cast@data$cruise_id[1]\n    )\n  \n    # drop NA rows left by cleaning\n    cast_df &lt;- subset(cast_df, !is.na(scan))\n    \n    # Append the data to the combined dataframe\n    combined_df &lt;- rbind(combined_df, cast_df)\n  }, error = function(e){\n    print(glue(\"error in cast {cast@metadata$station[1]}\"))\n    print(e)\n  })\n}\n# Save to CSV\nfile_path &lt;- here(glue(\"data/cleaned/{cruise_id}.csv\"))\nwrite.csv(combined_df, file_path, row.names = FALSE)"
  },
  {
    "objectID": "cruise_report/cruise_reports/WS19322.html",
    "href": "cruise_report/cruise_reports/WS19322.html",
    "title": "WS19322",
    "section": "",
    "text": "WS19322\n\n\nsetup\nif (!nzchar(system.file(package = \"librarian\"))) {\n  install.packages(\"librarian\")\n}\n\nlibrarian::shelf(\n  quiet = TRUE,\n  readr, here, fs, ggplot2, glue, \"jiho/castr\", dplyr, oce, patchwork, purrr, tidyr\n)\n\n\n\n\nCode\nsource(here(\"R/cruise_load.R\"))\ncruise_df &lt;- cruise_load(params$cruise_id)\n\n\n\n\nplot depth & pressure vs time elapsed\ntryCatch({\n  plots &lt;- list()\n  \n  for (station_name in unique(cruise_df$station)) {\n    subset_df &lt;- filter(cruise_df, station == station_name)\n    plots[[station_name]] &lt;- ggplot(subset_df, aes(x = time_elapsed)) +\n      geom_point(aes(y = depth), color = \"blue\") +  # Plot depth in blue\n      geom_line(aes(y = sea_water_pressure), color = \"red\") +  # Plot sea water pressure in red\n      ggtitle(glue(\"{station_name}\")) +\n      theme(\n        axis.title.x = element_blank(),\n        axis.title.y = element_blank(),\n        axis.text.x = element_blank(),\n        axis.text.y = element_blank(),\n        axis.ticks.x = element_blank(),\n        axis.ticks.y = element_blank()\n      )  # Remove individual axis titles and text\n  }\n  \n  # drop nulls\n  plots &lt;- purrr::compact(plots)\n  \n  # Combine all plots into a grid\n  combined_plot &lt;- wrap_plots(plots) + \n    plot_layout(ncol = 4) +  # Adjust ncol to set number of columns in the grid\n    plot_annotation(\n      title = \"Depth (blue) and Pressure (red)\",\n      subtitle = \"Each panel represents a different station\",\n      caption = \"Time Elapsed (x-axis) vs Depth & Pressure (y-axis)\"\n    ) +\n    theme(\n      plot.tag = element_text(size = 12, face = \"bold\"),\n      plot.tag.position = \"topleft\",\n      axis.title.x = element_text(margin = margin(t = 10)),\n      axis.title.y = element_text(margin = margin(r = 10))\n    )\n  \n  print(combined_plot)\n}, error = function(er){\n  print(er)\n});\n\n\n&lt;error/rlang_error&gt;\nError in `geom_point()`:\n! Problem while computing aesthetics.\n Error occurred in the 1st layer.\nCaused by error:\n! object 'time_elapsed' not found\n---\nBacktrace:\n     \n  1. base::tryCatch(...)\n  2.  base (local) tryCatchList(expr, classes, parentenv, handlers)\n  3.    base (local) tryCatchOne(expr, names, parentenv, handlers[[1L]])\n  4.      base (local) doTryCatch(return(expr), name, parentenv, handler)\n  5. base::print(combined_plot)\n  6. patchwork:::print.patchwork(combined_plot)\n  7.   patchwork:::build_patchwork(plot, plot$layout$guides %||% \"auto\")\n  8.     base::lapply(x$plots, plot_table, guides = guides)\n  9.       patchwork (local) FUN(X[[i]], ...)\n 10.       patchwork:::plot_table.ggplot(X[[i]], ...)\n 11.         ggplot2::ggplotGrob(x)\n 12.           ggplot2::ggplot_gtable(ggplot_build(x))\n 13.            ggplot2:::attach_plot_env(data$plot$plot_env)\n 14.              base::options(ggplot2_plot_env = env)\n 15.           ggplot2::ggplot_build(x)\n 16.           ggplot2:::ggplot_build.ggplot(x)\n 17.             ggplot2:::by_layer(...)\n 18.               rlang::try_fetch(...)\n 19.                base::tryCatch(...)\n 20.                 base (local) tryCatchList(expr, classes, parentenv, handlers)\n 21.                   base (local) tryCatchOne(expr, names, parentenv, handlers[[1L]])\n 22.                     base (local) doTryCatch(return(expr), name, parentenv, handler)\n 23.                base::withCallingHandlers(...)\n 24.               ggplot2 (local) f(l = layers[[i]], d = data[[i]])\n 25.                 l$compute_aesthetics(d, plot)\n 26.                   ggplot2 (local) compute_aesthetics(..., self = self)\n 27.                     base::lapply(aesthetics, eval_tidy, data = data, env = env)\n 28.                       rlang (local) FUN(X[[i]], ...)\n\n\n\n\nplot across all stations\np &lt;- ggplot(cruise_df, aes(x = time, y = depth, fill = station)) +\n  geom_col() +  # This creates the bars\n  # geom_text(aes(label = station), vjust = -0.3) +  # This adds labels to each bar, adjust vjust for position\n  labs(x = \"Time\", y = \"Depth\", title = \"Depth over Time by Station\") +  # Set labels and title\n  theme_minimal()  # Use a minimal theme\nprint(p)\n\n\n\n\n\n\n\n\n\n\n\ncreate oce.ctd objects from dataframes\nctd_load &lt;- function(data, other_params = NULL) {\n  \n  # create csv into ctd object\n  test_ctd &lt;-\n    as.ctd(\n      salinity    = data$sea_water_salinity,\n      temperature = data$sea_water_temperature,\n      pressure    = data$sea_water_pressure,\n      station     = data$station\n    )\n  \n  # add additional columns to ctd object\n  if (!is.null(other_params)) {\n    for (param_name in other_params) {\n      test_ctd &lt;-\n        oceSetData(\n          object = test_ctd,\n          name   = param_name,\n          value  = data[[param_name]]\n        )\n    }\n  }\n  print(glue(\"{data$station[1]}:\\t{length(test_ctd@data$scan)} scans\"))\n\n\n  return(test_ctd)\n}\n\n# Define other parameters to add\nother_params &lt;- c(\n  \"cruise_id\", \"station\", \"time\", \"time_elapsed\", \n  \"latitude\", \"longitude\", \"sea_water_electrical_conductivity\", \n  \"CDOM\", \"dissolved_oxygen\",\"oxygen_saturation\", \"chlorophyll_concentration\", \n  \"chlorophyll_fluorescence\", \"photosynthetically_available_radiation\", \n  \"beam_attenuation\",\"beam_transmission\", \"depth\", \"sea_water_sigma_t\",\n  \"descent_rate\", \"sound_velocity\",\"altimeter\"\n)\n\n# Split data by station and create data list\nctd_FK &lt;- cruise_df %&gt;%\n  split(.$station) %&gt;%\n  map(~ ctd_load(.x, other_params = other_params)) # ~ is a lambda(x)\n\n\n10: 1405 scans\n12: 3553 scans\n16: 1311 scans\n18: 2238 scans\n2:  3900 scans\n21/LK:  3791 scans\n30: 2927 scans\n31: 2638 scans\n33: 2155 scans\n41: 1665 scans\n45: 2277 scans\n51: 1948 scans\n54: 1712 scans\n55: 239 scans\n56: 1787 scans\n57: 1502 scans\n57.1:   2037 scans\n57.2:   2156 scans\n57.3:   2833 scans\n58: 1933 scans\n60: 2207 scans\n64: 133 scans\n65: 12 scans\n68: 1143 scans\n7:  2791 scans\n9:  3952 scans\n9.5:    8943 scans\nBG2:    2437 scans\nBG3:    2595 scans\nBG4:    2171 scans\nCAL1:   17 scans\nCAL2:   2569 scans\nCAL3:   2641 scans\nCAL4:   3370 scans\nCAL5:   3236 scans\nCAL6:   3869 scans\nCAL7:   3120 scans\nCAL8:   2292 scans\nCW1:    1854 scans\nCW2:    2128 scans\nCW3:    2503 scans\nCW4:    2590 scans\nCW5:    3368 scans\nCW6:    3585 scans\nGP5:    7967 scans\nKW1:    2572 scans\nKW2:    3013 scans\nKW4:    2907 scans\nMR: 3729 scans\nRP1:    2345 scans\nRP2:    2029 scans\nRP3:    2557 scans\nRP4:    2934 scans\nTB1:    2458 scans\nTB10:   3341 scans\nTB2:    2213 scans\nTB3:    3032 scans\nTB4:    5107 scans\nTB5:    3508 scans\nTB6:    1406 scans\nTB7:    1637 scans\nTB8:    2054 scans\nTB9:    2165 scans\nV1: 2365 scans\nV2: 2600 scans\nV3: 3419 scans\nV4: 3011 scans\nV5: 3719 scans\nV6: 3405 scans\nV7: 3203 scans\nV8: 4298 scans\nV9: 4854 scans\nWS: 4654 scans\n\n\n\n\nplotting scans for each cast in the first list\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # 1 is selecting only the first sublist\n  # print(i)\n  print(glue(\"=== station: {cast@metadata$station[1]}\"))\n  print(glue(\"# scans: {length(cast@data$scan)}\"))\n  plotScan(cast)\n}\n\n\n=== station: 10\n# scans: 1405\n\n\n\n\n\n\n\n\n\n=== station: 12\n# scans: 3553\n\n\n\n\n\n\n\n\n\n=== station: 16\n# scans: 1311\n\n\n\n\n\n\n\n\n\n=== station: 18\n# scans: 2238\n\n\n\n\n\n\n\n\n\n=== station: 2\n# scans: 3900\n\n\n\n\n\n\n\n\n\n=== station: 21/LK\n# scans: 3791\n\n\n\n\n\n\n\n\n\n=== station: 30\n# scans: 2927\n\n\n\n\n\n\n\n\n\n=== station: 31\n# scans: 2638\n\n\n\n\n\n\n\n\n\n=== station: 33\n# scans: 2155\n\n\n\n\n\n\n\n\n\n=== station: 41\n# scans: 1665\n\n\n\n\n\n\n\n\n\n=== station: 45\n# scans: 2277\n\n\n\n\n\n\n\n\n\n=== station: 51\n# scans: 1948\n\n\n\n\n\n\n\n\n\n=== station: 54\n# scans: 1712\n\n\n\n\n\n\n\n\n\n=== station: 55\n# scans: 239\n\n\n\n\n\n\n\n\n\n=== station: 56\n# scans: 1787\n\n\n\n\n\n\n\n\n\n=== station: 57\n# scans: 1502\n\n\n\n\n\n\n\n\n\n=== station: 57.1\n# scans: 2037\n\n\n\n\n\n\n\n\n\n=== station: 57.2\n# scans: 2156\n\n\n\n\n\n\n\n\n\n=== station: 57.3\n# scans: 2833\n\n\n\n\n\n\n\n\n\n=== station: 58\n# scans: 1933\n\n\n\n\n\n\n\n\n\n=== station: 60\n# scans: 2207\n\n\n\n\n\n\n\n\n\n=== station: 64\n# scans: 133\n\n\n\n\n\n\n\n\n\n=== station: 65\n# scans: 12\n\n\n\n\n\n\n\n\n\n=== station: 68\n# scans: 1143\n\n\n\n\n\n\n\n\n\n=== station: 7\n# scans: 2791\n\n\n\n\n\n\n\n\n\n=== station: 9\n# scans: 3952\n\n\n\n\n\n\n\n\n\n=== station: 9.5\n# scans: 8943\n\n\n\n\n\n\n\n\n\n=== station: BG2\n# scans: 2437\n\n\n\n\n\n\n\n\n\n=== station: BG3\n# scans: 2595\n\n\n\n\n\n\n\n\n\n=== station: BG4\n# scans: 2171\n\n\n\n\n\n\n\n\n\n=== station: CAL1\n# scans: 17\n\n\n\n\n\n\n\n\n\n=== station: CAL2\n# scans: 2569\n\n\n\n\n\n\n\n\n\n=== station: CAL3\n# scans: 2641\n\n\n\n\n\n\n\n\n\n=== station: CAL4\n# scans: 3370\n\n\n\n\n\n\n\n\n\n=== station: CAL5\n# scans: 3236\n\n\n\n\n\n\n\n\n\n=== station: CAL6\n# scans: 3869\n\n\n\n\n\n\n\n\n\n=== station: CAL7\n# scans: 3120\n\n\n\n\n\n\n\n\n\n=== station: CAL8\n# scans: 2292\n\n\n\n\n\n\n\n\n\n=== station: CW1\n# scans: 1854\n\n\n\n\n\n\n\n\n\n=== station: CW2\n# scans: 2128\n\n\n\n\n\n\n\n\n\n=== station: CW3\n# scans: 2503\n\n\n\n\n\n\n\n\n\n=== station: CW4\n# scans: 2590\n\n\n\n\n\n\n\n\n\n=== station: CW5\n# scans: 3368\n\n\n\n\n\n\n\n\n\n=== station: CW6\n# scans: 3585\n\n\n\n\n\n\n\n\n\n=== station: GP5\n# scans: 7967\n\n\n\n\n\n\n\n\n\n=== station: KW1\n# scans: 2572\n\n\n\n\n\n\n\n\n\n=== station: KW2\n# scans: 3013\n\n\n\n\n\n\n\n\n\n=== station: KW4\n# scans: 2907\n\n\n\n\n\n\n\n\n\n=== station: MR\n# scans: 3729\n\n\n\n\n\n\n\n\n\n=== station: RP1\n# scans: 2345\n\n\n\n\n\n\n\n\n\n=== station: RP2\n# scans: 2029\n\n\n\n\n\n\n\n\n\n=== station: RP3\n# scans: 2557\n\n\n\n\n\n\n\n\n\n=== station: RP4\n# scans: 2934\n\n\n\n\n\n\n\n\n\n=== station: TB1\n# scans: 2458\n\n\n\n\n\n\n\n\n\n=== station: TB10\n# scans: 3341\n\n\n\n\n\n\n\n\n\n=== station: TB2\n# scans: 2213\n\n\n\n\n\n\n\n\n\n=== station: TB3\n# scans: 3032\n\n\n\n\n\n\n\n\n\n=== station: TB4\n# scans: 5107\n\n\n\n\n\n\n\n\n\n=== station: TB5\n# scans: 3508\n\n\n\n\n\n\n\n\n\n=== station: TB6\n# scans: 1406\n\n\n\n\n\n\n\n\n\n=== station: TB7\n# scans: 1637\n\n\n\n\n\n\n\n\n\n=== station: TB8\n# scans: 2054\n\n\n\n\n\n\n\n\n\n=== station: TB9\n# scans: 2165\n\n\n\n\n\n\n\n\n\n=== station: V1\n# scans: 2365\n\n\n\n\n\n\n\n\n\n=== station: V2\n# scans: 2600\n\n\n\n\n\n\n\n\n\n=== station: V3\n# scans: 3419\n\n\n\n\n\n\n\n\n\n=== station: V4\n# scans: 3011\n\n\n\n\n\n\n\n\n\n=== station: V5\n# scans: 3719\n\n\n\n\n\n\n\n\n\n=== station: V6\n# scans: 3405\n\n\n\n\n\n\n\n\n\n=== station: V7\n# scans: 3203\n\n\n\n\n\n\n\n\n\n=== station: V8\n# scans: 4298\n\n\n\n\n\n\n\n\n\n=== station: V9\n# scans: 4854\n\n\n\n\n\n\n\n\n\n=== station: WS\n# scans: 4654\n\n\n\n\n\n\n\n\n\n\n\nplotting each cast in the first list\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # 1 is selecting only the first sublist\n  tryCatch({\n    plot(ctdDecimate(ctdTrim(cast)))\n  }, error = function(e){\n    print(e)\n  })\n}\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1405' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3553' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1311' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2238' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3900' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3791' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2927' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2638' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2155' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1665' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2277' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1948' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1712' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1787' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1502' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2037' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2156' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2833' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1933' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2207' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1143' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2791' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3952' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 8943' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2437' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2595' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2171' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2569' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2641' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3370' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3236' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3869' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3120' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2292' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1854' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2128' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2503' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2590' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3368' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3585' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 7967' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2572' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3013' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2907' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3729' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2345' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2029' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2557' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2934' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2458' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3341' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2213' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3032' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 5107' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3508' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1406' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1637' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2054' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2165' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2365' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2600' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3419' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3011' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3719' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3405' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3203' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4298' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4854' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4654' in coercion to 'logical(1)'&gt;\n\n\n\n\nplotting other physical parameters for each cast\n# Loop through each CTD cast\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # Assuming each sublist contains only one relevant CTD object\n  tryCatch({\n    # Extract metadata for station name and cruise ID\n    station_name &lt;- cast@metadata$station[1]\n    cruise_id &lt;- cast@data$cruise_id[1]\n\n    # Generate a title with station name and cruise ID\n    overall_title &lt;- glue::glue(\"Station: {station_name}, Cruise ID: {cruise_id}\")\n\n    # Set margins: increase the outer margin for the title\n    par(oma = c(0, 0, 3, 0))  # Top outer margin increased for title\n\n    # Plotting function with specific parameters\n    oce::plot(\n      x = ctdDecimate(ctdTrim(cast)),\n      which = c(\n        \"sea_water_electrical_conductivity\",\n        \"descent_rate\", \"sound_velocity\",\n        \"sea_water_sigma_t\",\"altimeter\"\n      ),\n      main = \"\"  # No main title for individual subplots\n    )\n\n    # Place a single overall title at the top of the plot frame\n    mtext(overall_title, side = 3, line = 1, outer = TRUE, cex = 1.5)\n\n    # Reset outer margins to default\n    par(oma = c(0, 0, 0, 0))\n\n  }, error = function(e) {\n    print(e$message)  # Print any errors that occur during plotting\n  })\n}\n\n\n\n\n\n\n\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n\n\nplotting other nutrient parameters for each cast\n# Loop through each CTD cast\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # Assuming each sublist contains only one relevant CTD object\n  tryCatch({\n    # Extract metadata for station name and cruise ID\n    station_name &lt;- cast@metadata$station[1]\n    cruise_id &lt;- cast@data$cruise_id[1]\n\n    # Generate a title with station name and cruise ID\n    overall_title &lt;- glue::glue(\"Station: {station_name}, Cruise ID: {cruise_id}\")\n\n    # Set margins: increase the outer margin for the title\n    par(oma = c(0, 0, 3, 0))  # Top outer margin increased for title\n\n    # Plotting function with specific parameters\n    oce::plot(\n      x = ctdDecimate(ctdTrim(cast)),\n      which = c(\n        \"CDOM\", \"dissolved_oxygen\",\n        \"oxygen_saturation\",\n        \"chlorophyll_concentration\", \"chlorophyll_fluorescence\"\n      ),\n      main = \"\"  # No main title for individual subplots\n    )\n\n    # Place a single overall title at the top of the plot frame\n    mtext(overall_title, side = 3, line = 1, outer = TRUE, cex = 1.5)\n\n    # Reset outer margins to default\n    par(oma = c(0, 0, 0, 0))\n\n  }, error = function(e) {\n    print(e$message)  # Print any errors that occur during plotting\n  })\n}\n\n\n\n\n\n\n\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n\n\n\n\nplotting other optical parameters for each cast\n# Loop through each CTD cast\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # Assuming each sublist contains only one relevant CTD object\n  tryCatch({\n    # Extract metadata for station name and cruise ID\n    station_name &lt;- cast@metadata$station[1]\n    cruise_id &lt;- cast@data$cruise_id[1]\n\n    # Generate a title with station name and cruise ID\n    overall_title &lt;- glue::glue(\"Station: {station_name}, Cruise ID: {cruise_id}\")\n\n    # Set margins: increase the outer margin for the title\n    par(oma = c(0, 0, 3, 0))  # Top outer margin increased for title\n\n    # Plotting function with specific parameters\n    oce::plot(\n      x = ctdDecimate(ctdTrim(cast)),\n      which = c(\n        \"photosynthetically_available_radiation\",\n        \"beam_attenuation\",\"beam_transmission\"\n      ),\n      main = \"\"  # No main title for individual subplots\n    )\n\n    # Place a single overall title at the top of the plot frame\n    mtext(overall_title, side = 3, line = 1, outer = TRUE, cex = 1.5)\n\n    # Reset outer margins to default\n    par(oma = c(0, 0, 0, 0))\n\n  }, error = function(e) {\n    print(e$message)  # Print any errors that occur during plotting\n  })\n}\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n\n\nloop through every cast, clean, & save\ncombined_df &lt;- data.frame()\nfor (i in seq(ctd_FK)){\n  tryCatch({\n    cast &lt;- ctd_FK[[i]]  # 1 is selecting only the first sublist\n    \n    # print(class(cast))\n    # clean cast \n    trimmed_cast &lt;- ctdTrim(cast)\n    decimated_cast &lt;- ctdDecimate(trimmed_cast, p = 0.5)  # binned to 0.5 m\n    \n    # convert to df\n    cast_df &lt;- as.data.frame(decimated_cast@data)\n    \n    # Add metadata\n    # assumes station ID and cruise ID the same for all & just uses 1st one\n    cast_df &lt;- mutate(\n      cast_df,\n      station = cast@data$station[1],\n      cruise_id = cast@data$cruise_id[1]\n    )\n  \n    # drop NA rows left by cleaning\n    cast_df &lt;- subset(cast_df, !is.na(scan))\n    \n    # Append the data to the combined dataframe\n    combined_df &lt;- rbind(combined_df, cast_df)\n  }, error = function(e){\n    print(glue(\"error in cast {cast@metadata$station[1]}\"))\n    print(e)\n  })\n}\n# Save to CSV\nfile_path &lt;- here(glue(\"data/cleaned/{cruise_id}.csv\"))\nwrite.csv(combined_df, file_path, row.names = FALSE)"
  },
  {
    "objectID": "cruise_report/cruise_reports/WS20231.html",
    "href": "cruise_report/cruise_reports/WS20231.html",
    "title": "WS20231",
    "section": "",
    "text": "WS20231\n\n\nsetup\nif (!nzchar(system.file(package = \"librarian\"))) {\n  install.packages(\"librarian\")\n}\n\nlibrarian::shelf(\n  quiet = TRUE,\n  readr, here, fs, ggplot2, glue, \"jiho/castr\", dplyr, oce, patchwork, purrr, tidyr\n)\n\n\n\n\nCode\nsource(here(\"R/cruise_load.R\"))\ncruise_df &lt;- cruise_load(params$cruise_id)\n\n\n\n\nplot depth & pressure vs time elapsed\ntryCatch({\n  plots &lt;- list()\n  \n  for (station_name in unique(cruise_df$station)) {\n    subset_df &lt;- filter(cruise_df, station == station_name)\n    plots[[station_name]] &lt;- ggplot(subset_df, aes(x = time_elapsed)) +\n      geom_point(aes(y = depth), color = \"blue\") +  # Plot depth in blue\n      geom_line(aes(y = sea_water_pressure), color = \"red\") +  # Plot sea water pressure in red\n      ggtitle(glue(\"{station_name}\")) +\n      theme(\n        axis.title.x = element_blank(),\n        axis.title.y = element_blank(),\n        axis.text.x = element_blank(),\n        axis.text.y = element_blank(),\n        axis.ticks.x = element_blank(),\n        axis.ticks.y = element_blank()\n      )  # Remove individual axis titles and text\n  }\n  \n  # drop nulls\n  plots &lt;- purrr::compact(plots)\n  \n  # Combine all plots into a grid\n  combined_plot &lt;- wrap_plots(plots) + \n    plot_layout(ncol = 4) +  # Adjust ncol to set number of columns in the grid\n    plot_annotation(\n      title = \"Depth (blue) and Pressure (red)\",\n      subtitle = \"Each panel represents a different station\",\n      caption = \"Time Elapsed (x-axis) vs Depth & Pressure (y-axis)\"\n    ) +\n    theme(\n      plot.tag = element_text(size = 12, face = \"bold\"),\n      plot.tag.position = \"topleft\",\n      axis.title.x = element_text(margin = margin(t = 10)),\n      axis.title.y = element_text(margin = margin(r = 10))\n    )\n  \n  print(combined_plot)\n}, error = function(er){\n  print(er)\n});\n\n\n&lt;error/rlang_error&gt;\nError in `geom_point()`:\n! Problem while computing aesthetics.\n Error occurred in the 1st layer.\nCaused by error:\n! object 'time_elapsed' not found\n---\nBacktrace:\n     \n  1. base::tryCatch(...)\n  2.  base (local) tryCatchList(expr, classes, parentenv, handlers)\n  3.    base (local) tryCatchOne(expr, names, parentenv, handlers[[1L]])\n  4.      base (local) doTryCatch(return(expr), name, parentenv, handler)\n  5. base::print(combined_plot)\n  6. patchwork:::print.patchwork(combined_plot)\n  7.   patchwork:::build_patchwork(plot, plot$layout$guides %||% \"auto\")\n  8.     base::lapply(x$plots, plot_table, guides = guides)\n  9.       patchwork (local) FUN(X[[i]], ...)\n 10.       patchwork:::plot_table.ggplot(X[[i]], ...)\n 11.         ggplot2::ggplotGrob(x)\n 12.           ggplot2::ggplot_gtable(ggplot_build(x))\n 13.            ggplot2:::attach_plot_env(data$plot$plot_env)\n 14.              base::options(ggplot2_plot_env = env)\n 15.           ggplot2::ggplot_build(x)\n 16.           ggplot2:::ggplot_build.ggplot(x)\n 17.             ggplot2:::by_layer(...)\n 18.               rlang::try_fetch(...)\n 19.                base::tryCatch(...)\n 20.                 base (local) tryCatchList(expr, classes, parentenv, handlers)\n 21.                   base (local) tryCatchOne(expr, names, parentenv, handlers[[1L]])\n 22.                     base (local) doTryCatch(return(expr), name, parentenv, handler)\n 23.                base::withCallingHandlers(...)\n 24.               ggplot2 (local) f(l = layers[[i]], d = data[[i]])\n 25.                 l$compute_aesthetics(d, plot)\n 26.                   ggplot2 (local) compute_aesthetics(..., self = self)\n 27.                     base::lapply(aesthetics, eval_tidy, data = data, env = env)\n 28.                       rlang (local) FUN(X[[i]], ...)\n\n\n\n\nplot across all stations\np &lt;- ggplot(cruise_df, aes(x = time, y = depth, fill = station)) +\n  geom_col() +  # This creates the bars\n  # geom_text(aes(label = station), vjust = -0.3) +  # This adds labels to each bar, adjust vjust for position\n  labs(x = \"Time\", y = \"Depth\", title = \"Depth over Time by Station\") +  # Set labels and title\n  theme_minimal()  # Use a minimal theme\nprint(p)\n\n\n\n\n\n\n\n\n\n\n\ncreate oce.ctd objects from dataframes\nctd_load &lt;- function(data, other_params = NULL) {\n  \n  # create csv into ctd object\n  test_ctd &lt;-\n    as.ctd(\n      salinity    = data$sea_water_salinity,\n      temperature = data$sea_water_temperature,\n      pressure    = data$sea_water_pressure,\n      station     = data$station\n    )\n  \n  # add additional columns to ctd object\n  if (!is.null(other_params)) {\n    for (param_name in other_params) {\n      test_ctd &lt;-\n        oceSetData(\n          object = test_ctd,\n          name   = param_name,\n          value  = data[[param_name]]\n        )\n    }\n  }\n  print(glue(\"{data$station[1]}:\\t{length(test_ctd@data$scan)} scans\"))\n\n\n  return(test_ctd)\n}\n\n# Define other parameters to add\nother_params &lt;- c(\n  \"cruise_id\", \"station\", \"time\", \"time_elapsed\", \n  \"latitude\", \"longitude\", \"sea_water_electrical_conductivity\", \n  \"CDOM\", \"dissolved_oxygen\",\"oxygen_saturation\", \"chlorophyll_concentration\", \n  \"chlorophyll_fluorescence\", \"photosynthetically_available_radiation\", \n  \"beam_attenuation\",\"beam_transmission\", \"depth\", \"sea_water_sigma_t\",\n  \"descent_rate\", \"sound_velocity\",\"altimeter\"\n)\n\n# Split data by station and create data list\nctd_FK &lt;- cruise_df %&gt;%\n  split(.$station) %&gt;%\n  map(~ ctd_load(.x, other_params = other_params)) # ~ is a lambda(x)\n\n\n1:  4965 scans\n10: 4539 scans\n12: 5920 scans\n16: 3236 scans\n18: 3563 scans\n2:  1931 scans\n21/LK:  4504 scans\n22: 4141 scans\n24: 3523 scans\n3:  7923 scans\n30: 3066 scans\n31: 1955 scans\n33: 2692 scans\n41: 8 scans\n45: 2830 scans\n49: 1199 scans\n51: 2110 scans\n54: 671 scans\n55: 1670 scans\n56: 35 scans\n57: 1180 scans\n57.1:   4250 scans\n60: 3570 scans\n63: 2418 scans\n68: 85 scans\n7:  37 scans\n9:  5358 scans\n9.5:    7848 scans\nBG2:    2867 scans\nBG3:    2628 scans\nBG4:    3335 scans\nCAL1:   3465 scans\nCAL2:   3453 scans\nCAL3:   2624 scans\nCAL4:   3273 scans\nCAL5:   5117 scans\nCAL6:   4408 scans\nEB1:    4068 scans\nEB2:    2246 scans\nGP1.5:  2179 scans\nGP5:    5412 scans\nKW1:    3986 scans\nKW2:    2918 scans\nKW4:    2844 scans\nMR: 5168 scans\nRP1:    2601 scans\nRP2:    1942 scans\nRP3:    2280 scans\nRP4:    4115 scans\nWS: 4301 scans\n\n\n\n\nplotting scans for each cast in the first list\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # 1 is selecting only the first sublist\n  # print(i)\n  print(glue(\"=== station: {cast@metadata$station[1]}\"))\n  print(glue(\"# scans: {length(cast@data$scan)}\"))\n  plotScan(cast)\n}\n\n\n=== station: 1\n# scans: 4965\n\n\n\n\n\n\n\n\n\n=== station: 10\n# scans: 4539\n\n\n\n\n\n\n\n\n\n=== station: 12\n# scans: 5920\n\n\n\n\n\n\n\n\n\n=== station: 16\n# scans: 3236\n\n\n\n\n\n\n\n\n\n=== station: 18\n# scans: 3563\n\n\n\n\n\n\n\n\n\n=== station: 2\n# scans: 1931\n\n\n\n\n\n\n\n\n\n=== station: 21/LK\n# scans: 4504\n\n\n\n\n\n\n\n\n\n=== station: 22\n# scans: 4141\n\n\n\n\n\n\n\n\n\n=== station: 24\n# scans: 3523\n\n\n\n\n\n\n\n\n\n=== station: 3\n# scans: 7923\n\n\n\n\n\n\n\n\n\n=== station: 30\n# scans: 3066\n\n\n\n\n\n\n\n\n\n=== station: 31\n# scans: 1955\n\n\n\n\n\n\n\n\n\n=== station: 33\n# scans: 2692\n\n\n\n\n\n\n\n\n\n=== station: 41\n# scans: 8\n\n\n\n\n\n\n\n\n\n=== station: 45\n# scans: 2830\n\n\n\n\n\n\n\n\n\n=== station: 49\n# scans: 1199\n\n\n\n\n\n\n\n\n\n=== station: 51\n# scans: 2110\n\n\n\n\n\n\n\n\n\n=== station: 54\n# scans: 671\n\n\n\n\n\n\n\n\n\n=== station: 55\n# scans: 1670\n\n\n\n\n\n\n\n\n\n=== station: 56\n# scans: 35\n\n\n\n\n\n\n\n\n\n=== station: 57\n# scans: 1180\n\n\n\n\n\n\n\n\n\n=== station: 57.1\n# scans: 4250\n\n\n\n\n\n\n\n\n\n=== station: 60\n# scans: 3570\n\n\n\n\n\n\n\n\n\n=== station: 63\n# scans: 2418\n\n\n\n\n\n\n\n\n\n=== station: 68\n# scans: 85\n\n\n\n\n\n\n\n\n\n=== station: 7\n# scans: 37\n\n\n\n\n\n\n\n\n\n=== station: 9\n# scans: 5358\n\n\n\n\n\n\n\n\n\n=== station: 9.5\n# scans: 7848\n\n\n\n\n\n\n\n\n\n=== station: BG2\n# scans: 2867\n\n\n\n\n\n\n\n\n\n=== station: BG3\n# scans: 2628\n\n\n\n\n\n\n\n\n\n=== station: BG4\n# scans: 3335\n\n\n\n\n\n\n\n\n\n=== station: CAL1\n# scans: 3465\n\n\n\n\n\n\n\n\n\n=== station: CAL2\n# scans: 3453\n\n\n\n\n\n\n\n\n\n=== station: CAL3\n# scans: 2624\n\n\n\n\n\n\n\n\n\n=== station: CAL4\n# scans: 3273\n\n\n\n\n\n\n\n\n\n=== station: CAL5\n# scans: 5117\n\n\n\n\n\n\n\n\n\n=== station: CAL6\n# scans: 4408\n\n\n\n\n\n\n\n\n\n=== station: EB1\n# scans: 4068\n\n\n\n\n\n\n\n\n\n=== station: EB2\n# scans: 2246\n\n\n\n\n\n\n\n\n\n=== station: GP1.5\n# scans: 2179\n\n\n\n\n\n\n\n\n\n=== station: GP5\n# scans: 5412\n\n\n\n\n\n\n\n\n\n=== station: KW1\n# scans: 3986\n\n\n\n\n\n\n\n\n\n=== station: KW2\n# scans: 2918\n\n\n\n\n\n\n\n\n\n=== station: KW4\n# scans: 2844\n\n\n\n\n\n\n\n\n\n=== station: MR\n# scans: 5168\n\n\n\n\n\n\n\n\n\n=== station: RP1\n# scans: 2601\n\n\n\n\n\n\n\n\n\n=== station: RP2\n# scans: 1942\n\n\n\n\n\n\n\n\n\n=== station: RP3\n# scans: 2280\n\n\n\n\n\n\n\n\n\n=== station: RP4\n# scans: 4115\n\n\n\n\n\n\n\n\n\n=== station: WS\n# scans: 4301\n\n\n\n\n\n\n\n\n\n\n\nplotting each cast in the first list\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # 1 is selecting only the first sublist\n  tryCatch({\n    plot(ctdDecimate(ctdTrim(cast)))\n  }, error = function(e){\n    print(e)\n  })\n}\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4965' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4539' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 5920' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3236' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3563' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1931' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4504' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4141' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3523' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 7923' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3066' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1955' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2692' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2830' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2110' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1670' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 35' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4250' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3570' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2418' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 5358' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 7848' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2867' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2628' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3335' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3465' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3453' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2624' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3273' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 5117' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4408' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4068' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2246' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2179' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 5412' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3986' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2918' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2844' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 5168' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2601' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1942' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2280' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4115' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4301' in coercion to 'logical(1)'&gt;\n\n\n\n\nplotting other physical parameters for each cast\n# Loop through each CTD cast\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # Assuming each sublist contains only one relevant CTD object\n  tryCatch({\n    # Extract metadata for station name and cruise ID\n    station_name &lt;- cast@metadata$station[1]\n    cruise_id &lt;- cast@data$cruise_id[1]\n\n    # Generate a title with station name and cruise ID\n    overall_title &lt;- glue::glue(\"Station: {station_name}, Cruise ID: {cruise_id}\")\n\n    # Set margins: increase the outer margin for the title\n    par(oma = c(0, 0, 3, 0))  # Top outer margin increased for title\n\n    # Plotting function with specific parameters\n    oce::plot(\n      x = ctdDecimate(ctdTrim(cast)),\n      which = c(\n        \"sea_water_electrical_conductivity\",\n        \"descent_rate\", \"sound_velocity\",\n        \"sea_water_sigma_t\",\"altimeter\"\n      ),\n      main = \"\"  # No main title for individual subplots\n    )\n\n    # Place a single overall title at the top of the plot frame\n    mtext(overall_title, side = 3, line = 1, outer = TRUE, cex = 1.5)\n\n    # Reset outer margins to default\n    par(oma = c(0, 0, 0, 0))\n\n  }, error = function(e) {\n    print(e$message)  # Print any errors that occur during plotting\n  })\n}\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n\n\nplotting other nutrient parameters for each cast\n# Loop through each CTD cast\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # Assuming each sublist contains only one relevant CTD object\n  tryCatch({\n    # Extract metadata for station name and cruise ID\n    station_name &lt;- cast@metadata$station[1]\n    cruise_id &lt;- cast@data$cruise_id[1]\n\n    # Generate a title with station name and cruise ID\n    overall_title &lt;- glue::glue(\"Station: {station_name}, Cruise ID: {cruise_id}\")\n\n    # Set margins: increase the outer margin for the title\n    par(oma = c(0, 0, 3, 0))  # Top outer margin increased for title\n\n    # Plotting function with specific parameters\n    oce::plot(\n      x = ctdDecimate(ctdTrim(cast)),\n      which = c(\n        \"CDOM\", \"dissolved_oxygen\",\n        \"oxygen_saturation\",\n        \"chlorophyll_concentration\", \"chlorophyll_fluorescence\"\n      ),\n      main = \"\"  # No main title for individual subplots\n    )\n\n    # Place a single overall title at the top of the plot frame\n    mtext(overall_title, side = 3, line = 1, outer = TRUE, cex = 1.5)\n\n    # Reset outer margins to default\n    par(oma = c(0, 0, 0, 0))\n\n  }, error = function(e) {\n    print(e$message)  # Print any errors that occur during plotting\n  })\n}\n\n\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n\n\n\n\nplotting other optical parameters for each cast\n# Loop through each CTD cast\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # Assuming each sublist contains only one relevant CTD object\n  tryCatch({\n    # Extract metadata for station name and cruise ID\n    station_name &lt;- cast@metadata$station[1]\n    cruise_id &lt;- cast@data$cruise_id[1]\n\n    # Generate a title with station name and cruise ID\n    overall_title &lt;- glue::glue(\"Station: {station_name}, Cruise ID: {cruise_id}\")\n\n    # Set margins: increase the outer margin for the title\n    par(oma = c(0, 0, 3, 0))  # Top outer margin increased for title\n\n    # Plotting function with specific parameters\n    oce::plot(\n      x = ctdDecimate(ctdTrim(cast)),\n      which = c(\n        \"photosynthetically_available_radiation\",\n        \"beam_attenuation\",\"beam_transmission\"\n      ),\n      main = \"\"  # No main title for individual subplots\n    )\n\n    # Place a single overall title at the top of the plot frame\n    mtext(overall_title, side = 3, line = 1, outer = TRUE, cex = 1.5)\n\n    # Reset outer margins to default\n    par(oma = c(0, 0, 0, 0))\n\n  }, error = function(e) {\n    print(e$message)  # Print any errors that occur during plotting\n  })\n}\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n\n\nloop through every cast, clean, & save\ncombined_df &lt;- data.frame()\nfor (i in seq(ctd_FK)){\n  tryCatch({\n    cast &lt;- ctd_FK[[i]]  # 1 is selecting only the first sublist\n    \n    # print(class(cast))\n    # clean cast \n    trimmed_cast &lt;- ctdTrim(cast)\n    decimated_cast &lt;- ctdDecimate(trimmed_cast, p = 0.5)  # binned to 0.5 m\n    \n    # convert to df\n    cast_df &lt;- as.data.frame(decimated_cast@data)\n    \n    # Add metadata\n    # assumes station ID and cruise ID the same for all & just uses 1st one\n    cast_df &lt;- mutate(\n      cast_df,\n      station = cast@data$station[1],\n      cruise_id = cast@data$cruise_id[1]\n    )\n  \n    # drop NA rows left by cleaning\n    cast_df &lt;- subset(cast_df, !is.na(scan))\n    \n    # Append the data to the combined dataframe\n    combined_df &lt;- rbind(combined_df, cast_df)\n  }, error = function(e){\n    print(glue(\"error in cast {cast@metadata$station[1]}\"))\n    print(e)\n  })\n}\n# Save to CSV\nfile_path &lt;- here(glue(\"data/cleaned/{cruise_id}.csv\"))\nwrite.csv(combined_df, file_path, row.names = FALSE)"
  },
  {
    "objectID": "cruise_report/cruise_reports/WS20342.html",
    "href": "cruise_report/cruise_reports/WS20342.html",
    "title": "WS20342",
    "section": "",
    "text": "WS20342\n\n\nsetup\nif (!nzchar(system.file(package = \"librarian\"))) {\n  install.packages(\"librarian\")\n}\n\nlibrarian::shelf(\n  quiet = TRUE,\n  readr, here, fs, ggplot2, glue, \"jiho/castr\", dplyr, oce, patchwork, purrr, tidyr\n)\n\n\n\n\nCode\nsource(here(\"R/cruise_load.R\"))\ncruise_df &lt;- cruise_load(params$cruise_id)\n\n\n\n\nplot depth & pressure vs time elapsed\ntryCatch({\n  plots &lt;- list()\n  \n  for (station_name in unique(cruise_df$station)) {\n    subset_df &lt;- filter(cruise_df, station == station_name)\n    plots[[station_name]] &lt;- ggplot(subset_df, aes(x = time_elapsed)) +\n      geom_point(aes(y = depth), color = \"blue\") +  # Plot depth in blue\n      geom_line(aes(y = sea_water_pressure), color = \"red\") +  # Plot sea water pressure in red\n      ggtitle(glue(\"{station_name}\")) +\n      theme(\n        axis.title.x = element_blank(),\n        axis.title.y = element_blank(),\n        axis.text.x = element_blank(),\n        axis.text.y = element_blank(),\n        axis.ticks.x = element_blank(),\n        axis.ticks.y = element_blank()\n      )  # Remove individual axis titles and text\n  }\n  \n  # drop nulls\n  plots &lt;- purrr::compact(plots)\n  \n  # Combine all plots into a grid\n  combined_plot &lt;- wrap_plots(plots) + \n    plot_layout(ncol = 4) +  # Adjust ncol to set number of columns in the grid\n    plot_annotation(\n      title = \"Depth (blue) and Pressure (red)\",\n      subtitle = \"Each panel represents a different station\",\n      caption = \"Time Elapsed (x-axis) vs Depth & Pressure (y-axis)\"\n    ) +\n    theme(\n      plot.tag = element_text(size = 12, face = \"bold\"),\n      plot.tag.position = \"topleft\",\n      axis.title.x = element_text(margin = margin(t = 10)),\n      axis.title.y = element_text(margin = margin(r = 10))\n    )\n  \n  print(combined_plot)\n}, error = function(er){\n  print(er)\n});\n\n\n\n\n\n\n\n\n\n\n\nplot across all stations\np &lt;- ggplot(cruise_df, aes(x = time, y = depth, fill = station)) +\n  geom_col() +  # This creates the bars\n  # geom_text(aes(label = station), vjust = -0.3) +  # This adds labels to each bar, adjust vjust for position\n  labs(x = \"Time\", y = \"Depth\", title = \"Depth over Time by Station\") +  # Set labels and title\n  theme_minimal()  # Use a minimal theme\nprint(p)\n\n\n\n\n\n\n\n\n\n\n\ncreate oce.ctd objects from dataframes\nctd_load &lt;- function(data, other_params = NULL) {\n  \n  # create csv into ctd object\n  test_ctd &lt;-\n    as.ctd(\n      salinity    = data$sea_water_salinity,\n      temperature = data$sea_water_temperature,\n      pressure    = data$sea_water_pressure,\n      station     = data$station\n    )\n  \n  # add additional columns to ctd object\n  if (!is.null(other_params)) {\n    for (param_name in other_params) {\n      test_ctd &lt;-\n        oceSetData(\n          object = test_ctd,\n          name   = param_name,\n          value  = data[[param_name]]\n        )\n    }\n  }\n  print(glue(\"{data$station[1]}:\\t{length(test_ctd@data$scan)} scans\"))\n\n\n  return(test_ctd)\n}\n\n# Define other parameters to add\nother_params &lt;- c(\n  \"cruise_id\", \"station\", \"time\", \"time_elapsed\", \n  \"latitude\", \"longitude\", \"sea_water_electrical_conductivity\", \n  \"CDOM\", \"dissolved_oxygen\",\"oxygen_saturation\", \"chlorophyll_concentration\", \n  \"chlorophyll_fluorescence\", \"photosynthetically_available_radiation\", \n  \"beam_attenuation\",\"beam_transmission\", \"depth\", \"sea_water_sigma_t\",\n  \"descent_rate\", \"sound_velocity\",\"altimeter\"\n)\n\n# Split data by station and create data list\nctd_FK &lt;- cruise_df %&gt;%\n  split(.$station) %&gt;%\n  map(~ ctd_load(.x, other_params = other_params)) # ~ is a lambda(x)\n\n\n.10:    2804 scans\n.12:    3637 scans\n.15:    4703 scans\n.15_5:  9730 scans\n.16:    1581 scans\n.18:    3897 scans\n.2: 4068 scans\n.30:    3103 scans\n.31:    3059 scans\n.33:    1897 scans\n.41:    2906 scans\n.47:    1777 scans\n.49:    20 scans\n.51:    3005 scans\n.53:    47 scans\n.54:    8 scans\n.55:    1186 scans\n.56:    1980 scans\n.57:    1610 scans\n.57_1:  1985 scans\n.57_2:  1793 scans\n.57_3:  2152 scans\n.58:    2854 scans\n.60:    1135 scans\n.64:    1572 scans\n.68:    2791 scans\n.7: 4783 scans\n.AMI1:  2130 scans\n.AMI2:  3509 scans\n.AMI3:  4121 scans\n.AMI4:  5691 scans\n.AMI5:  5453 scans\n.AMI6:  4742 scans\n.AMI7:  5030 scans\n.AMI8:  8118 scans\n.AMI9:  5740 scans\n.BG1:   4040 scans\n.BG2:   4507 scans\n.BG3:   3962 scans\n.BG4:   3809 scans\n.CAL1:  5 scans\n.CAL2:  1833 scans\n.CAL3:  1933 scans\n.CAL4:  2145 scans\n.CAL5:  3160 scans\n.CAL6:  3942 scans\n.GP5:   5361 scans\n.KW1:   2081 scans\n.KW2:   2376 scans\n.KW4:   2921 scans\n.LK:    4359 scans\n.MR:    3438 scans\n.RP1:   2228 scans\n.RP2:   3537 scans\n.RP3:   3249 scans\n.RP4:   4394 scans\n.TB1:   2643 scans\n.TB2:   1849 scans\n.TB3:   2031 scans\n.TB4:   3711 scans\n.TB5:   4715 scans\n.V1:    1793 scans\n.V2:    2147 scans\n.V3:    2336 scans\n.V4:    2580 scans\n.V5:    2787 scans\n.V6:    4788 scans\n.V7:    5355 scans\n.V8:    3982 scans\n.V9:    5104 scans\n.WS:    2341 scans\n\n\n\n\nplotting scans for each cast in the first list\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # 1 is selecting only the first sublist\n  # print(i)\n  print(glue(\"=== station: {cast@metadata$station[1]}\"))\n  print(glue(\"# scans: {length(cast@data$scan)}\"))\n  plotScan(cast)\n}\n\n\n=== station: .10\n# scans: 2804\n\n\n\n\n\n\n\n\n\n=== station: .12\n# scans: 3637\n\n\n\n\n\n\n\n\n\n=== station: .15\n# scans: 4703\n\n\n\n\n\n\n\n\n\n=== station: .15_5\n# scans: 9730\n\n\n\n\n\n\n\n\n\n=== station: .16\n# scans: 1581\n\n\n\n\n\n\n\n\n\n=== station: .18\n# scans: 3897\n\n\n\n\n\n\n\n\n\n=== station: .2\n# scans: 4068\n\n\n\n\n\n\n\n\n\n=== station: .30\n# scans: 3103\n\n\n\n\n\n\n\n\n\n=== station: .31\n# scans: 3059\n\n\n\n\n\n\n\n\n\n=== station: .33\n# scans: 1897\n\n\n\n\n\n\n\n\n\n=== station: .41\n# scans: 2906\n\n\n\n\n\n\n\n\n\n=== station: .47\n# scans: 1777\n\n\n\n\n\n\n\n\n\n=== station: .49\n# scans: 20\n\n\n\n\n\n\n\n\n\n=== station: .51\n# scans: 3005\n\n\n\n\n\n\n\n\n\n=== station: .53\n# scans: 47\n\n\n\n\n\n\n\n\n\n=== station: .54\n# scans: 8\n\n\n\n\n\n\n\n\n\n=== station: .55\n# scans: 1186\n\n\n\n\n\n\n\n\n\n=== station: .56\n# scans: 1980\n\n\n\n\n\n\n\n\n\n=== station: .57\n# scans: 1610\n\n\n\n\n\n\n\n\n\n=== station: .57_1\n# scans: 1985\n\n\n\n\n\n\n\n\n\n=== station: .57_2\n# scans: 1793\n\n\n\n\n\n\n\n\n\n=== station: .57_3\n# scans: 2152\n\n\n\n\n\n\n\n\n\n=== station: .58\n# scans: 2854\n\n\n\n\n\n\n\n\n\n=== station: .60\n# scans: 1135\n\n\n\n\n\n\n\n\n\n=== station: .64\n# scans: 1572\n\n\n\n\n\n\n\n\n\n=== station: .68\n# scans: 2791\n\n\n\n\n\n\n\n\n\n=== station: .7\n# scans: 4783\n\n\n\n\n\n\n\n\n\n=== station: .AMI1\n# scans: 2130\n\n\n\n\n\n\n\n\n\n=== station: .AMI2\n# scans: 3509\n\n\n\n\n\n\n\n\n\n=== station: .AMI3\n# scans: 4121\n\n\n\n\n\n\n\n\n\n=== station: .AMI4\n# scans: 5691\n\n\n\n\n\n\n\n\n\n=== station: .AMI5\n# scans: 5453\n\n\n\n\n\n\n\n\n\n=== station: .AMI6\n# scans: 4742\n\n\n\n\n\n\n\n\n\n=== station: .AMI7\n# scans: 5030\n\n\n\n\n\n\n\n\n\n=== station: .AMI8\n# scans: 8118\n\n\n\n\n\n\n\n\n\n=== station: .AMI9\n# scans: 5740\n\n\n\n\n\n\n\n\n\n=== station: .BG1\n# scans: 4040\n\n\n\n\n\n\n\n\n\n=== station: .BG2\n# scans: 4507\n\n\n\n\n\n\n\n\n\n=== station: .BG3\n# scans: 3962\n\n\n\n\n\n\n\n\n\n=== station: .BG4\n# scans: 3809\n\n\n\n\n\n\n\n\n\n=== station: .CAL1\n# scans: 5\n\n\n\n\n\n\n\n\n\n=== station: .CAL2\n# scans: 1833\n\n\n\n\n\n\n\n\n\n=== station: .CAL3\n# scans: 1933\n\n\n\n\n\n\n\n\n\n=== station: .CAL4\n# scans: 2145\n\n\n\n\n\n\n\n\n\n=== station: .CAL5\n# scans: 3160\n\n\n\n\n\n\n\n\n\n=== station: .CAL6\n# scans: 3942\n\n\n\n\n\n\n\n\n\n=== station: .GP5\n# scans: 5361\n\n\n\n\n\n\n\n\n\n=== station: .KW1\n# scans: 2081\n\n\n\n\n\n\n\n\n\n=== station: .KW2\n# scans: 2376\n\n\n\n\n\n\n\n\n\n=== station: .KW4\n# scans: 2921\n\n\n\n\n\n\n\n\n\n=== station: .LK\n# scans: 4359\n\n\n\n\n\n\n\n\n\n=== station: .MR\n# scans: 3438\n\n\n\n\n\n\n\n\n\n=== station: .RP1\n# scans: 2228\n\n\n\n\n\n\n\n\n\n=== station: .RP2\n# scans: 3537\n\n\n\n\n\n\n\n\n\n=== station: .RP3\n# scans: 3249\n\n\n\n\n\n\n\n\n\n=== station: .RP4\n# scans: 4394\n\n\n\n\n\n\n\n\n\n=== station: .TB1\n# scans: 2643\n\n\n\n\n\n\n\n\n\n=== station: .TB2\n# scans: 1849\n\n\n\n\n\n\n\n\n\n=== station: .TB3\n# scans: 2031\n\n\n\n\n\n\n\n\n\n=== station: .TB4\n# scans: 3711\n\n\n\n\n\n\n\n\n\n=== station: .TB5\n# scans: 4715\n\n\n\n\n\n\n\n\n\n=== station: .V1\n# scans: 1793\n\n\n\n\n\n\n\n\n\n=== station: .V2\n# scans: 2147\n\n\n\n\n\n\n\n\n\n=== station: .V3\n# scans: 2336\n\n\n\n\n\n\n\n\n\n=== station: .V4\n# scans: 2580\n\n\n\n\n\n\n\n\n\n=== station: .V5\n# scans: 2787\n\n\n\n\n\n\n\n\n\n=== station: .V6\n# scans: 4788\n\n\n\n\n\n\n\n\n\n=== station: .V7\n# scans: 5355\n\n\n\n\n\n\n\n\n\n=== station: .V8\n# scans: 3982\n\n\n\n\n\n\n\n\n\n=== station: .V9\n# scans: 5104\n\n\n\n\n\n\n\n\n\n=== station: .WS\n# scans: 2341\n\n\n\n\n\n\n\n\n\n\n\nplotting each cast in the first list\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # 1 is selecting only the first sublist\n  tryCatch({\n    plot(ctdDecimate(ctdTrim(cast)))\n  }, error = function(e){\n    print(e)\n  })\n}\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2804' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3637' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4703' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 9730' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1581' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3897' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4068' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3103' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3059' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1897' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2906' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1777' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3005' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1186' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1980' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1610' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1985' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1793' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2152' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2854' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1135' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1572' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2791' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4783' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2130' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3509' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4121' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 5691' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 5453' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4742' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 5030' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 8118' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 5740' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4040' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4507' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3962' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3809' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1833' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1933' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2145' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3160' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3942' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 5361' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2081' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2376' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2921' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4359' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3438' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2228' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3537' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3249' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4394' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2643' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1849' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2031' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3711' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4715' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1793' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2147' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2336' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2580' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2787' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4788' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 5355' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3982' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 5104' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2341' in coercion to 'logical(1)'&gt;\n\n\n\n\nplotting other physical parameters for each cast\n# Loop through each CTD cast\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # Assuming each sublist contains only one relevant CTD object\n  tryCatch({\n    # Extract metadata for station name and cruise ID\n    station_name &lt;- cast@metadata$station[1]\n    cruise_id &lt;- cast@data$cruise_id[1]\n\n    # Generate a title with station name and cruise ID\n    overall_title &lt;- glue::glue(\"Station: {station_name}, Cruise ID: {cruise_id}\")\n\n    # Set margins: increase the outer margin for the title\n    par(oma = c(0, 0, 3, 0))  # Top outer margin increased for title\n\n    # Plotting function with specific parameters\n    oce::plot(\n      x = ctdDecimate(ctdTrim(cast)),\n      which = c(\n        \"sea_water_electrical_conductivity\",\n        \"descent_rate\", \"sound_velocity\",\n        \"sea_water_sigma_t\",\"altimeter\"\n      ),\n      main = \"\"  # No main title for individual subplots\n    )\n\n    # Place a single overall title at the top of the plot frame\n    mtext(overall_title, side = 3, line = 1, outer = TRUE, cex = 1.5)\n\n    # Reset outer margins to default\n    par(oma = c(0, 0, 0, 0))\n\n  }, error = function(e) {\n    print(e$message)  # Print any errors that occur during plotting\n  })\n}\n\n\n\n\n\n\n\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n\n\nplotting other nutrient parameters for each cast\n# Loop through each CTD cast\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # Assuming each sublist contains only one relevant CTD object\n  tryCatch({\n    # Extract metadata for station name and cruise ID\n    station_name &lt;- cast@metadata$station[1]\n    cruise_id &lt;- cast@data$cruise_id[1]\n\n    # Generate a title with station name and cruise ID\n    overall_title &lt;- glue::glue(\"Station: {station_name}, Cruise ID: {cruise_id}\")\n\n    # Set margins: increase the outer margin for the title\n    par(oma = c(0, 0, 3, 0))  # Top outer margin increased for title\n\n    # Plotting function with specific parameters\n    oce::plot(\n      x = ctdDecimate(ctdTrim(cast)),\n      which = c(\n        \"CDOM\", \"dissolved_oxygen\",\n        \"oxygen_saturation\",\n        \"chlorophyll_concentration\", \"chlorophyll_fluorescence\"\n      ),\n      main = \"\"  # No main title for individual subplots\n    )\n\n    # Place a single overall title at the top of the plot frame\n    mtext(overall_title, side = 3, line = 1, outer = TRUE, cex = 1.5)\n\n    # Reset outer margins to default\n    par(oma = c(0, 0, 0, 0))\n\n  }, error = function(e) {\n    print(e$message)  # Print any errors that occur during plotting\n  })\n}\n\n\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"plot.new has not been called yet\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n\n\n\n\nplotting other optical parameters for each cast\n# Loop through each CTD cast\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # Assuming each sublist contains only one relevant CTD object\n  tryCatch({\n    # Extract metadata for station name and cruise ID\n    station_name &lt;- cast@metadata$station[1]\n    cruise_id &lt;- cast@data$cruise_id[1]\n\n    # Generate a title with station name and cruise ID\n    overall_title &lt;- glue::glue(\"Station: {station_name}, Cruise ID: {cruise_id}\")\n\n    # Set margins: increase the outer margin for the title\n    par(oma = c(0, 0, 3, 0))  # Top outer margin increased for title\n\n    # Plotting function with specific parameters\n    oce::plot(\n      x = ctdDecimate(ctdTrim(cast)),\n      which = c(\n        \"photosynthetically_available_radiation\",\n        \"beam_attenuation\",\"beam_transmission\"\n      ),\n      main = \"\"  # No main title for individual subplots\n    )\n\n    # Place a single overall title at the top of the plot frame\n    mtext(overall_title, side = 3, line = 1, outer = TRUE, cex = 1.5)\n\n    # Reset outer margins to default\n    par(oma = c(0, 0, 0, 0))\n\n  }, error = function(e) {\n    print(e$message)  # Print any errors that occur during plotting\n  })\n}\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n\n\nloop through every cast, clean, & save\ncombined_df &lt;- data.frame()\nfor (i in seq(ctd_FK)){\n  tryCatch({\n    cast &lt;- ctd_FK[[i]]  # 1 is selecting only the first sublist\n    \n    # print(class(cast))\n    # clean cast \n    trimmed_cast &lt;- ctdTrim(cast)\n    decimated_cast &lt;- ctdDecimate(trimmed_cast, p = 0.5)  # binned to 0.5 m\n    \n    # convert to df\n    cast_df &lt;- as.data.frame(decimated_cast@data)\n    \n    # Add metadata\n    # assumes station ID and cruise ID the same for all & just uses 1st one\n    cast_df &lt;- mutate(\n      cast_df,\n      station = cast@data$station[1],\n      cruise_id = cast@data$cruise_id[1]\n    )\n  \n    # drop NA rows left by cleaning\n    cast_df &lt;- subset(cast_df, !is.na(scan))\n    \n    # Append the data to the combined dataframe\n    combined_df &lt;- rbind(combined_df, cast_df)\n  }, error = function(e){\n    print(glue(\"error in cast {cast@metadata$station[1]}\"))\n    print(e)\n  })\n}\n# Save to CSV\nfile_path &lt;- here(glue(\"data/cleaned/{cruise_id}.csv\"))\nwrite.csv(combined_df, file_path, row.names = FALSE)"
  },
  {
    "objectID": "cruise_report/cruise_reports/WS21093.html",
    "href": "cruise_report/cruise_reports/WS21093.html",
    "title": "WS21093",
    "section": "",
    "text": "WS21093\n\n\nsetup\nif (!nzchar(system.file(package = \"librarian\"))) {\n  install.packages(\"librarian\")\n}\n\nlibrarian::shelf(\n  quiet = TRUE,\n  readr, here, fs, ggplot2, glue, \"jiho/castr\", dplyr, oce, patchwork, purrr, tidyr\n)\n\n\n\n\nCode\nsource(here(\"R/cruise_load.R\"))\ncruise_df &lt;- cruise_load(params$cruise_id)\n\n\n\n\nplot depth & pressure vs time elapsed\ntryCatch({\n  plots &lt;- list()\n  \n  for (station_name in unique(cruise_df$station)) {\n    subset_df &lt;- filter(cruise_df, station == station_name)\n    plots[[station_name]] &lt;- ggplot(subset_df, aes(x = time_elapsed)) +\n      geom_point(aes(y = depth), color = \"blue\") +  # Plot depth in blue\n      geom_line(aes(y = sea_water_pressure), color = \"red\") +  # Plot sea water pressure in red\n      ggtitle(glue(\"{station_name}\")) +\n      theme(\n        axis.title.x = element_blank(),\n        axis.title.y = element_blank(),\n        axis.text.x = element_blank(),\n        axis.text.y = element_blank(),\n        axis.ticks.x = element_blank(),\n        axis.ticks.y = element_blank()\n      )  # Remove individual axis titles and text\n  }\n  \n  # drop nulls\n  plots &lt;- purrr::compact(plots)\n  \n  # Combine all plots into a grid\n  combined_plot &lt;- wrap_plots(plots) + \n    plot_layout(ncol = 4) +  # Adjust ncol to set number of columns in the grid\n    plot_annotation(\n      title = \"Depth (blue) and Pressure (red)\",\n      subtitle = \"Each panel represents a different station\",\n      caption = \"Time Elapsed (x-axis) vs Depth & Pressure (y-axis)\"\n    ) +\n    theme(\n      plot.tag = element_text(size = 12, face = \"bold\"),\n      plot.tag.position = \"topleft\",\n      axis.title.x = element_text(margin = margin(t = 10)),\n      axis.title.y = element_text(margin = margin(r = 10))\n    )\n  \n  print(combined_plot)\n}, error = function(er){\n  print(er)\n});\n\n\n\n\n\n\n\n\n\n\n\nplot across all stations\np &lt;- ggplot(cruise_df, aes(x = time, y = depth, fill = station)) +\n  geom_col() +  # This creates the bars\n  # geom_text(aes(label = station), vjust = -0.3) +  # This adds labels to each bar, adjust vjust for position\n  labs(x = \"Time\", y = \"Depth\", title = \"Depth over Time by Station\") +  # Set labels and title\n  theme_minimal()  # Use a minimal theme\nprint(p)\n\n\n\n\n\n\n\n\n\n\n\ncreate oce.ctd objects from dataframes\nctd_load &lt;- function(data, other_params = NULL) {\n  \n  # create csv into ctd object\n  test_ctd &lt;-\n    as.ctd(\n      salinity    = data$sea_water_salinity,\n      temperature = data$sea_water_temperature,\n      pressure    = data$sea_water_pressure,\n      station     = data$station\n    )\n  \n  # add additional columns to ctd object\n  if (!is.null(other_params)) {\n    for (param_name in other_params) {\n      test_ctd &lt;-\n        oceSetData(\n          object = test_ctd,\n          name   = param_name,\n          value  = data[[param_name]]\n        )\n    }\n  }\n  print(glue(\"{data$station[1]}:\\t{length(test_ctd@data$scan)} scans\"))\n\n\n  return(test_ctd)\n}\n\n# Define other parameters to add\nother_params &lt;- c(\n  \"cruise_id\", \"station\", \"time\", \"time_elapsed\", \n  \"latitude\", \"longitude\", \"sea_water_electrical_conductivity\", \n  \"CDOM\", \"dissolved_oxygen\",\"oxygen_saturation\", \"chlorophyll_concentration\", \n  \"chlorophyll_fluorescence\", \"photosynthetically_available_radiation\", \n  \"beam_attenuation\",\"beam_transmission\", \"depth\", \"sea_water_sigma_t\",\n  \"descent_rate\", \"sound_velocity\",\"altimeter\"\n)\n\n# Split data by station and create data list\nctd_FK &lt;- cruise_df %&gt;%\n  split(.$station) %&gt;%\n  map(~ ctd_load(.x, other_params = other_params)) # ~ is a lambda(x)\n\n\n.002:   3445 scans\n.007:   29 scans\n.010:   1661 scans\n.016:   2491 scans\n.058:   2018 scans\n.060:   3042 scans\n.064:   10 scans\n.065:   1739 scans\n.068:   2500 scans\n.12:    3949 scans\n.18:    3949 scans\n.21LK:  5134 scans\n.30:    4839 scans\n.31:    5993 scans\n.33:    3568 scans\n.41:    2548 scans\n.45:    2187 scans\n.47:    2427 scans\n.51:    1988 scans\n.53:    807 scans\n.54:    450 scans\n.55:    41 scans\n.56:    268 scans\n.57:    2376 scans\n.57_1:  1599 scans\n.57_2:  2843 scans\n.57_3:  3016 scans\n.9: 3649 scans\n.AM18:  5253 scans\n.AM19:  4195 scans\n.AMI1:  4246 scans\n.AMI2:  2703 scans\n.AMI3:  3356 scans\n.AMI4:  3814 scans\n.AMI5:  3561 scans\n.AMI6:  3070 scans\n.AMI7:  3785 scans\n.BG1:   1671 scans\n.BG2:   1900 scans\n.BG3:   2097 scans\n.BG4:   2657 scans\n.CAL1:  3254 scans\n.CAL2:  2145 scans\n.CAL3:  2877 scans\n.CAL4:  5100 scans\n.CAL5:  3076 scans\n.CAL6:  3921 scans\n.GP5:   2940 scans\n.KW1:   1649 scans\n.KW2:   2213 scans\n.KW4:   3918 scans\n.MR:    3828 scans\n.RP1:   2363 scans\n.RP2:   2051 scans\n.RP3:   2100 scans\n.RP4:   2015 scans\n.TB1:   2796 scans\n.TB1_RECAST:    2138 scans\n.TB10:  5217 scans\n.TB2:   1714 scans\n.TB3:   3703 scans\n.TB4:   4615 scans\n.TB5:   5415 scans\n.V1:    3324 scans\n.V2:    2616 scans\n.V3:    4225 scans\n.V4:    4691 scans\n.V5:    4533 scans\n.V6:    4683 scans\n.V7:    3244 scans\n.V8:    3959 scans\n.V9:    4042 scans\n.WS:    3743 scans\n\n\n\n\nplotting scans for each cast in the first list\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # 1 is selecting only the first sublist\n  # print(i)\n  print(glue(\"=== station: {cast@metadata$station[1]}\"))\n  print(glue(\"# scans: {length(cast@data$scan)}\"))\n  plotScan(cast)\n}\n\n\n=== station: .002\n# scans: 3445\n\n\n\n\n\n\n\n\n\n=== station: .007\n# scans: 29\n\n\n\n\n\n\n\n\n\n=== station: .010\n# scans: 1661\n\n\n\n\n\n\n\n\n\n=== station: .016\n# scans: 2491\n\n\n\n\n\n\n\n\n\n=== station: .058\n# scans: 2018\n\n\n\n\n\n\n\n\n\n=== station: .060\n# scans: 3042\n\n\n\n\n\n\n\n\n\n=== station: .064\n# scans: 10\n\n\n\n\n\n\n\n\n\n=== station: .065\n# scans: 1739\n\n\n\n\n\n\n\n\n\n=== station: .068\n# scans: 2500\n\n\n\n\n\n\n\n\n\n=== station: .12\n# scans: 3949\n\n\n\n\n\n\n\n\n\n=== station: .18\n# scans: 3949\n\n\n\n\n\n\n\n\n\n=== station: .21LK\n# scans: 5134\n\n\n\n\n\n\n\n\n\n=== station: .30\n# scans: 4839\n\n\n\n\n\n\n\n\n\n=== station: .31\n# scans: 5993\n\n\n\n\n\n\n\n\n\n=== station: .33\n# scans: 3568\n\n\n\n\n\n\n\n\n\n=== station: .41\n# scans: 2548\n\n\n\n\n\n\n\n\n\n=== station: .45\n# scans: 2187\n\n\n\n\n\n\n\n\n\n=== station: .47\n# scans: 2427\n\n\n\n\n\n\n\n\n\n=== station: .51\n# scans: 1988\n\n\n\n\n\n\n\n\n\n=== station: .53\n# scans: 807\n\n\n\n\n\n\n\n\n\n=== station: .54\n# scans: 450\n\n\n\n\n\n\n\n\n\n=== station: .55\n# scans: 41\n\n\n\n\n\n\n\n\n\n=== station: .56\n# scans: 268\n\n\n\n\n\n\n\n\n\n=== station: .57\n# scans: 2376\n\n\n\n\n\n\n\n\n\n=== station: .57_1\n# scans: 1599\n\n\n\n\n\n\n\n\n\n=== station: .57_2\n# scans: 2843\n\n\n\n\n\n\n\n\n\n=== station: .57_3\n# scans: 3016\n\n\n\n\n\n\n\n\n\n=== station: .9\n# scans: 3649\n\n\n\n\n\n\n\n\n\n=== station: .AM18\n# scans: 5253\n\n\n\n\n\n\n\n\n\n=== station: .AM19\n# scans: 4195\n\n\n\n\n\n\n\n\n\n=== station: .AMI1\n# scans: 4246\n\n\n\n\n\n\n\n\n\n=== station: .AMI2\n# scans: 2703\n\n\n\n\n\n\n\n\n\n=== station: .AMI3\n# scans: 3356\n\n\n\n\n\n\n\n\n\n=== station: .AMI4\n# scans: 3814\n\n\n\n\n\n\n\n\n\n=== station: .AMI5\n# scans: 3561\n\n\n\n\n\n\n\n\n\n=== station: .AMI6\n# scans: 3070\n\n\n\n\n\n\n\n\n\n=== station: .AMI7\n# scans: 3785\n\n\n\n\n\n\n\n\n\n=== station: .BG1\n# scans: 1671\n\n\n\n\n\n\n\n\n\n=== station: .BG2\n# scans: 1900\n\n\n\n\n\n\n\n\n\n=== station: .BG3\n# scans: 2097\n\n\n\n\n\n\n\n\n\n=== station: .BG4\n# scans: 2657\n\n\n\n\n\n\n\n\n\n=== station: .CAL1\n# scans: 3254\n\n\n\n\n\n\n\n\n\n=== station: .CAL2\n# scans: 2145\n\n\n\n\n\n\n\n\n\n=== station: .CAL3\n# scans: 2877\n\n\n\n\n\n\n\n\n\n=== station: .CAL4\n# scans: 5100\n\n\n\n\n\n\n\n\n\n=== station: .CAL5\n# scans: 3076\n\n\n\n\n\n\n\n\n\n=== station: .CAL6\n# scans: 3921\n\n\n\n\n\n\n\n\n\n=== station: .GP5\n# scans: 2940\n\n\n\n\n\n\n\n\n\n=== station: .KW1\n# scans: 1649\n\n\n\n\n\n\n\n\n\n=== station: .KW2\n# scans: 2213\n\n\n\n\n\n\n\n\n\n=== station: .KW4\n# scans: 3918\n\n\n\n\n\n\n\n\n\n=== station: .MR\n# scans: 3828\n\n\n\n\n\n\n\n\n\n=== station: .RP1\n# scans: 2363\n\n\n\n\n\n\n\n\n\n=== station: .RP2\n# scans: 2051\n\n\n\n\n\n\n\n\n\n=== station: .RP3\n# scans: 2100\n\n\n\n\n\n\n\n\n\n=== station: .RP4\n# scans: 2015\n\n\n\n\n\n\n\n\n\n=== station: .TB1\n# scans: 2796\n\n\n\n\n\n\n\n\n\n=== station: .TB1_RECAST\n# scans: 2138\n\n\n\n\n\n\n\n\n\n=== station: .TB10\n# scans: 5217\n\n\n\n\n\n\n\n\n\n=== station: .TB2\n# scans: 1714\n\n\n\n\n\n\n\n\n\n=== station: .TB3\n# scans: 3703\n\n\n\n\n\n\n\n\n\n=== station: .TB4\n# scans: 4615\n\n\n\n\n\n\n\n\n\n=== station: .TB5\n# scans: 5415\n\n\n\n\n\n\n\n\n\n=== station: .V1\n# scans: 3324\n\n\n\n\n\n\n\n\n\n=== station: .V2\n# scans: 2616\n\n\n\n\n\n\n\n\n\n=== station: .V3\n# scans: 4225\n\n\n\n\n\n\n\n\n\n=== station: .V4\n# scans: 4691\n\n\n\n\n\n\n\n\n\n=== station: .V5\n# scans: 4533\n\n\n\n\n\n\n\n\n\n=== station: .V6\n# scans: 4683\n\n\n\n\n\n\n\n\n\n=== station: .V7\n# scans: 3244\n\n\n\n\n\n\n\n\n\n=== station: .V8\n# scans: 3959\n\n\n\n\n\n\n\n\n\n=== station: .V9\n# scans: 4042\n\n\n\n\n\n\n\n\n\n=== station: .WS\n# scans: 3743\n\n\n\n\n\n\n\n\n\n\n\nplotting each cast in the first list\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # 1 is selecting only the first sublist\n  tryCatch({\n    plot(ctdDecimate(ctdTrim(cast)))\n  }, error = function(e){\n    print(e)\n  })\n}\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3445' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 29' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1661' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2491' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2018' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3042' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2500' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3949' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3949' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 5134' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4839' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 5993' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3568' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2548' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2187' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2427' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1988' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 807' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2376' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1599' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2843' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3016' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3649' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 5253' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4195' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4246' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2703' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3356' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3814' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3561' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3070' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3785' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1671' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1900' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2097' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2657' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3254' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2145' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2877' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 5100' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3076' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3921' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2940' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1649' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2213' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3918' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3828' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2363' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2051' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2100' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2015' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2796' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2138' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 5217' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1714' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3703' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4615' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 5415' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3324' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2616' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4225' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4691' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4533' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4683' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3244' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3959' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4042' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3743' in coercion to 'logical(1)'&gt;\n\n\n\n\nplotting other physical parameters for each cast\n# Loop through each CTD cast\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # Assuming each sublist contains only one relevant CTD object\n  tryCatch({\n    # Extract metadata for station name and cruise ID\n    station_name &lt;- cast@metadata$station[1]\n    cruise_id &lt;- cast@data$cruise_id[1]\n\n    # Generate a title with station name and cruise ID\n    overall_title &lt;- glue::glue(\"Station: {station_name}, Cruise ID: {cruise_id}\")\n\n    # Set margins: increase the outer margin for the title\n    par(oma = c(0, 0, 3, 0))  # Top outer margin increased for title\n\n    # Plotting function with specific parameters\n    oce::plot(\n      x = ctdDecimate(ctdTrim(cast)),\n      which = c(\n        \"sea_water_electrical_conductivity\",\n        \"descent_rate\", \"sound_velocity\",\n        \"sea_water_sigma_t\",\"altimeter\"\n      ),\n      main = \"\"  # No main title for individual subplots\n    )\n\n    # Place a single overall title at the top of the plot frame\n    mtext(overall_title, side = 3, line = 1, outer = TRUE, cex = 1.5)\n\n    # Reset outer margins to default\n    par(oma = c(0, 0, 0, 0))\n\n  }, error = function(e) {\n    print(e$message)  # Print any errors that occur during plotting\n  })\n}\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n\n\nplotting other nutrient parameters for each cast\n# Loop through each CTD cast\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # Assuming each sublist contains only one relevant CTD object\n  tryCatch({\n    # Extract metadata for station name and cruise ID\n    station_name &lt;- cast@metadata$station[1]\n    cruise_id &lt;- cast@data$cruise_id[1]\n\n    # Generate a title with station name and cruise ID\n    overall_title &lt;- glue::glue(\"Station: {station_name}, Cruise ID: {cruise_id}\")\n\n    # Set margins: increase the outer margin for the title\n    par(oma = c(0, 0, 3, 0))  # Top outer margin increased for title\n\n    # Plotting function with specific parameters\n    oce::plot(\n      x = ctdDecimate(ctdTrim(cast)),\n      which = c(\n        \"CDOM\", \"dissolved_oxygen\",\n        \"oxygen_saturation\",\n        \"chlorophyll_concentration\", \"chlorophyll_fluorescence\"\n      ),\n      main = \"\"  # No main title for individual subplots\n    )\n\n    # Place a single overall title at the top of the plot frame\n    mtext(overall_title, side = 3, line = 1, outer = TRUE, cex = 1.5)\n\n    # Reset outer margins to default\n    par(oma = c(0, 0, 0, 0))\n\n  }, error = function(e) {\n    print(e$message)  # Print any errors that occur during plotting\n  })\n}\n\n\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n\n\n\n\nplotting other optical parameters for each cast\n# Loop through each CTD cast\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # Assuming each sublist contains only one relevant CTD object\n  tryCatch({\n    # Extract metadata for station name and cruise ID\n    station_name &lt;- cast@metadata$station[1]\n    cruise_id &lt;- cast@data$cruise_id[1]\n\n    # Generate a title with station name and cruise ID\n    overall_title &lt;- glue::glue(\"Station: {station_name}, Cruise ID: {cruise_id}\")\n\n    # Set margins: increase the outer margin for the title\n    par(oma = c(0, 0, 3, 0))  # Top outer margin increased for title\n\n    # Plotting function with specific parameters\n    oce::plot(\n      x = ctdDecimate(ctdTrim(cast)),\n      which = c(\n        \"photosynthetically_available_radiation\",\n        \"beam_attenuation\",\"beam_transmission\"\n      ),\n      main = \"\"  # No main title for individual subplots\n    )\n\n    # Place a single overall title at the top of the plot frame\n    mtext(overall_title, side = 3, line = 1, outer = TRUE, cex = 1.5)\n\n    # Reset outer margins to default\n    par(oma = c(0, 0, 0, 0))\n\n  }, error = function(e) {\n    print(e$message)  # Print any errors that occur during plotting\n  })\n}\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n\n\n\n\n\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n[1] \"In plot,ctd-method() : which=\\\"photosynthetically_available_radiationbeam_attenuationbeam_transmission\\\" cannot be handled\"\n\n\n\n\nloop through every cast, clean, & save\ncombined_df &lt;- data.frame()\nfor (i in seq(ctd_FK)){\n  tryCatch({\n    cast &lt;- ctd_FK[[i]]  # 1 is selecting only the first sublist\n    \n    # print(class(cast))\n    # clean cast \n    trimmed_cast &lt;- ctdTrim(cast)\n    decimated_cast &lt;- ctdDecimate(trimmed_cast, p = 0.5)  # binned to 0.5 m\n    \n    # convert to df\n    cast_df &lt;- as.data.frame(decimated_cast@data)\n    \n    # Add metadata\n    # assumes station ID and cruise ID the same for all & just uses 1st one\n    cast_df &lt;- mutate(\n      cast_df,\n      station = cast@data$station[1],\n      cruise_id = cast@data$cruise_id[1]\n    )\n  \n    # drop NA rows left by cleaning\n    cast_df &lt;- subset(cast_df, !is.na(scan))\n    \n    # Append the data to the combined dataframe\n    combined_df &lt;- rbind(combined_df, cast_df)\n  }, error = function(e){\n    print(glue(\"error in cast {cast@metadata$station[1]}\"))\n    print(e)\n  })\n}\n# Save to CSV\nfile_path &lt;- here(glue(\"data/cleaned/{cruise_id}.csv\"))\nwrite.csv(combined_df, file_path, row.names = FALSE)"
  },
  {
    "objectID": "cruise_report/cruise_reports/WS21212.html",
    "href": "cruise_report/cruise_reports/WS21212.html",
    "title": "WS21212",
    "section": "",
    "text": "WS21212\n\n\nsetup\nif (!nzchar(system.file(package = \"librarian\"))) {\n  install.packages(\"librarian\")\n}\n\nlibrarian::shelf(\n  quiet = TRUE,\n  readr, here, fs, ggplot2, glue, \"jiho/castr\", dplyr, oce, patchwork, purrr, tidyr\n)\n\n\n\n\nCode\nsource(here(\"R/cruise_load.R\"))\ncruise_df &lt;- cruise_load(params$cruise_id)\n\n\n\n\nplot depth & pressure vs time elapsed\ntryCatch({\n  plots &lt;- list()\n  \n  for (station_name in unique(cruise_df$station)) {\n    subset_df &lt;- filter(cruise_df, station == station_name)\n    plots[[station_name]] &lt;- ggplot(subset_df, aes(x = time_elapsed)) +\n      geom_point(aes(y = depth), color = \"blue\") +  # Plot depth in blue\n      geom_line(aes(y = sea_water_pressure), color = \"red\") +  # Plot sea water pressure in red\n      ggtitle(glue(\"{station_name}\")) +\n      theme(\n        axis.title.x = element_blank(),\n        axis.title.y = element_blank(),\n        axis.text.x = element_blank(),\n        axis.text.y = element_blank(),\n        axis.ticks.x = element_blank(),\n        axis.ticks.y = element_blank()\n      )  # Remove individual axis titles and text\n  }\n  \n  # drop nulls\n  plots &lt;- purrr::compact(plots)\n  \n  # Combine all plots into a grid\n  combined_plot &lt;- wrap_plots(plots) + \n    plot_layout(ncol = 4) +  # Adjust ncol to set number of columns in the grid\n    plot_annotation(\n      title = \"Depth (blue) and Pressure (red)\",\n      subtitle = \"Each panel represents a different station\",\n      caption = \"Time Elapsed (x-axis) vs Depth & Pressure (y-axis)\"\n    ) +\n    theme(\n      plot.tag = element_text(size = 12, face = \"bold\"),\n      plot.tag.position = \"topleft\",\n      axis.title.x = element_text(margin = margin(t = 10)),\n      axis.title.y = element_text(margin = margin(r = 10))\n    )\n  \n  print(combined_plot)\n}, error = function(er){\n  print(er)\n});\n\n\n\n\n\n\n\n\n\n\n\nplot across all stations\np &lt;- ggplot(cruise_df, aes(x = time, y = depth, fill = station)) +\n  geom_col() +  # This creates the bars\n  # geom_text(aes(label = station), vjust = -0.3) +  # This adds labels to each bar, adjust vjust for position\n  labs(x = \"Time\", y = \"Depth\", title = \"Depth over Time by Station\") +  # Set labels and title\n  theme_minimal()  # Use a minimal theme\nprint(p)\n\n\n\n\n\n\n\n\n\n\n\ncreate oce.ctd objects from dataframes\nctd_load &lt;- function(data, other_params = NULL) {\n  \n  # create csv into ctd object\n  test_ctd &lt;-\n    as.ctd(\n      salinity    = data$sea_water_salinity,\n      temperature = data$sea_water_temperature,\n      pressure    = data$sea_water_pressure,\n      station     = data$station\n    )\n  \n  # add additional columns to ctd object\n  if (!is.null(other_params)) {\n    for (param_name in other_params) {\n      test_ctd &lt;-\n        oceSetData(\n          object = test_ctd,\n          name   = param_name,\n          value  = data[[param_name]]\n        )\n    }\n  }\n  print(glue(\"{data$station[1]}:\\t{length(test_ctd@data$scan)} scans\"))\n\n\n  return(test_ctd)\n}\n\n# Define other parameters to add\nother_params &lt;- c(\n  \"cruise_id\", \"station\", \"time\", \"time_elapsed\", \n  \"latitude\", \"longitude\", \"sea_water_electrical_conductivity\", \n  \"CDOM\", \"dissolved_oxygen\",\"oxygen_saturation\", \"chlorophyll_concentration\", \n  \"chlorophyll_fluorescence\", \"photosynthetically_available_radiation\", \n  \"beam_attenuation\",\"beam_transmission\", \"depth\", \"sea_water_sigma_t\",\n  \"descent_rate\", \"sound_velocity\",\"altimeter\"\n)\n\n# Split data by station and create data list\nctd_FK &lt;- cruise_df %&gt;%\n  split(.$station) %&gt;%\n  map(~ ctd_load(.x, other_params = other_params)) # ~ is a lambda(x)\n\n\n002:    3517 scans\n007:    2660 scans\n009:    1545 scans\n009.5:  7129 scans\n010:    1534 scans\n012:    3807 scans\n016:    1060 scans\n018:    2942 scans\n021LK:  4301 scans\n030:    3165 scans\n031:    3025 scans\n033:    1758 scans\n041:    2915 scans\n045:    2772 scans\n047:    2751 scans\n049:    2473 scans\n051:    2008 scans\n054:    364 scans\n055:    41 scans\n056:    53 scans\n057:    1985 scans\n057.1:  900 scans\n057.2:  3312 scans\n057.3:  3851 scans\n058:    1737 scans\n060:    707 scans\n064:    194 scans\n065:    441 scans\n068:    67 scans\nAMI1:   2897 scans\nAMI2:   1584 scans\nAMI3:   1819 scans\nAMI4:   2264 scans\nAMI5:   3470 scans\nAMI6:   3345 scans\nAMI7:   2782 scans\nAMI8:   3547 scans\nAMI9:   3438 scans\nBG1:    3260 scans\nBG2:    4752 scans\nBG3:    4039 scans\nBG4:    3313 scans\nCAL1:   2729 scans\nCAL2:   3372 scans\nCAL3:   4220 scans\nCAL4:   1910 scans\nCAL5:   2228 scans\nCAL6:   2932 scans\nCW1:    132 scans\nCW2:    3760 scans\nCW3:    2728 scans\nCW4:    3473 scans\nGP5:    4622 scans\nKW1:    3080 scans\nKW2:    2775 scans\nKW4:    4339 scans\nMR: 3733 scans\nRP1:    3493 scans\nRP2:    3805 scans\nRP3:    3772 scans\nRP4:    3459 scans\nTB1:    2895 scans\nTB10:   5203 scans\nTB2:    2727 scans\nTB3:    3730 scans\nTB4:    4740 scans\nTB5:    4354 scans\nV1: 2911 scans\nV2: 4073 scans\nV3: 3899 scans\nV4: 3986 scans\nV5: 4406 scans\nV6: 6245 scans\nV7: 4541 scans\nV8: 4966 scans\nV9: 6442 scans\nWS: 4593 scans\nWS2:    671 scans\n\n\n\n\nplotting scans for each cast in the first list\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # 1 is selecting only the first sublist\n  # print(i)\n  print(glue(\"=== station: {cast@metadata$station[1]}\"))\n  print(glue(\"# scans: {length(cast@data$scan)}\"))\n  plotScan(cast)\n}\n\n\n=== station: 002\n# scans: 3517\n\n\n\n\n\n\n\n\n\n=== station: 007\n# scans: 2660\n\n\n\n\n\n\n\n\n\n=== station: 009\n# scans: 1545\n\n\n\n\n\n\n\n\n\n=== station: 009.5\n# scans: 7129\n\n\n\n\n\n\n\n\n\n=== station: 010\n# scans: 1534\n\n\n\n\n\n\n\n\n\n=== station: 012\n# scans: 3807\n\n\n\n\n\n\n\n\n\n=== station: 016\n# scans: 1060\n\n\n\n\n\n\n\n\n\n=== station: 018\n# scans: 2942\n\n\n\n\n\n\n\n\n\n=== station: 021LK\n# scans: 4301\n\n\n\n\n\n\n\n\n\n=== station: 030\n# scans: 3165\n\n\n\n\n\n\n\n\n\n=== station: 031\n# scans: 3025\n\n\n\n\n\n\n\n\n\n=== station: 033\n# scans: 1758\n\n\n\n\n\n\n\n\n\n=== station: 041\n# scans: 2915\n\n\n\n\n\n\n\n\n\n=== station: 045\n# scans: 2772\n\n\n\n\n\n\n\n\n\n=== station: 047\n# scans: 2751\n\n\n\n\n\n\n\n\n\n=== station: 049\n# scans: 2473\n\n\n\n\n\n\n\n\n\n=== station: 051\n# scans: 2008\n\n\n\n\n\n\n\n\n\n=== station: 054\n# scans: 364\n\n\n\n\n\n\n\n\n\n=== station: 055\n# scans: 41\n\n\n\n\n\n\n\n\n\n=== station: 056\n# scans: 53\n\n\n\n\n\n\n\n\n\n=== station: 057\n# scans: 1985\n\n\n\n\n\n\n\n\n\n=== station: 057.1\n# scans: 900\n\n\n\n\n\n\n\n\n\n=== station: 057.2\n# scans: 3312\n\n\n\n\n\n\n\n\n\n=== station: 057.3\n# scans: 3851\n\n\n\n\n\n\n\n\n\n=== station: 058\n# scans: 1737\n\n\n\n\n\n\n\n\n\n=== station: 060\n# scans: 707\n\n\n\n\n\n\n\n\n\n=== station: 064\n# scans: 194\n\n\n\n\n\n\n\n\n\n=== station: 065\n# scans: 441\n\n\n\n\n\n\n\n\n\n=== station: 068\n# scans: 67\n\n\n\n\n\n\n\n\n\n=== station: AMI1\n# scans: 2897\n\n\n\n\n\n\n\n\n\n=== station: AMI2\n# scans: 1584\n\n\n\n\n\n\n\n\n\n=== station: AMI3\n# scans: 1819\n\n\n\n\n\n\n\n\n\n=== station: AMI4\n# scans: 2264\n\n\n\n\n\n\n\n\n\n=== station: AMI5\n# scans: 3470\n\n\n\n\n\n\n\n\n\n=== station: AMI6\n# scans: 3345\n\n\n\n\n\n\n\n\n\n=== station: AMI7\n# scans: 2782\n\n\n\n\n\n\n\n\n\n=== station: AMI8\n# scans: 3547\n\n\n\n\n\n\n\n\n\n=== station: AMI9\n# scans: 3438\n\n\n\n\n\n\n\n\n\n=== station: BG1\n# scans: 3260\n\n\n\n\n\n\n\n\n\n=== station: BG2\n# scans: 4752\n\n\n\n\n\n\n\n\n\n=== station: BG3\n# scans: 4039\n\n\n\n\n\n\n\n\n\n=== station: BG4\n# scans: 3313\n\n\n\n\n\n\n\n\n\n=== station: CAL1\n# scans: 2729\n\n\n\n\n\n\n\n\n\n=== station: CAL2\n# scans: 3372\n\n\n\n\n\n\n\n\n\n=== station: CAL3\n# scans: 4220\n\n\n\n\n\n\n\n\n\n=== station: CAL4\n# scans: 1910\n\n\n\n\n\n\n\n\n\n=== station: CAL5\n# scans: 2228\n\n\n\n\n\n\n\n\n\n=== station: CAL6\n# scans: 2932\n\n\n\n\n\n\n\n\n\n=== station: CW1\n# scans: 132\n\n\n\n\n\n\n\n\n\n=== station: CW2\n# scans: 3760\n\n\n\n\n\n\n\n\n\n=== station: CW3\n# scans: 2728\n\n\n\n\n\n\n\n\n\n=== station: CW4\n# scans: 3473\n\n\n\n\n\n\n\n\n\n=== station: GP5\n# scans: 4622\n\n\n\n\n\n\n\n\n\n=== station: KW1\n# scans: 3080\n\n\n\n\n\n\n\n\n\n=== station: KW2\n# scans: 2775\n\n\n\n\n\n\n\n\n\n=== station: KW4\n# scans: 4339\n\n\n\n\n\n\n\n\n\n=== station: MR\n# scans: 3733\n\n\n\n\n\n\n\n\n\n=== station: RP1\n# scans: 3493\n\n\n\n\n\n\n\n\n\n=== station: RP2\n# scans: 3805\n\n\n\n\n\n\n\n\n\n=== station: RP3\n# scans: 3772\n\n\n\n\n\n\n\n\n\n=== station: RP4\n# scans: 3459\n\n\n\n\n\n\n\n\n\n=== station: TB1\n# scans: 2895\n\n\n\n\n\n\n\n\n\n=== station: TB10\n# scans: 5203\n\n\n\n\n\n\n\n\n\n=== station: TB2\n# scans: 2727\n\n\n\n\n\n\n\n\n\n=== station: TB3\n# scans: 3730\n\n\n\n\n\n\n\n\n\n=== station: TB4\n# scans: 4740\n\n\n\n\n\n\n\n\n\n=== station: TB5\n# scans: 4354\n\n\n\n\n\n\n\n\n\n=== station: V1\n# scans: 2911\n\n\n\n\n\n\n\n\n\n=== station: V2\n# scans: 4073\n\n\n\n\n\n\n\n\n\n=== station: V3\n# scans: 3899\n\n\n\n\n\n\n\n\n\n=== station: V4\n# scans: 3986\n\n\n\n\n\n\n\n\n\n=== station: V5\n# scans: 4406\n\n\n\n\n\n\n\n\n\n=== station: V6\n# scans: 6245\n\n\n\n\n\n\n\n\n\n=== station: V7\n# scans: 4541\n\n\n\n\n\n\n\n\n\n=== station: V8\n# scans: 4966\n\n\n\n\n\n\n\n\n\n=== station: V9\n# scans: 6442\n\n\n\n\n\n\n\n\n\n=== station: WS\n# scans: 4593\n\n\n\n\n\n\n\n\n\n=== station: WS2\n# scans: 671\n\n\n\n\n\n\n\n\n\n\n\nplotting each cast in the first list\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # 1 is selecting only the first sublist\n  tryCatch({\n    plot(ctdDecimate(ctdTrim(cast)))\n  }, error = function(e){\n    print(e)\n  })\n}\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3517' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2660' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1545' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 7129' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1534' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3807' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2942' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4301' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3165' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3025' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1758' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2915' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2772' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2751' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2473' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2008' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1985' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3312' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3851' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1737' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 194' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 441' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2897' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1584' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1819' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2264' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3470' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3345' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2782' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3547' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3438' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3260' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4752' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4039' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3313' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2729' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3372' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4220' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1910' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2228' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2932' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 132' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3760' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2728' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3473' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4622' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3080' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2775' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4339' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3733' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3493' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3805' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3772' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3459' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2895' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 5203' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2727' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3730' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4740' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4354' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2911' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4073' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3899' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3986' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4406' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 6245' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4541' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4966' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 6442' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4593' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 671' in coercion to 'logical(1)'&gt;\n\n\n\n\nplotting other physical parameters for each cast\n# Loop through each CTD cast\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # Assuming each sublist contains only one relevant CTD object\n  tryCatch({\n    # Extract metadata for station name and cruise ID\n    station_name &lt;- cast@metadata$station[1]\n    cruise_id &lt;- cast@data$cruise_id[1]\n\n    # Generate a title with station name and cruise ID\n    overall_title &lt;- glue::glue(\"Station: {station_name}, Cruise ID: {cruise_id}\")\n\n    # Set margins: increase the outer margin for the title\n    par(oma = c(0, 0, 3, 0))  # Top outer margin increased for title\n\n    # Plotting function with specific parameters\n    oce::plot(\n      x = ctdDecimate(ctdTrim(cast)),\n      which = c(\n        \"sea_water_electrical_conductivity\",\n        \"descent_rate\", \"sound_velocity\",\n        \"sea_water_sigma_t\",\"altimeter\"\n      ),\n      main = \"\"  # No main title for individual subplots\n    )\n\n    # Place a single overall title at the top of the plot frame\n    mtext(overall_title, side = 3, line = 1, outer = TRUE, cex = 1.5)\n\n    # Reset outer margins to default\n    par(oma = c(0, 0, 0, 0))\n\n  }, error = function(e) {\n    print(e$message)  # Print any errors that occur during plotting\n  })\n}\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n\n\nplotting other nutrient parameters for each cast\n# Loop through each CTD cast\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # Assuming each sublist contains only one relevant CTD object\n  tryCatch({\n    # Extract metadata for station name and cruise ID\n    station_name &lt;- cast@metadata$station[1]\n    cruise_id &lt;- cast@data$cruise_id[1]\n\n    # Generate a title with station name and cruise ID\n    overall_title &lt;- glue::glue(\"Station: {station_name}, Cruise ID: {cruise_id}\")\n\n    # Set margins: increase the outer margin for the title\n    par(oma = c(0, 0, 3, 0))  # Top outer margin increased for title\n\n    # Plotting function with specific parameters\n    oce::plot(\n      x = ctdDecimate(ctdTrim(cast)),\n      which = c(\n        \"CDOM\", \"dissolved_oxygen\",\n        \"oxygen_saturation\",\n        \"chlorophyll_concentration\", \"chlorophyll_fluorescence\"\n      ),\n      main = \"\"  # No main title for individual subplots\n    )\n\n    # Place a single overall title at the top of the plot frame\n    mtext(overall_title, side = 3, line = 1, outer = TRUE, cex = 1.5)\n\n    # Reset outer margins to default\n    par(oma = c(0, 0, 0, 0))\n\n  }, error = function(e) {\n    print(e$message)  # Print any errors that occur during plotting\n  })\n}\n\n\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"plot.new has not been called yet\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"plot.new has not been called yet\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n[1] \"In plot,ctd-method() : which=\\\"CDOMdissolved_oxygenoxygen_saturationchlorophyll_concentrationchlorophyll_fluorescence\\\" cannot be handled\"\n\n\n\n\nplotting other optical parameters for each cast\n# Loop through each CTD cast\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # Assuming each sublist contains only one relevant CTD object\n  tryCatch({\n    # Extract metadata for station name and cruise ID\n    station_name &lt;- cast@metadata$station[1]\n    cruise_id &lt;- cast@data$cruise_id[1]\n\n    # Generate a title with station name and cruise ID\n    overall_title &lt;- glue::glue(\"Station: {station_name}, Cruise ID: {cruise_id}\")\n\n    # Set margins: increase the outer margin for the title\n    par(oma = c(0, 0, 3, 0))  # Top outer margin increased for title\n\n    # Plotting function with specific parameters\n    oce::plot(\n      x = ctdDecimate(ctdTrim(cast)),\n      which = c(\n        \"photosynthetically_available_radiation\",\n        \"beam_attenuation\",\"beam_transmission\"\n      ),\n      main = \"\"  # No main title for individual subplots\n    )\n\n    # Place a single overall title at the top of the plot frame\n    mtext(overall_title, side = 3, line = 1, outer = TRUE, cex = 1.5)\n\n    # Reset outer margins to default\n    par(oma = c(0, 0, 0, 0))\n\n  }, error = function(e) {\n    print(e$message)  # Print any errors that occur during plotting\n  })\n}\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n\n\nloop through every cast, clean, & save\ncombined_df &lt;- data.frame()\nfor (i in seq(ctd_FK)){\n  tryCatch({\n    cast &lt;- ctd_FK[[i]]  # 1 is selecting only the first sublist\n    \n    # print(class(cast))\n    # clean cast \n    trimmed_cast &lt;- ctdTrim(cast)\n    decimated_cast &lt;- ctdDecimate(trimmed_cast, p = 0.5)  # binned to 0.5 m\n    \n    # convert to df\n    cast_df &lt;- as.data.frame(decimated_cast@data)\n    \n    # Add metadata\n    # assumes station ID and cruise ID the same for all & just uses 1st one\n    cast_df &lt;- mutate(\n      cast_df,\n      station = cast@data$station[1],\n      cruise_id = cast@data$cruise_id[1]\n    )\n  \n    # drop NA rows left by cleaning\n    cast_df &lt;- subset(cast_df, !is.na(scan))\n    \n    # Append the data to the combined dataframe\n    combined_df &lt;- rbind(combined_df, cast_df)\n  }, error = function(e){\n    print(glue(\"error in cast {cast@metadata$station[1]}\"))\n    print(e)\n  })\n}\n# Save to CSV\nfile_path &lt;- here(glue(\"data/cleaned/{cruise_id}.csv\"))\nwrite.csv(combined_df, file_path, row.names = FALSE)"
  },
  {
    "objectID": "cruise_report/cruise_reports/WS22022.html",
    "href": "cruise_report/cruise_reports/WS22022.html",
    "title": "WS22022",
    "section": "",
    "text": "WS22022\n\n\nsetup\nif (!nzchar(system.file(package = \"librarian\"))) {\n  install.packages(\"librarian\")\n}\n\nlibrarian::shelf(\n  quiet = TRUE,\n  readr, here, fs, ggplot2, glue, \"jiho/castr\", dplyr, oce, patchwork, purrr, tidyr\n)\n\n\n\n\nCode\nsource(here(\"R/cruise_load.R\"))\ncruise_df &lt;- cruise_load(params$cruise_id)\n\n\n\n\nplot depth & pressure vs time elapsed\ntryCatch({\n  plots &lt;- list()\n  \n  for (station_name in unique(cruise_df$station)) {\n    subset_df &lt;- filter(cruise_df, station == station_name)\n    plots[[station_name]] &lt;- ggplot(subset_df, aes(x = time_elapsed)) +\n      geom_point(aes(y = depth), color = \"blue\") +  # Plot depth in blue\n      geom_line(aes(y = sea_water_pressure), color = \"red\") +  # Plot sea water pressure in red\n      ggtitle(glue(\"{station_name}\")) +\n      theme(\n        axis.title.x = element_blank(),\n        axis.title.y = element_blank(),\n        axis.text.x = element_blank(),\n        axis.text.y = element_blank(),\n        axis.ticks.x = element_blank(),\n        axis.ticks.y = element_blank()\n      )  # Remove individual axis titles and text\n  }\n  \n  # drop nulls\n  plots &lt;- purrr::compact(plots)\n  \n  # Combine all plots into a grid\n  combined_plot &lt;- wrap_plots(plots) + \n    plot_layout(ncol = 4) +  # Adjust ncol to set number of columns in the grid\n    plot_annotation(\n      title = \"Depth (blue) and Pressure (red)\",\n      subtitle = \"Each panel represents a different station\",\n      caption = \"Time Elapsed (x-axis) vs Depth & Pressure (y-axis)\"\n    ) +\n    theme(\n      plot.tag = element_text(size = 12, face = \"bold\"),\n      plot.tag.position = \"topleft\",\n      axis.title.x = element_text(margin = margin(t = 10)),\n      axis.title.y = element_text(margin = margin(r = 10))\n    )\n  \n  print(combined_plot)\n}, error = function(er){\n  print(er)\n});\n\n\n\n\n\n\n\n\n\n\n\nplot across all stations\np &lt;- ggplot(cruise_df, aes(x = time, y = depth, fill = station)) +\n  geom_col() +  # This creates the bars\n  # geom_text(aes(label = station), vjust = -0.3) +  # This adds labels to each bar, adjust vjust for position\n  labs(x = \"Time\", y = \"Depth\", title = \"Depth over Time by Station\") +  # Set labels and title\n  theme_minimal()  # Use a minimal theme\nprint(p)\n\n\n\n\n\n\n\n\n\n\n\ncreate oce.ctd objects from dataframes\nctd_load &lt;- function(data, other_params = NULL) {\n  \n  # create csv into ctd object\n  test_ctd &lt;-\n    as.ctd(\n      salinity    = data$sea_water_salinity,\n      temperature = data$sea_water_temperature,\n      pressure    = data$sea_water_pressure,\n      station     = data$station\n    )\n  \n  # add additional columns to ctd object\n  if (!is.null(other_params)) {\n    for (param_name in other_params) {\n      test_ctd &lt;-\n        oceSetData(\n          object = test_ctd,\n          name   = param_name,\n          value  = data[[param_name]]\n        )\n    }\n  }\n  print(glue(\"{data$station[1]}:\\t{length(test_ctd@data$scan)} scans\"))\n\n\n  return(test_ctd)\n}\n\n# Define other parameters to add\nother_params &lt;- c(\n  \"cruise_id\", \"station\", \"time\", \"time_elapsed\", \n  \"latitude\", \"longitude\", \"sea_water_electrical_conductivity\", \n  \"CDOM\", \"dissolved_oxygen\",\"oxygen_saturation\", \"chlorophyll_concentration\", \n  \"chlorophyll_fluorescence\", \"photosynthetically_available_radiation\", \n  \"beam_attenuation\",\"beam_transmission\", \"depth\", \"sea_water_sigma_t\",\n  \"descent_rate\", \"sound_velocity\",\"altimeter\"\n)\n\n# Split data by station and create data list\nctd_FK &lt;- cruise_df %&gt;%\n  split(.$station) %&gt;%\n  map(~ ctd_load(.x, other_params = other_params)) # ~ is a lambda(x)\n\n\n.10:    1711 scans\n.12:    3581 scans\n.16:    2619 scans\n.18:    3540 scans\n.2: 2900 scans\n.21LK:  4921 scans\n.30:    3067 scans\n.31:    3694 scans\n.33:    2368 scans\n.41:    2802 scans\n.45:    2676 scans\n.47:    2767 scans\n.49:    2844 scans\n.51:    2716 scans\n.53:    22 scans\n.54:    230 scans\n.55:    247 scans\n.56:    3211 scans\n.57:    2482 scans\n.57_1:  3095 scans\n.57_2:  2981 scans\n.57_3:  2843 scans\n.58:    2797 scans\n.60:    2635 scans\n.64:    31 scans\n.65:    103 scans\n.68:    403 scans\n.7: 1837 scans\n.9: 4317 scans\n.9_5:   10084 scans\n.AMI1:  3028 scans\n.AMI2:  2364 scans\n.AMI3:  2669 scans\n.AMI6:  4801 scans\n.AMI7:  6116 scans\n.AMI8:  5566 scans\n.AMI9:  6105 scans\n.BG1:   2456 scans\n.BG2:   3995 scans\n.BG3:   2699 scans\n.BG4:   3908 scans\n.CAL1:  2440 scans\n.CAL2:  2555 scans\n.CAL3:  2893 scans\n.CAL4:  3641 scans\n.CAL5:  2733 scans\n.CAL6:  4857 scans\n.GP5:   3012 scans\n.KW1:   3045 scans\n.KW2:   3528 scans\n.KW4:   3215 scans\n.MR:    2477 scans\n.RP1:   3349 scans\n.RP2:   2647 scans\n.RP3:   2339 scans\n.RP4:   3074 scans\n.TB1:   2725 scans\n.TB10:  4493 scans\n.TB2:   2490 scans\n.TB3:   3545 scans\n.TB4:   4024 scans\n.TB5:   4107 scans\n.V1:    3102 scans\n.V2:    3554 scans\n.V3:    3336 scans\n.V4:    3234 scans\n.V5:    3898 scans\n.V6:    4607 scans\n.V7:    4384 scans\n.V8:    4133 scans\n.V9:    4376 scans\n.WS:    4192 scans\n\n\n\n\nplotting scans for each cast in the first list\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # 1 is selecting only the first sublist\n  # print(i)\n  print(glue(\"=== station: {cast@metadata$station[1]}\"))\n  print(glue(\"# scans: {length(cast@data$scan)}\"))\n  plotScan(cast)\n}\n\n\n=== station: .10\n# scans: 1711\n\n\n\n\n\n\n\n\n\n=== station: .12\n# scans: 3581\n\n\n\n\n\n\n\n\n\n=== station: .16\n# scans: 2619\n\n\n\n\n\n\n\n\n\n=== station: .18\n# scans: 3540\n\n\n\n\n\n\n\n\n\n=== station: .2\n# scans: 2900\n\n\n\n\n\n\n\n\n\n=== station: .21LK\n# scans: 4921\n\n\n\n\n\n\n\n\n\n=== station: .30\n# scans: 3067\n\n\n\n\n\n\n\n\n\n=== station: .31\n# scans: 3694\n\n\n\n\n\n\n\n\n\n=== station: .33\n# scans: 2368\n\n\n\n\n\n\n\n\n\n=== station: .41\n# scans: 2802\n\n\n\n\n\n\n\n\n\n=== station: .45\n# scans: 2676\n\n\n\n\n\n\n\n\n\n=== station: .47\n# scans: 2767\n\n\n\n\n\n\n\n\n\n=== station: .49\n# scans: 2844\n\n\n\n\n\n\n\n\n\n=== station: .51\n# scans: 2716\n\n\n\n\n\n\n\n\n\n=== station: .53\n# scans: 22\n\n\n\n\n\n\n\n\n\n=== station: .54\n# scans: 230\n\n\n\n\n\n\n\n\n\n=== station: .55\n# scans: 247\n\n\n\n\n\n\n\n\n\n=== station: .56\n# scans: 3211\n\n\n\n\n\n\n\n\n\n=== station: .57\n# scans: 2482\n\n\n\n\n\n\n\n\n\n=== station: .57_1\n# scans: 3095\n\n\n\n\n\n\n\n\n\n=== station: .57_2\n# scans: 2981\n\n\n\n\n\n\n\n\n\n=== station: .57_3\n# scans: 2843\n\n\n\n\n\n\n\n\n\n=== station: .58\n# scans: 2797\n\n\n\n\n\n\n\n\n\n=== station: .60\n# scans: 2635\n\n\n\n\n\n\n\n\n\n=== station: .64\n# scans: 31\n\n\n\n\n\n\n\n\n\n=== station: .65\n# scans: 103\n\n\n\n\n\n\n\n\n\n=== station: .68\n# scans: 403\n\n\n\n\n\n\n\n\n\n=== station: .7\n# scans: 1837\n\n\n\n\n\n\n\n\n\n=== station: .9\n# scans: 4317\n\n\n\n\n\n\n\n\n\n=== station: .9_5\n# scans: 10084\n\n\n\n\n\n\n\n\n\n=== station: .AMI1\n# scans: 3028\n\n\n\n\n\n\n\n\n\n=== station: .AMI2\n# scans: 2364\n\n\n\n\n\n\n\n\n\n=== station: .AMI3\n# scans: 2669\n\n\n\n\n\n\n\n\n\n=== station: .AMI6\n# scans: 4801\n\n\n\n\n\n\n\n\n\n=== station: .AMI7\n# scans: 6116\n\n\n\n\n\n\n\n\n\n=== station: .AMI8\n# scans: 5566\n\n\n\n\n\n\n\n\n\n=== station: .AMI9\n# scans: 6105\n\n\n\n\n\n\n\n\n\n=== station: .BG1\n# scans: 2456\n\n\n\n\n\n\n\n\n\n=== station: .BG2\n# scans: 3995\n\n\n\n\n\n\n\n\n\n=== station: .BG3\n# scans: 2699\n\n\n\n\n\n\n\n\n\n=== station: .BG4\n# scans: 3908\n\n\n\n\n\n\n\n\n\n=== station: .CAL1\n# scans: 2440\n\n\n\n\n\n\n\n\n\n=== station: .CAL2\n# scans: 2555\n\n\n\n\n\n\n\n\n\n=== station: .CAL3\n# scans: 2893\n\n\n\n\n\n\n\n\n\n=== station: .CAL4\n# scans: 3641\n\n\n\n\n\n\n\n\n\n=== station: .CAL5\n# scans: 2733\n\n\n\n\n\n\n\n\n\n=== station: .CAL6\n# scans: 4857\n\n\n\n\n\n\n\n\n\n=== station: .GP5\n# scans: 3012\n\n\n\n\n\n\n\n\n\n=== station: .KW1\n# scans: 3045\n\n\n\n\n\n\n\n\n\n=== station: .KW2\n# scans: 3528\n\n\n\n\n\n\n\n\n\n=== station: .KW4\n# scans: 3215\n\n\n\n\n\n\n\n\n\n=== station: .MR\n# scans: 2477\n\n\n\n\n\n\n\n\n\n=== station: .RP1\n# scans: 3349\n\n\n\n\n\n\n\n\n\n=== station: .RP2\n# scans: 2647\n\n\n\n\n\n\n\n\n\n=== station: .RP3\n# scans: 2339\n\n\n\n\n\n\n\n\n\n=== station: .RP4\n# scans: 3074\n\n\n\n\n\n\n\n\n\n=== station: .TB1\n# scans: 2725\n\n\n\n\n\n\n\n\n\n=== station: .TB10\n# scans: 4493\n\n\n\n\n\n\n\n\n\n=== station: .TB2\n# scans: 2490\n\n\n\n\n\n\n\n\n\n=== station: .TB3\n# scans: 3545\n\n\n\n\n\n\n\n\n\n=== station: .TB4\n# scans: 4024\n\n\n\n\n\n\n\n\n\n=== station: .TB5\n# scans: 4107\n\n\n\n\n\n\n\n\n\n=== station: .V1\n# scans: 3102\n\n\n\n\n\n\n\n\n\n=== station: .V2\n# scans: 3554\n\n\n\n\n\n\n\n\n\n=== station: .V3\n# scans: 3336\n\n\n\n\n\n\n\n\n\n=== station: .V4\n# scans: 3234\n\n\n\n\n\n\n\n\n\n=== station: .V5\n# scans: 3898\n\n\n\n\n\n\n\n\n\n=== station: .V6\n# scans: 4607\n\n\n\n\n\n\n\n\n\n=== station: .V7\n# scans: 4384\n\n\n\n\n\n\n\n\n\n=== station: .V8\n# scans: 4133\n\n\n\n\n\n\n\n\n\n=== station: .V9\n# scans: 4376\n\n\n\n\n\n\n\n\n\n=== station: .WS\n# scans: 4192\n\n\n\n\n\n\n\n\n\n\n\nplotting each cast in the first list\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # 1 is selecting only the first sublist\n  tryCatch({\n    plot(ctdDecimate(ctdTrim(cast)))\n  }, error = function(e){\n    print(e)\n  })\n}\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3581' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2619' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3540' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2900' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4921' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3067' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3694' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2368' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2802' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2676' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2767' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2844' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2716' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 230' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 247' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3211' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2482' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3095' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2981' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2843' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2797' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2635' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 31' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 403' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 1837' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 10084' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3028' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2364' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2669' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4801' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 6116' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 5566' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 6105' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2440' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2555' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2893' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3641' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2733' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4857' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3045' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3528' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3215' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2477' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3349' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2647' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2339' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3074' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2725' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4493' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2490' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3545' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4024' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4107' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3554' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3336' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3234' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3898' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4607' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4384' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4133' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4376' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4192' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n\n\nplotting other physical parameters for each cast\n# Loop through each CTD cast\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # Assuming each sublist contains only one relevant CTD object\n  tryCatch({\n    # Extract metadata for station name and cruise ID\n    station_name &lt;- cast@metadata$station[1]\n    cruise_id &lt;- cast@data$cruise_id[1]\n\n    # Generate a title with station name and cruise ID\n    overall_title &lt;- glue::glue(\"Station: {station_name}, Cruise ID: {cruise_id}\")\n\n    # Set margins: increase the outer margin for the title\n    par(oma = c(0, 0, 3, 0))  # Top outer margin increased for title\n\n    # Plotting function with specific parameters\n    oce::plot(\n      x = ctdDecimate(ctdTrim(cast)),\n      which = c(\n        \"sea_water_electrical_conductivity\",\n        \"descent_rate\", \"sound_velocity\",\n        \"sea_water_sigma_t\",\"altimeter\"\n      ),\n      main = \"\"  # No main title for individual subplots\n    )\n\n    # Place a single overall title at the top of the plot frame\n    mtext(overall_title, side = 3, line = 1, outer = TRUE, cex = 1.5)\n\n    # Reset outer margins to default\n    par(oma = c(0, 0, 0, 0))\n\n  }, error = function(e) {\n    print(e$message)  # Print any errors that occur during plotting\n  })\n}\n\n\n[1] \"plot.new has not been called yet\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n\n\nplotting other nutrient parameters for each cast\n# Loop through each CTD cast\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # Assuming each sublist contains only one relevant CTD object\n  tryCatch({\n    # Extract metadata for station name and cruise ID\n    station_name &lt;- cast@metadata$station[1]\n    cruise_id &lt;- cast@data$cruise_id[1]\n\n    # Generate a title with station name and cruise ID\n    overall_title &lt;- glue::glue(\"Station: {station_name}, Cruise ID: {cruise_id}\")\n\n    # Set margins: increase the outer margin for the title\n    par(oma = c(0, 0, 3, 0))  # Top outer margin increased for title\n\n    # Plotting function with specific parameters\n    oce::plot(\n      x = ctdDecimate(ctdTrim(cast)),\n      which = c(\n        \"CDOM\", \"dissolved_oxygen\",\n        \"oxygen_saturation\",\n        \"chlorophyll_concentration\", \"chlorophyll_fluorescence\"\n      ),\n      main = \"\"  # No main title for individual subplots\n    )\n\n    # Place a single overall title at the top of the plot frame\n    mtext(overall_title, side = 3, line = 1, outer = TRUE, cex = 1.5)\n\n    # Reset outer margins to default\n    par(oma = c(0, 0, 0, 0))\n\n  }, error = function(e) {\n    print(e$message)  # Print any errors that occur during plotting\n  })\n}\n\n\n[1] \"plot.new has not been called yet\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n\n\nplotting other optical parameters for each cast\n# Loop through each CTD cast\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # Assuming each sublist contains only one relevant CTD object\n  tryCatch({\n    # Extract metadata for station name and cruise ID\n    station_name &lt;- cast@metadata$station[1]\n    cruise_id &lt;- cast@data$cruise_id[1]\n\n    # Generate a title with station name and cruise ID\n    overall_title &lt;- glue::glue(\"Station: {station_name}, Cruise ID: {cruise_id}\")\n\n    # Set margins: increase the outer margin for the title\n    par(oma = c(0, 0, 3, 0))  # Top outer margin increased for title\n\n    # Plotting function with specific parameters\n    oce::plot(\n      x = ctdDecimate(ctdTrim(cast)),\n      which = c(\n        \"photosynthetically_available_radiation\",\n        \"beam_attenuation\",\"beam_transmission\"\n      ),\n      main = \"\"  # No main title for individual subplots\n    )\n\n    # Place a single overall title at the top of the plot frame\n    mtext(overall_title, side = 3, line = 1, outer = TRUE, cex = 1.5)\n\n    # Reset outer margins to default\n    par(oma = c(0, 0, 0, 0))\n\n  }, error = function(e) {\n    print(e$message)  # Print any errors that occur during plotting\n  })\n}\n\n\n[1] \"plot.new has not been called yet\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n\n\nloop through every cast, clean, & save\ncombined_df &lt;- data.frame()\nfor (i in seq(ctd_FK)){\n  tryCatch({\n    cast &lt;- ctd_FK[[i]]  # 1 is selecting only the first sublist\n    \n    # print(class(cast))\n    # clean cast \n    trimmed_cast &lt;- ctdTrim(cast)\n    decimated_cast &lt;- ctdDecimate(trimmed_cast, p = 0.5)  # binned to 0.5 m\n    \n    # convert to df\n    cast_df &lt;- as.data.frame(decimated_cast@data)\n    \n    # Add metadata\n    # assumes station ID and cruise ID the same for all & just uses 1st one\n    cast_df &lt;- mutate(\n      cast_df,\n      station = cast@data$station[1],\n      cruise_id = cast@data$cruise_id[1]\n    )\n  \n    # drop NA rows left by cleaning\n    cast_df &lt;- subset(cast_df, !is.na(scan))\n    \n    # Append the data to the combined dataframe\n    combined_df &lt;- rbind(combined_df, cast_df)\n  }, error = function(e){\n    print(glue(\"error in cast {cast@metadata$station[1]}\"))\n    print(e)\n  })\n}\n# Save to CSV\nfile_path &lt;- here(glue(\"data/cleaned/{cruise_id}.csv\"))\nwrite.csv(combined_df, file_path, row.names = FALSE)"
  },
  {
    "objectID": "cruise_report/cruise_reports/WS22141.html",
    "href": "cruise_report/cruise_reports/WS22141.html",
    "title": "WS22141",
    "section": "",
    "text": "WS22141\n\n\nsetup\nif (!nzchar(system.file(package = \"librarian\"))) {\n  install.packages(\"librarian\")\n}\n\nlibrarian::shelf(\n  quiet = TRUE,\n  readr, here, fs, ggplot2, glue, \"jiho/castr\", dplyr, oce, patchwork, purrr, tidyr\n)\n\n\n\n\nCode\nsource(here(\"R/cruise_load.R\"))\ncruise_df &lt;- cruise_load(params$cruise_id)\n\n\n\n\nplot depth & pressure vs time elapsed\ntryCatch({\n  plots &lt;- list()\n  \n  for (station_name in unique(cruise_df$station)) {\n    subset_df &lt;- filter(cruise_df, station == station_name)\n    plots[[station_name]] &lt;- ggplot(subset_df, aes(x = time_elapsed)) +\n      geom_point(aes(y = depth), color = \"blue\") +  # Plot depth in blue\n      geom_line(aes(y = sea_water_pressure), color = \"red\") +  # Plot sea water pressure in red\n      ggtitle(glue(\"{station_name}\")) +\n      theme(\n        axis.title.x = element_blank(),\n        axis.title.y = element_blank(),\n        axis.text.x = element_blank(),\n        axis.text.y = element_blank(),\n        axis.ticks.x = element_blank(),\n        axis.ticks.y = element_blank()\n      )  # Remove individual axis titles and text\n  }\n  \n  # drop nulls\n  plots &lt;- purrr::compact(plots)\n  \n  # Combine all plots into a grid\n  combined_plot &lt;- wrap_plots(plots) + \n    plot_layout(ncol = 4) +  # Adjust ncol to set number of columns in the grid\n    plot_annotation(\n      title = \"Depth (blue) and Pressure (red)\",\n      subtitle = \"Each panel represents a different station\",\n      caption = \"Time Elapsed (x-axis) vs Depth & Pressure (y-axis)\"\n    ) +\n    theme(\n      plot.tag = element_text(size = 12, face = \"bold\"),\n      plot.tag.position = \"topleft\",\n      axis.title.x = element_text(margin = margin(t = 10)),\n      axis.title.y = element_text(margin = margin(r = 10))\n    )\n  \n  print(combined_plot)\n}, error = function(er){\n  print(er)\n});\n\n\n\n\n\n\n\n\n\n\n\nplot across all stations\np &lt;- ggplot(cruise_df, aes(x = time, y = depth, fill = station)) +\n  geom_col() +  # This creates the bars\n  # geom_text(aes(label = station), vjust = -0.3) +  # This adds labels to each bar, adjust vjust for position\n  labs(x = \"Time\", y = \"Depth\", title = \"Depth over Time by Station\") +  # Set labels and title\n  theme_minimal()  # Use a minimal theme\nprint(p)\n\n\n\n\n\n\n\n\n\n\n\ncreate oce.ctd objects from dataframes\nctd_load &lt;- function(data, other_params = NULL) {\n  \n  # create csv into ctd object\n  test_ctd &lt;-\n    as.ctd(\n      salinity    = data$sea_water_salinity,\n      temperature = data$sea_water_temperature,\n      pressure    = data$sea_water_pressure,\n      station     = data$station\n    )\n  \n  # add additional columns to ctd object\n  if (!is.null(other_params)) {\n    for (param_name in other_params) {\n      test_ctd &lt;-\n        oceSetData(\n          object = test_ctd,\n          name   = param_name,\n          value  = data[[param_name]]\n        )\n    }\n  }\n  print(glue(\"{data$station[1]}:\\t{length(test_ctd@data$scan)} scans\"))\n\n\n  return(test_ctd)\n}\n\n# Define other parameters to add\nother_params &lt;- c(\n  \"cruise_id\", \"station\", \"time\", \"time_elapsed\", \n  \"latitude\", \"longitude\", \"sea_water_electrical_conductivity\", \n  \"CDOM\", \"dissolved_oxygen\",\"oxygen_saturation\", \"chlorophyll_concentration\", \n  \"chlorophyll_fluorescence\", \"photosynthetically_available_radiation\", \n  \"beam_attenuation\",\"beam_transmission\", \"depth\", \"sea_water_sigma_t\",\n  \"descent_rate\", \"sound_velocity\",\"altimeter\"\n)\n\n# Split data by station and create data list\nctd_FK &lt;- cruise_df %&gt;%\n  split(.$station) %&gt;%\n  map(~ ctd_load(.x, other_params = other_params)) # ~ is a lambda(x)\n\n\n.002:   2832 scans\n.007:   22 scans\n.009:   4657 scans\n.0095:  7366 scans\n.010:   2780 scans\n.012:   4476 scans\n.016:   3203 scans\n.018:   2686 scans\n.030:   3887 scans\n.031:   3506 scans\n.033:   2932 scans\n.041:   2833 scans\n.045:   3832 scans\n.047:   2538 scans\n.049:   154 scans\n.051:   2227 scans\n.053:   37 scans\n.054:   160 scans\n.055:   581 scans\n.056:   646 scans\n.057:   2275 scans\n.0571:  2566 scans\n.0572:  3072 scans\n.0573:  3302 scans\n.058:   3199 scans\n.060:   3074 scans\n.064:   162 scans\n.065:   3418 scans\n.068:   2501 scans\n.21LK:  4092 scans\n.AMI1:  3172 scans\n.AMI2:  3720 scans\n.AMI3:  3184 scans\n.AMI4:  3835 scans\n.AMI5:  4171 scans\n.AMI6:  3678 scans\n.AMI7:  4053 scans\n.AMI8:  4786 scans\n.AMI9:  5258 scans\n.BG1:   3041 scans\n.BG2:   3418 scans\n.BG3:   3386 scans\n.BG4:   3670 scans\n.CAL1:  2338 scans\n.CAL2:  2391 scans\n.CAL3:  3493 scans\n.CAL4:  3906 scans\n.CAL5:  4630 scans\n.GP5:   3615 scans\n.KW1:   3199 scans\n.KW2:   3298 scans\n.KW4:   3684 scans\n.MR:    4390 scans\n.RP1:   195 scans\n.RP2:   2969 scans\n.RP3:   2859 scans\n.RP4:   2999 scans\n.TB1:   2774 scans\n.TB10:  3945 scans\n.TB2:   3813 scans\n.TB3:   4151 scans\n.TB4:   3917 scans\n.TB5:   4014 scans\n.V1:    3447 scans\n.V2:    4213 scans\n.V3:    3561 scans\n.V4:    3728 scans\n.V5:    4217 scans\n.V6:    4331 scans\n.V7:    3700 scans\n.V8:    4629 scans\n.V9:    5525 scans\n.WS:    4345 scans\n\n\n\n\nplotting scans for each cast in the first list\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # 1 is selecting only the first sublist\n  # print(i)\n  print(glue(\"=== station: {cast@metadata$station[1]}\"))\n  print(glue(\"# scans: {length(cast@data$scan)}\"))\n  plotScan(cast)\n}\n\n\n=== station: .002\n# scans: 2832\n\n\n\n\n\n\n\n\n\n=== station: .007\n# scans: 22\n\n\n\n\n\n\n\n\n\n=== station: .009\n# scans: 4657\n\n\n\n\n\n\n\n\n\n=== station: .0095\n# scans: 7366\n\n\n\n\n\n\n\n\n\n=== station: .010\n# scans: 2780\n\n\n\n\n\n\n\n\n\n=== station: .012\n# scans: 4476\n\n\n\n\n\n\n\n\n\n=== station: .016\n# scans: 3203\n\n\n\n\n\n\n\n\n\n=== station: .018\n# scans: 2686\n\n\n\n\n\n\n\n\n\n=== station: .030\n# scans: 3887\n\n\n\n\n\n\n\n\n\n=== station: .031\n# scans: 3506\n\n\n\n\n\n\n\n\n\n=== station: .033\n# scans: 2932\n\n\n\n\n\n\n\n\n\n=== station: .041\n# scans: 2833\n\n\n\n\n\n\n\n\n\n=== station: .045\n# scans: 3832\n\n\n\n\n\n\n\n\n\n=== station: .047\n# scans: 2538\n\n\n\n\n\n\n\n\n\n=== station: .049\n# scans: 154\n\n\n\n\n\n\n\n\n\n=== station: .051\n# scans: 2227\n\n\n\n\n\n\n\n\n\n=== station: .053\n# scans: 37\n\n\n\n\n\n\n\n\n\n=== station: .054\n# scans: 160\n\n\n\n\n\n\n\n\n\n=== station: .055\n# scans: 581\n\n\n\n\n\n\n\n\n\n=== station: .056\n# scans: 646\n\n\n\n\n\n\n\n\n\n=== station: .057\n# scans: 2275\n\n\n\n\n\n\n\n\n\n=== station: .0571\n# scans: 2566\n\n\n\n\n\n\n\n\n\n=== station: .0572\n# scans: 3072\n\n\n\n\n\n\n\n\n\n=== station: .0573\n# scans: 3302\n\n\n\n\n\n\n\n\n\n=== station: .058\n# scans: 3199\n\n\n\n\n\n\n\n\n\n=== station: .060\n# scans: 3074\n\n\n\n\n\n\n\n\n\n=== station: .064\n# scans: 162\n\n\n\n\n\n\n\n\n\n=== station: .065\n# scans: 3418\n\n\n\n\n\n\n\n\n\n=== station: .068\n# scans: 2501\n\n\n\n\n\n\n\n\n\n=== station: .21LK\n# scans: 4092\n\n\n\n\n\n\n\n\n\n=== station: .AMI1\n# scans: 3172\n\n\n\n\n\n\n\n\n\n=== station: .AMI2\n# scans: 3720\n\n\n\n\n\n\n\n\n\n=== station: .AMI3\n# scans: 3184\n\n\n\n\n\n\n\n\n\n=== station: .AMI4\n# scans: 3835\n\n\n\n\n\n\n\n\n\n=== station: .AMI5\n# scans: 4171\n\n\n\n\n\n\n\n\n\n=== station: .AMI6\n# scans: 3678\n\n\n\n\n\n\n\n\n\n=== station: .AMI7\n# scans: 4053\n\n\n\n\n\n\n\n\n\n=== station: .AMI8\n# scans: 4786\n\n\n\n\n\n\n\n\n\n=== station: .AMI9\n# scans: 5258\n\n\n\n\n\n\n\n\n\n=== station: .BG1\n# scans: 3041\n\n\n\n\n\n\n\n\n\n=== station: .BG2\n# scans: 3418\n\n\n\n\n\n\n\n\n\n=== station: .BG3\n# scans: 3386\n\n\n\n\n\n\n\n\n\n=== station: .BG4\n# scans: 3670\n\n\n\n\n\n\n\n\n\n=== station: .CAL1\n# scans: 2338\n\n\n\n\n\n\n\n\n\n=== station: .CAL2\n# scans: 2391\n\n\n\n\n\n\n\n\n\n=== station: .CAL3\n# scans: 3493\n\n\n\n\n\n\n\n\n\n=== station: .CAL4\n# scans: 3906\n\n\n\n\n\n\n\n\n\n=== station: .CAL5\n# scans: 4630\n\n\n\n\n\n\n\n\n\n=== station: .GP5\n# scans: 3615\n\n\n\n\n\n\n\n\n\n=== station: .KW1\n# scans: 3199\n\n\n\n\n\n\n\n\n\n=== station: .KW2\n# scans: 3298\n\n\n\n\n\n\n\n\n\n=== station: .KW4\n# scans: 3684\n\n\n\n\n\n\n\n\n\n=== station: .MR\n# scans: 4390\n\n\n\n\n\n\n\n\n\n=== station: .RP1\n# scans: 195\n\n\n\n\n\n\n\n\n\n=== station: .RP2\n# scans: 2969\n\n\n\n\n\n\n\n\n\n=== station: .RP3\n# scans: 2859\n\n\n\n\n\n\n\n\n\n=== station: .RP4\n# scans: 2999\n\n\n\n\n\n\n\n\n\n=== station: .TB1\n# scans: 2774\n\n\n\n\n\n\n\n\n\n=== station: .TB10\n# scans: 3945\n\n\n\n\n\n\n\n\n\n=== station: .TB2\n# scans: 3813\n\n\n\n\n\n\n\n\n\n=== station: .TB3\n# scans: 4151\n\n\n\n\n\n\n\n\n\n=== station: .TB4\n# scans: 3917\n\n\n\n\n\n\n\n\n\n=== station: .TB5\n# scans: 4014\n\n\n\n\n\n\n\n\n\n=== station: .V1\n# scans: 3447\n\n\n\n\n\n\n\n\n\n=== station: .V2\n# scans: 4213\n\n\n\n\n\n\n\n\n\n=== station: .V3\n# scans: 3561\n\n\n\n\n\n\n\n\n\n=== station: .V4\n# scans: 3728\n\n\n\n\n\n\n\n\n\n=== station: .V5\n# scans: 4217\n\n\n\n\n\n\n\n\n\n=== station: .V6\n# scans: 4331\n\n\n\n\n\n\n\n\n\n=== station: .V7\n# scans: 3700\n\n\n\n\n\n\n\n\n\n=== station: .V8\n# scans: 4629\n\n\n\n\n\n\n\n\n\n=== station: .V9\n# scans: 5525\n\n\n\n\n\n\n\n\n\n=== station: .WS\n# scans: 4345\n\n\n\n\n\n\n\n\n\n\n\nplotting each cast in the first list\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # 1 is selecting only the first sublist\n  tryCatch({\n    plot(ctdDecimate(ctdTrim(cast)))\n  }, error = function(e){\n    print(e)\n  })\n}\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2832' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4657' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 7366' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2780' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4476' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3203' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2686' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3887' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3506' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2932' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2833' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3832' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2538' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2227' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 581' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 646' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2275' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2566' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3072' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3302' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3199' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3074' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3418' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2501' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4092' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3172' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3720' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3184' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3835' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4171' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3678' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4053' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4786' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 5258' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3041' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3418' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3386' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3670' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2338' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2391' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3493' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3906' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4630' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3615' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3199' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3298' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3684' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4390' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 195' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2969' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2859' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2999' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2774' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3945' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3813' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4151' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3917' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4014' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3447' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4213' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3561' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3728' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4217' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4331' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3700' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4629' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 5525' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4345' in coercion to 'logical(1)'&gt;\n\n\n\n\nplotting other physical parameters for each cast\n# Loop through each CTD cast\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # Assuming each sublist contains only one relevant CTD object\n  tryCatch({\n    # Extract metadata for station name and cruise ID\n    station_name &lt;- cast@metadata$station[1]\n    cruise_id &lt;- cast@data$cruise_id[1]\n\n    # Generate a title with station name and cruise ID\n    overall_title &lt;- glue::glue(\"Station: {station_name}, Cruise ID: {cruise_id}\")\n\n    # Set margins: increase the outer margin for the title\n    par(oma = c(0, 0, 3, 0))  # Top outer margin increased for title\n\n    # Plotting function with specific parameters\n    oce::plot(\n      x = ctdDecimate(ctdTrim(cast)),\n      which = c(\n        \"sea_water_electrical_conductivity\",\n        \"descent_rate\", \"sound_velocity\",\n        \"sea_water_sigma_t\",\"altimeter\"\n      ),\n      main = \"\"  # No main title for individual subplots\n    )\n\n    # Place a single overall title at the top of the plot frame\n    mtext(overall_title, side = 3, line = 1, outer = TRUE, cex = 1.5)\n\n    # Reset outer margins to default\n    par(oma = c(0, 0, 0, 0))\n\n  }, error = function(e) {\n    print(e$message)  # Print any errors that occur during plotting\n  })\n}\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n\n\nplotting other nutrient parameters for each cast\n# Loop through each CTD cast\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # Assuming each sublist contains only one relevant CTD object\n  tryCatch({\n    # Extract metadata for station name and cruise ID\n    station_name &lt;- cast@metadata$station[1]\n    cruise_id &lt;- cast@data$cruise_id[1]\n\n    # Generate a title with station name and cruise ID\n    overall_title &lt;- glue::glue(\"Station: {station_name}, Cruise ID: {cruise_id}\")\n\n    # Set margins: increase the outer margin for the title\n    par(oma = c(0, 0, 3, 0))  # Top outer margin increased for title\n\n    # Plotting function with specific parameters\n    oce::plot(\n      x = ctdDecimate(ctdTrim(cast)),\n      which = c(\n        \"CDOM\", \"dissolved_oxygen\",\n        \"oxygen_saturation\",\n        \"chlorophyll_concentration\", \"chlorophyll_fluorescence\"\n      ),\n      main = \"\"  # No main title for individual subplots\n    )\n\n    # Place a single overall title at the top of the plot frame\n    mtext(overall_title, side = 3, line = 1, outer = TRUE, cex = 1.5)\n\n    # Reset outer margins to default\n    par(oma = c(0, 0, 0, 0))\n\n  }, error = function(e) {\n    print(e$message)  # Print any errors that occur during plotting\n  })\n}\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n\n\nplotting other optical parameters for each cast\n# Loop through each CTD cast\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # Assuming each sublist contains only one relevant CTD object\n  tryCatch({\n    # Extract metadata for station name and cruise ID\n    station_name &lt;- cast@metadata$station[1]\n    cruise_id &lt;- cast@data$cruise_id[1]\n\n    # Generate a title with station name and cruise ID\n    overall_title &lt;- glue::glue(\"Station: {station_name}, Cruise ID: {cruise_id}\")\n\n    # Set margins: increase the outer margin for the title\n    par(oma = c(0, 0, 3, 0))  # Top outer margin increased for title\n\n    # Plotting function with specific parameters\n    oce::plot(\n      x = ctdDecimate(ctdTrim(cast)),\n      which = c(\n        \"photosynthetically_available_radiation\",\n        \"beam_attenuation\",\"beam_transmission\"\n      ),\n      main = \"\"  # No main title for individual subplots\n    )\n\n    # Place a single overall title at the top of the plot frame\n    mtext(overall_title, side = 3, line = 1, outer = TRUE, cex = 1.5)\n\n    # Reset outer margins to default\n    par(oma = c(0, 0, 0, 0))\n\n  }, error = function(e) {\n    print(e$message)  # Print any errors that occur during plotting\n  })\n}\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n\n\nloop through every cast, clean, & save\ncombined_df &lt;- data.frame()\nfor (i in seq(ctd_FK)){\n  tryCatch({\n    cast &lt;- ctd_FK[[i]]  # 1 is selecting only the first sublist\n    \n    # print(class(cast))\n    # clean cast \n    trimmed_cast &lt;- ctdTrim(cast)\n    decimated_cast &lt;- ctdDecimate(trimmed_cast, p = 0.5)  # binned to 0.5 m\n    \n    # convert to df\n    cast_df &lt;- as.data.frame(decimated_cast@data)\n    \n    # Add metadata\n    # assumes station ID and cruise ID the same for all & just uses 1st one\n    cast_df &lt;- mutate(\n      cast_df,\n      station = cast@data$station[1],\n      cruise_id = cast@data$cruise_id[1]\n    )\n  \n    # drop NA rows left by cleaning\n    cast_df &lt;- subset(cast_df, !is.na(scan))\n    \n    # Append the data to the combined dataframe\n    combined_df &lt;- rbind(combined_df, cast_df)\n  }, error = function(e){\n    print(glue(\"error in cast {cast@metadata$station[1]}\"))\n    print(e)\n  })\n}\n# Save to CSV\nfile_path &lt;- here(glue(\"data/cleaned/{cruise_id}.csv\"))\nwrite.csv(combined_df, file_path, row.names = FALSE)"
  },
  {
    "objectID": "cruise_report/cruise_reports/WS22281.html",
    "href": "cruise_report/cruise_reports/WS22281.html",
    "title": "WS22281",
    "section": "",
    "text": "WS22281\n\n\nsetup\nif (!nzchar(system.file(package = \"librarian\"))) {\n  install.packages(\"librarian\")\n}\n\nlibrarian::shelf(\n  quiet = TRUE,\n  readr, here, fs, ggplot2, glue, \"jiho/castr\", dplyr, oce, patchwork, purrr, tidyr\n)\n\n\n\n\nCode\nsource(here(\"R/cruise_load.R\"))\ncruise_df &lt;- cruise_load(params$cruise_id)\n\n\n\n\nplot depth & pressure vs time elapsed\ntryCatch({\n  plots &lt;- list()\n  \n  for (station_name in unique(cruise_df$station)) {\n    subset_df &lt;- filter(cruise_df, station == station_name)\n    plots[[station_name]] &lt;- ggplot(subset_df, aes(x = time_elapsed)) +\n      geom_point(aes(y = depth), color = \"blue\") +  # Plot depth in blue\n      geom_line(aes(y = sea_water_pressure), color = \"red\") +  # Plot sea water pressure in red\n      ggtitle(glue(\"{station_name}\")) +\n      theme(\n        axis.title.x = element_blank(),\n        axis.title.y = element_blank(),\n        axis.text.x = element_blank(),\n        axis.text.y = element_blank(),\n        axis.ticks.x = element_blank(),\n        axis.ticks.y = element_blank()\n      )  # Remove individual axis titles and text\n  }\n  \n  # drop nulls\n  plots &lt;- purrr::compact(plots)\n  \n  # Combine all plots into a grid\n  combined_plot &lt;- wrap_plots(plots) + \n    plot_layout(ncol = 4) +  # Adjust ncol to set number of columns in the grid\n    plot_annotation(\n      title = \"Depth (blue) and Pressure (red)\",\n      subtitle = \"Each panel represents a different station\",\n      caption = \"Time Elapsed (x-axis) vs Depth & Pressure (y-axis)\"\n    ) +\n    theme(\n      plot.tag = element_text(size = 12, face = \"bold\"),\n      plot.tag.position = \"topleft\",\n      axis.title.x = element_text(margin = margin(t = 10)),\n      axis.title.y = element_text(margin = margin(r = 10))\n    )\n  \n  print(combined_plot)\n}, error = function(er){\n  print(er)\n});\n\n\n\n\n\n\n\n\n\n\n\nplot across all stations\np &lt;- ggplot(cruise_df, aes(x = time, y = depth, fill = station)) +\n  geom_col() +  # This creates the bars\n  # geom_text(aes(label = station), vjust = -0.3) +  # This adds labels to each bar, adjust vjust for position\n  labs(x = \"Time\", y = \"Depth\", title = \"Depth over Time by Station\") +  # Set labels and title\n  theme_minimal()  # Use a minimal theme\nprint(p)\n\n\n\n\n\n\n\n\n\n\n\ncreate oce.ctd objects from dataframes\nctd_load &lt;- function(data, other_params = NULL) {\n  \n  # create csv into ctd object\n  test_ctd &lt;-\n    as.ctd(\n      salinity    = data$sea_water_salinity,\n      temperature = data$sea_water_temperature,\n      pressure    = data$sea_water_pressure,\n      station     = data$station\n    )\n  \n  # add additional columns to ctd object\n  if (!is.null(other_params)) {\n    for (param_name in other_params) {\n      test_ctd &lt;-\n        oceSetData(\n          object = test_ctd,\n          name   = param_name,\n          value  = data[[param_name]]\n        )\n    }\n  }\n  print(glue(\"{data$station[1]}:\\t{length(test_ctd@data$scan)} scans\"))\n\n\n  return(test_ctd)\n}\n\n# Define other parameters to add\nother_params &lt;- c(\n  \"cruise_id\", \"station\", \"time\", \"time_elapsed\", \n  \"latitude\", \"longitude\", \"sea_water_electrical_conductivity\", \n  \"CDOM\", \"dissolved_oxygen\",\"oxygen_saturation\", \"chlorophyll_concentration\", \n  \"chlorophyll_fluorescence\", \"photosynthetically_available_radiation\", \n  \"beam_attenuation\",\"beam_transmission\", \"depth\", \"sea_water_sigma_t\",\n  \"descent_rate\", \"sound_velocity\",\"altimeter\"\n)\n\n# Split data by station and create data list\nctd_FK &lt;- cruise_df %&gt;%\n  split(.$station) %&gt;%\n  map(~ ctd_load(.x, other_params = other_params)) # ~ is a lambda(x)\n\n\n002:    3329 scans\n007:    22 scans\n009:    5577 scans\n009.5:  17040 scans\n010:    5868 scans\n012:    4897 scans\n016:    2820 scans\n018:    3619 scans\n030:    3807 scans\n031:    4003 scans\n033:    3733 scans\n041:    3017 scans\n045:    2864 scans\n047:    2821 scans\n049:    2309 scans\n051:    2356 scans\n053:    19 scans\n054:    2284 scans\n055:    681 scans\n057.1:  3155 scans\n057.2:  2666 scans\n057.3:  3022 scans\n058:    3600 scans\n21LK:   5426 scans\n55: 89 scans\n56: 5293 scans\n57: 2372 scans\n60: 2719 scans\n64: 2485 scans\n65: 3338 scans\n68: 3006 scans\nAMI1:   2880 scans\nAMI2:   3457 scans\nAMI3:   3452 scans\nAMI4:   4243 scans\nAMI5:   5102 scans\nAMI6:   5423 scans\nAMI7:   5566 scans\nAMI8:   4717 scans\nAMI9:   5078 scans\nBG1:    3347 scans\nBG2:    3667 scans\nBG3:    3262 scans\nBG4:    3332 scans\nCAL1:   2141 scans\nCAL2:   3346 scans\nCAL3:   2738 scans\nCAL4:   3008 scans\nCAL5:   5370 scans\nCAL6:   4438 scans\nGLIDER: 4688 scans\nGP5:    4695 scans\nI1: 4715 scans\nKW1:    3195 scans\nKW2:    3359 scans\nKW4:    4261 scans\nMR: 5153 scans\nRP1:    2391 scans\nRP2:    3466 scans\nRP3:    3042 scans\nRP4:    3950 scans\nTB1:    2723 scans\nTB10:   4453 scans\nTB2:    3367 scans\nTB3:    3741 scans\nTB4:    4076 scans\nTB5:    5237 scans\nV1: 3088 scans\nV2: 3381 scans\nV3: 3898 scans\nV4: 3835 scans\nV5: 4361 scans\nV6: 4321 scans\nV7: 3731 scans\nV8: 4568 scans\nV9: 5041 scans\nWS: 4263 scans\n\n\n\n\nplotting scans for each cast in the first list\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # 1 is selecting only the first sublist\n  # print(i)\n  print(glue(\"=== station: {cast@metadata$station[1]}\"))\n  print(glue(\"# scans: {length(cast@data$scan)}\"))\n  plotScan(cast)\n}\n\n\n=== station: 002\n# scans: 3329\n\n\n\n\n\n\n\n\n\n=== station: 007\n# scans: 22\n\n\n\n\n\n\n\n\n\n=== station: 009\n# scans: 5577\n\n\n\n\n\n\n\n\n\n=== station: 009.5\n# scans: 17040\n\n\n\n\n\n\n\n\n\n=== station: 010\n# scans: 5868\n\n\n\n\n\n\n\n\n\n=== station: 012\n# scans: 4897\n\n\n\n\n\n\n\n\n\n=== station: 016\n# scans: 2820\n\n\n\n\n\n\n\n\n\n=== station: 018\n# scans: 3619\n\n\n\n\n\n\n\n\n\n=== station: 030\n# scans: 3807\n\n\n\n\n\n\n\n\n\n=== station: 031\n# scans: 4003\n\n\n\n\n\n\n\n\n\n=== station: 033\n# scans: 3733\n\n\n\n\n\n\n\n\n\n=== station: 041\n# scans: 3017\n\n\n\n\n\n\n\n\n\n=== station: 045\n# scans: 2864\n\n\n\n\n\n\n\n\n\n=== station: 047\n# scans: 2821\n\n\n\n\n\n\n\n\n\n=== station: 049\n# scans: 2309\n\n\n\n\n\n\n\n\n\n=== station: 051\n# scans: 2356\n\n\n\n\n\n\n\n\n\n=== station: 053\n# scans: 19\n\n\n\n\n\n\n\n\n\n=== station: 054\n# scans: 2284\n\n\n\n\n\n\n\n\n\n=== station: 055\n# scans: 681\n\n\n\n\n\n\n\n\n\n=== station: 057.1\n# scans: 3155\n\n\n\n\n\n\n\n\n\n=== station: 057.2\n# scans: 2666\n\n\n\n\n\n\n\n\n\n=== station: 057.3\n# scans: 3022\n\n\n\n\n\n\n\n\n\n=== station: 058\n# scans: 3600\n\n\n\n\n\n\n\n\n\n=== station: 21LK\n# scans: 5426\n\n\n\n\n\n\n\n\n\n=== station: 55\n# scans: 89\n\n\n\n\n\n\n\n\n\n=== station: 56\n# scans: 5293\n\n\n\n\n\n\n\n\n\n=== station: 57\n# scans: 2372\n\n\n\n\n\n\n\n\n\n=== station: 60\n# scans: 2719\n\n\n\n\n\n\n\n\n\n=== station: 64\n# scans: 2485\n\n\n\n\n\n\n\n\n\n=== station: 65\n# scans: 3338\n\n\n\n\n\n\n\n\n\n=== station: 68\n# scans: 3006\n\n\n\n\n\n\n\n\n\n=== station: AMI1\n# scans: 2880\n\n\n\n\n\n\n\n\n\n=== station: AMI2\n# scans: 3457\n\n\n\n\n\n\n\n\n\n=== station: AMI3\n# scans: 3452\n\n\n\n\n\n\n\n\n\n=== station: AMI4\n# scans: 4243\n\n\n\n\n\n\n\n\n\n=== station: AMI5\n# scans: 5102\n\n\n\n\n\n\n\n\n\n=== station: AMI6\n# scans: 5423\n\n\n\n\n\n\n\n\n\n=== station: AMI7\n# scans: 5566\n\n\n\n\n\n\n\n\n\n=== station: AMI8\n# scans: 4717\n\n\n\n\n\n\n\n\n\n=== station: AMI9\n# scans: 5078\n\n\n\n\n\n\n\n\n\n=== station: BG1\n# scans: 3347\n\n\n\n\n\n\n\n\n\n=== station: BG2\n# scans: 3667\n\n\n\n\n\n\n\n\n\n=== station: BG3\n# scans: 3262\n\n\n\n\n\n\n\n\n\n=== station: BG4\n# scans: 3332\n\n\n\n\n\n\n\n\n\n=== station: CAL1\n# scans: 2141\n\n\n\n\n\n\n\n\n\n=== station: CAL2\n# scans: 3346\n\n\n\n\n\n\n\n\n\n=== station: CAL3\n# scans: 2738\n\n\n\n\n\n\n\n\n\n=== station: CAL4\n# scans: 3008\n\n\n\n\n\n\n\n\n\n=== station: CAL5\n# scans: 5370\n\n\n\n\n\n\n\n\n\n=== station: CAL6\n# scans: 4438\n\n\n\n\n\n\n\n\n\n=== station: GLIDER\n# scans: 4688\n\n\n\n\n\n\n\n\n\n=== station: GP5\n# scans: 4695\n\n\n\n\n\n\n\n\n\n=== station: I1\n# scans: 4715\n\n\n\n\n\n\n\n\n\n=== station: KW1\n# scans: 3195\n\n\n\n\n\n\n\n\n\n=== station: KW2\n# scans: 3359\n\n\n\n\n\n\n\n\n\n=== station: KW4\n# scans: 4261\n\n\n\n\n\n\n\n\n\n=== station: MR\n# scans: 5153\n\n\n\n\n\n\n\n\n\n=== station: RP1\n# scans: 2391\n\n\n\n\n\n\n\n\n\n=== station: RP2\n# scans: 3466\n\n\n\n\n\n\n\n\n\n=== station: RP3\n# scans: 3042\n\n\n\n\n\n\n\n\n\n=== station: RP4\n# scans: 3950\n\n\n\n\n\n\n\n\n\n=== station: TB1\n# scans: 2723\n\n\n\n\n\n\n\n\n\n=== station: TB10\n# scans: 4453\n\n\n\n\n\n\n\n\n\n=== station: TB2\n# scans: 3367\n\n\n\n\n\n\n\n\n\n=== station: TB3\n# scans: 3741\n\n\n\n\n\n\n\n\n\n=== station: TB4\n# scans: 4076\n\n\n\n\n\n\n\n\n\n=== station: TB5\n# scans: 5237\n\n\n\n\n\n\n\n\n\n=== station: V1\n# scans: 3088\n\n\n\n\n\n\n\n\n\n=== station: V2\n# scans: 3381\n\n\n\n\n\n\n\n\n\n=== station: V3\n# scans: 3898\n\n\n\n\n\n\n\n\n\n=== station: V4\n# scans: 3835\n\n\n\n\n\n\n\n\n\n=== station: V5\n# scans: 4361\n\n\n\n\n\n\n\n\n\n=== station: V6\n# scans: 4321\n\n\n\n\n\n\n\n\n\n=== station: V7\n# scans: 3731\n\n\n\n\n\n\n\n\n\n=== station: V8\n# scans: 4568\n\n\n\n\n\n\n\n\n\n=== station: V9\n# scans: 5041\n\n\n\n\n\n\n\n\n\n=== station: WS\n# scans: 4263\n\n\n\n\n\n\n\n\n\n\n\nplotting each cast in the first list\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # 1 is selecting only the first sublist\n  tryCatch({\n    plot(ctdDecimate(ctdTrim(cast)))\n  }, error = function(e){\n    print(e)\n  })\n}\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3329' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 5577' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 17040' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 5868' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4897' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2820' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3619' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3807' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4003' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3733' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3017' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2864' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2821' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2309' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2356' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2284' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 681' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3155' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2666' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3022' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3600' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 5426' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 5293' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2372' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2719' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2485' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3338' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3006' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2880' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3457' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3452' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4243' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 5102' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 5423' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 5566' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4717' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 5078' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3347' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3667' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3262' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3332' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2141' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3346' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2738' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3008' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 5370' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4438' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4688' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4695' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4715' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3195' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3359' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4261' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 5153' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2391' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3466' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3042' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3950' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2723' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4453' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3367' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3741' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4076' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 5237' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3088' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3381' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3898' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3835' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4361' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4321' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3731' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4568' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 5041' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4263' in coercion to 'logical(1)'&gt;\n\n\n\n\nplotting other physical parameters for each cast\n# Loop through each CTD cast\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # Assuming each sublist contains only one relevant CTD object\n  tryCatch({\n    # Extract metadata for station name and cruise ID\n    station_name &lt;- cast@metadata$station[1]\n    cruise_id &lt;- cast@data$cruise_id[1]\n\n    # Generate a title with station name and cruise ID\n    overall_title &lt;- glue::glue(\"Station: {station_name}, Cruise ID: {cruise_id}\")\n\n    # Set margins: increase the outer margin for the title\n    par(oma = c(0, 0, 3, 0))  # Top outer margin increased for title\n\n    # Plotting function with specific parameters\n    oce::plot(\n      x = ctdDecimate(ctdTrim(cast)),\n      which = c(\n        \"sea_water_electrical_conductivity\",\n        \"descent_rate\", \"sound_velocity\",\n        \"sea_water_sigma_t\",\"altimeter\"\n      ),\n      main = \"\"  # No main title for individual subplots\n    )\n\n    # Place a single overall title at the top of the plot frame\n    mtext(overall_title, side = 3, line = 1, outer = TRUE, cex = 1.5)\n\n    # Reset outer margins to default\n    par(oma = c(0, 0, 0, 0))\n\n  }, error = function(e) {\n    print(e$message)  # Print any errors that occur during plotting\n  })\n}\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n\n\nplotting other nutrient parameters for each cast\n# Loop through each CTD cast\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # Assuming each sublist contains only one relevant CTD object\n  tryCatch({\n    # Extract metadata for station name and cruise ID\n    station_name &lt;- cast@metadata$station[1]\n    cruise_id &lt;- cast@data$cruise_id[1]\n\n    # Generate a title with station name and cruise ID\n    overall_title &lt;- glue::glue(\"Station: {station_name}, Cruise ID: {cruise_id}\")\n\n    # Set margins: increase the outer margin for the title\n    par(oma = c(0, 0, 3, 0))  # Top outer margin increased for title\n\n    # Plotting function with specific parameters\n    oce::plot(\n      x = ctdDecimate(ctdTrim(cast)),\n      which = c(\n        \"CDOM\", \"dissolved_oxygen\",\n        \"oxygen_saturation\",\n        \"chlorophyll_concentration\", \"chlorophyll_fluorescence\"\n      ),\n      main = \"\"  # No main title for individual subplots\n    )\n\n    # Place a single overall title at the top of the plot frame\n    mtext(overall_title, side = 3, line = 1, outer = TRUE, cex = 1.5)\n\n    # Reset outer margins to default\n    par(oma = c(0, 0, 0, 0))\n\n  }, error = function(e) {\n    print(e$message)  # Print any errors that occur during plotting\n  })\n}\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n\n\nplotting other optical parameters for each cast\n# Loop through each CTD cast\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # Assuming each sublist contains only one relevant CTD object\n  tryCatch({\n    # Extract metadata for station name and cruise ID\n    station_name &lt;- cast@metadata$station[1]\n    cruise_id &lt;- cast@data$cruise_id[1]\n\n    # Generate a title with station name and cruise ID\n    overall_title &lt;- glue::glue(\"Station: {station_name}, Cruise ID: {cruise_id}\")\n\n    # Set margins: increase the outer margin for the title\n    par(oma = c(0, 0, 3, 0))  # Top outer margin increased for title\n\n    # Plotting function with specific parameters\n    oce::plot(\n      x = ctdDecimate(ctdTrim(cast)),\n      which = c(\n        \"photosynthetically_available_radiation\",\n        \"beam_attenuation\",\"beam_transmission\"\n      ),\n      main = \"\"  # No main title for individual subplots\n    )\n\n    # Place a single overall title at the top of the plot frame\n    mtext(overall_title, side = 3, line = 1, outer = TRUE, cex = 1.5)\n\n    # Reset outer margins to default\n    par(oma = c(0, 0, 0, 0))\n\n  }, error = function(e) {\n    print(e$message)  # Print any errors that occur during plotting\n  })\n}\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n\n\nloop through every cast, clean, & save\ncombined_df &lt;- data.frame()\nfor (i in seq(ctd_FK)){\n  tryCatch({\n    cast &lt;- ctd_FK[[i]]  # 1 is selecting only the first sublist\n    \n    # print(class(cast))\n    # clean cast \n    trimmed_cast &lt;- ctdTrim(cast)\n    decimated_cast &lt;- ctdDecimate(trimmed_cast, p = 0.5)  # binned to 0.5 m\n    \n    # convert to df\n    cast_df &lt;- as.data.frame(decimated_cast@data)\n    \n    # Add metadata\n    # assumes station ID and cruise ID the same for all & just uses 1st one\n    cast_df &lt;- mutate(\n      cast_df,\n      station = cast@data$station[1],\n      cruise_id = cast@data$cruise_id[1]\n    )\n  \n    # drop NA rows left by cleaning\n    cast_df &lt;- subset(cast_df, !is.na(scan))\n    \n    # Append the data to the combined dataframe\n    combined_df &lt;- rbind(combined_df, cast_df)\n  }, error = function(e){\n    print(glue(\"error in cast {cast@metadata$station[1]}\"))\n    print(e)\n  })\n}\n# Save to CSV\nfile_path &lt;- here(glue(\"data/cleaned/{cruise_id}.csv\"))\nwrite.csv(combined_df, file_path, row.names = FALSE)"
  },
  {
    "objectID": "cruise_report/cruise_reports/WS23010.html",
    "href": "cruise_report/cruise_reports/WS23010.html",
    "title": "WS23010",
    "section": "",
    "text": "WS23010\n\n\nsetup\nif (!nzchar(system.file(package = \"librarian\"))) {\n  install.packages(\"librarian\")\n}\n\nlibrarian::shelf(\n  quiet = TRUE,\n  readr, here, fs, ggplot2, glue, \"jiho/castr\", dplyr, oce, patchwork, purrr, tidyr\n)\n\n\n\n\nCode\nsource(here(\"R/cruise_load.R\"))\ncruise_df &lt;- cruise_load(params$cruise_id)\n\n\n\n\nplot depth & pressure vs time elapsed\ntryCatch({\n  plots &lt;- list()\n  \n  for (station_name in unique(cruise_df$station)) {\n    subset_df &lt;- filter(cruise_df, station == station_name)\n    plots[[station_name]] &lt;- ggplot(subset_df, aes(x = time_elapsed)) +\n      geom_point(aes(y = depth), color = \"blue\") +  # Plot depth in blue\n      geom_line(aes(y = sea_water_pressure), color = \"red\") +  # Plot sea water pressure in red\n      ggtitle(glue(\"{station_name}\")) +\n      theme(\n        axis.title.x = element_blank(),\n        axis.title.y = element_blank(),\n        axis.text.x = element_blank(),\n        axis.text.y = element_blank(),\n        axis.ticks.x = element_blank(),\n        axis.ticks.y = element_blank()\n      )  # Remove individual axis titles and text\n  }\n  \n  # drop nulls\n  plots &lt;- purrr::compact(plots)\n  \n  # Combine all plots into a grid\n  combined_plot &lt;- wrap_plots(plots) + \n    plot_layout(ncol = 4) +  # Adjust ncol to set number of columns in the grid\n    plot_annotation(\n      title = \"Depth (blue) and Pressure (red)\",\n      subtitle = \"Each panel represents a different station\",\n      caption = \"Time Elapsed (x-axis) vs Depth & Pressure (y-axis)\"\n    ) +\n    theme(\n      plot.tag = element_text(size = 12, face = \"bold\"),\n      plot.tag.position = \"topleft\",\n      axis.title.x = element_text(margin = margin(t = 10)),\n      axis.title.y = element_text(margin = margin(r = 10))\n    )\n  \n  print(combined_plot)\n}, error = function(er){\n  print(er)\n});\n\n\n\n\n\n\n\n\n\n\n\nplot across all stations\np &lt;- ggplot(cruise_df, aes(x = time, y = depth, fill = station)) +\n  geom_col() +  # This creates the bars\n  # geom_text(aes(label = station), vjust = -0.3) +  # This adds labels to each bar, adjust vjust for position\n  labs(x = \"Time\", y = \"Depth\", title = \"Depth over Time by Station\") +  # Set labels and title\n  theme_minimal()  # Use a minimal theme\nprint(p)\n\n\n\n\n\n\n\n\n\n\n\ncreate oce.ctd objects from dataframes\nctd_load &lt;- function(data, other_params = NULL) {\n  \n  # create csv into ctd object\n  test_ctd &lt;-\n    as.ctd(\n      salinity    = data$sea_water_salinity,\n      temperature = data$sea_water_temperature,\n      pressure    = data$sea_water_pressure,\n      station     = data$station\n    )\n  \n  # add additional columns to ctd object\n  if (!is.null(other_params)) {\n    for (param_name in other_params) {\n      test_ctd &lt;-\n        oceSetData(\n          object = test_ctd,\n          name   = param_name,\n          value  = data[[param_name]]\n        )\n    }\n  }\n  print(glue(\"{data$station[1]}:\\t{length(test_ctd@data$scan)} scans\"))\n\n\n  return(test_ctd)\n}\n\n# Define other parameters to add\nother_params &lt;- c(\n  \"cruise_id\", \"station\", \"time\", \"time_elapsed\", \n  \"latitude\", \"longitude\", \"sea_water_electrical_conductivity\", \n  \"CDOM\", \"dissolved_oxygen\",\"oxygen_saturation\", \"chlorophyll_concentration\", \n  \"chlorophyll_fluorescence\", \"photosynthetically_available_radiation\", \n  \"beam_attenuation\",\"beam_transmission\", \"depth\", \"sea_water_sigma_t\",\n  \"descent_rate\", \"sound_velocity\",\"altimeter\"\n)\n\n# Split data by station and create data list\nctd_FK &lt;- cruise_df %&gt;%\n  split(.$station) %&gt;%\n  map(~ ctd_load(.x, other_params = other_params)) # ~ is a lambda(x)\n\n\n.002:   2410 scans\n.007:   2635 scans\n.009:   4250 scans\n.009_5: 10157 scans\n.010:   3213 scans\n.012:   5044 scans\n.016:   3332 scans\n.018:   6207 scans\n.030:   4497 scans\n.031:   3782 scans\n.033:   2894 scans\n.041:   2952 scans\n.045:   3062 scans\n.047:   2812 scans\n.049:   144 scans\n.051:   2810 scans\n.053:   138 scans\n.054:   35 scans\n.055:   775 scans\n.056:   18 scans\n.057:   13 scans\n.057_1: 2949 scans\n.057_2: 4029 scans\n.057_3: 4266 scans\n.058:   4254 scans\n.060:   3216 scans\n.064:   92 scans\n.065:   52 scans\n.068:   2678 scans\n.21LK:  6110 scans\n.AMI1:  3459 scans\n.AMI2:  2845 scans\n.AMI3:  4106 scans\n.AMI4:  4335 scans\n.AMI5:  4708 scans\n.AMI6:  5013 scans\n.AMI7:  5509 scans\n.AMI8:  5573 scans\n.AMI9:  6866 scans\n.BG1:   3502 scans\n.BG2:   4069 scans\n.BG3:   3768 scans\n.BG4:   4155 scans\n.CAL1:  275 scans\n.CAL2:  3212 scans\n.CAL3:  3500 scans\n.CAL4:  3810 scans\n.CAL5:  4241 scans\n.CAL6:  5124 scans\n.CW1:   3244 scans\n.CW2:   3476 scans\n.CW3:   3757 scans\n.CW4:   5006 scans\n.GP5:   4612 scans\n.KW1:   3146 scans\n.KW2:   3512 scans\n.KW4:   4962 scans\n.MR:    4702 scans\n.RP1:   2899 scans\n.RP2:   3234 scans\n.RP3:   2977 scans\n.RP4:   4057 scans\n.TB1:   2999 scans\n.TB10:  9390 scans\n.TB2:   3360 scans\n.TB3:   3803 scans\n.TB4:   3603 scans\n.TB5:   5371 scans\n.V1:    2817 scans\n.V2:    4168 scans\n.V3:    5294 scans\n.V4:    4775 scans\n.V5:    4238 scans\n.V6:    4426 scans\n.V7:    5896 scans\n.V8:    5761 scans\n.V9:    4927 scans\n.WS:    3826 scans\n\n\n\n\nplotting scans for each cast in the first list\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # 1 is selecting only the first sublist\n  # print(i)\n  print(glue(\"=== station: {cast@metadata$station[1]}\"))\n  print(glue(\"# scans: {length(cast@data$scan)}\"))\n  plotScan(cast)\n}\n\n\n=== station: .002\n# scans: 2410\n\n\n\n\n\n\n\n\n\n=== station: .007\n# scans: 2635\n\n\n\n\n\n\n\n\n\n=== station: .009\n# scans: 4250\n\n\n\n\n\n\n\n\n\n=== station: .009_5\n# scans: 10157\n\n\n\n\n\n\n\n\n\n=== station: .010\n# scans: 3213\n\n\n\n\n\n\n\n\n\n=== station: .012\n# scans: 5044\n\n\n\n\n\n\n\n\n\n=== station: .016\n# scans: 3332\n\n\n\n\n\n\n\n\n\n=== station: .018\n# scans: 6207\n\n\n\n\n\n\n\n\n\n=== station: .030\n# scans: 4497\n\n\n\n\n\n\n\n\n\n=== station: .031\n# scans: 3782\n\n\n\n\n\n\n\n\n\n=== station: .033\n# scans: 2894\n\n\n\n\n\n\n\n\n\n=== station: .041\n# scans: 2952\n\n\n\n\n\n\n\n\n\n=== station: .045\n# scans: 3062\n\n\n\n\n\n\n\n\n\n=== station: .047\n# scans: 2812\n\n\n\n\n\n\n\n\n\n=== station: .049\n# scans: 144\n\n\n\n\n\n\n\n\n\n=== station: .051\n# scans: 2810\n\n\n\n\n\n\n\n\n\n=== station: .053\n# scans: 138\n\n\n\n\n\n\n\n\n\n=== station: .054\n# scans: 35\n\n\n\n\n\n\n\n\n\n=== station: .055\n# scans: 775\n\n\n\n\n\n\n\n\n\n=== station: .056\n# scans: 18\n\n\n\n\n\n\n\n\n\n=== station: .057\n# scans: 13\n\n\n\n\n\n\n\n\n\n=== station: .057_1\n# scans: 2949\n\n\n\n\n\n\n\n\n\n=== station: .057_2\n# scans: 4029\n\n\n\n\n\n\n\n\n\n=== station: .057_3\n# scans: 4266\n\n\n\n\n\n\n\n\n\n=== station: .058\n# scans: 4254\n\n\n\n\n\n\n\n\n\n=== station: .060\n# scans: 3216\n\n\n\n\n\n\n\n\n\n=== station: .064\n# scans: 92\n\n\n\n\n\n\n\n\n\n=== station: .065\n# scans: 52\n\n\n\n\n\n\n\n\n\n=== station: .068\n# scans: 2678\n\n\n\n\n\n\n\n\n\n=== station: .21LK\n# scans: 6110\n\n\n\n\n\n\n\n\n\n=== station: .AMI1\n# scans: 3459\n\n\n\n\n\n\n\n\n\n=== station: .AMI2\n# scans: 2845\n\n\n\n\n\n\n\n\n\n=== station: .AMI3\n# scans: 4106\n\n\n\n\n\n\n\n\n\n=== station: .AMI4\n# scans: 4335\n\n\n\n\n\n\n\n\n\n=== station: .AMI5\n# scans: 4708\n\n\n\n\n\n\n\n\n\n=== station: .AMI6\n# scans: 5013\n\n\n\n\n\n\n\n\n\n=== station: .AMI7\n# scans: 5509\n\n\n\n\n\n\n\n\n\n=== station: .AMI8\n# scans: 5573\n\n\n\n\n\n\n\n\n\n=== station: .AMI9\n# scans: 6866\n\n\n\n\n\n\n\n\n\n=== station: .BG1\n# scans: 3502\n\n\n\n\n\n\n\n\n\n=== station: .BG2\n# scans: 4069\n\n\n\n\n\n\n\n\n\n=== station: .BG3\n# scans: 3768\n\n\n\n\n\n\n\n\n\n=== station: .BG4\n# scans: 4155\n\n\n\n\n\n\n\n\n\n=== station: .CAL1\n# scans: 275\n\n\n\n\n\n\n\n\n\n=== station: .CAL2\n# scans: 3212\n\n\n\n\n\n\n\n\n\n=== station: .CAL3\n# scans: 3500\n\n\n\n\n\n\n\n\n\n=== station: .CAL4\n# scans: 3810\n\n\n\n\n\n\n\n\n\n=== station: .CAL5\n# scans: 4241\n\n\n\n\n\n\n\n\n\n=== station: .CAL6\n# scans: 5124\n\n\n\n\n\n\n\n\n\n=== station: .CW1\n# scans: 3244\n\n\n\n\n\n\n\n\n\n=== station: .CW2\n# scans: 3476\n\n\n\n\n\n\n\n\n\n=== station: .CW3\n# scans: 3757\n\n\n\n\n\n\n\n\n\n=== station: .CW4\n# scans: 5006\n\n\n\n\n\n\n\n\n\n=== station: .GP5\n# scans: 4612\n\n\n\n\n\n\n\n\n\n=== station: .KW1\n# scans: 3146\n\n\n\n\n\n\n\n\n\n=== station: .KW2\n# scans: 3512\n\n\n\n\n\n\n\n\n\n=== station: .KW4\n# scans: 4962\n\n\n\n\n\n\n\n\n\n=== station: .MR\n# scans: 4702\n\n\n\n\n\n\n\n\n\n=== station: .RP1\n# scans: 2899\n\n\n\n\n\n\n\n\n\n=== station: .RP2\n# scans: 3234\n\n\n\n\n\n\n\n\n\n=== station: .RP3\n# scans: 2977\n\n\n\n\n\n\n\n\n\n=== station: .RP4\n# scans: 4057\n\n\n\n\n\n\n\n\n\n=== station: .TB1\n# scans: 2999\n\n\n\n\n\n\n\n\n\n=== station: .TB10\n# scans: 9390\n\n\n\n\n\n\n\n\n\n=== station: .TB2\n# scans: 3360\n\n\n\n\n\n\n\n\n\n=== station: .TB3\n# scans: 3803\n\n\n\n\n\n\n\n\n\n=== station: .TB4\n# scans: 3603\n\n\n\n\n\n\n\n\n\n=== station: .TB5\n# scans: 5371\n\n\n\n\n\n\n\n\n\n=== station: .V1\n# scans: 2817\n\n\n\n\n\n\n\n\n\n=== station: .V2\n# scans: 4168\n\n\n\n\n\n\n\n\n\n=== station: .V3\n# scans: 5294\n\n\n\n\n\n\n\n\n\n=== station: .V4\n# scans: 4775\n\n\n\n\n\n\n\n\n\n=== station: .V5\n# scans: 4238\n\n\n\n\n\n\n\n\n\n=== station: .V6\n# scans: 4426\n\n\n\n\n\n\n\n\n\n=== station: .V7\n# scans: 5896\n\n\n\n\n\n\n\n\n\n=== station: .V8\n# scans: 5761\n\n\n\n\n\n\n\n\n\n=== station: .V9\n# scans: 4927\n\n\n\n\n\n\n\n\n\n=== station: .WS\n# scans: 3826\n\n\n\n\n\n\n\n\n\n\n\nplotting each cast in the first list\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # 1 is selecting only the first sublist\n  tryCatch({\n    plot(ctdDecimate(ctdTrim(cast)))\n  }, error = function(e){\n    print(e)\n  })\n}\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2410' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2635' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4250' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 10157' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3213' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 5044' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3332' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 6207' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4497' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3782' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2894' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2952' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3062' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2812' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 144' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2810' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 138' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 775' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 13' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2949' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4029' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4266' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4254' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3216' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2678' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 6110' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3459' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2845' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4106' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4335' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4708' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 5013' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 5509' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 5573' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 6866' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3502' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4069' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3768' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4155' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 275' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3212' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3500' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3810' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4241' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 5124' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3244' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3476' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3757' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 5006' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4612' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3146' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3512' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4962' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4702' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2899' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3234' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2977' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4057' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2999' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 9390' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3360' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3803' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3603' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 5371' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 2817' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4168' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 5294' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4775' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4238' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4426' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 5896' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 5761' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 4927' in coercion to 'logical(1)'&gt;\n\n\n\n\n\n\n\n\n\n&lt;simpleError in !is.null(x@metadata$station) && !is.na(x@metadata$station): 'length = 3826' in coercion to 'logical(1)'&gt;\n\n\n\n\nplotting other physical parameters for each cast\n# Loop through each CTD cast\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # Assuming each sublist contains only one relevant CTD object\n  tryCatch({\n    # Extract metadata for station name and cruise ID\n    station_name &lt;- cast@metadata$station[1]\n    cruise_id &lt;- cast@data$cruise_id[1]\n\n    # Generate a title with station name and cruise ID\n    overall_title &lt;- glue::glue(\"Station: {station_name}, Cruise ID: {cruise_id}\")\n\n    # Set margins: increase the outer margin for the title\n    par(oma = c(0, 0, 3, 0))  # Top outer margin increased for title\n\n    # Plotting function with specific parameters\n    oce::plot(\n      x = ctdDecimate(ctdTrim(cast)),\n      which = c(\n        \"sea_water_electrical_conductivity\",\n        \"descent_rate\", \"sound_velocity\",\n        \"sea_water_sigma_t\",\"altimeter\"\n      ),\n      main = \"\"  # No main title for individual subplots\n    )\n\n    # Place a single overall title at the top of the plot frame\n    mtext(overall_title, side = 3, line = 1, outer = TRUE, cex = 1.5)\n\n    # Reset outer margins to default\n    par(oma = c(0, 0, 0, 0))\n\n  }, error = function(e) {\n    print(e$message)  # Print any errors that occur during plotting\n  })\n}\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n\n\nplotting other nutrient parameters for each cast\n# Loop through each CTD cast\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # Assuming each sublist contains only one relevant CTD object\n  tryCatch({\n    # Extract metadata for station name and cruise ID\n    station_name &lt;- cast@metadata$station[1]\n    cruise_id &lt;- cast@data$cruise_id[1]\n\n    # Generate a title with station name and cruise ID\n    overall_title &lt;- glue::glue(\"Station: {station_name}, Cruise ID: {cruise_id}\")\n\n    # Set margins: increase the outer margin for the title\n    par(oma = c(0, 0, 3, 0))  # Top outer margin increased for title\n\n    # Plotting function with specific parameters\n    oce::plot(\n      x = ctdDecimate(ctdTrim(cast)),\n      which = c(\n        \"CDOM\", \"dissolved_oxygen\",\n        \"oxygen_saturation\",\n        \"chlorophyll_concentration\", \"chlorophyll_fluorescence\"\n      ),\n      main = \"\"  # No main title for individual subplots\n    )\n\n    # Place a single overall title at the top of the plot frame\n    mtext(overall_title, side = 3, line = 1, outer = TRUE, cex = 1.5)\n\n    # Reset outer margins to default\n    par(oma = c(0, 0, 0, 0))\n\n  }, error = function(e) {\n    print(e$message)  # Print any errors that occur during plotting\n  })\n}\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n[1] \"need finite 'xlim' values\"\n\n\n[1] \"need finite 'xlim' values\"\n\n\n\n\nplotting other optical parameters for each cast\n# Loop through each CTD cast\nfor (i in seq(ctd_FK)){\n  cast &lt;- ctd_FK[[i]]  # Assuming each sublist contains only one relevant CTD object\n  tryCatch({\n    # Extract metadata for station name and cruise ID\n    station_name &lt;- cast@metadata$station[1]\n    cruise_id &lt;- cast@data$cruise_id[1]\n\n    # Generate a title with station name and cruise ID\n    overall_title &lt;- glue::glue(\"Station: {station_name}, Cruise ID: {cruise_id}\")\n\n    # Set margins: increase the outer margin for the title\n    par(oma = c(0, 0, 3, 0))  # Top outer margin increased for title\n\n    # Plotting function with specific parameters\n    oce::plot(\n      x = ctdDecimate(ctdTrim(cast)),\n      which = c(\n        \"photosynthetically_available_radiation\",\n        \"beam_attenuation\",\"beam_transmission\"\n      ),\n      main = \"\"  # No main title for individual subplots\n    )\n\n    # Place a single overall title at the top of the plot frame\n    mtext(overall_title, side = 3, line = 1, outer = TRUE, cex = 1.5)\n\n    # Reset outer margins to default\n    par(oma = c(0, 0, 0, 0))\n\n  }, error = function(e) {\n    print(e$message)  # Print any errors that occur during plotting\n  })\n}\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n[1] \"need finite 'xlim' values\"\n\n\n\n\nloop through every cast, clean, & save\ncombined_df &lt;- data.frame()\nfor (i in seq(ctd_FK)){\n  tryCatch({\n    cast &lt;- ctd_FK[[i]]  # 1 is selecting only the first sublist\n    \n    # print(class(cast))\n    # clean cast \n    trimmed_cast &lt;- ctdTrim(cast)\n    decimated_cast &lt;- ctdDecimate(trimmed_cast, p = 0.5)  # binned to 0.5 m\n    \n    # convert to df\n    cast_df &lt;- as.data.frame(decimated_cast@data)\n    \n    # Add metadata\n    # assumes station ID and cruise ID the same for all & just uses 1st one\n    cast_df &lt;- mutate(\n      cast_df,\n      station = cast@data$station[1],\n      cruise_id = cast@data$cruise_id[1]\n    )\n  \n    # drop NA rows left by cleaning\n    cast_df &lt;- subset(cast_df, !is.na(scan))\n    \n    # Append the data to the combined dataframe\n    combined_df &lt;- rbind(combined_df, cast_df)\n  }, error = function(e){\n    print(glue(\"error in cast {cast@metadata$station[1]}\"))\n    print(e)\n  })\n}\n# Save to CSV\nfile_path &lt;- here(glue(\"data/cleaned/{cruise_id}.csv\"))\nwrite.csv(combined_df, file_path, row.names = FALSE)"
  }
]